{"ast":null,"code":"import { closest, addClass, select } from '@syncfusion/ej2-base';\nimport { extend, getValue, resetBlazorTemplate, updateBlazorTemplate, isBlazor } from '@syncfusion/ej2-base';\nimport { remove } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { EditRender } from '../renderer/edit-renderer';\nimport { BooleanEditCell } from '../renderer/boolean-edit-cell';\nimport { DropDownEditCell } from '../renderer/dropdown-edit-cell';\nimport { NumericEditCell } from '../renderer/numeric-edit-cell';\nimport { DefaultEditCell } from '../renderer/default-edit-cell';\nimport { InlineEdit } from './inline-edit';\nimport { BatchEdit } from './batch-edit';\nimport { DialogEdit } from './dialog-edit';\nimport { Dialog } from '@syncfusion/ej2-popups';\nimport { parentsUntil, getComplexFieldID, setComplexFieldID, getScrollBarWidth, setValidationRuels } from '../base/util';\nimport { FormValidator } from '@syncfusion/ej2-inputs';\nimport { DatePickerEditCell } from '../renderer/datepicker-edit-cell';\nimport { calculateRelativeBasedPosition } from '@syncfusion/ej2-popups';\nimport { TemplateEditCell } from '../renderer/template-edit-cell';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * The `Edit` module is used to handle editing actions.\n */\n\nvar Edit =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid editing module\n   * @hidden\n   */\n  function Edit(parent, serviceLocator) {\n    this.editType = {\n      'Inline': InlineEdit,\n      'Normal': InlineEdit,\n      'Batch': BatchEdit,\n      'Dialog': DialogEdit\n    };\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.l10n = this.serviceLocator.getService('localization');\n    this.addEventListener();\n    this.updateEditObj();\n    this.createAlertDlg();\n    this.createConfirmDlg();\n  }\n\n  Edit.prototype.updateColTypeObj = function () {\n    var cols = this.parent.columnModel;\n\n    for (var i = 0; i < cols.length; i++) {\n      if (this.parent.editSettings.template || cols[i].editTemplate) {\n        var templteCell = 'templateedit';\n        cols[i].edit = extend(new Edit.editCellType[templteCell](this.parent), cols[i].edit || {});\n      } else {\n        cols[i].edit = extend(new Edit.editCellType[cols[i].editType && Edit.editCellType[cols[i].editType] ? cols[i].editType : 'defaultedit'](this.parent, this.serviceLocator), cols[i].edit || {});\n      }\n    }\n\n    this.parent.log('primary_column_missing');\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  Edit.prototype.getModuleName = function () {\n    return 'edit';\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var newProp = e.properties;\n\n    for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      switch (prop) {\n        case 'allowAdding':\n        case 'allowDeleting':\n        case 'allowEditing':\n          if (gObj.editSettings.allowAdding || gObj.editSettings.allowEditing || gObj.editSettings.allowDeleting) {\n            this.initialEnd();\n          }\n\n          break;\n\n        case 'mode':\n          this.updateEditObj();\n          gObj.isEdit = false;\n          gObj.refresh();\n          break;\n      }\n    }\n  };\n\n  Edit.prototype.updateEditObj = function () {\n    if (this.editModule) {\n      this.editModule.destroy();\n    }\n\n    this.renderer = new EditRender(this.parent, this.serviceLocator);\n    this.editModule = new this.editType[this.parent.editSettings.mode](this.parent, this.serviceLocator, this.renderer);\n  };\n\n  Edit.prototype.initialEnd = function () {\n    this.updateColTypeObj();\n  };\n  /**\n   * Edits any bound record in the Grid by TR element.\n   * @param {HTMLTableRowElement} tr - Defines the table row to be edited.\n   */\n\n\n  Edit.prototype.startEdit = function (tr) {\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowEditing || gObj.isEdit || gObj.editSettings.mode === 'Batch') {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n\n    if (!gObj.getSelectedRows().length) {\n      if (!tr) {\n        this.showDialog('EditOperationAlert', this.alertDObj);\n        return;\n      }\n    } else if (!tr) {\n      tr = gObj.getSelectedRows()[0];\n    }\n\n    this.isLastRow = tr.rowIndex === this.parent.getContent().querySelector('tr:last-child').rowIndex;\n\n    if (tr.style.display === 'none') {\n      return;\n    }\n\n    this.editModule.startEdit(tr);\n\n    if (!isBlazor()) {\n      this.refreshToolbar();\n      gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n      this.parent.notify('start-edit', {});\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.checkLastRow = function (tr, args) {\n    var checkLastRow = this.isLastRow;\n\n    if (this.parent.height !== 'auto' && this.parent.editSettings.newRowPosition === 'Bottom' && args && args.requestType === 'add' && this.parent.height > this.parent.getContentTable().scrollHeight) {\n      addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowadded');\n    } else if (checkLastRow && tr && tr.classList) {\n      addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowcell');\n    }\n  };\n  /**\n   * Cancels edited state.\n   */\n\n\n  Edit.prototype.closeEdit = function () {\n    if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog && this.parent.element.querySelectorAll('.e-updatedtd').length) {\n      this.showDialog('CancelEdit', this.dialogObj);\n      return;\n    }\n\n    this.parent.element.classList.remove('e-editing');\n    this.editModule.closeEdit();\n\n    if (!isBlazor()) {\n      this.refreshToolbar();\n      this.parent.notify('close-edit', {});\n    }\n  };\n\n  Edit.prototype.refreshToolbar = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * To adds a new row at the top with the given data. When data is not passed, it will add empty rows.\n   * > `editSettings.allowEditing` should be true.\n   * @param {Object} data - Defines the new add record data.\n   * @param {number} index - Defines the row index to be added\n   */\n\n\n  Edit.prototype.addRecord = function (data, index) {\n    if (!this.parent.editSettings.allowAdding) {\n      return;\n    }\n\n    var args = {\n      startEdit: true\n    };\n\n    if (!data) {\n      this.parent.notify(events.virtualScrollAddActionBegin, args);\n    }\n\n    if (args.startEdit) {\n      this.parent.element.classList.add('e-editing');\n      this.editModule.addRecord(data, index);\n\n      if (!isBlazor()) {\n        this.refreshToolbar();\n        this.parent.notify('start-add', {});\n      }\n    }\n  };\n  /**\n   * Deletes a record with the given options. If fieldname and data are not given, the Grid will delete the selected record.\n   * > `editSettings.allowDeleting` should be true.\n   * @param {string} fieldname - Defines the primary key field name of the column.\n   * @param {Object} data - Defines the JSON data record to be deleted.\n   */\n\n\n  Edit.prototype.deleteRecord = function (fieldname, data) {\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowDeleting) {\n      return;\n    }\n\n    if (!data) {\n      if (!gObj.getSelectedRecords().length && isNullOrUndefined(gObj.commandDelIndex)) {\n        this.showDialog('DeleteOperationAlert', this.alertDObj);\n        return;\n      }\n    }\n\n    if (gObj.editSettings.showDeleteConfirmDialog) {\n      this.showDialog('ConfirmDelete', this.dialogObj);\n      return;\n    }\n\n    this.editModule.deleteRecord(fieldname, data);\n  };\n  /**\n   * Deletes a visible row by TR element.\n   * @param {HTMLTableRowElement} tr - Defines the table row element.\n   */\n\n\n  Edit.prototype.deleteRow = function (tr) {\n    this.deleteRowUid = tr.getAttribute('data-uid');\n    var rowObj = this.parent.getRowObjectFromUID(this.deleteRowUid);\n\n    if (!isNullOrUndefined(rowObj)) {\n      this.deleteRecord(null, rowObj.data);\n    }\n  };\n  /**\n   * If Grid is in editable state, you can save a record by invoking endEdit.\n   */\n\n\n  Edit.prototype.endEdit = function () {\n    if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog && (isNullOrUndefined(this.formObj) || this.formObj.validate())) {\n      this.parent.editModule.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n\n      if (isNullOrUndefined(this.formObj) || this.formObj.validate()) {\n        this.showDialog('BatchSaveConfirm', this.dialogObj);\n        return;\n      }\n    }\n\n    this.endEditing();\n  };\n  /**\n   * To update the specified cell by given value without changing into edited state.\n   * @param {number} rowIndex Defines the row index.\n   * @param {string} field Defines the column field.\n   * @param {string | number | boolean | Date} value - Defines the value to be changed.\n   */\n\n\n  Edit.prototype.updateCell = function (rowIndex, field, value) {\n    this.editModule.updateCell(rowIndex, field, value);\n  };\n  /**\n   * To update the specified row by given values without changing into edited state.\n   * @param {number} index Defines the row index.\n   * @param {Object} data Defines the data object to be updated.\n   */\n\n\n  Edit.prototype.updateRow = function (index, data) {\n    this.editModule.updateRow(index, data);\n  };\n  /**\n   * Resets added, edited, and deleted records in the batch mode.\n   */\n\n\n  Edit.prototype.batchCancel = function () {\n    this.closeEdit();\n  };\n  /**\n   * Bulk saves added, edited, and deleted records in the batch mode.\n   */\n\n\n  Edit.prototype.batchSave = function () {\n    this.endEdit();\n  };\n  /**\n   * Changes a particular cell into edited state based on the row index and field name provided in the `batch` mode.\n   * @param {number} index - Defines row index to edit a particular cell.\n   * @param {string} field - Defines the field name of the column to perform batch edit.\n   */\n\n\n  Edit.prototype.editCell = function (index, field) {\n    this.editModule.editCell(index, field);\n  };\n  /**\n   * Checks the status of validation at the time of editing. If validation is passed, it returns true.\n   * @return {boolean}\n   */\n\n\n  Edit.prototype.editFormValidate = function () {\n    if (this.formObj) {\n      return this.formObj.validate();\n    }\n\n    return false;\n  };\n  /**\n   * Gets the added, edited,and deleted data before bulk save to the DataSource in batch mode.\n   * @return {Object}\n   */\n\n\n  Edit.prototype.getBatchChanges = function () {\n    return this.editModule.getBatchChanges ? this.editModule.getBatchChanges() : {};\n  };\n  /**\n   * Gets the current value of the edited component.\n   */\n\n\n  Edit.prototype.getCurrentEditCellData = function () {\n    var obj = this.getCurrentEditedData(this.formObj.element, {});\n    return obj[Object.keys(obj)[0]];\n  };\n  /**\n   * Saves the cell that is currently edited. It does not save the value to the DataSource.\n   */\n\n\n  Edit.prototype.saveCell = function () {\n    this.editModule.saveCell();\n  };\n\n  Edit.prototype.endEditing = function () {\n    this.parent.element.classList.remove('e-editing');\n    this.editModule.endEdit();\n    this.refreshToolbar();\n  };\n\n  Edit.prototype.showDialog = function (content, obj) {\n    obj.content = '<div>' + this.l10n.getConstant(content) + '</div>';\n    obj.dataBind();\n    obj.show();\n  };\n\n  Edit.prototype.getValueFromType = function (col, value) {\n    var val = value;\n\n    switch (col.type) {\n      case 'number':\n        val = !isNaN(parseFloat(value)) ? parseFloat(value) : null;\n        break;\n\n      case 'boolean':\n        if (col.editType !== 'booleanedit') {\n          val = value === this.l10n.getConstant('True') || value === true ? true : false;\n        }\n\n        break;\n\n      case 'date':\n      case 'datetime':\n        if (col.editType !== 'datepickeredit' && col.editType !== 'datetimepickeredit' && value && value.length) {\n          val = new Date(value);\n        } else if (value === '') {\n          val = null;\n        }\n\n        break;\n    }\n\n    return val;\n  };\n\n  Edit.prototype.destroyToolTip = function () {\n    var elements = [].slice.call(this.parent.element.querySelectorAll('.e-griderror'));\n\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n      var elem = elements_1[_i];\n      remove(elem);\n    }\n\n    this.parent.getContent().firstElementChild.style.position = 'relative';\n  };\n\n  Edit.prototype.createConfirmDlg = function () {\n    this.dialogObj = this.dlgWidget([{\n      click: this.dlgOk.bind(this),\n      buttonModel: {\n        content: this.l10n.getConstant('OKButton'),\n        cssClass: 'e-primary',\n        isPrimary: true\n      }\n    }, {\n      click: this.dlgCancel.bind(this),\n      buttonModel: {\n        cssClass: 'e-flat',\n        content: this.l10n.getConstant('CancelButton')\n      }\n    }], 'EditConfirm');\n  };\n\n  Edit.prototype.createAlertDlg = function () {\n    this.alertDObj = this.dlgWidget([{\n      click: this.alertClick.bind(this),\n      buttonModel: {\n        content: this.l10n.getConstant('OKButton'),\n        cssClass: 'e-flat',\n        isPrimary: true\n      }\n    }], 'EditAlert');\n  };\n\n  Edit.prototype.alertClick = function () {\n    this.alertDObj.hide();\n  };\n\n  Edit.prototype.dlgWidget = function (btnOptions, name) {\n    var div = this.parent.createElement('div', {\n      id: this.parent.element.id + name\n    });\n    this.parent.element.appendChild(div);\n    var options = {\n      showCloseIcon: false,\n      isModal: true,\n      visible: false,\n      closeOnEscape: true,\n      target: this.parent.element,\n      width: '320px',\n      animationSettings: {\n        effect: 'None'\n      }\n    };\n    options.buttons = btnOptions;\n    var obj = new Dialog(options);\n    var isStringTemplate = 'isStringTemplate';\n    obj[isStringTemplate] = true;\n    obj.appendTo(div);\n    return obj;\n  };\n\n  Edit.prototype.dlgCancel = function () {\n    this.parent.focusModule.clearIndicator();\n    this.parent.focusModule.restoreFocus();\n    this.dialogObj.hide();\n  };\n\n  Edit.prototype.dlgOk = function (e) {\n    switch (this.dialogObj.element.querySelector('.e-dlg-content').firstElementChild.innerText) {\n      case this.l10n.getConstant('ConfirmDelete'):\n        this.editModule.deleteRecord();\n        break;\n\n      case this.l10n.getConstant('CancelEdit'):\n        this.editModule.closeEdit();\n        break;\n\n      case this.l10n.getConstant('BatchSaveConfirm'):\n        this.endEditing();\n        break;\n\n      case this.l10n.getConstant('BatchSaveLostChanges'):\n        if (this.parent.editSettings.mode === 'Batch') {\n          this.editModule.addCancelWhilePaging();\n\n          if (isBlazor() && this.parent.isServerRendered) {\n            this.editModule.closeEdit();\n          }\n        }\n\n        this.executeAction();\n        break;\n    }\n\n    this.dlgCancel();\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.initialEnd, this.initialEnd, this);\n    this.parent.on(events.keyPressed, this.keyPressHandler, this);\n    this.parent.on(events.autoCol, this.updateColTypeObj, this);\n    this.parent.on(events.tooltipDestroy, this.destroyToolTip, this);\n    this.parent.on(events.preventBatch, this.preventBatch, this);\n    this.parent.on(events.destroyForm, this.destroyForm, this);\n    this.actionBeginFunction = this.onActionBegin.bind(this);\n    this.actionCompleteFunction = this.actionComplete.bind(this);\n    this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n    this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n    this.parent.off(events.initialEnd, this.initialEnd);\n    this.parent.off(events.keyPressed, this.keyPressHandler);\n    this.parent.off(events.autoCol, this.updateColTypeObj);\n    this.parent.off(events.tooltipDestroy, this.destroyToolTip);\n    this.parent.off(events.preventBatch, this.preventBatch);\n    this.parent.off(events.destroyForm, this.destroyForm);\n    this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n    this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n  };\n\n  Edit.prototype.actionComplete = function (e) {\n    var actions = ['add', 'beginEdit', 'save', 'delete', 'cancel'];\n\n    if (actions.indexOf(e.requestType) < 0) {\n      this.parent.isEdit = false;\n    }\n\n    if (e.requestType === 'batchsave') {\n      this.parent.focusModule.restoreFocus();\n    }\n\n    this.refreshToolbar();\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.getCurrentEditedData = function (form, editedData) {\n    var gObj = this.parent;\n\n    if (gObj.editSettings.template) {\n      var elements = [].slice.call(form.elements);\n\n      for (var k = 0; k < elements.length; k++) {\n        if (elements[k].hasAttribute('name') && elements[k].className !== 'e-multi-hidden' || elements[k].classList.contains('e-multiselect')) {\n          var field = elements[k].hasAttribute('name') ? setComplexFieldID(elements[k].getAttribute('name')) : setComplexFieldID(elements[k].getAttribute('id'));\n          var column = gObj.getColumnByField(field) || {\n            field: field,\n            type: elements[k].getAttribute('type')\n          };\n          var value = void 0;\n\n          if (column.type === 'checkbox' || column.type === 'boolean') {\n            value = elements[k].checked;\n          } else if (elements[k].value) {\n            value = elements[k].value;\n\n            if (elements[k].ej2_instances && elements[k].ej2_instances.length && !isNullOrUndefined(elements[k].ej2_instances[0].value)) {\n              elements[k].blur();\n              value = elements[k].ej2_instances[0].value;\n\n              if ((column.type === 'date' || column.type === 'dateTime' || column.type === 'datetime') && elements[k].ej2_instances[0].isServerRendered) {\n                value = elements[k].value;\n              }\n            }\n          } else if (elements[k].ej2_instances) {\n            value = elements[k].ej2_instances[0].value;\n          }\n\n          if (column.edit && typeof column.edit.read === 'string') {\n            value = getValue(column.edit.read, window)(elements[k], value);\n          } else if (column.edit && column.edit.read) {\n            value = column.edit.read(elements[k], value);\n          }\n\n          value = gObj.editModule.getValueFromType(column, value);\n\n          if (elements[k].type === 'radio') {\n            if (elements[k].checked) {\n              DataUtil.setValue(column.field, value, editedData);\n            }\n          } else {\n            DataUtil.setValue(column.field, value, editedData);\n          }\n        }\n      }\n\n      return editedData;\n    }\n\n    var col = gObj.columnModel.filter(function (col) {\n      return col.editTemplate;\n    });\n\n    for (var j = 0; j < col.length; j++) {\n      if (form[getComplexFieldID(col[j].field)]) {\n        var inputElements = [].slice.call(form[getComplexFieldID(col[j].field)]);\n        inputElements = inputElements.length ? inputElements : [form[getComplexFieldID(col[j].field)]];\n        var temp = inputElements.filter(function (e) {\n          return !isNullOrUndefined(e.ej2_instances);\n        });\n\n        if (temp.length === 0) {\n          temp = inputElements.filter(function (e) {\n            return e.hasAttribute('name');\n          });\n        }\n\n        for (var k = 0; k < temp.length; k++) {\n          var value = this.getValue(col[j], temp[k], editedData);\n          DataUtil.setValue(col[j].field, value, editedData);\n        }\n      }\n    }\n\n    var inputs = [].slice.call(form.querySelectorAll('.e-field'));\n\n    for (var i = 0, len = inputs.length; i < len; i++) {\n      var col_1 = gObj.getColumnByUid(inputs[i].getAttribute('e-mappinguid'));\n\n      if (col_1 && col_1.field) {\n        var value = this.getValue(col_1, inputs[i], editedData);\n        DataUtil.setValue(col_1.field, value, editedData);\n      }\n    }\n\n    return editedData;\n  };\n\n  Edit.prototype.getValue = function (col, input, editedData) {\n    var value = input.ej2_instances && !(isBlazor() && input.ej2_instances[0].isServerRendered && (col.type === 'date' || col.type === 'datetime')) ? input.ej2_instances[0].value : input.value;\n    var gObj = this.parent;\n    var temp = col.edit.read;\n\n    if (col.type === 'checkbox' || col.type === 'boolean') {\n      value = input.checked;\n    }\n\n    if (typeof temp === 'string') {\n      temp = getValue(temp, window);\n      value = gObj.editModule.getValueFromType(col, temp(input, value));\n    } else {\n      value = gObj.editModule.getValueFromType(col, col.edit.read(input, value));\n    }\n\n    if (isNullOrUndefined(editedData[col.field]) && value === '') {\n      value = editedData[col.field];\n    }\n\n    return value;\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.onActionBegin = function (e) {\n    if (e.requestType === 'columnstate' && this.parent.isEdit && this.parent.editSettings.mode !== 'Batch') {\n      this.closeEdit();\n    } else {\n      var editRow = this.parent.element.querySelector('.e-editedrow');\n\n      if (editRow && this.parent.frozenRows && e.requestType === 'virtualscroll' && parseInt(parentsUntil(editRow, 'e-row').getAttribute('aria-rowindex'), 10) < this.parent.frozenRows) {\n        return;\n      }\n\n      var restrictedRequestTypes = ['filterafteropen', 'filterbeforeopen', 'filterchoicerequest', 'save', 'infiniteScroll'];\n\n      if (this.parent.editSettings.mode !== 'Batch' && this.formObj && !this.formObj.isDestroyed && restrictedRequestTypes.indexOf(e.requestType) === -1 && !e.cancel) {\n        this.destroyWidgets();\n        this.destroyForm();\n      }\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.destroyWidgets = function (cols) {\n    var gObj = this.parent;\n\n    if (gObj.editSettings.template) {\n      this.parent.destroyTemplate(['editSettingsTemplate']);\n\n      if (this.parent.isReact) {\n        this.parent.renderTemplates();\n      }\n    }\n\n    cols = cols ? cols : this.parent.getVisibleColumns();\n\n    if (cols.some(function (column) {\n      return !isNullOrUndefined(column.editTemplate);\n    })) {\n      this.parent.destroyTemplate(['editTemplate']);\n\n      if (this.parent.isReact) {\n        this.parent.renderTemplates();\n      }\n    }\n\n    for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n      var col = cols_1[_i];\n      var temp = col.edit.destroy;\n\n      if (isBlazor() && col.editTemplate) {\n        resetBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate');\n        updateBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate', col, false);\n      }\n\n      if (col.edit.destroy) {\n        if (typeof temp === 'string') {\n          temp = getValue(temp, window);\n          temp();\n        } else {\n          col.edit.destroy();\n        }\n      }\n    }\n\n    var elements = [].slice.call(this.formObj.element.elements);\n\n    for (var i = 0; i < elements.length; i++) {\n      if (elements[i].hasAttribute('name')) {\n        if (elements[i].ej2_instances && elements[i].ej2_instances.length && !elements[i].ej2_instances[0].isDestroyed) {\n          elements[i].ej2_instances[0].destroy();\n        }\n      }\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.destroyForm = function () {\n    this.destroyToolTip();\n\n    if (this.formObj && !this.formObj.isDestroyed) {\n      this.formObj.destroy();\n    }\n\n    this.destroyToolTip();\n  };\n  /**\n   * To destroy the editing.\n   * @return {void}\n   * @hidden\n   */\n\n\n  Edit.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement) {\n      return;\n    }\n\n    var hasGridChild = gridElement.querySelector('.e-gridheader') && gridElement.querySelector('.e-gridcontent') ? true : false;\n\n    if (hasGridChild) {\n      this.destroyForm();\n    }\n\n    this.removeEventListener();\n    var elem = this.dialogObj.element;\n\n    if (elem.childElementCount > 0) {\n      this.dialogObj.destroy();\n      remove(elem);\n    }\n\n    elem = this.alertDObj.element;\n\n    if (elem.childElementCount > 0) {\n      this.alertDObj.destroy();\n      remove(elem);\n    }\n\n    if (!hasGridChild) {\n      return;\n    }\n\n    if (this.editModule) {\n      this.editModule.destroy();\n    }\n  };\n\n  Edit.prototype.keyPressHandler = function (e) {\n    switch (e.action) {\n      case 'insert':\n        this.addRecord();\n        break;\n\n      case 'delete':\n        if ((e.target.tagName !== 'INPUT' || e.target.classList.contains('e-checkselect')) && !document.querySelector('.e-popup-open')) {\n          this.deleteRecord();\n        }\n\n        break;\n\n      case 'f2':\n        this.startEdit();\n        break;\n\n      case 'enter':\n        if (!parentsUntil(e.target, 'e-unboundcelldiv') && this.parent.editSettings.mode !== 'Batch' && (parentsUntil(e.target, 'e-gridcontent') || this.parent.frozenRows && parentsUntil(e.target, 'e-headercontent')) && !document.querySelectorAll('.e-popup-open').length) {\n          e.preventDefault();\n          this.endEdit();\n        }\n\n        break;\n\n      case 'escape':\n        if (this.parent.isEdit) {\n          if (this.parent.editSettings.mode === 'Batch') {\n            this.editModule.escapeCellEdit();\n          } else {\n            this.closeEdit();\n          }\n        }\n\n        break;\n    }\n  };\n\n  Edit.prototype.preventBatch = function (args) {\n    this.preventObj = args;\n    this.showDialog('BatchSaveLostChanges', this.dialogObj);\n  };\n\n  Edit.prototype.executeAction = function () {\n    this.preventObj.handler.call(this.preventObj.instance, this.preventObj.arg1, this.preventObj.arg2, this.preventObj.arg3, this.preventObj.arg4, this.preventObj.arg5, this.preventObj.arg6, this.preventObj.arg7, this.preventObj.arg8);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.applyFormValidation = function (cols) {\n    var gObj = this.parent;\n    var frzCols = gObj.isFrozenGrid();\n    var isInline = this.parent.editSettings.mode === 'Normal';\n    var idx = this.parent.getFrozenMode() === 'Right' && isInline ? 1 : 0;\n    var form = this.parent.editSettings.mode !== 'Dialog' ? gObj.element.querySelectorAll('.e-gridform')[idx] : select('#' + gObj.element.id + '_dialogEdit_wrapper .e-gridform', document);\n    var index = this.parent.getFrozenMode() === 'Right' && isInline ? 0 : 1;\n    var mForm = gObj.element.querySelectorAll('.e-gridform')[index];\n    var rules = {};\n    var mRules = {};\n    var frRules = {};\n    cols = cols ? cols : gObj.getColumns();\n\n    for (var i = 0; i < cols.length; i++) {\n      if (!cols[i].visible) {\n        continue;\n      }\n\n      if (isBlazor() && cols[i].editTemplate) {\n        continue;\n      }\n\n      if (cols[i].validationRules) {\n        setValidationRuels(cols[i], index, rules, mRules, frRules, cols.length);\n      }\n    }\n\n    if (frzCols && this.parent.editSettings.mode !== 'Dialog') {\n      this.parent.editModule.mFormObj = this.createFormObj(mForm, mRules);\n\n      if (this.parent.getFrozenMode() === 'Left-Right') {\n        var frForm = gObj.element.querySelectorAll('.e-gridform')[2];\n        this.parent.editModule.frFormObj = this.createFormObj(frForm, frRules);\n      }\n    } else {\n      rules = extend(rules, mRules, frRules);\n    }\n\n    if (isBlazor() && this.parent.editSettings.template) {\n      this.parent.editModule.formObj = this.createFormObj(form, {});\n    } else {\n      this.parent.editModule.formObj = this.createFormObj(form, rules);\n    }\n  };\n\n  Edit.prototype.createFormObj = function (form, rules) {\n    var _this = this;\n\n    return new FormValidator(form, {\n      rules: rules,\n      locale: this.parent.locale,\n      validationComplete: function (args) {\n        _this.validationComplete(args);\n      },\n      customPlacement: function (inputElement, error) {\n        var uid = inputElement.getAttribute('e-mappinguid');\n        var args = {\n          column: _this.parent.getColumnByUid(uid),\n          error: error,\n          inputElement: inputElement,\n          value: inputElement.value\n        };\n\n        _this.valErrorPlacement(inputElement, error);\n\n        _this.parent.notify(events.valCustomPlacement, args);\n      }\n    });\n  };\n\n  Edit.prototype.valErrorPlacement = function (inputElement, error) {\n    if (this.parent.isEdit) {\n      var id = error.getAttribute('for');\n      var elem = this.getElemTable(inputElement).querySelector('#' + id + '_Error');\n\n      if (!elem) {\n        this.createTooltip(inputElement, error, id, '');\n      } else {\n        elem.querySelector('.e-tip-content').innerHTML = error.outerHTML;\n      }\n    }\n  };\n\n  Edit.prototype.getElemTable = function (inputElement) {\n    var isFHdr;\n\n    if (this.parent.editSettings.mode !== 'Dialog') {\n      isFHdr = this.parent.frozenRows && this.parent.frozenRows > (parseInt(closest(inputElement, '.e-row').getAttribute('aria-rowindex'), 10) || 0);\n    }\n\n    return this.parent.editSettings.mode !== 'Dialog' ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() : select('#' + this.parent.element.id + '_dialogEdit_wrapper', document);\n  };\n\n  Edit.prototype.resetElemPosition = function (elem, args) {\n    if (args.element.offsetWidth < elem.offsetWidth) {\n      elem.style.left = args.element.getBoundingClientRect().left - (elem.offsetWidth - args.element.offsetWidth) / 2 + 'px';\n    }\n  };\n\n  Edit.prototype.validationComplete = function (args) {\n    if (this.parent.isEdit) {\n      var elem = this.getElemTable(args.element).querySelector('#' + args.inputName + '_Error');\n\n      if (elem) {\n        if (args.status === 'failure') {\n          elem.style.display = '';\n          this.resetElemPosition(elem, args);\n        } else {\n          elem.style.display = 'none';\n        }\n      }\n    }\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  Edit.prototype.createTooltip = function (element, error, name, display) {\n    var column = this.parent.getColumnByField(name);\n    var formObj = this.parent.getFrozenMode() === 'Left-Right' && this.parent.editSettings.mode === 'Normal' && column.getFreezeTableName() === 'frozen-right' ? this.frFormObj.element : this.formObj.element;\n    var gcontent = this.parent.getContent().firstElementChild;\n    var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount() || this.parent.getFrozenRightColumnsCount();\n\n    if (frzCols) {\n      gcontent = this.parent.getMovableVirtualContent();\n    }\n\n    var isScroll = gcontent.scrollHeight > gcontent.clientHeight || gcontent.scrollWidth > gcontent.clientWidth;\n    var isInline = this.parent.editSettings.mode !== 'Dialog';\n    var td = closest(element, '.e-rowcell');\n    var row = closest(element, '.e-row');\n    var fCont = this.parent.getContent().querySelector('.e-frozencontent');\n    var isFHdr;\n    var isFHdrLastRow = false;\n    var validationForBottomRowPos;\n    var isBatchModeLastRow = false;\n    var viewPortRowCount = Math.round(this.parent.getContent().clientHeight / this.parent.getRowHeight()) - 1;\n    var rows = !fCont ? [].slice.call(this.parent.getContent().querySelectorAll('.e-row')) : [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('.e-row'));\n\n    if (this.parent.editSettings.mode === 'Batch') {\n      if (viewPortRowCount > 1 && rows.length >= viewPortRowCount && rows[rows.length - 1].getAttribute('aria-rowindex') === row.getAttribute('aria-rowindex')) {\n        isBatchModeLastRow = true;\n      }\n    }\n\n    if (isInline) {\n      if (this.parent.frozenRows) {\n        var fHeraderRows = frzCols ? this.parent.getFrozenVirtualHeader().querySelector('tbody').children : this.parent.getHeaderTable().querySelector('tbody').children;\n        isFHdr = fHeraderRows.length > (parseInt(row.getAttribute('aria-rowindex'), 10) || 0);\n        isFHdrLastRow = isFHdr && parseInt(row.getAttribute('aria-rowindex'), 10) === fHeraderRows.length - 1;\n      }\n\n      if (isFHdrLastRow || viewPortRowCount > 1 && rows.length >= viewPortRowCount && (this.parent.editSettings.newRowPosition === 'Bottom' && this.editModule.args && this.editModule.args.requestType === 'add' || td.classList.contains('e-lastrowcell') && !row.classList.contains('e-addedrow')) || isBatchModeLastRow) {\n        validationForBottomRowPos = true;\n      }\n    }\n\n    var table = isInline ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() : select('#' + this.parent.element.id + '_dialogEdit_wrapper .e-dlg-content', document);\n    var client = table.getBoundingClientRect();\n    var left = isInline ? this.parent.element.getBoundingClientRect().left : client.left;\n    var input = closest(element, 'td');\n    var inputClient = input ? input.getBoundingClientRect() : element.parentElement.getBoundingClientRect();\n    var div = this.parent.createElement('div', {\n      className: 'e-tooltip-wrap e-lib e-control e-popup e-griderror',\n      id: name + '_Error',\n      styles: 'display:' + display + ';top:' + ((isFHdr ? inputClient.top + inputClient.height : inputClient.bottom - client.top - (frzCols ? fCont.scrollTop : 0)) + table.scrollTop + 9) + 'px;left:' + (inputClient.left - left + table.scrollLeft + inputClient.width / 2) + 'px;' + 'max-width:' + inputClient.width + 'px;text-align:center;'\n    });\n\n    if (isInline && client.left < left) {\n      div.style.left = parseInt(div.style.left, 10) - client.left + left + 'px';\n    }\n\n    var content = this.parent.createElement('div', {\n      className: 'e-tip-content'\n    });\n    content.appendChild(error);\n    var arrow;\n\n    if (validationForBottomRowPos) {\n      arrow = this.parent.createElement('div', {\n        className: 'e-arrow-tip e-tip-bottom'\n      });\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-outer e-tip-bottom'\n      }));\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-inner e-tip-bottom'\n      }));\n    } else {\n      arrow = this.parent.createElement('div', {\n        className: 'e-arrow-tip e-tip-top'\n      });\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-outer e-tip-top'\n      }));\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-inner e-tip-top'\n      }));\n    }\n\n    div.appendChild(content);\n    div.appendChild(arrow);\n\n    if ((frzCols || this.parent.frozenRows) && this.parent.editSettings.mode !== 'Dialog') {\n      var getEditCell = this.parent.editSettings.mode === 'Normal' ? closest(element, '.e-editcell') : closest(element, '.e-table');\n      getEditCell.style.position = 'relative';\n      div.style.position = 'absolute';\n\n      if (this.parent.editSettings.mode === 'Batch' || closest(element, '.e-frozencontent') || closest(element, '.e-frozenheader') || this.parent.frozenRows && !frzCols) {\n        formObj.appendChild(div);\n      } else {\n        this.mFormObj.element.appendChild(div);\n      }\n    } else {\n      this.formObj.element.appendChild(div);\n    }\n\n    if (!validationForBottomRowPos && isInline && gcontent.getBoundingClientRect().bottom < inputClient.bottom + inputClient.height) {\n      gcontent.scrollTop = gcontent.scrollTop + div.offsetHeight + arrow.scrollHeight;\n    }\n\n    var lineHeight = parseInt(document.defaultView.getComputedStyle(div, null).getPropertyValue('font-size'), 10);\n\n    if (div.getBoundingClientRect().width < inputClient.width && div.querySelector('label').getBoundingClientRect().height / (lineHeight * 1.2) >= 2) {\n      div.style.width = div.style.maxWidth;\n    }\n\n    if ((frzCols || this.parent.frozenRows) && this.parent.editSettings.mode !== 'Dialog') {\n      div.style.left = input.offsetLeft + (input.offsetWidth / 2 - div.offsetWidth / 2) + 'px';\n    } else {\n      div.style.left = parseInt(div.style.left, 10) - div.offsetWidth / 2 + 'px';\n    }\n\n    if (isInline && !isScroll && !this.parent.allowPaging || frzCols || this.parent.frozenRows) {\n      gcontent.style.position = 'static';\n      var pos = calculateRelativeBasedPosition(input, div);\n      div.style.top = pos.top + inputClient.height + 9 + 'px';\n    }\n\n    if (validationForBottomRowPos) {\n      if (isScroll && !frzCols && this.parent.height !== 'auto' && !this.parent.frozenRows && !this.parent.enableVirtualization) {\n        var scrollWidth = gcontent.scrollWidth > gcontent.offsetWidth ? getScrollBarWidth() : 0;\n        div.style.bottom = this.parent.height - gcontent.querySelector('table').offsetHeight - scrollWidth + inputClient.height + 9 + 'px';\n      } else {\n        div.style.bottom = inputClient.height + 9 + 'px';\n      }\n\n      if (rows.length < viewPortRowCount && this.parent.editSettings.newRowPosition === 'Bottom' && this.editModule.args && this.editModule.args.requestType === 'add') {\n        var rowsCount = this.parent.frozenRows ? this.parent.frozenRows + (rows.length - 1) : rows.length - 1;\n        var rowsHeight = rowsCount * this.parent.getRowHeight();\n        var position = this.parent.getContent().clientHeight - rowsHeight;\n        div.style.bottom = position + 9 + 'px';\n      }\n\n      div.style.top = null;\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.checkColumnIsGrouped = function (col) {\n    return !col.visible && !(this.parent.groupSettings.columns.indexOf(col.field) > -1);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.AddEditors = function (editors) {\n    Edit.editCellType = extend(Edit.editCellType, editors);\n  };\n\n  Edit.editCellType = {\n    'dropdownedit': DropDownEditCell,\n    'numericedit': NumericEditCell,\n    'datepickeredit': DatePickerEditCell,\n    'datetimepickeredit': DatePickerEditCell,\n    'booleanedit': BooleanEditCell,\n    'defaultedit': DefaultEditCell,\n    'templateedit': TemplateEditCell\n  };\n  return Edit;\n}();\n\nexport { Edit };","map":{"version":3,"sources":["C:/Users/appsk/Documents/Projects/PredictiveMaintenance/React PDM/env/frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/edit.js"],"names":["closest","addClass","select","extend","getValue","resetBlazorTemplate","updateBlazorTemplate","isBlazor","remove","isNullOrUndefined","events","EditRender","BooleanEditCell","DropDownEditCell","NumericEditCell","DefaultEditCell","InlineEdit","BatchEdit","DialogEdit","Dialog","parentsUntil","getComplexFieldID","setComplexFieldID","getScrollBarWidth","setValidationRuels","FormValidator","DatePickerEditCell","calculateRelativeBasedPosition","TemplateEditCell","DataUtil","Edit","parent","serviceLocator","editType","l10n","getService","addEventListener","updateEditObj","createAlertDlg","createConfirmDlg","prototype","updateColTypeObj","cols","columnModel","i","length","editSettings","template","editTemplate","templteCell","edit","editCellType","log","getModuleName","onPropertyChanged","e","module","gObj","newProp","properties","_i","_a","Object","keys","prop","allowAdding","allowEditing","allowDeleting","initialEnd","isEdit","refresh","editModule","destroy","renderer","mode","startEdit","tr","element","classList","add","getSelectedRows","showDialog","alertDObj","isLastRow","rowIndex","getContent","querySelector","style","display","refreshToolbar","notify","checkLastRow","args","height","newRowPosition","requestType","getContentTable","scrollHeight","querySelectorAll","closeEdit","showConfirmDialog","dialogObj","toolbarRefresh","addRecord","data","index","virtualScrollAddActionBegin","deleteRecord","fieldname","getSelectedRecords","commandDelIndex","showDeleteConfirmDialog","deleteRow","deleteRowUid","getAttribute","rowObj","getRowObjectFromUID","endEdit","formObj","validate","saveCell","editNextValCell","endEditing","updateCell","field","value","updateRow","batchCancel","batchSave","editCell","editFormValidate","getBatchChanges","getCurrentEditCellData","obj","getCurrentEditedData","content","getConstant","dataBind","show","getValueFromType","col","val","type","isNaN","parseFloat","Date","destroyToolTip","elements","slice","call","elements_1","elem","firstElementChild","position","dlgWidget","click","dlgOk","bind","buttonModel","cssClass","isPrimary","dlgCancel","alertClick","hide","btnOptions","name","div","createElement","id","appendChild","options","showCloseIcon","isModal","visible","closeOnEscape","target","width","animationSettings","effect","buttons","isStringTemplate","appendTo","focusModule","clearIndicator","restoreFocus","innerText","addCancelWhilePaging","isServerRendered","executeAction","isDestroyed","on","inBoundModelChanged","keyPressed","keyPressHandler","autoCol","tooltipDestroy","preventBatch","destroyForm","actionBeginFunction","onActionBegin","actionCompleteFunction","actionComplete","actionBegin","removeEventListener","off","actions","indexOf","form","editedData","k","hasAttribute","className","contains","column","getColumnByField","checked","ej2_instances","blur","read","window","setValue","filter","j","inputElements","temp","inputs","len","col_1","getColumnByUid","input","editRow","frozenRows","parseInt","restrictedRequestTypes","cancel","destroyWidgets","destroyTemplate","isReact","renderTemplates","getVisibleColumns","some","cols_1","uid","gridElement","hasGridChild","childElementCount","action","tagName","document","preventDefault","escapeCellEdit","preventObj","handler","instance","arg1","arg2","arg3","arg4","arg5","arg6","arg7","arg8","applyFormValidation","frzCols","isFrozenGrid","isInline","idx","getFrozenMode","mForm","rules","mRules","frRules","getColumns","validationRules","mFormObj","createFormObj","frForm","frFormObj","_this","locale","validationComplete","customPlacement","inputElement","error","valErrorPlacement","valCustomPlacement","getElemTable","createTooltip","innerHTML","outerHTML","isFHdr","getHeaderTable","resetElemPosition","offsetWidth","left","getBoundingClientRect","inputName","status","getFreezeTableName","gcontent","getFrozenColumns","getFrozenLeftColumnsCount","getFrozenRightColumnsCount","getMovableVirtualContent","isScroll","clientHeight","scrollWidth","clientWidth","td","row","fCont","isFHdrLastRow","validationForBottomRowPos","isBatchModeLastRow","viewPortRowCount","Math","round","getRowHeight","rows","getFrozenVirtualContent","fHeraderRows","getFrozenVirtualHeader","children","table","client","inputClient","parentElement","styles","top","bottom","scrollTop","scrollLeft","arrow","getEditCell","offsetHeight","lineHeight","defaultView","getComputedStyle","getPropertyValue","maxWidth","offsetLeft","allowPaging","pos","enableVirtualization","rowsCount","rowsHeight","checkColumnIsGrouped","groupSettings","columns","AddEditors","editors"],"mappings":"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","sourcesContent":["import { closest, addClass, select } from '@syncfusion/ej2-base';\nimport { extend, getValue, resetBlazorTemplate, updateBlazorTemplate, isBlazor } from '@syncfusion/ej2-base';\nimport { remove } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { EditRender } from '../renderer/edit-renderer';\nimport { BooleanEditCell } from '../renderer/boolean-edit-cell';\nimport { DropDownEditCell } from '../renderer/dropdown-edit-cell';\nimport { NumericEditCell } from '../renderer/numeric-edit-cell';\nimport { DefaultEditCell } from '../renderer/default-edit-cell';\nimport { InlineEdit } from './inline-edit';\nimport { BatchEdit } from './batch-edit';\nimport { DialogEdit } from './dialog-edit';\nimport { Dialog } from '@syncfusion/ej2-popups';\nimport { parentsUntil, getComplexFieldID, setComplexFieldID, getScrollBarWidth, setValidationRuels } from '../base/util';\nimport { FormValidator } from '@syncfusion/ej2-inputs';\nimport { DatePickerEditCell } from '../renderer/datepicker-edit-cell';\nimport { calculateRelativeBasedPosition } from '@syncfusion/ej2-popups';\nimport { TemplateEditCell } from '../renderer/template-edit-cell';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * The `Edit` module is used to handle editing actions.\n */\nvar Edit = /** @class */ (function () {\n    /**\n     * Constructor for the Grid editing module\n     * @hidden\n     */\n    function Edit(parent, serviceLocator) {\n        this.editType = { 'Inline': InlineEdit, 'Normal': InlineEdit, 'Batch': BatchEdit, 'Dialog': DialogEdit };\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.l10n = this.serviceLocator.getService('localization');\n        this.addEventListener();\n        this.updateEditObj();\n        this.createAlertDlg();\n        this.createConfirmDlg();\n    }\n    Edit.prototype.updateColTypeObj = function () {\n        var cols = this.parent.columnModel;\n        for (var i = 0; i < cols.length; i++) {\n            if (this.parent.editSettings.template || cols[i].editTemplate) {\n                var templteCell = 'templateedit';\n                cols[i].edit = extend(new Edit.editCellType[templteCell](this.parent), cols[i].edit || {});\n            }\n            else {\n                cols[i].edit = extend(new Edit.editCellType[cols[i].editType && Edit.editCellType[cols[i].editType] ?\n                    cols[i].editType : 'defaultedit'](this.parent, this.serviceLocator), cols[i].edit || {});\n            }\n        }\n        this.parent.log('primary_column_missing');\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    Edit.prototype.getModuleName = function () {\n        return 'edit';\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.onPropertyChanged = function (e) {\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        var gObj = this.parent;\n        var newProp = e.properties;\n        for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            switch (prop) {\n                case 'allowAdding':\n                case 'allowDeleting':\n                case 'allowEditing':\n                    if (gObj.editSettings.allowAdding || gObj.editSettings.allowEditing || gObj.editSettings.allowDeleting) {\n                        this.initialEnd();\n                    }\n                    break;\n                case 'mode':\n                    this.updateEditObj();\n                    gObj.isEdit = false;\n                    gObj.refresh();\n                    break;\n            }\n        }\n    };\n    Edit.prototype.updateEditObj = function () {\n        if (this.editModule) {\n            this.editModule.destroy();\n        }\n        this.renderer = new EditRender(this.parent, this.serviceLocator);\n        this.editModule = new this.editType[this.parent.editSettings.mode](this.parent, this.serviceLocator, this.renderer);\n    };\n    Edit.prototype.initialEnd = function () {\n        this.updateColTypeObj();\n    };\n    /**\n     * Edits any bound record in the Grid by TR element.\n     * @param {HTMLTableRowElement} tr - Defines the table row to be edited.\n     */\n    Edit.prototype.startEdit = function (tr) {\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowEditing || gObj.isEdit || gObj.editSettings.mode === 'Batch') {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        if (!gObj.getSelectedRows().length) {\n            if (!tr) {\n                this.showDialog('EditOperationAlert', this.alertDObj);\n                return;\n            }\n        }\n        else if (!tr) {\n            tr = gObj.getSelectedRows()[0];\n        }\n        this.isLastRow = tr.rowIndex === this.parent.getContent().querySelector('tr:last-child').rowIndex;\n        if (tr.style.display === 'none') {\n            return;\n        }\n        this.editModule.startEdit(tr);\n        if (!isBlazor()) {\n            this.refreshToolbar();\n            gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n            this.parent.notify('start-edit', {});\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.checkLastRow = function (tr, args) {\n        var checkLastRow = this.isLastRow;\n        if (this.parent.height !== 'auto' && this.parent.editSettings.newRowPosition === 'Bottom' && args &&\n            args.requestType === 'add' && this.parent.height > this.parent.getContentTable().scrollHeight) {\n            addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowadded');\n        }\n        else if (checkLastRow && tr && tr.classList) {\n            addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowcell');\n        }\n    };\n    /**\n     * Cancels edited state.\n     */\n    Edit.prototype.closeEdit = function () {\n        if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog\n            && this.parent.element.querySelectorAll('.e-updatedtd').length) {\n            this.showDialog('CancelEdit', this.dialogObj);\n            return;\n        }\n        this.parent.element.classList.remove('e-editing');\n        this.editModule.closeEdit();\n        if (!isBlazor()) {\n            this.refreshToolbar();\n            this.parent.notify('close-edit', {});\n        }\n    };\n    Edit.prototype.refreshToolbar = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * To adds a new row at the top with the given data. When data is not passed, it will add empty rows.\n     * > `editSettings.allowEditing` should be true.\n     * @param {Object} data - Defines the new add record data.\n     * @param {number} index - Defines the row index to be added\n     */\n    Edit.prototype.addRecord = function (data, index) {\n        if (!this.parent.editSettings.allowAdding) {\n            return;\n        }\n        var args = { startEdit: true };\n        if (!data) {\n            this.parent.notify(events.virtualScrollAddActionBegin, args);\n        }\n        if (args.startEdit) {\n            this.parent.element.classList.add('e-editing');\n            this.editModule.addRecord(data, index);\n            if (!isBlazor()) {\n                this.refreshToolbar();\n                this.parent.notify('start-add', {});\n            }\n        }\n    };\n    /**\n     * Deletes a record with the given options. If fieldname and data are not given, the Grid will delete the selected record.\n     * > `editSettings.allowDeleting` should be true.\n     * @param {string} fieldname - Defines the primary key field name of the column.\n     * @param {Object} data - Defines the JSON data record to be deleted.\n     */\n    Edit.prototype.deleteRecord = function (fieldname, data) {\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowDeleting) {\n            return;\n        }\n        if (!data) {\n            if (!gObj.getSelectedRecords().length && isNullOrUndefined(gObj.commandDelIndex)) {\n                this.showDialog('DeleteOperationAlert', this.alertDObj);\n                return;\n            }\n        }\n        if (gObj.editSettings.showDeleteConfirmDialog) {\n            this.showDialog('ConfirmDelete', this.dialogObj);\n            return;\n        }\n        this.editModule.deleteRecord(fieldname, data);\n    };\n    /**\n     * Deletes a visible row by TR element.\n     * @param {HTMLTableRowElement} tr - Defines the table row element.\n     */\n    Edit.prototype.deleteRow = function (tr) {\n        this.deleteRowUid = tr.getAttribute('data-uid');\n        var rowObj = this.parent.getRowObjectFromUID(this.deleteRowUid);\n        if (!isNullOrUndefined(rowObj)) {\n            this.deleteRecord(null, rowObj.data);\n        }\n    };\n    /**\n     * If Grid is in editable state, you can save a record by invoking endEdit.\n     */\n    Edit.prototype.endEdit = function () {\n        if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog &&\n            (isNullOrUndefined(this.formObj) || this.formObj.validate())) {\n            this.parent.editModule.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n            if (isNullOrUndefined(this.formObj) || this.formObj.validate()) {\n                this.showDialog('BatchSaveConfirm', this.dialogObj);\n                return;\n            }\n        }\n        this.endEditing();\n    };\n    /**\n     * To update the specified cell by given value without changing into edited state.\n     * @param {number} rowIndex Defines the row index.\n     * @param {string} field Defines the column field.\n     * @param {string | number | boolean | Date} value - Defines the value to be changed.\n     */\n    Edit.prototype.updateCell = function (rowIndex, field, value) {\n        this.editModule.updateCell(rowIndex, field, value);\n    };\n    /**\n     * To update the specified row by given values without changing into edited state.\n     * @param {number} index Defines the row index.\n     * @param {Object} data Defines the data object to be updated.\n     */\n    Edit.prototype.updateRow = function (index, data) {\n        this.editModule.updateRow(index, data);\n    };\n    /**\n     * Resets added, edited, and deleted records in the batch mode.\n     */\n    Edit.prototype.batchCancel = function () {\n        this.closeEdit();\n    };\n    /**\n     * Bulk saves added, edited, and deleted records in the batch mode.\n     */\n    Edit.prototype.batchSave = function () {\n        this.endEdit();\n    };\n    /**\n     * Changes a particular cell into edited state based on the row index and field name provided in the `batch` mode.\n     * @param {number} index - Defines row index to edit a particular cell.\n     * @param {string} field - Defines the field name of the column to perform batch edit.\n     */\n    Edit.prototype.editCell = function (index, field) {\n        this.editModule.editCell(index, field);\n    };\n    /**\n     * Checks the status of validation at the time of editing. If validation is passed, it returns true.\n     * @return {boolean}\n     */\n    Edit.prototype.editFormValidate = function () {\n        if (this.formObj) {\n            return this.formObj.validate();\n        }\n        return false;\n    };\n    /**\n     * Gets the added, edited,and deleted data before bulk save to the DataSource in batch mode.\n     * @return {Object}\n     */\n    Edit.prototype.getBatchChanges = function () {\n        return this.editModule.getBatchChanges ? this.editModule.getBatchChanges() : {};\n    };\n    /**\n     * Gets the current value of the edited component.\n     */\n    Edit.prototype.getCurrentEditCellData = function () {\n        var obj = this.getCurrentEditedData(this.formObj.element, {});\n        return obj[Object.keys(obj)[0]];\n    };\n    /**\n     * Saves the cell that is currently edited. It does not save the value to the DataSource.\n     */\n    Edit.prototype.saveCell = function () {\n        this.editModule.saveCell();\n    };\n    Edit.prototype.endEditing = function () {\n        this.parent.element.classList.remove('e-editing');\n        this.editModule.endEdit();\n        this.refreshToolbar();\n    };\n    Edit.prototype.showDialog = function (content, obj) {\n        obj.content = '<div>' + this.l10n.getConstant(content) + '</div>';\n        obj.dataBind();\n        obj.show();\n    };\n    Edit.prototype.getValueFromType = function (col, value) {\n        var val = value;\n        switch (col.type) {\n            case 'number':\n                val = !isNaN(parseFloat(value)) ? parseFloat(value) : null;\n                break;\n            case 'boolean':\n                if (col.editType !== 'booleanedit') {\n                    val = value === this.l10n.getConstant('True') || value === true ? true : false;\n                }\n                break;\n            case 'date':\n            case 'datetime':\n                if (col.editType !== 'datepickeredit' && col.editType !== 'datetimepickeredit'\n                    && value && value.length) {\n                    val = new Date(value);\n                }\n                else if (value === '') {\n                    val = null;\n                }\n                break;\n        }\n        return val;\n    };\n    Edit.prototype.destroyToolTip = function () {\n        var elements = [].slice.call(this.parent.element.querySelectorAll('.e-griderror'));\n        for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n            var elem = elements_1[_i];\n            remove(elem);\n        }\n        this.parent.getContent().firstElementChild.style.position = 'relative';\n    };\n    Edit.prototype.createConfirmDlg = function () {\n        this.dialogObj = this.dlgWidget([\n            {\n                click: this.dlgOk.bind(this),\n                buttonModel: { content: this.l10n.getConstant('OKButton'), cssClass: 'e-primary', isPrimary: true }\n            },\n            {\n                click: this.dlgCancel.bind(this),\n                buttonModel: { cssClass: 'e-flat', content: this.l10n.getConstant('CancelButton') }\n            }\n        ], 'EditConfirm');\n    };\n    Edit.prototype.createAlertDlg = function () {\n        this.alertDObj = this.dlgWidget([\n            {\n                click: this.alertClick.bind(this), buttonModel: { content: this.l10n.getConstant('OKButton'), cssClass: 'e-flat', isPrimary: true }\n            }\n        ], 'EditAlert');\n    };\n    Edit.prototype.alertClick = function () {\n        this.alertDObj.hide();\n    };\n    Edit.prototype.dlgWidget = function (btnOptions, name) {\n        var div = this.parent.createElement('div', { id: this.parent.element.id + name });\n        this.parent.element.appendChild(div);\n        var options = {\n            showCloseIcon: false,\n            isModal: true,\n            visible: false,\n            closeOnEscape: true,\n            target: this.parent.element,\n            width: '320px',\n            animationSettings: { effect: 'None' }\n        };\n        options.buttons = btnOptions;\n        var obj = new Dialog(options);\n        var isStringTemplate = 'isStringTemplate';\n        obj[isStringTemplate] = true;\n        obj.appendTo(div);\n        return obj;\n    };\n    Edit.prototype.dlgCancel = function () {\n        this.parent.focusModule.clearIndicator();\n        this.parent.focusModule.restoreFocus();\n        this.dialogObj.hide();\n    };\n    Edit.prototype.dlgOk = function (e) {\n        switch (this.dialogObj.element.querySelector('.e-dlg-content').firstElementChild.innerText) {\n            case this.l10n.getConstant('ConfirmDelete'):\n                this.editModule.deleteRecord();\n                break;\n            case this.l10n.getConstant('CancelEdit'):\n                this.editModule.closeEdit();\n                break;\n            case this.l10n.getConstant('BatchSaveConfirm'):\n                this.endEditing();\n                break;\n            case this.l10n.getConstant('BatchSaveLostChanges'):\n                if (this.parent.editSettings.mode === 'Batch') {\n                    this.editModule.addCancelWhilePaging();\n                    if (isBlazor() && this.parent.isServerRendered) {\n                        this.editModule.closeEdit();\n                    }\n                }\n                this.executeAction();\n                break;\n        }\n        this.dlgCancel();\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.initialEnd, this.initialEnd, this);\n        this.parent.on(events.keyPressed, this.keyPressHandler, this);\n        this.parent.on(events.autoCol, this.updateColTypeObj, this);\n        this.parent.on(events.tooltipDestroy, this.destroyToolTip, this);\n        this.parent.on(events.preventBatch, this.preventBatch, this);\n        this.parent.on(events.destroyForm, this.destroyForm, this);\n        this.actionBeginFunction = this.onActionBegin.bind(this);\n        this.actionCompleteFunction = this.actionComplete.bind(this);\n        this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n        this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n        this.parent.off(events.initialEnd, this.initialEnd);\n        this.parent.off(events.keyPressed, this.keyPressHandler);\n        this.parent.off(events.autoCol, this.updateColTypeObj);\n        this.parent.off(events.tooltipDestroy, this.destroyToolTip);\n        this.parent.off(events.preventBatch, this.preventBatch);\n        this.parent.off(events.destroyForm, this.destroyForm);\n        this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n        this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n    };\n    Edit.prototype.actionComplete = function (e) {\n        var actions = ['add', 'beginEdit', 'save', 'delete', 'cancel'];\n        if (actions.indexOf(e.requestType) < 0) {\n            this.parent.isEdit = false;\n        }\n        if (e.requestType === 'batchsave') {\n            this.parent.focusModule.restoreFocus();\n        }\n        this.refreshToolbar();\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.getCurrentEditedData = function (form, editedData) {\n        var gObj = this.parent;\n        if (gObj.editSettings.template) {\n            var elements = [].slice.call(form.elements);\n            for (var k = 0; k < elements.length; k++) {\n                if ((elements[k].hasAttribute('name') && (elements[k].className !== 'e-multi-hidden')) ||\n                    elements[k].classList.contains('e-multiselect')) {\n                    var field = (elements[k].hasAttribute('name')) ? setComplexFieldID(elements[k].getAttribute('name')) :\n                        setComplexFieldID(elements[k].getAttribute('id'));\n                    var column = gObj.getColumnByField(field) || { field: field, type: elements[k].getAttribute('type') };\n                    var value = void 0;\n                    if (column.type === 'checkbox' || column.type === 'boolean') {\n                        value = elements[k].checked;\n                    }\n                    else if (elements[k].value) {\n                        value = elements[k].value;\n                        if (elements[k].ej2_instances &&\n                            elements[k].ej2_instances.length &&\n                            !isNullOrUndefined(elements[k].ej2_instances[0].value)) {\n                            elements[k].blur();\n                            value = elements[k].ej2_instances[0].value;\n                            if ((column.type === 'date' || column.type === 'dateTime' || column.type === 'datetime') &&\n                                (elements[k].ej2_instances[0].isServerRendered)) {\n                                value = elements[k].value;\n                            }\n                        }\n                    }\n                    else if (elements[k].ej2_instances) {\n                        value = elements[k].ej2_instances[0].value;\n                    }\n                    if (column.edit && typeof column.edit.read === 'string') {\n                        value = getValue(column.edit.read, window)(elements[k], value);\n                    }\n                    else if (column.edit && column.edit.read) {\n                        value = column.edit.read(elements[k], value);\n                    }\n                    value = gObj.editModule.getValueFromType(column, value);\n                    if (elements[k].type === 'radio') {\n                        if (elements[k].checked) {\n                            DataUtil.setValue(column.field, value, editedData);\n                        }\n                    }\n                    else {\n                        DataUtil.setValue(column.field, value, editedData);\n                    }\n                }\n            }\n            return editedData;\n        }\n        var col = gObj.columnModel.filter(function (col) { return col.editTemplate; });\n        for (var j = 0; j < col.length; j++) {\n            if (form[getComplexFieldID(col[j].field)]) {\n                var inputElements = [].slice.call(form[getComplexFieldID(col[j].field)]);\n                inputElements = inputElements.length ? inputElements : [form[getComplexFieldID(col[j].field)]];\n                var temp = inputElements.filter(function (e) {\n                    return !isNullOrUndefined((e.ej2_instances));\n                });\n                if (temp.length === 0) {\n                    temp = inputElements.filter(function (e) { return e.hasAttribute('name'); });\n                }\n                for (var k = 0; k < temp.length; k++) {\n                    var value = this.getValue(col[j], temp[k], editedData);\n                    DataUtil.setValue(col[j].field, value, editedData);\n                }\n            }\n        }\n        var inputs = [].slice.call(form.querySelectorAll('.e-field'));\n        for (var i = 0, len = inputs.length; i < len; i++) {\n            var col_1 = gObj.getColumnByUid(inputs[i].getAttribute('e-mappinguid'));\n            if (col_1 && col_1.field) {\n                var value = this.getValue(col_1, inputs[i], editedData);\n                DataUtil.setValue(col_1.field, value, editedData);\n            }\n        }\n        return editedData;\n    };\n    Edit.prototype.getValue = function (col, input, editedData) {\n        var value = input.ej2_instances &&\n            !(isBlazor() && input.ej2_instances[0].isServerRendered\n                && (col.type === 'date' || col.type === 'datetime')) ?\n            input.ej2_instances[0].value : input.value;\n        var gObj = this.parent;\n        var temp = col.edit.read;\n        if (col.type === 'checkbox' || col.type === 'boolean') {\n            value = input.checked;\n        }\n        if (typeof temp === 'string') {\n            temp = getValue(temp, window);\n            value = gObj.editModule.getValueFromType(col, (temp)(input, value));\n        }\n        else {\n            value = gObj.editModule.getValueFromType(col, col.edit.read(input, value));\n        }\n        if (isNullOrUndefined(editedData[col.field]) && value === '') {\n            value = editedData[col.field];\n        }\n        return value;\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.onActionBegin = function (e) {\n        if (e.requestType === 'columnstate' && this.parent.isEdit\n            && this.parent.editSettings.mode !== 'Batch') {\n            this.closeEdit();\n        }\n        else {\n            var editRow = this.parent.element.querySelector('.e-editedrow');\n            if (editRow && this.parent.frozenRows && e.requestType === 'virtualscroll'\n                && parseInt(parentsUntil(editRow, 'e-row').getAttribute('aria-rowindex'), 10) < this.parent.frozenRows) {\n                return;\n            }\n            var restrictedRequestTypes = ['filterafteropen', 'filterbeforeopen', 'filterchoicerequest', 'save', 'infiniteScroll'];\n            if (this.parent.editSettings.mode !== 'Batch' && this.formObj && !this.formObj.isDestroyed\n                && restrictedRequestTypes.indexOf(e.requestType) === -1 && !e.cancel) {\n                this.destroyWidgets();\n                this.destroyForm();\n            }\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.destroyWidgets = function (cols) {\n        var gObj = this.parent;\n        if (gObj.editSettings.template) {\n            this.parent.destroyTemplate(['editSettingsTemplate']);\n            if (this.parent.isReact) {\n                this.parent.renderTemplates();\n            }\n        }\n        cols = cols ? cols : this.parent.getVisibleColumns();\n        if (cols.some(function (column) { return !isNullOrUndefined(column.editTemplate); })) {\n            this.parent.destroyTemplate(['editTemplate']);\n            if (this.parent.isReact) {\n                this.parent.renderTemplates();\n            }\n        }\n        for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n            var col = cols_1[_i];\n            var temp = col.edit.destroy;\n            if (isBlazor() && col.editTemplate) {\n                resetBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate');\n                updateBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate', col, false);\n            }\n            if (col.edit.destroy) {\n                if (typeof temp === 'string') {\n                    temp = getValue(temp, window);\n                    temp();\n                }\n                else {\n                    col.edit.destroy();\n                }\n            }\n        }\n        var elements = [].slice.call(this.formObj.element.elements);\n        for (var i = 0; i < elements.length; i++) {\n            if (elements[i].hasAttribute('name')) {\n                if (elements[i].ej2_instances &&\n                    elements[i].ej2_instances.length &&\n                    !elements[i].ej2_instances[0].isDestroyed) {\n                    elements[i].ej2_instances[0].destroy();\n                }\n            }\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.destroyForm = function () {\n        this.destroyToolTip();\n        if (this.formObj && !this.formObj.isDestroyed) {\n            this.formObj.destroy();\n        }\n        this.destroyToolTip();\n    };\n    /**\n     * To destroy the editing.\n     * @return {void}\n     * @hidden\n     */\n    Edit.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (!gridElement) {\n            return;\n        }\n        var hasGridChild = gridElement.querySelector('.e-gridheader') &&\n            gridElement.querySelector('.e-gridcontent') ? true : false;\n        if (hasGridChild) {\n            this.destroyForm();\n        }\n        this.removeEventListener();\n        var elem = this.dialogObj.element;\n        if (elem.childElementCount > 0) {\n            this.dialogObj.destroy();\n            remove(elem);\n        }\n        elem = this.alertDObj.element;\n        if (elem.childElementCount > 0) {\n            this.alertDObj.destroy();\n            remove(elem);\n        }\n        if (!hasGridChild) {\n            return;\n        }\n        if (this.editModule) {\n            this.editModule.destroy();\n        }\n    };\n    Edit.prototype.keyPressHandler = function (e) {\n        switch (e.action) {\n            case 'insert':\n                this.addRecord();\n                break;\n            case 'delete':\n                if ((e.target.tagName !== 'INPUT' || e.target.classList.contains('e-checkselect'))\n                    && !document.querySelector('.e-popup-open')) {\n                    this.deleteRecord();\n                }\n                break;\n            case 'f2':\n                this.startEdit();\n                break;\n            case 'enter':\n                if (!parentsUntil(e.target, 'e-unboundcelldiv') && this.parent.editSettings.mode !== 'Batch' &&\n                    (parentsUntil(e.target, 'e-gridcontent') || (this.parent.frozenRows\n                        && parentsUntil(e.target, 'e-headercontent')))\n                    && !document.querySelectorAll('.e-popup-open').length) {\n                    e.preventDefault();\n                    this.endEdit();\n                }\n                break;\n            case 'escape':\n                if (this.parent.isEdit) {\n                    if (this.parent.editSettings.mode === 'Batch') {\n                        this.editModule.escapeCellEdit();\n                    }\n                    else {\n                        this.closeEdit();\n                    }\n                }\n                break;\n        }\n    };\n    Edit.prototype.preventBatch = function (args) {\n        this.preventObj = args;\n        this.showDialog('BatchSaveLostChanges', this.dialogObj);\n    };\n    Edit.prototype.executeAction = function () {\n        this.preventObj.handler.call(this.preventObj.instance, this.preventObj.arg1, this.preventObj.arg2, this.preventObj.arg3, this.preventObj.arg4, this.preventObj.arg5, this.preventObj.arg6, this.preventObj.arg7, this.preventObj.arg8);\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.applyFormValidation = function (cols) {\n        var gObj = this.parent;\n        var frzCols = gObj.isFrozenGrid();\n        var isInline = this.parent.editSettings.mode === 'Normal';\n        var idx = this.parent.getFrozenMode() === 'Right' && isInline ? 1 : 0;\n        var form = this.parent.editSettings.mode !== 'Dialog' ?\n            gObj.element.querySelectorAll('.e-gridform')[idx] :\n            select('#' + gObj.element.id + '_dialogEdit_wrapper .e-gridform', document);\n        var index = this.parent.getFrozenMode() === 'Right' && isInline ? 0 : 1;\n        var mForm = gObj.element.querySelectorAll('.e-gridform')[index];\n        var rules = {};\n        var mRules = {};\n        var frRules = {};\n        cols = cols ? cols : gObj.getColumns();\n        for (var i = 0; i < cols.length; i++) {\n            if (!cols[i].visible) {\n                continue;\n            }\n            if (isBlazor() && cols[i].editTemplate) {\n                continue;\n            }\n            if (cols[i].validationRules) {\n                setValidationRuels(cols[i], index, rules, mRules, frRules, cols.length);\n            }\n        }\n        if (frzCols && this.parent.editSettings.mode !== 'Dialog') {\n            this.parent.editModule.mFormObj = this.createFormObj(mForm, mRules);\n            if (this.parent.getFrozenMode() === 'Left-Right') {\n                var frForm = gObj.element.querySelectorAll('.e-gridform')[2];\n                this.parent.editModule.frFormObj = this.createFormObj(frForm, frRules);\n            }\n        }\n        else {\n            rules = extend(rules, mRules, frRules);\n        }\n        if (isBlazor() && this.parent.editSettings.template) {\n            this.parent.editModule.formObj = this.createFormObj(form, {});\n        }\n        else {\n            this.parent.editModule.formObj = this.createFormObj(form, rules);\n        }\n    };\n    Edit.prototype.createFormObj = function (form, rules) {\n        var _this = this;\n        return new FormValidator(form, {\n            rules: rules,\n            locale: this.parent.locale,\n            validationComplete: function (args) {\n                _this.validationComplete(args);\n            },\n            customPlacement: function (inputElement, error) {\n                var uid = inputElement.getAttribute('e-mappinguid');\n                var args = {\n                    column: _this.parent.getColumnByUid(uid),\n                    error: error,\n                    inputElement: inputElement,\n                    value: inputElement.value,\n                };\n                _this.valErrorPlacement(inputElement, error);\n                _this.parent.notify(events.valCustomPlacement, args);\n            }\n        });\n    };\n    Edit.prototype.valErrorPlacement = function (inputElement, error) {\n        if (this.parent.isEdit) {\n            var id = error.getAttribute('for');\n            var elem = this.getElemTable(inputElement).querySelector('#' + id + '_Error');\n            if (!elem) {\n                this.createTooltip(inputElement, error, id, '');\n            }\n            else {\n                elem.querySelector('.e-tip-content').innerHTML = error.outerHTML;\n            }\n        }\n    };\n    Edit.prototype.getElemTable = function (inputElement) {\n        var isFHdr;\n        if (this.parent.editSettings.mode !== 'Dialog') {\n            isFHdr = (this.parent.frozenRows && this.parent.frozenRows\n                > (parseInt(closest(inputElement, '.e-row').getAttribute('aria-rowindex'), 10) || 0));\n        }\n        return this.parent.editSettings.mode !== 'Dialog' ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() :\n            select('#' + this.parent.element.id + '_dialogEdit_wrapper', document);\n    };\n    Edit.prototype.resetElemPosition = function (elem, args) {\n        if (args.element.offsetWidth < elem.offsetWidth) {\n            elem.style.left = args.element.getBoundingClientRect().left - ((elem.offsetWidth - args.element.offsetWidth) / 2) + 'px';\n        }\n    };\n    Edit.prototype.validationComplete = function (args) {\n        if (this.parent.isEdit) {\n            var elem = this.getElemTable(args.element).querySelector('#' + args.inputName + '_Error');\n            if (elem) {\n                if (args.status === 'failure') {\n                    elem.style.display = '';\n                    this.resetElemPosition(elem, args);\n                }\n                else {\n                    elem.style.display = 'none';\n                }\n            }\n        }\n    };\n    // tslint:disable-next-line:max-func-body-length\n    Edit.prototype.createTooltip = function (element, error, name, display) {\n        var column = this.parent.getColumnByField(name);\n        var formObj = this.parent.getFrozenMode() === 'Left-Right' && this.parent.editSettings.mode === 'Normal'\n            && column.getFreezeTableName() === 'frozen-right' ? this.frFormObj.element : this.formObj.element;\n        var gcontent = this.parent.getContent().firstElementChild;\n        var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount()\n            || this.parent.getFrozenRightColumnsCount();\n        if (frzCols) {\n            gcontent = this.parent.getMovableVirtualContent();\n        }\n        var isScroll = gcontent.scrollHeight > gcontent.clientHeight || gcontent.scrollWidth > gcontent.clientWidth;\n        var isInline = this.parent.editSettings.mode !== 'Dialog';\n        var td = closest(element, '.e-rowcell');\n        var row = closest(element, '.e-row');\n        var fCont = this.parent.getContent().querySelector('.e-frozencontent');\n        var isFHdr;\n        var isFHdrLastRow = false;\n        var validationForBottomRowPos;\n        var isBatchModeLastRow = false;\n        var viewPortRowCount = Math.round(this.parent.getContent().clientHeight / this.parent.getRowHeight()) - 1;\n        var rows = !fCont ? [].slice.call(this.parent.getContent().querySelectorAll('.e-row'))\n            : [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('.e-row'));\n        if (this.parent.editSettings.mode === 'Batch') {\n            if (viewPortRowCount > 1 && rows.length >= viewPortRowCount\n                && rows[rows.length - 1].getAttribute('aria-rowindex') === row.getAttribute('aria-rowindex')) {\n                isBatchModeLastRow = true;\n            }\n        }\n        if (isInline) {\n            if (this.parent.frozenRows) {\n                var fHeraderRows = frzCols ? this.parent.getFrozenVirtualHeader().querySelector('tbody').children\n                    : this.parent.getHeaderTable().querySelector('tbody').children;\n                isFHdr = fHeraderRows.length > (parseInt(row.getAttribute('aria-rowindex'), 10) || 0);\n                isFHdrLastRow = isFHdr && parseInt(row.getAttribute('aria-rowindex'), 10) === fHeraderRows.length - 1;\n            }\n            if (isFHdrLastRow || (viewPortRowCount > 1 && rows.length >= viewPortRowCount\n                && ((this.parent.editSettings.newRowPosition === 'Bottom' && (this.editModule.args\n                    && this.editModule.args.requestType === 'add')) || (td.classList.contains('e-lastrowcell')\n                    && !row.classList.contains('e-addedrow')))) || isBatchModeLastRow) {\n                validationForBottomRowPos = true;\n            }\n        }\n        var table = isInline ?\n            (isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable()) :\n            select('#' + this.parent.element.id + '_dialogEdit_wrapper .e-dlg-content', document);\n        var client = table.getBoundingClientRect();\n        var left = isInline ?\n            this.parent.element.getBoundingClientRect().left : client.left;\n        var input = closest(element, 'td');\n        var inputClient = input ? input.getBoundingClientRect() : element.parentElement.getBoundingClientRect();\n        var div = this.parent.createElement('div', {\n            className: 'e-tooltip-wrap e-lib e-control e-popup e-griderror',\n            id: name + '_Error',\n            styles: 'display:' + display + ';top:' +\n                ((isFHdr ? inputClient.top + inputClient.height : inputClient.bottom - client.top\n                    - (frzCols ? fCont.scrollTop : 0)) + table.scrollTop + 9) + 'px;left:' +\n                (inputClient.left - left + table.scrollLeft + inputClient.width / 2) + 'px;' +\n                'max-width:' + inputClient.width + 'px;text-align:center;'\n        });\n        if (isInline && client.left < left) {\n            div.style.left = parseInt(div.style.left, 10) - client.left + left + 'px';\n        }\n        var content = this.parent.createElement('div', { className: 'e-tip-content' });\n        content.appendChild(error);\n        var arrow;\n        if (validationForBottomRowPos) {\n            arrow = this.parent.createElement('div', { className: 'e-arrow-tip e-tip-bottom' });\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-outer e-tip-bottom' }));\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-inner e-tip-bottom' }));\n        }\n        else {\n            arrow = this.parent.createElement('div', { className: 'e-arrow-tip e-tip-top' });\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-outer e-tip-top' }));\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-inner e-tip-top' }));\n        }\n        div.appendChild(content);\n        div.appendChild(arrow);\n        if ((frzCols || this.parent.frozenRows) && this.parent.editSettings.mode !== 'Dialog') {\n            var getEditCell = this.parent.editSettings.mode === 'Normal' ?\n                closest(element, '.e-editcell') : closest(element, '.e-table');\n            getEditCell.style.position = 'relative';\n            div.style.position = 'absolute';\n            if (this.parent.editSettings.mode === 'Batch' ||\n                (closest(element, '.e-frozencontent') || closest(element, '.e-frozenheader'))\n                || (this.parent.frozenRows && !frzCols)) {\n                formObj.appendChild(div);\n            }\n            else {\n                this.mFormObj.element.appendChild(div);\n            }\n        }\n        else {\n            this.formObj.element.appendChild(div);\n        }\n        if (!validationForBottomRowPos && isInline && gcontent.getBoundingClientRect().bottom < inputClient.bottom + inputClient.height) {\n            gcontent.scrollTop = gcontent.scrollTop + div.offsetHeight + arrow.scrollHeight;\n        }\n        var lineHeight = parseInt(document.defaultView.getComputedStyle(div, null).getPropertyValue('font-size'), 10);\n        if (div.getBoundingClientRect().width < inputClient.width &&\n            div.querySelector('label').getBoundingClientRect().height / (lineHeight * 1.2) >= 2) {\n            div.style.width = div.style.maxWidth;\n        }\n        if ((frzCols || this.parent.frozenRows) && this.parent.editSettings.mode !== 'Dialog') {\n            div.style.left = input.offsetLeft + (input.offsetWidth / 2 - div.offsetWidth / 2) + 'px';\n        }\n        else {\n            div.style.left = (parseInt(div.style.left, 10) - div.offsetWidth / 2) + 'px';\n        }\n        if (isInline && !isScroll && !this.parent.allowPaging || frzCols || this.parent.frozenRows) {\n            gcontent.style.position = 'static';\n            var pos = calculateRelativeBasedPosition(input, div);\n            div.style.top = pos.top + inputClient.height + 9 + 'px';\n        }\n        if (validationForBottomRowPos) {\n            if (isScroll && !frzCols && this.parent.height !== 'auto' && !this.parent.frozenRows\n                && !this.parent.enableVirtualization) {\n                var scrollWidth = gcontent.scrollWidth > gcontent.offsetWidth ? getScrollBarWidth() : 0;\n                div.style.bottom = (this.parent.height - gcontent.querySelector('table').offsetHeight\n                    - scrollWidth) + inputClient.height + 9 + 'px';\n            }\n            else {\n                div.style.bottom = inputClient.height + 9 + 'px';\n            }\n            if (rows.length < viewPortRowCount && this.parent.editSettings.newRowPosition === 'Bottom' && (this.editModule.args\n                && this.editModule.args.requestType === 'add')) {\n                var rowsCount = this.parent.frozenRows ? this.parent.frozenRows + (rows.length - 1) : rows.length - 1;\n                var rowsHeight = rowsCount * this.parent.getRowHeight();\n                var position = this.parent.getContent().clientHeight - rowsHeight;\n                div.style.bottom = position + 9 + 'px';\n            }\n            div.style.top = null;\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.checkColumnIsGrouped = function (col) {\n        return !col.visible && !(this.parent.groupSettings.columns.indexOf(col.field) > -1);\n    };\n    /**\n     * @hidden\n     */\n    Edit.AddEditors = function (editors) {\n        Edit.editCellType = extend(Edit.editCellType, editors);\n    };\n    Edit.editCellType = {\n        'dropdownedit': DropDownEditCell, 'numericedit': NumericEditCell,\n        'datepickeredit': DatePickerEditCell, 'datetimepickeredit': DatePickerEditCell,\n        'booleanedit': BooleanEditCell, 'defaultedit': DefaultEditCell,\n        'templateedit': TemplateEditCell\n    };\n    return Edit;\n}());\nexport { Edit };\n"]},"metadata":{},"sourceType":"module"}