{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { remove, createElement, closest, formatUnit, Browser, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { dataReady, modelChanged, refreshVirtualBlock, contentReady } from '../base/constant';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { ContentRender } from './content-renderer';\nimport { HeaderRender } from './header-renderer';\nimport { InterSectionObserver } from '../services/intersection-observer';\nimport { VirtualRowModelGenerator } from '../services/virtual-row-model-generator';\nimport { isGroupAdaptive, ensureLastRow, ensureFirstRow, getEditedDataIndex } from '../base/util';\nimport { isBlazor, setStyleAttribute } from '@syncfusion/ej2-base';\n/**\n * VirtualContentRenderer\n * @hidden\n */\n\nvar VirtualContentRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualContentRenderer, _super);\n\n  function VirtualContentRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.prevHeight = 0;\n    /** @hidden */\n\n    _this.startIndex = 0;\n    _this.preStartIndex = 0;\n    _this.preventEvent = false;\n    _this.actions = ['filtering', 'searching', 'grouping', 'ungrouping'];\n    /** @hidden */\n\n    _this.offsets = {};\n    _this.tmpOffsets = {};\n    /** @hidden */\n\n    _this.virtualEle = new VirtualElementHandler();\n    _this.offsetKeys = [];\n    _this.isFocused = false;\n    _this.isSelection = false;\n    _this.isBottom = false;\n    _this.rndrCount = 0;\n    _this.empty = undefined;\n    _this.isCancel = false;\n    _this.requestTypes = ['beginEdit', 'cancel', 'delete', 'add', 'save'];\n    _this.isNormaledit = _this.parent.editSettings.mode === 'Normal';\n    /** @hidden */\n\n    _this.virtualData = {};\n    _this.emptyRowData = {};\n    _this.vfColIndex = [];\n    _this.frzIdx = 1;\n    _this.locator = locator;\n\n    _this.eventListener('on');\n\n    _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n\n    _this.vgenerator = _this.generator;\n    return _this;\n  }\n\n  VirtualContentRenderer.prototype.renderTable = function () {\n    this.header = this.locator.getService('rendererFactory').getRenderer(RenderType.Header);\n\n    _super.prototype.renderTable.call(this);\n\n    this.virtualEle.table = this.getTable();\n    this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');\n    this.virtualEle.renderWrapper(this.parent.height);\n    this.virtualEle.renderPlaceHolder();\n    this.virtualEle.wrapper.style.position = 'absolute';\n    var debounceEvent = this.parent.dataSource instanceof DataManager && !this.parent.dataSource.dataSource.offline;\n    var opt = {\n      container: this.content,\n      pageHeight: this.getBlockHeight() * 2,\n      debounceEvent: debounceEvent,\n      axes: this.parent.enableColumnVirtualization ? ['X', 'Y'] : ['Y']\n    };\n    this.observer = new InterSectionObserver(this.virtualEle.wrapper, opt);\n  };\n\n  VirtualContentRenderer.prototype.renderEmpty = function (tbody) {\n    this.getTable().appendChild(tbody);\n    this.virtualEle.adjustTable(0, 0);\n  };\n\n  VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {\n    this.scrollAfterEdit();\n\n    if (this.parent.enablePersistence) {\n      this.parent.scrollPosition = scrollArgs.offset;\n    }\n\n    if (this.preventEvent || this.parent.isDestroyed) {\n      this.preventEvent = false;\n      return;\n    }\n\n    if (isNullOrUndefined(document.activeElement)) {\n      this.isFocused = false;\n    } else {\n      this.isFocused = this.content === closest(document.activeElement, '.e-content') || this.content === document.activeElement;\n    }\n\n    var info = scrollArgs.sentinel;\n    var pStartIndex = this.preStartIndex;\n    var previousColIndexes = this.parent.getColumnIndexesInView();\n    var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);\n\n    if (isBlazor() && this.parent.isServerRendered && this.parent.enableColumnVirtualization && JSON.stringify(previousColIndexes) !== JSON.stringify(viewInfo.columnIndexes)) {\n      this.parent.refreshHeader();\n      var translateX = this.getColumnOffset(this.startColIndex - 1);\n      var width = this.getColumnOffset(this.endColIndex - 1) - translateX + '';\n      this.parent.notify('refresh-virtual-indices', {\n        requestType: 'virtualscroll',\n        startColumnIndex: viewInfo.columnIndexes[0],\n        endColumnIndex: viewInfo.columnIndexes[viewInfo.columnIndexes.length - 1],\n        axis: 'X',\n        VTablewidth: width,\n        translateX: this.getColumnOffset(viewInfo.columnIndexes[0] - 1)\n      });\n      this.parent.notify('setcolumnstyles', {});\n    }\n\n    if (isGroupAdaptive(this.parent) && !isBlazor()) {\n      if (info.axis === 'Y' && viewInfo.blockIndexes && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString() && scrollArgs.direction === 'up' && viewInfo.blockIndexes[viewInfo.blockIndexes.length - 1] !== 2) {\n        return;\n      } else {\n        viewInfo.event = 'refresh-virtual-block';\n\n        if (!isNullOrUndefined(viewInfo.offsets)) {\n          viewInfo.offsets.top = this.content.scrollTop;\n        }\n\n        this.parent.notify(viewInfo.event, {\n          requestType: 'virtualscroll',\n          virtualInfo: viewInfo,\n          focusElement: scrollArgs.focusElement\n        });\n        return;\n      }\n    }\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      if (this.prevInfo && (info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString() || info.axis === 'X' && this.prevInfo.columnIndexes.toString() === viewInfo.columnIndexes.toString())) {\n        if (Browser.isIE) {\n          this.parent.hideSpinner();\n        }\n\n        this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n        this.restoreEdit();\n        return;\n      }\n    }\n\n    this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      this.parent.pageSettings.currentPage = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n    } else if (isBlazor() && this.parent.isServerRendered && this.preStartIndex !== pStartIndex && this.parent.pageSettings.currentPage === viewInfo.currentPage) {\n      this.parent.notify('refresh-virtual-indices', {\n        requestType: 'virtualscroll',\n        virtualStartIndex: viewInfo.startIndex,\n        virtualEndIndex: viewInfo.endIndex,\n        axis: 'Y',\n        RHeight: this.parent.getRowHeight()\n      });\n    }\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      this.requestType = 'virtualscroll';\n      this.parent.notify(viewInfo.event, {\n        requestType: 'virtualscroll',\n        virtualInfo: viewInfo,\n        focusElement: scrollArgs.focusElement\n      });\n    } else if (this.preStartIndex !== pStartIndex && this.parent.pageSettings.currentPage !== viewInfo.currentPage) {\n      this.parent.pageSettings.currentPage = viewInfo.currentPage;\n      this.parent.notify(viewInfo.event, {\n        requestType: 'virtualscroll',\n        virtualStartIndex: viewInfo.startIndex,\n        virtualEndIndex: viewInfo.endIndex,\n        axis: 'Y',\n        RHeight: this.parent.getRowHeight()\n      });\n    }\n  };\n\n  VirtualContentRenderer.prototype.block = function (blk) {\n    return this.vgenerator.isBlockAvailable(blk);\n  };\n\n  VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {\n    var isBlockAdded = false;\n    var tempBlocks = [];\n    var infoType = {\n      direction: direction,\n      sentinelInfo: info,\n      offsets: e,\n      startIndex: this.preStartIndex,\n      endIndex: this.preEndIndex\n    };\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;\n    infoType.page = this.getPageFromTop(e.top, infoType);\n    infoType.blockIndexes = tempBlocks = this.vgenerator.getBlockIndexes(infoType.page);\n    infoType.loadSelf = !this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);\n    var blocks = this.ensureBlocks(infoType);\n\n    if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {\n      // To avoid dupilcate row index problem in key focus support\n      var newBlock = blocks[blocks.length - 1];\n\n      if (infoType.blockIndexes.indexOf(newBlock) === -1) {\n        isBlockAdded = true;\n      }\n    }\n\n    infoType.blockIndexes = blocks;\n    infoType.loadNext = !blocks.filter(function (val) {\n      return tempBlocks.indexOf(val) === -1;\n    }).every(this.block.bind(this));\n    infoType.event = infoType.loadNext || infoType.loadSelf ? modelChanged : refreshVirtualBlock;\n    infoType.nextInfo = infoType.loadNext ? {\n      page: Math.max(1, infoType.page + (direction === 'down' ? 1 : -1))\n    } : {};\n\n    if (isBlockAdded) {\n      infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];\n    }\n\n    if (this.activeKey === 'downArrow') {\n      var firstBlock = Math.ceil(this.rowIndex / this.getBlockSize());\n\n      if (firstBlock !== 1 && (infoType.blockIndexes[1] !== firstBlock || infoType.blockIndexes.length < 3)) {\n        infoType.blockIndexes = [firstBlock - 1, firstBlock, firstBlock + 1];\n      }\n    }\n\n    infoType.columnIndexes = info.axis === 'X' ? this.vgenerator.getColumnIndexes() : this.parent.getColumnIndexesInView();\n\n    if (this.parent.enableColumnVirtualization && info.axis === 'X') {\n      infoType.event = refreshVirtualBlock;\n    }\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      var rowHeight = this.parent.getRowHeight();\n      var exactTopIndex = e.top / rowHeight;\n      var noOfInViewIndexes = vHeight / rowHeight;\n      var exactEndIndex = exactTopIndex + noOfInViewIndexes;\n      var pageSizeBy4 = this.parent.pageSettings.pageSize / 4;\n\n      if (infoType.direction === 'down') {\n        var sIndex = Math.round(exactEndIndex) - Math.round(pageSizeBy4);\n\n        if (isNullOrUndefined(infoType.startIndex) || exactEndIndex > infoType.startIndex + Math.round(this.parent.pageSettings.pageSize / 2 + pageSizeBy4) && infoType.endIndex !== this.count) {\n          infoType.startIndex = sIndex >= 0 ? Math.round(sIndex) : 0;\n          infoType.startIndex = infoType.startIndex > exactTopIndex ? Math.floor(exactTopIndex) : infoType.startIndex;\n          var eIndex = infoType.startIndex + this.parent.pageSettings.pageSize;\n          infoType.startIndex = eIndex < exactEndIndex ? Math.ceil(exactEndIndex) - this.parent.pageSettings.pageSize : infoType.startIndex;\n          infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n          infoType.startIndex = eIndex >= this.count ? infoType.endIndex - this.parent.pageSettings.pageSize : infoType.startIndex;\n          infoType.currentPage = Math.ceil(infoType.endIndex / this.parent.pageSettings.pageSize);\n          this.setKeyboardNavIndex();\n        }\n      } else if (infoType.direction === 'up') {\n        if (infoType.startIndex && infoType.endIndex) {\n          var loadAtIndex = Math.round((infoType.startIndex * rowHeight + pageSizeBy4 * rowHeight) / rowHeight);\n\n          if (exactTopIndex < loadAtIndex) {\n            var idxAddedToExactTop = pageSizeBy4 > noOfInViewIndexes ? pageSizeBy4 : noOfInViewIndexes + noOfInViewIndexes / 4;\n            var eIndex = Math.round(exactTopIndex + idxAddedToExactTop);\n            infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n            var sIndex = infoType.endIndex - this.parent.pageSettings.pageSize;\n            infoType.startIndex = sIndex > 0 ? sIndex : 0;\n            infoType.endIndex = sIndex < 0 ? this.parent.pageSettings.pageSize : infoType.endIndex;\n            infoType.currentPage = Math.ceil(infoType.startIndex / this.parent.pageSettings.pageSize);\n            this.setKeyboardNavIndex();\n          }\n        }\n      }\n\n      this.preStartIndex = this.startIndex = infoType.startIndex;\n      this.preEndIndex = infoType.endIndex;\n      infoType.event = infoType.currentPage !== this.parent.pageSettings.currentPage ? modelChanged : refreshVirtualBlock;\n    }\n\n    return infoType;\n  };\n\n  VirtualContentRenderer.prototype.setKeyboardNavIndex = function () {\n    this.blazorDataLoad = true;\n\n    if (this.activeKey === 'downArrow' || this.activeKey === 'upArrow') {\n      this.blzRowIndex = this.activeKey === 'downArrow' ? this.rowIndex + 1 : this.rowIndex - 1;\n      document.activeElement.blur();\n    }\n  };\n\n  VirtualContentRenderer.prototype.ensureBlocks = function (info) {\n    var _this = this;\n\n    var index = info.blockIndexes[info.block];\n    var mIdx;\n    var old = index;\n    var max = Math.max;\n    var indexes = info.direction === 'down' ? [max(index, 1), ++index, ++index] : [max(index - 1, 1), index, index + 1];\n\n    if (this.parent.enableColumnVirtualization && this.parent.isFrozenGrid()) {\n      // To avoid frozen content white space issue\n      if (info.sentinelInfo.axis === 'X' || info.sentinelInfo.axis === 'Y' && info.page === this.prevInfo.page) {\n        indexes = this.prevInfo.blockIndexes;\n      }\n    }\n\n    indexes = indexes.filter(function (val, ind) {\n      return indexes.indexOf(val) === ind;\n    });\n\n    if (this.prevInfo.blockIndexes.toString() === indexes.toString()) {\n      return indexes;\n    }\n\n    if (info.loadSelf || info.direction === 'down' && this.isEndBlock(old)) {\n      indexes = this.vgenerator.getBlockIndexes(info.page);\n    }\n\n    indexes.some(function (val, ind) {\n      var result = val === (isGroupAdaptive(_this.parent) ? _this.getGroupedTotalBlocks() : _this.getTotalBlocks());\n\n      if (result) {\n        mIdx = ind;\n      }\n\n      return result;\n    });\n\n    if (mIdx !== undefined) {\n      indexes = indexes.slice(0, mIdx + 1);\n\n      if (info.block === 0 && indexes.length === 1 && this.vgenerator.isBlockAvailable(indexes[0] - 1)) {\n        indexes = [indexes[0] - 1, indexes[0]];\n      }\n    }\n\n    return indexes;\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  VirtualContentRenderer.prototype.appendContent = function (target, newChild, e) {\n    var _this = this; // currentInfo value will be used if there are multiple dom updates happened due to mousewheel\n\n\n    var isFrozen = this.parent.isFrozenGrid();\n    var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n    var colVFtable = this.parent.enableColumnVirtualization && isFrozen;\n    this.checkFirstBlockColIndexes(e);\n    var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && this.currentInfo.page && this.currentInfo.page !== e.virtualInfo.page ? this.currentInfo : e.virtualInfo;\n    this.prevInfo = this.prevInfo || e.virtualInfo;\n    var cBlock = info.columnIndexes[0] - 1;\n\n    if (colVFtable && info.columnIndexes[0] === frzCols) {\n      cBlock = info.columnIndexes[0] - frzCols - 1;\n    }\n\n    var cOffset = this.getColumnOffset(cBlock);\n    var width;\n    var blocks = info.blockIndexes;\n\n    if (this.parent.groupSettings.columns.length) {\n      this.refreshOffsets();\n    }\n\n    if (this.parent.height === '100%') {\n      this.parent.element.style.height = '100%';\n    }\n\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;\n\n    if (!this.requestTypes.some(function (value) {\n      return value === _this.requestType;\n    })) {\n      var translate = this.getTranslateY(this.content.scrollTop, vHeight, info);\n      this.virtualEle.adjustTable(colVFtable ? 0 : cOffset, translate);\n\n      if (colVFtable) {\n        this.virtualEle.adjustMovableTable(cOffset, 0);\n      }\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      this.header.virtualEle.adjustTable(colVFtable ? 0 : cOffset, 0);\n\n      if (colVFtable) {\n        this.header.virtualEle.adjustMovableTable(cOffset, 0);\n      }\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      var cIndex = info.columnIndexes;\n      width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n\n      if (colVFtable) {\n        this.header.virtualEle.setMovableWrapperWidth(width);\n      } else {\n        this.header.virtualEle.setWrapperWidth(width);\n      }\n    }\n\n    if (colVFtable) {\n      this.virtualEle.setMovableWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n    } else {\n      this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n    }\n\n    if (!isNullOrUndefined(target.parentNode)) {\n      remove(target);\n    }\n\n    var tbody;\n\n    if (isFrozen) {\n      if (e.renderFrozenRightContent) {\n        tbody = this.parent.getContent().querySelector('.e-frozen-right-content').querySelector('tbody');\n      } else if (!e.renderMovableContent) {\n        tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n      } else if (e.renderMovableContent) {\n        tbody = this.parent.getMovableVirtualContent().querySelector('tbody');\n      }\n    } else {\n      tbody = this.parent.element.querySelector('.e-content').querySelector('tbody');\n    }\n\n    if (tbody) {\n      remove(tbody);\n      target = null;\n    }\n\n    var isReact = this.parent.isReact && !isNullOrUndefined(this.parent.rowTemplate);\n\n    if (!isReact) {\n      target = this.parent.createElement('tbody');\n      target.appendChild(newChild);\n    } else {\n      target = newChild;\n    }\n\n    if (this.parent.frozenRows && e.requestType === 'virtualscroll' && this.parent.pageSettings.currentPage === 1) {\n      for (var i = 0; i < this.parent.frozenRows; i++) {\n        target.children[0].remove();\n      }\n    }\n\n    if (isFrozen) {\n      if (e.renderFrozenRightContent) {\n        this.parent.getContent().querySelector('.e-frozen-right-content').querySelector('.e-table').appendChild(target);\n        this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n      } else if (!e.renderMovableContent) {\n        this.parent.getFrozenVirtualContent().querySelector('.e-table').appendChild(target);\n      } else if (e.renderMovableContent) {\n        this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(target);\n\n        if (this.parent.getFrozenMode() !== 'Left-Right') {\n          this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n        }\n      }\n\n      if (this.vfColIndex.length) {\n        e.virtualInfo.columnIndexes = info.columnIndexes = extend([], this.vfColIndex);\n        this.vfColIndex = e.renderMovableContent ? [] : this.vfColIndex;\n      }\n    } else {\n      this.getTable().appendChild(target);\n      this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n    }\n\n    if (this.parent.groupSettings.columns.length) {\n      if (!isGroupAdaptive(this.parent) && info.direction === 'up') {\n        var blk = this.offsets[this.getTotalBlocks()] - this.prevHeight;\n        this.preventEvent = true;\n        var sTop = this.content.scrollTop;\n        this.content.scrollTop = sTop + blk;\n      }\n\n      this.setVirtualHeight();\n      this.observer.setPageHeight(this.getOffset(blocks[blocks.length - 1]) - this.getOffset(blocks[0] - 1));\n    }\n\n    this.prevInfo = info;\n\n    if (this.isFocused && this.activeKey !== 'downArrow' && this.activeKey !== 'upArrow') {\n      this.content.focus();\n    }\n\n    var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n\n    if (this.isBottom) {\n      this.isBottom = false;\n      this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 1];\n    }\n\n    if (this.parent.pageSettings.currentPage === lastPage && blocks.length === 1) {\n      this.isBottom = true;\n      this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 2];\n    }\n\n    if (e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n      this.parent.notify(events.autoCol, {});\n    }\n\n    this.focusCell(e);\n    this.restoreEdit(e);\n    this.restoreAdd(e);\n  };\n\n  VirtualContentRenderer.prototype.checkFirstBlockColIndexes = function (e) {\n    if (this.parent.enableColumnVirtualization && this.parent.isFrozenGrid() && e.virtualInfo.columnIndexes[0] === 0) {\n      var indexes = [];\n      var frozenCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n\n      if (!e.renderMovableContent && e.virtualInfo.columnIndexes.length > frozenCols) {\n        this.vfColIndex = e.virtualInfo.columnIndexes;\n\n        for (var i = 0; i < frozenCols; i++) {\n          indexes.push(i);\n        }\n\n        e.virtualInfo.columnIndexes = indexes;\n      } else if (e.renderMovableContent) {\n        if (!this.vfColIndex.length) {\n          this.vfColIndex = extend([], e.virtualInfo.columnIndexes);\n        }\n\n        e.virtualInfo.columnIndexes = extend([], this.vfColIndex);\n        e.virtualInfo.columnIndexes.splice(0, frozenCols);\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.focusCell = function (e) {\n    if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      return;\n    }\n\n    var row = this.parent.getRowByIndex(this.rowIndex); // tslint:disable-next-line:no-any\n\n    var cell = row.cells[this.cellIndex];\n    cell.focus({\n      preventScroll: true\n    });\n    this.parent.selectRow(parseInt(row.getAttribute('aria-rowindex'), 10));\n    this.activeKey = this.empty;\n  };\n\n  VirtualContentRenderer.prototype.restoreEdit = function (e) {\n    if (this.isNormaledit) {\n      var left = this.parent.getFrozenColumns();\n      var isFrozen = e && this.parent.isFrozenGrid();\n      var table = this.parent.getFrozenMode();\n      var trigger = e && (left || table === 'Left' || table === 'Right' ? e.renderMovableContent : e.renderFrozenRightContent);\n\n      if ((!isFrozen || isFrozen && trigger) && this.parent.editSettings.allowEditing && this.parent.editModule && !isNullOrUndefined(this.editedRowIndex)) {\n        var row = this.getRowByIndex(this.editedRowIndex);\n\n        if (Object.keys(this.virtualData).length && row && !this.content.querySelector('.e-editedrow')) {\n          var top_1 = row.getBoundingClientRect().top;\n\n          if (top_1 < this.content.offsetHeight && top_1 > this.parent.getRowHeight()) {\n            this.parent.isEdit = false;\n            this.parent.editModule.startEdit(row);\n          }\n        }\n\n        if (row && this.content.querySelector('.e-editedrow') && !Object.keys(this.virtualData).length) {\n          var rowData = extend({}, this.getRowObjectByIndex(this.editedRowIndex));\n          this.virtualData = this.getVirtualEditedData(rowData);\n        }\n      }\n\n      this.restoreAdd(e);\n    }\n  };\n\n  VirtualContentRenderer.prototype.getVirtualEditedData = function (rowData) {\n    var editForms = [].slice.call(this.parent.element.querySelectorAll('.e-gridform'));\n    var isFrozen = this.parent.isFrozenGrid();\n    var data = this.parent.editModule.getCurrentEditedData(editForms[0], rowData);\n\n    if (isFrozen) {\n      if (this.parent.getTablesCount() === 2) {\n        data = this.parent.editModule.getCurrentEditedData(editForms[1], rowData);\n      }\n\n      if (this.parent.getTablesCount() === 3) {\n        data = this.parent.editModule.getCurrentEditedData(editForms[1], rowData);\n        data = this.parent.editModule.getCurrentEditedData(editForms[2], rowData);\n      }\n    }\n\n    return data;\n  };\n\n  VirtualContentRenderer.prototype.restoreAdd = function (e) {\n    var left = this.parent.getFrozenColumns();\n    var isFrozen = e && this.parent.isFrozenGrid();\n    var table = this.parent.getFrozenMode();\n    var trigger = e && (left || table === 'Left' || table === 'Right' ? e.renderMovableContent : e.renderFrozenRightContent);\n\n    if ((!isFrozen || isFrozen && trigger) && this.isNormaledit && this.isAdd && !this.parent.element.querySelector('.e-addedrow')) {\n      var isTop = this.parent.editSettings.newRowPosition === 'Top' && this.content.scrollTop < this.parent.getRowHeight();\n      var isBottom = this.parent.editSettings.newRowPosition === 'Bottom' && this.parent.pageSettings.currentPage === this.maxPage;\n\n      if (isTop || isBottom) {\n        this.parent.isEdit = false;\n        this.parent.addRecord();\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.onDataReady = function (e) {\n    if (!isNullOrUndefined(e.count)) {\n      this.count = e.count;\n      this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n    }\n\n    this.vgenerator.checkAndResetCache(e.requestType);\n\n    if (['refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', undefined].some(function (value) {\n      return e.requestType === value;\n    })) {\n      this.refreshOffsets();\n    }\n\n    this.setVirtualHeight();\n    this.resetScrollPosition(e.requestType);\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.setVirtualHeight = function (height) {\n    var width = this.parent.enableColumnVirtualization ? this.getColumnOffset(this.parent.columns.length + this.parent.groupSettings.columns.length - 1) + 'px' : '100%';\n\n    if (this.parent.isFrozenGrid()) {\n      var virtualHeightTemp = this.parent.pageSettings.currentPage === 1 && Object.keys(this.offsets).length <= 2 ? this.offsets[1] : this.offsets[this.getTotalBlocks() - 2];\n      var scrollableElementHeight = this.content.clientHeight;\n      virtualHeightTemp = virtualHeightTemp > scrollableElementHeight ? virtualHeightTemp : 0; // To overcome the white space issue in last page (instead of position absolute)\n\n      this.virtualEle.setVirtualHeight(virtualHeightTemp, width);\n    } else {\n      var virtualHeight = isBlazor() && this.parent.isServerRendered && this.parent.groupSettings.columns.length && height ? height : this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()];\n      this.virtualEle.setVirtualHeight(virtualHeight, width);\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      this.header.virtualEle.setVirtualHeight(1, width);\n\n      if (this.parent.isFrozenGrid()) {\n        this.virtualEle.setMovableVirtualHeight(1, width);\n        this.header.virtualEle.setMovableVirtualHeight(1, width);\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {\n    var _this = this;\n\n    var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n    var page = 0;\n    var extra = this.offsets[total] - this.prevHeight;\n    this.offsetKeys.some(function (offset) {\n      var iOffset = Number(offset);\n      var border = sTop <= _this.offsets[offset] || iOffset === total && sTop > _this.offsets[offset];\n\n      if (border) {\n        if (_this.offsetKeys.length % 2 !== 0 && iOffset.toString() === _this.offsetKeys[_this.offsetKeys.length - 2] && sTop <= _this.offsets[_this.offsetKeys.length - 1]) {\n          iOffset = iOffset + 1;\n        }\n\n        info.block = iOffset % 2 === 0 ? 1 : 0;\n        page = Math.max(1, Math.min(_this.vgenerator.getPage(iOffset), _this.maxPage));\n      }\n\n      return border;\n    });\n    return page;\n  };\n\n  VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n    if (info === undefined) {\n      info = {\n        page: this.getPageFromTop(sTop, {})\n      };\n      info.blockIndexes = this.vgenerator.getBlockIndexes(info.page);\n    }\n\n    var block = (info.blockIndexes[0] || 1) - 1;\n    var translate = this.getOffset(block);\n    var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);\n\n    if (isOnenter) {\n      info = this.prevInfo;\n    }\n\n    var result = translate > sTop ? this.getOffset(block - 1) : endTranslate < sTop + cHeight ? this.getOffset(block + 1) : translate;\n    var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] - this.tmpOffsets[info.blockIndexes[0]];\n\n    if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]) {\n      result -= result + blockHeight - this.offsets[this.getTotalBlocks()];\n    }\n\n    return result;\n  };\n\n  VirtualContentRenderer.prototype.getOffset = function (block) {\n    return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);\n  };\n\n  VirtualContentRenderer.prototype.onEntered = function () {\n    var _this = this;\n\n    return function (element, current, direction, e, isWheel, check) {\n      if (Browser.isIE && !isWheel && check && !_this.preventEvent) {\n        _this.parent.showSpinner();\n      }\n\n      var colVFtable = _this.parent.enableColumnVirtualization && _this.parent.isFrozenGrid();\n\n      var xAxis = current.axis === 'X';\n      var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;\n\n      var height = _this.content.getBoundingClientRect().height;\n\n      var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n\n      var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);\n\n      if (isBlazor() && _this.parent.isServerRendered && _this.currentInfo && _this.currentInfo.startIndex && xAxis) {\n        y = _this.currentInfo.startIndex * _this.parent.getRowHeight();\n      }\n\n      _this.virtualEle.adjustTable(colVFtable ? 0 : x, Math.min(y, _this.offsets[_this.maxBlock]));\n\n      if (colVFtable) {\n        _this.virtualEle.adjustMovableTable(x, 0);\n      }\n\n      if (isBlazor() && _this.parent.isServerRendered && xAxis) {\n        _this.parent.notify('setcolumnstyles', {\n          refresh: true\n        });\n      }\n\n      if (_this.parent.enableColumnVirtualization && (!isBlazor() || isBlazor() && !_this.parent.isServerRendered)) {\n        _this.header.virtualEle.adjustTable(colVFtable ? 0 : x, 0);\n\n        if (colVFtable) {\n          _this.header.virtualEle.adjustMovableTable(x, 0);\n        }\n      }\n    };\n  };\n\n  VirtualContentRenderer.prototype.dataBound = function () {\n    this.parent.notify(events.refreshVirtualFrozenHeight, {});\n\n    if (this.isSelection && this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      this.parent.selectRow(this.selectedRowIndex);\n    } else if (!isBlazor()) {\n      this.activeKey = this.empty;\n    }\n  };\n\n  VirtualContentRenderer.prototype.rowSelected = function () {\n    this.isSelection = false;\n  };\n\n  VirtualContentRenderer.prototype.eventListener = function (action) {\n    var _this = this;\n\n    this.parent[action](dataReady, this.onDataReady, this);\n    this.parent.addEventListener(events.dataBound, this.dataBound.bind(this));\n    this.parent.addEventListener(events.actionBegin, this.actionBegin.bind(this));\n    this.parent.addEventListener(events.actionComplete, this.actionComplete.bind(this));\n    this.parent.addEventListener(events.rowSelected, this.rowSelected.bind(this));\n    this.parent[action](refreshVirtualBlock, this.refreshContentRows, this);\n    this.parent[action](events.selectVirtualRow, this.selectVirtualRow, this);\n    this.parent[action](events.virtaulCellFocus, this.virtualCellFocus, this);\n    this.parent[action](events.virtualScrollEditActionBegin, this.editActionBegin, this);\n    this.parent[action](events.virtualScrollAddActionBegin, this.addActionBegin, this);\n    this.parent[action](events.virtualScrollEdit, this.restoreEdit, this);\n    this.parent[action](events.virtualScrollEditSuccess, this.editSuccess, this);\n    this.parent[action](events.refreshVirtualCache, this.refreshCache, this);\n    this.parent[action](events.editReset, this.resetIsedit, this);\n    this.parent[action](events.getVirtualData, this.getVirtualData, this);\n    this.parent[action](events.virtualScrollEditCancel, this.editCancel, this);\n    var event = this.actions;\n\n    for (var i = 0; i < event.length; i++) {\n      this.parent[action](event[i] + \"-begin\", this.onActionBegin, this);\n    }\n\n    var fn = function () {\n      _this.observer.observe(function (scrollArgs) {\n        return _this.scrollListener(scrollArgs);\n      }, _this.onEntered());\n\n      var gObj = _this.parent;\n\n      if (gObj.enablePersistence && gObj.scrollPosition) {\n        _this.content.scrollTop = gObj.scrollPosition.top;\n        var scrollValues = {\n          direction: 'down',\n          sentinel: _this.observer.sentinelInfo.down,\n          offset: gObj.scrollPosition,\n          focusElement: gObj.element\n        };\n\n        _this.scrollListener(scrollValues);\n\n        if (gObj.enableColumnVirtualization) {\n          _this.content.scrollLeft = gObj.scrollPosition.left;\n        }\n      }\n\n      _this.parent.off(contentReady, fn);\n    };\n\n    this.parent.on(contentReady, fn, this);\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.getVirtualData = function (data) {\n    data.virtualData = this.virtualData;\n    data.isAdd = this.isAdd;\n    data.isCancel = this.isCancel;\n  };\n\n  VirtualContentRenderer.prototype.editCancel = function (args) {\n    var dataIndex = getEditedDataIndex(this.parent, args.data);\n\n    if (!isNullOrUndefined(dataIndex)) {\n      args.data = this.parent.getCurrentViewRecords()[dataIndex];\n    }\n  };\n\n  VirtualContentRenderer.prototype.editSuccess = function (args) {\n    if (this.isNormaledit) {\n      if (!this.isAdd && args.data) {\n        this.updateCurrentViewData(args.data);\n      }\n\n      this.isAdd = false;\n    }\n  };\n\n  VirtualContentRenderer.prototype.updateCurrentViewData = function (data) {\n    var dataIndex = getEditedDataIndex(this.parent, data);\n\n    if (!isNullOrUndefined(dataIndex)) {\n      this.parent.getCurrentViewRecords()[dataIndex] = data;\n    }\n  };\n\n  VirtualContentRenderer.prototype.actionBegin = function (args) {\n    if (args.requestType !== 'virtualscroll') {\n      this.requestType = args.requestType;\n    }\n\n    if (!args.cancel) {\n      this.parent.notify(events.refreshVirtualFrozenRows, args);\n    }\n  };\n\n  VirtualContentRenderer.prototype.virtualCellFocus = function (e) {\n    // To decide the action (select or scroll), when using arrow keys for cell focus\n    var ele = document.activeElement;\n\n    if (ele.classList.contains('e-rowcell') && e && (e.action === 'upArrow' || e.action === 'downArrow')) {\n      var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n\n      if (e && (e.action === 'downArrow' || e.action === 'upArrow')) {\n        var scrollEle = this.parent.getContent().firstElementChild;\n        e.action === 'downArrow' ? rowIndex += 1 : rowIndex -= 1;\n        this.rowIndex = rowIndex;\n        this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n        var row = this.parent.getRowByIndex(rowIndex);\n        var page = this.parent.pageSettings.currentPage;\n        var visibleRowCount = Math.floor(scrollEle.offsetHeight / this.parent.getRowHeight()) - 1;\n        var emptyRow = false;\n\n        if (isNullOrUndefined(row)) {\n          emptyRow = true;\n\n          if (e.action === 'downArrow' && page === this.maxPage - 1 || e.action === 'upArrow' && page === 1) {\n            emptyRow = false;\n          }\n        }\n\n        if (emptyRow || ensureLastRow(row, this.parent) && e.action === 'downArrow' || ensureFirstRow(row, this.parent.getRowHeight() * 2) && e.action === 'upArrow') {\n          this.activeKey = e.action;\n          scrollEle.scrollTop = e.action === 'downArrow' ? (rowIndex - visibleRowCount) * this.parent.getRowHeight() : rowIndex * this.parent.getRowHeight();\n        } else {\n          this.activeKey = this.empty;\n        }\n\n        if (!isBlazor() || isBlazor() && !this.blazorDataLoad) {\n          this.parent.selectRow(rowIndex);\n        }\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.editActionBegin = function (e) {\n    this.editedRowIndex = e.index;\n    var rowData = extend({}, this.getRowObjectByIndex(e.index));\n    e.data = Object.keys(this.virtualData).length ? this.virtualData : rowData;\n  };\n\n  VirtualContentRenderer.prototype.refreshCache = function (data) {\n    var block = Math.ceil((this.editedRowIndex + 1) / this.getBlockSize());\n    var index = this.editedRowIndex - (block - 1) * this.getBlockSize();\n    this.vgenerator.cache[block][index].data = data;\n\n    if (this.vgenerator.movableCache[block]) {\n      this.vgenerator.movableCache[block][index].data = data;\n    }\n\n    if (this.vgenerator.frozenRightCache[block]) {\n      this.vgenerator.frozenRightCache[block][index].data = data;\n    }\n  };\n\n  VirtualContentRenderer.prototype.actionComplete = function (args) {\n    if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n      this.refreshOffsets();\n      this.refreshVirtualElement();\n\n      if (this.isNormaledit) {\n        if (args.requestType === 'cancel') {\n          this.isCancel = true;\n        }\n\n        this.isAdd = false;\n        this.editedRowIndex = this.empty;\n        this.virtualData = {};\n        this.parent.editModule.previousVirtualData = {};\n      }\n    }\n\n    if (this.parent.enableColumnVirtualization && args.requestType === 'filterafteropen' && this.currentInfo.columnIndexes && this.currentInfo.columnIndexes[0] > 0) {\n      this.parent.resetFilterDlgPosition(args.columnName);\n    }\n  };\n\n  VirtualContentRenderer.prototype.resetIsedit = function () {\n    if (this.parent.enableVirtualization && this.isNormaledit) {\n      if (this.parent.editSettings.allowEditing && Object.keys(this.virtualData).length || this.parent.editSettings.allowAdding && this.isAdd) {\n        this.parent.isEdit = true;\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.scrollAfterEdit = function () {\n    if (this.parent.editModule && this.parent.editSettings.allowEditing && this.isNormaledit) {\n      if (this.parent.element.querySelector('.e-gridform')) {\n        var editForm = this.parent.element.querySelector('.e-editedrow');\n        var addForm = this.parent.element.querySelector('.e-addedrow');\n\n        if (editForm || addForm) {\n          var rowData = editForm ? extend({}, this.getRowObjectByIndex(this.editedRowIndex)) : extend({}, this.emptyRowData);\n          this.virtualData = this.getVirtualEditedData(rowData);\n        }\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.createEmptyRowdata = function () {\n    var _this = this;\n\n    this.parent.getColumns().filter(function (e) {\n      _this.emptyRowData[e.field] = _this.empty;\n    });\n  };\n\n  VirtualContentRenderer.prototype.addActionBegin = function (args) {\n    if (this.isNormaledit) {\n      if (!Object.keys(this.emptyRowData).length) {\n        this.createEmptyRowdata();\n      }\n\n      this.isAdd = true;\n      var page = this.parent.pageSettings.currentPage;\n\n      if (page > 1 && this.parent.editSettings.newRowPosition === 'Top') {\n        this.isAdd = true;\n        this.onActionBegin();\n        args.startEdit = false;\n        this.content.scrollTop = 0;\n      }\n\n      if (page < this.maxPage - 1 && this.parent.editSettings.newRowPosition === 'Bottom') {\n        this.isAdd = true;\n        this.parent.setProperties({\n          pageSettings: {\n            currentPage: this.maxPage - 1\n          }\n        }, true);\n        args.startEdit = false;\n        this.content.scrollTop = this.offsets[this.offsetKeys.length];\n      }\n    }\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.getRowObjectByIndex = function (index) {\n    var data = this.getRowCollection(index, false, true);\n    return data;\n  };\n\n  VirtualContentRenderer.prototype.getBlockSize = function () {\n    return this.parent.pageSettings.pageSize >> 1;\n  };\n\n  VirtualContentRenderer.prototype.getBlockHeight = function () {\n    return this.getBlockSize() * this.parent.getRowHeight();\n  };\n\n  VirtualContentRenderer.prototype.isEndBlock = function (index) {\n    var totalBlocks = this.getTotalBlocks();\n    return index >= totalBlocks || index === totalBlocks - 1;\n  };\n\n  VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {\n    var rows = this.parent.vcRows;\n    return Math.floor(rows.length / this.getBlockSize() < 1 ? 1 : rows.length / this.getBlockSize());\n  };\n\n  VirtualContentRenderer.prototype.getTotalBlocks = function () {\n    return Math.ceil(this.count / this.getBlockSize());\n  };\n\n  VirtualContentRenderer.prototype.getColumnOffset = function (block) {\n    return this.vgenerator.cOffsets[block] | 0;\n  };\n\n  VirtualContentRenderer.prototype.getModelGenerator = function () {\n    return new VirtualRowModelGenerator(this.parent);\n  };\n\n  VirtualContentRenderer.prototype.resetScrollPosition = function (action) {\n    if (this.actions.some(function (value) {\n      return value === action;\n    })) {\n      this.preventEvent = this.content.scrollTop !== 0;\n      this.content.scrollTop = 0;\n    }\n\n    if (action !== 'virtualscroll') {\n      this.isAdd = false;\n    }\n  };\n\n  VirtualContentRenderer.prototype.onActionBegin = function (e) {\n    //Update property silently..\n    this.parent.setProperties({\n      pageSettings: {\n        currentPage: 1\n      }\n    }, true);\n  };\n\n  VirtualContentRenderer.prototype.getRows = function () {\n    return this.vgenerator.getRows();\n  };\n\n  VirtualContentRenderer.prototype.getRowByIndex = function (index) {\n    if (isGroupAdaptive(this.parent)) {\n      return this.parent.getDataRows()[index];\n    }\n\n    return this.getRowCollection(index, false);\n  };\n\n  VirtualContentRenderer.prototype.getMovableVirtualRowByIndex = function (index) {\n    return this.getRowCollection(index, true);\n  };\n\n  VirtualContentRenderer.prototype.getFrozenRightVirtualRowByIndex = function (index) {\n    return this.getRowCollection(index, false, false, true);\n  };\n\n  VirtualContentRenderer.prototype.getRowCollection = function (index, isMovable, isRowObject, isFrozenRight) {\n    var prev = this.prevInfo.blockIndexes;\n    var startIdx = !isBlazor() || isBlazor() && !this.parent.isServerRendered ? (prev[0] - 1) * this.getBlockSize() : this.startIndex;\n    var rowCollection = isMovable ? this.parent.getMovableDataRows() : this.parent.getDataRows();\n    rowCollection = isFrozenRight ? this.parent.getFrozenRightDataRows() : rowCollection;\n    var collection = isRowObject ? this.parent.getCurrentViewRecords() : rowCollection;\n    var selectedRow = collection[index - startIdx];\n\n    if (this.parent.frozenRows && this.parent.pageSettings.currentPage > 1) {\n      if (!isRowObject) {\n        selectedRow = index <= this.parent.frozenRows ? rowCollection[index] : rowCollection[index - startIdx + this.parent.frozenRows];\n      } else {\n        selectedRow = index <= this.parent.frozenRows ? this.parent.getRowsObject()[index].data : selectedRow;\n      }\n    }\n\n    return selectedRow;\n  };\n\n  VirtualContentRenderer.prototype.getVirtualRowIndex = function (index) {\n    var prev = this.prevInfo.blockIndexes;\n    var startIdx = (prev[0] - 1) * this.getBlockSize();\n    return startIdx + index;\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.refreshOffsets = function () {\n    var gObj = this.parent;\n    var row = 0;\n    var bSize = this.getBlockSize();\n    var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n    this.prevHeight = this.offsets[total];\n    this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;\n    this.offsets = {}; //Row offset update\n\n    var blocks = Array.apply(null, Array(total)).map(function () {\n      return ++row;\n    });\n\n    for (var i = 0; i < blocks.length; i++) {\n      var tmp = (this.vgenerator.cache[blocks[i]] || []).length;\n      var rem = !isGroupAdaptive(this.parent) ? this.count % bSize : gObj.vcRows.length % bSize;\n      var size = !isGroupAdaptive(this.parent) && blocks[i] in this.vgenerator.cache ? tmp * this.parent.getRowHeight() : rem && blocks[i] === total ? rem * this.parent.getRowHeight() : this.getBlockHeight(); // let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?\n      // tmp * getRowHeight() : this.getBlockHeight();\n\n      this.offsets[blocks[i]] = (this.offsets[blocks[i] - 1] | 0) + size;\n      this.tmpOffsets[blocks[i]] = this.offsets[blocks[i] - 1] | 0;\n    }\n\n    this.offsetKeys = Object.keys(this.offsets);\n\n    if (isGroupAdaptive(this.parent)) {\n      this.parent.vGroupOffsets = this.offsets;\n    } //Column offset update\n\n\n    if (this.parent.enableColumnVirtualization) {\n      this.vgenerator.refreshColOffsets();\n    }\n  };\n\n  VirtualContentRenderer.prototype.refreshVirtualElement = function () {\n    this.vgenerator.refreshColOffsets();\n    this.setVirtualHeight();\n  };\n\n  VirtualContentRenderer.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var frozenCols = this.parent.getFrozenColumns();\n    var fcntColGrp;\n    var mcntColGrp;\n\n    if (frozenCols) {\n      fcntColGrp = [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('col'));\n      mcntColGrp = [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('col'));\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      this.parent.notify('setvisibility', columns);\n    }\n\n    var rows = [];\n    rows = this.getRows();\n    var testRow;\n    rows.some(function (r) {\n      if (r.isDataRow) {\n        testRow = r;\n      }\n\n      return r.isDataRow;\n    });\n    var needFullRefresh = true;\n\n    if (!gObj.groupSettings.columns.length && testRow) {\n      needFullRefresh = false;\n    }\n\n    var tr = gObj.getDataRows();\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      var idx = gObj.getNormalizedColumnIndex(column.uid);\n      var displayVal = column.visible === true ? '' : 'none';\n      var colGrp = void 0;\n\n      if (fcntColGrp && mcntColGrp) {\n        if (idx >= frozenCols) {\n          colGrp = mcntColGrp;\n          tr = this.parent.getMovableRows();\n          idx = idx - frozenCols;\n        } else {\n          colGrp = fcntColGrp;\n        }\n      } else {\n        colGrp = this.getColGroup().children;\n      }\n\n      if (idx !== -1 && testRow && idx < testRow.cells.length) {\n        setStyleAttribute(colGrp[idx], {\n          'display': displayVal\n        });\n      }\n\n      if (!needFullRefresh) {\n        var width = void 0;\n\n        if (column.visible) {\n          width = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n        } else {\n          width = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n        }\n\n        if (width > gObj.width) {\n          this.setDisplayNone(tr, idx, displayVal, rows);\n\n          if (this.parent.enableColumnVirtualization) {\n            this.virtualEle.setWrapperWidth(width + '');\n          }\n\n          this.refreshVirtualElement();\n        } else {\n          needFullRefresh = true;\n        }\n      }\n\n      if (!this.parent.invokedFromMedia && column.hideAtMedia) {\n        this.parent.updateMediaColumns(column);\n      }\n\n      this.parent.invokedFromMedia = false;\n    }\n\n    if (isBlazor() && this.parent.isServerRendered && needFullRefresh) {\n      var inViewIdx = this.parent.inViewIndexes;\n      var translateX = this.getColumnOffset(inViewIdx[0] - 1);\n      var width = this.getColumnOffset(inViewIdx[inViewIdx.length - 1]) - translateX + '';\n      this.parent.notify('refresh-virtual-indices', {\n        requestType: 'virtualScrollRefresh',\n        startColumnIndex: inViewIdx[0],\n        endColumnIndex: inViewIdx[inViewIdx.length - 1],\n        axis: 'X',\n        VTablewidth: width,\n        translateX: translateX\n      });\n      this.parent.notify('setcolumnstyles', {});\n    }\n\n    if (needFullRefresh || frozenCols) {\n      this.refreshContentRows({\n        requestType: 'refresh'\n      });\n    } else {\n      this.parent.notify(events.partialRefresh, {\n        rows: rows,\n        args: {\n          isFrozen: false,\n          rows: rows\n        }\n      });\n    }\n  };\n\n  VirtualContentRenderer.prototype.selectVirtualRow = function (args) {\n    var _this = this;\n\n    if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow' && !this.requestTypes.some(function (value) {\n      return value === _this.requestType;\n    }) && !this.parent.selectionModule.isInteracted) {\n      var selectedRow = this.parent.getRowByIndex(args.selectedIndex);\n      var rowHeight = this.parent.getRowHeight();\n      var eleOffsHeight = this.content.offsetHeight;\n\n      if (!selectedRow || this.isRowInView(args.selectedIndex, selectedRow, this.content, eleOffsHeight, rowHeight)) {\n        this.isSelection = true;\n        this.selectedRowIndex = args.selectedIndex;\n        var scrollTop = (args.selectedIndex + 1) * rowHeight;\n\n        if (!isNullOrUndefined(scrollTop)) {\n          this.content.scrollTop = scrollTop;\n        }\n      }\n    }\n\n    if (this.parent.isFrozenGrid() && this.requestType) {\n      if (this.parent.getTablesCount() === this.frzIdx) {\n        this.requestType = this.empty;\n        this.frzIdx = 1;\n      } else {\n        this.frzIdx++;\n      }\n    } else {\n      this.requestType = this.empty;\n    }\n  };\n\n  VirtualContentRenderer.prototype.isRowInView = function (index, selectedRow, ele, eleOffsHeight, rowHeight) {\n    if (isBlazor()) {\n      var exactTopIndex = ele.scrollTop / rowHeight;\n      var exactEndIndex = exactTopIndex + eleOffsHeight / rowHeight;\n      return index < exactTopIndex || index > exactEndIndex;\n    } else {\n      if (this.parent.frozenRows && index < this.parent.frozenRows) {\n        return false;\n      }\n\n      var rectTop = selectedRow ? selectedRow.getBoundingClientRect().top : 0;\n      return rectTop < rowHeight || rectTop > eleOffsHeight;\n    }\n  };\n\n  return VirtualContentRenderer;\n}(ContentRender);\n\nexport { VirtualContentRenderer };\n/**\n * @hidden\n */\n\nvar VirtualHeaderRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualHeaderRenderer, _super);\n\n  function VirtualHeaderRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.virtualEle = new VirtualElementHandler();\n    _this.isMovable = false;\n    _this.gen = new VirtualRowModelGenerator(_this.parent);\n\n    _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n\n    _this.parent.on(refreshVirtualBlock, function (e) {\n      return e.virtualInfo.sentinelInfo.axis === 'X' ? _this.refreshUI() : null;\n    }, _this);\n\n    return _this;\n  }\n\n  VirtualHeaderRenderer.prototype.renderTable = function () {\n    this.gen.refreshColOffsets();\n    this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      this.parent.notify('refresh-virtual-indices', {\n        startColumnIndex: this.parent.contentModule.startColIndex,\n        endColumnIndex: this.parent.contentModule.endColIndex,\n        axis: 'X'\n      });\n    }\n\n    _super.prototype.renderTable.call(this);\n\n    this.virtualEle.table = this.getTable();\n    this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');\n    this.virtualEle.content.style.position = 'relative';\n    this.virtualEle.renderWrapper();\n    this.virtualEle.renderPlaceHolder('absolute');\n  };\n\n  VirtualHeaderRenderer.prototype.appendContent = function (table) {\n    if (!this.isMovable) {\n      this.virtualEle.wrapper.appendChild(table);\n    } else {\n      this.virtualEle.movableWrapper.appendChild(table);\n      this.isMovable = false;\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.refreshUI = function () {\n    this.isMovable = this.parent.isFrozenGrid();\n    this.setFrozenTable(this.parent.getMovableVirtualContent());\n    this.gen.refreshColOffsets();\n    this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n\n    _super.prototype.refreshUI.call(this);\n\n    this.setFrozenTable(this.parent.getFrozenVirtualContent());\n  };\n\n  VirtualHeaderRenderer.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var displayVal;\n    var idx;\n    var needFullRefresh;\n    var frozenCols = this.parent.getFrozenColumns();\n    var fhdrColGrp;\n    var mhdrColGrp;\n\n    if (frozenCols) {\n      fhdrColGrp = [].slice.call(this.parent.getFrozenVirtualHeader().querySelectorAll('col'));\n      mhdrColGrp = [].slice.call(this.parent.getMovableVirtualHeader().querySelectorAll('col'));\n    }\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      idx = gObj.getNormalizedColumnIndex(column.uid);\n      displayVal = column.visible ? '' : 'none';\n      var colGrp = void 0;\n\n      if (fhdrColGrp && mhdrColGrp) {\n        if (idx >= frozenCols) {\n          colGrp = mhdrColGrp;\n          idx = idx - frozenCols;\n        } else {\n          colGrp = fhdrColGrp;\n        }\n      } else {\n        colGrp = this.getColGroup().children;\n      }\n\n      setStyleAttribute(colGrp[idx], {\n        'display': displayVal\n      });\n\n      if (gObj.enableColumnVirtualization && !gObj.groupSettings.columns.length) {\n        var tablewidth = void 0;\n\n        if (column.visible) {\n          tablewidth = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n        } else {\n          tablewidth = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n        }\n\n        if (tablewidth > gObj.width) {\n          this.setDisplayNone(column, displayVal);\n          this.virtualEle.setWrapperWidth(tablewidth + '');\n          this.gen.refreshColOffsets();\n        } else {\n          needFullRefresh = true;\n        }\n      } else {\n        needFullRefresh = true;\n      }\n\n      if (needFullRefresh && !frozenCols) {\n        this.refreshUI();\n      }\n    }\n\n    if (frozenCols) {\n      this.parent.notify(events.columnPositionChanged, {});\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.setFrozenTable = function (content) {\n    if (this.parent.isFrozenGrid() && this.parent.enableColumnVirtualization && this.parent.contentModule.isXaxis()) {\n      this.parent.contentModule.setTable(content.querySelector('.e-table'));\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.setDisplayNone = function (col, displayVal) {\n    var frozenCols = this.parent.isFrozenGrid();\n    var table = this.getTable();\n\n    if (frozenCols && col.getFreezeTableName() === 'movable') {\n      table = this.parent.getMovableVirtualHeader().querySelector('.e-table');\n    }\n\n    for (var _i = 0, _a = [].slice.apply(table.querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n      var ele = _a[_i];\n\n      if (ele.querySelector('[e-mappinguid]') && ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === col.uid) {\n        setStyleAttribute(ele, {\n          'display': displayVal\n        });\n\n        if (displayVal === '') {\n          removeClass([ele], 'e-hide');\n        }\n\n        break;\n      }\n    }\n  };\n\n  return VirtualHeaderRenderer;\n}(HeaderRender);\n\nexport { VirtualHeaderRenderer };\n/**\n * @hidden\n */\n\nvar VirtualElementHandler =\n/** @class */\nfunction () {\n  function VirtualElementHandler() {}\n\n  VirtualElementHandler.prototype.renderWrapper = function (height) {\n    if (isBlazor()) {\n      this.wrapper = this.content.querySelector('.e-virtualtable') ? this.content.querySelector('.e-virtualtable') : createElement('div', {\n        className: 'e-virtualtable'\n      });\n      this.wrapper.setAttribute('styles', \"min-height:\" + formatUnit(height));\n    } else {\n      this.wrapper = createElement('div', {\n        className: 'e-virtualtable',\n        styles: \"min-height:\" + formatUnit(height)\n      });\n    }\n\n    this.wrapper.appendChild(this.table);\n    this.content.appendChild(this.wrapper);\n  };\n\n  VirtualElementHandler.prototype.renderPlaceHolder = function (position) {\n    if (position === void 0) {\n      position = 'relative';\n    }\n\n    if (isBlazor()) {\n      this.placeholder = this.content.querySelector('.e-virtualtrack') ? this.content.querySelector('.e-virtualtrack') : createElement('div', {\n        className: 'e-virtualtrack'\n      });\n      this.placeholder.setAttribute('styles', \"position:\" + position);\n    } else {\n      this.placeholder = createElement('div', {\n        className: 'e-virtualtrack',\n        styles: \"position:\" + position\n      });\n    }\n\n    this.content.appendChild(this.placeholder);\n  };\n\n  VirtualElementHandler.prototype.renderFrozenWrapper = function (height) {\n    this.wrapper = createElement('div', {\n      className: 'e-virtualtable',\n      styles: \"min-height:\" + formatUnit(height) + \"; display: flex\"\n    });\n    this.content.appendChild(this.wrapper);\n  };\n\n  VirtualElementHandler.prototype.renderFrozenPlaceHolder = function () {\n    this.placeholder = createElement('div', {\n      className: 'e-virtualtrack'\n    });\n    this.content.appendChild(this.placeholder);\n  };\n\n  VirtualElementHandler.prototype.renderMovableWrapper = function (height) {\n    this.movableWrapper = createElement('div', {\n      className: 'e-virtualtable',\n      styles: \"min-height:\" + formatUnit(height)\n    });\n    this.movableContent.appendChild(this.movableWrapper);\n  };\n\n  VirtualElementHandler.prototype.renderMovablePlaceHolder = function () {\n    this.movablePlaceholder = createElement('div', {\n      className: 'e-virtualtrack'\n    });\n    this.movableContent.appendChild(this.movablePlaceholder);\n  };\n\n  VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {\n    this.wrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n  };\n\n  VirtualElementHandler.prototype.adjustMovableTable = function (xValue, yValue) {\n    this.movableWrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n  };\n\n  VirtualElementHandler.prototype.setMovableWrapperWidth = function (width, full) {\n    this.movableWrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n  };\n\n  VirtualElementHandler.prototype.setMovableVirtualHeight = function (height, width) {\n    this.movablePlaceholder.style.height = height + \"px\";\n    this.movablePlaceholder.style.width = width;\n  };\n\n  VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {\n    this.wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n  };\n\n  VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {\n    this.placeholder.style.height = height + \"px\";\n    this.placeholder.style.width = width;\n  };\n\n  VirtualElementHandler.prototype.setFreezeWrapperWidth = function (wrapper, width, full) {\n    wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n  };\n\n  return VirtualElementHandler;\n}();\n\nexport { VirtualElementHandler };","map":{"version":3,"sources":["C:/Users/appsk/Documents/Projects/PredictiveMaintenance/React PDM/env/frontend/node_modules/@syncfusion/ej2-grids/src/grid/renderer/virtual-content-renderer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","remove","createElement","closest","formatUnit","Browser","extend","isNullOrUndefined","removeClass","DataManager","dataReady","modelChanged","refreshVirtualBlock","contentReady","events","RenderType","ContentRender","HeaderRender","InterSectionObserver","VirtualRowModelGenerator","isGroupAdaptive","ensureLastRow","ensureFirstRow","getEditedDataIndex","isBlazor","setStyleAttribute","VirtualContentRenderer","_super","parent","locator","_this","call","prevHeight","startIndex","preStartIndex","preventEvent","actions","offsets","tmpOffsets","virtualEle","VirtualElementHandler","offsetKeys","isFocused","isSelection","isBottom","rndrCount","empty","undefined","isCancel","requestTypes","isNormaledit","editSettings","mode","virtualData","emptyRowData","vfColIndex","frzIdx","eventListener","on","columnVisibilityChanged","setVisible","vgenerator","generator","renderTable","header","getService","getRenderer","Header","table","getTable","content","getPanel","querySelector","renderWrapper","height","renderPlaceHolder","wrapper","style","position","debounceEvent","dataSource","offline","opt","container","pageHeight","getBlockHeight","axes","enableColumnVirtualization","observer","renderEmpty","tbody","appendChild","adjustTable","scrollListener","scrollArgs","scrollAfterEdit","enablePersistence","scrollPosition","offset","isDestroyed","document","activeElement","info","sentinel","pStartIndex","previousColIndexes","getColumnIndexesInView","viewInfo","currentInfo","getInfoFromView","direction","isServerRendered","JSON","stringify","columnIndexes","refreshHeader","translateX","getColumnOffset","startColIndex","width","endColIndex","notify","requestType","startColumnIndex","endColumnIndex","length","axis","VTablewidth","blockIndexes","prevInfo","toString","event","top","scrollTop","virtualInfo","focusElement","isIE","hideSpinner","restoreEdit","setColumnIndexesInView","pageSettings","currentPage","loadNext","loadSelf","nextInfo","page","virtualStartIndex","virtualEndIndex","endIndex","RHeight","getRowHeight","block","blk","isBlockAvailable","e","isBlockAdded","tempBlocks","infoType","sentinelInfo","preEndIndex","vHeight","indexOf","getBoundingClientRect","element","getPageFromTop","getBlockIndexes","blocks","ensureBlocks","activeKey","newBlock","filter","val","every","bind","Math","max","firstBlock","ceil","rowIndex","getBlockSize","getColumnIndexes","rowHeight","exactTopIndex","noOfInViewIndexes","exactEndIndex","pageSizeBy4","pageSize","sIndex","round","count","floor","eIndex","setKeyboardNavIndex","loadAtIndex","idxAddedToExactTop","blazorDataLoad","blzRowIndex","blur","index","mIdx","old","indexes","isFrozenGrid","ind","isEndBlock","some","result","getGroupedTotalBlocks","getTotalBlocks","slice","appendContent","target","newChild","isFrozen","frzCols","getFrozenColumns","getFrozenLeftColumnsCount","colVFtable","checkFirstBlockColIndexes","cBlock","cOffset","groupSettings","columns","refreshOffsets","value","translate","getTranslateY","adjustMovableTable","cIndex","setMovableWrapperWidth","setWrapperWidth","name","parentNode","renderFrozenRightContent","getContent","renderMovableContent","getFrozenVirtualContent","getMovableVirtualContent","isReact","rowTemplate","frozenRows","i","children","getFrozenMode","sTop","setVirtualHeight","setPageHeight","getOffset","focus","lastPage","firstElementChild","autoCol","focusCell","restoreAdd","frozenCols","push","splice","row","getRowByIndex","cell","cells","cellIndex","preventScroll","selectRow","parseInt","getAttribute","left","trigger","allowEditing","editModule","editedRowIndex","keys","top_1","offsetHeight","isEdit","startEdit","rowData","getRowObjectByIndex","getVirtualEditedData","editForms","querySelectorAll","data","getCurrentEditedData","getTablesCount","isAdd","isTop","newRowPosition","maxPage","addRecord","onDataReady","checkAndResetCache","resetScrollPosition","virtualHeightTemp","scrollableElementHeight","clientHeight","virtualHeight","setMovableVirtualHeight","total","extra","iOffset","Number","border","min","getPage","cHeight","isOnenter","endTranslate","blockHeight","maxBlock","onEntered","current","isWheel","check","showSpinner","xAxis","x","y","refresh","dataBound","refreshVirtualFrozenHeight","selectedRowIndex","rowSelected","action","addEventListener","actionBegin","actionComplete","refreshContentRows","selectVirtualRow","virtaulCellFocus","virtualCellFocus","virtualScrollEditActionBegin","editActionBegin","virtualScrollAddActionBegin","addActionBegin","virtualScrollEdit","virtualScrollEditSuccess","editSuccess","refreshVirtualCache","refreshCache","editReset","resetIsedit","getVirtualData","virtualScrollEditCancel","editCancel","onActionBegin","fn","observe","gObj","scrollValues","down","scrollLeft","off","args","dataIndex","getCurrentViewRecords","updateCurrentViewData","cancel","refreshVirtualFrozenRows","ele","classList","contains","parentElement","scrollEle","visibleRowCount","emptyRow","cache","movableCache","frozenRightCache","refreshVirtualElement","previousVirtualData","resetFilterDlgPosition","columnName","enableVirtualization","allowAdding","editForm","addForm","createEmptyRowdata","getColumns","field","setProperties","getRowCollection","totalBlocks","rows","vcRows","cOffsets","getModelGenerator","getRows","getDataRows","getMovableVirtualRowByIndex","getFrozenRightVirtualRowByIndex","isMovable","isRowObject","isFrozenRight","prev","startIdx","rowCollection","getMovableDataRows","getFrozenRightDataRows","collection","selectedRow","getRowsObject","getVirtualRowIndex","bSize","apply","map","tmp","rem","size","vGroupOffsets","refreshColOffsets","fcntColGrp","mcntColGrp","testRow","r","isDataRow","needFullRefresh","tr","c","clen","column","idx","getNormalizedColumnIndex","uid","displayVal","visible","colGrp","getMovableRows","getColGroup","offsetWidth","setDisplayNone","invokedFromMedia","hideAtMedia","updateMediaColumns","inViewIdx","inViewIndexes","partialRefresh","selectionModule","isInteracted","selectedIndex","eleOffsHeight","isRowInView","rectTop","VirtualHeaderRenderer","gen","refreshUI","contentModule","movableWrapper","setFrozenTable","fhdrColGrp","mhdrColGrp","getFrozenVirtualHeader","getMovableVirtualHeader","tablewidth","columnPositionChanged","isXaxis","setTable","col","getFreezeTableName","_i","_a","className","setAttribute","styles","placeholder","renderFrozenWrapper","renderFrozenPlaceHolder","renderMovableWrapper","movableContent","renderMovablePlaceHolder","movablePlaceholder","xValue","yValue","transform","full","setFreezeWrapperWidth"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { remove, createElement, closest, formatUnit, Browser, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { dataReady, modelChanged, refreshVirtualBlock, contentReady } from '../base/constant';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { ContentRender } from './content-renderer';\nimport { HeaderRender } from './header-renderer';\nimport { InterSectionObserver } from '../services/intersection-observer';\nimport { VirtualRowModelGenerator } from '../services/virtual-row-model-generator';\nimport { isGroupAdaptive, ensureLastRow, ensureFirstRow, getEditedDataIndex } from '../base/util';\nimport { isBlazor, setStyleAttribute } from '@syncfusion/ej2-base';\n/**\n * VirtualContentRenderer\n * @hidden\n */\nvar VirtualContentRenderer = /** @class */ (function (_super) {\n    __extends(VirtualContentRenderer, _super);\n    function VirtualContentRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.prevHeight = 0;\n        /** @hidden */\n        _this.startIndex = 0;\n        _this.preStartIndex = 0;\n        _this.preventEvent = false;\n        _this.actions = ['filtering', 'searching', 'grouping', 'ungrouping'];\n        /** @hidden */\n        _this.offsets = {};\n        _this.tmpOffsets = {};\n        /** @hidden */\n        _this.virtualEle = new VirtualElementHandler();\n        _this.offsetKeys = [];\n        _this.isFocused = false;\n        _this.isSelection = false;\n        _this.isBottom = false;\n        _this.rndrCount = 0;\n        _this.empty = undefined;\n        _this.isCancel = false;\n        _this.requestTypes = ['beginEdit', 'cancel', 'delete', 'add', 'save'];\n        _this.isNormaledit = _this.parent.editSettings.mode === 'Normal';\n        /** @hidden */\n        _this.virtualData = {};\n        _this.emptyRowData = {};\n        _this.vfColIndex = [];\n        _this.frzIdx = 1;\n        _this.locator = locator;\n        _this.eventListener('on');\n        _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n        _this.vgenerator = _this.generator;\n        return _this;\n    }\n    VirtualContentRenderer.prototype.renderTable = function () {\n        this.header = this.locator.getService('rendererFactory').getRenderer(RenderType.Header);\n        _super.prototype.renderTable.call(this);\n        this.virtualEle.table = this.getTable();\n        this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');\n        this.virtualEle.renderWrapper(this.parent.height);\n        this.virtualEle.renderPlaceHolder();\n        this.virtualEle.wrapper.style.position = 'absolute';\n        var debounceEvent = (this.parent.dataSource instanceof DataManager && !this.parent.dataSource.dataSource.offline);\n        var opt = {\n            container: this.content, pageHeight: this.getBlockHeight() * 2, debounceEvent: debounceEvent,\n            axes: this.parent.enableColumnVirtualization ? ['X', 'Y'] : ['Y']\n        };\n        this.observer = new InterSectionObserver(this.virtualEle.wrapper, opt);\n    };\n    VirtualContentRenderer.prototype.renderEmpty = function (tbody) {\n        this.getTable().appendChild(tbody);\n        this.virtualEle.adjustTable(0, 0);\n    };\n    VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {\n        this.scrollAfterEdit();\n        if (this.parent.enablePersistence) {\n            this.parent.scrollPosition = scrollArgs.offset;\n        }\n        if (this.preventEvent || this.parent.isDestroyed) {\n            this.preventEvent = false;\n            return;\n        }\n        if (isNullOrUndefined(document.activeElement)) {\n            this.isFocused = false;\n        }\n        else {\n            this.isFocused = this.content === closest(document.activeElement, '.e-content') || this.content === document.activeElement;\n        }\n        var info = scrollArgs.sentinel;\n        var pStartIndex = this.preStartIndex;\n        var previousColIndexes = this.parent.getColumnIndexesInView();\n        var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);\n        if (isBlazor() && this.parent.isServerRendered && this.parent.enableColumnVirtualization &&\n            (JSON.stringify(previousColIndexes) !== JSON.stringify(viewInfo.columnIndexes))) {\n            this.parent.refreshHeader();\n            var translateX = this.getColumnOffset(this.startColIndex - 1);\n            var width = this.getColumnOffset(this.endColIndex - 1) - translateX + '';\n            this.parent.notify('refresh-virtual-indices', { requestType: 'virtualscroll', startColumnIndex: viewInfo.columnIndexes[0],\n                endColumnIndex: viewInfo.columnIndexes[viewInfo.columnIndexes.length - 1], axis: 'X',\n                VTablewidth: width, translateX: this.getColumnOffset(viewInfo.columnIndexes[0] - 1) });\n            this.parent.notify('setcolumnstyles', {});\n        }\n        if (isGroupAdaptive(this.parent) && !isBlazor()) {\n            if ((info.axis === 'Y' && viewInfo.blockIndexes && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString())\n                && scrollArgs.direction === 'up' && viewInfo.blockIndexes[viewInfo.blockIndexes.length - 1] !== 2) {\n                return;\n            }\n            else {\n                viewInfo.event = 'refresh-virtual-block';\n                if (!isNullOrUndefined(viewInfo.offsets)) {\n                    viewInfo.offsets.top = this.content.scrollTop;\n                }\n                this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo, focusElement: scrollArgs.focusElement });\n                return;\n            }\n        }\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            if (this.prevInfo && ((info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString())\n                || (info.axis === 'X' && this.prevInfo.columnIndexes.toString() === viewInfo.columnIndexes.toString()))) {\n                if (Browser.isIE) {\n                    this.parent.hideSpinner();\n                }\n                this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n                this.restoreEdit();\n                return;\n            }\n        }\n        this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            this.parent.pageSettings.currentPage = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n        }\n        else if (isBlazor() && this.parent.isServerRendered && this.preStartIndex !== pStartIndex &&\n            this.parent.pageSettings.currentPage === viewInfo.currentPage) {\n            this.parent.notify('refresh-virtual-indices', { requestType: 'virtualscroll', virtualStartIndex: viewInfo.startIndex,\n                virtualEndIndex: viewInfo.endIndex, axis: 'Y', RHeight: this.parent.getRowHeight() });\n        }\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            this.requestType = 'virtualscroll';\n            this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo,\n                focusElement: scrollArgs.focusElement });\n        }\n        else if (this.preStartIndex !== pStartIndex && this.parent.pageSettings.currentPage !== viewInfo.currentPage) {\n            this.parent.pageSettings.currentPage = viewInfo.currentPage;\n            this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualStartIndex: viewInfo.startIndex,\n                virtualEndIndex: viewInfo.endIndex, axis: 'Y', RHeight: this.parent.getRowHeight() });\n        }\n    };\n    VirtualContentRenderer.prototype.block = function (blk) {\n        return this.vgenerator.isBlockAvailable(blk);\n    };\n    VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {\n        var isBlockAdded = false;\n        var tempBlocks = [];\n        var infoType = { direction: direction, sentinelInfo: info, offsets: e,\n            startIndex: this.preStartIndex, endIndex: this.preEndIndex };\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height :\n            this.parent.element.getBoundingClientRect().height;\n        infoType.page = this.getPageFromTop(e.top, infoType);\n        infoType.blockIndexes = tempBlocks = this.vgenerator.getBlockIndexes(infoType.page);\n        infoType.loadSelf = !this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);\n        var blocks = this.ensureBlocks(infoType);\n        if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {\n            // To avoid dupilcate row index problem in key focus support\n            var newBlock = blocks[blocks.length - 1];\n            if (infoType.blockIndexes.indexOf(newBlock) === -1) {\n                isBlockAdded = true;\n            }\n        }\n        infoType.blockIndexes = blocks;\n        infoType.loadNext = !blocks.filter(function (val) { return tempBlocks.indexOf(val) === -1; })\n            .every(this.block.bind(this));\n        infoType.event = (infoType.loadNext || infoType.loadSelf) ? modelChanged : refreshVirtualBlock;\n        infoType.nextInfo = infoType.loadNext ? { page: Math.max(1, infoType.page + (direction === 'down' ? 1 : -1)) } : {};\n        if (isBlockAdded) {\n            infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];\n        }\n        if (this.activeKey === 'downArrow') {\n            var firstBlock = Math.ceil(this.rowIndex / this.getBlockSize());\n            if (firstBlock !== 1 && (infoType.blockIndexes[1] !== firstBlock || infoType.blockIndexes.length < 3)) {\n                infoType.blockIndexes = [firstBlock - 1, firstBlock, firstBlock + 1];\n            }\n        }\n        infoType.columnIndexes = info.axis === 'X' ? this.vgenerator.getColumnIndexes() : this.parent.getColumnIndexesInView();\n        if (this.parent.enableColumnVirtualization && info.axis === 'X') {\n            infoType.event = refreshVirtualBlock;\n        }\n        if (isBlazor() && this.parent.isServerRendered) {\n            var rowHeight = this.parent.getRowHeight();\n            var exactTopIndex = e.top / rowHeight;\n            var noOfInViewIndexes = vHeight / rowHeight;\n            var exactEndIndex = exactTopIndex + noOfInViewIndexes;\n            var pageSizeBy4 = this.parent.pageSettings.pageSize / 4;\n            if (infoType.direction === 'down') {\n                var sIndex = Math.round(exactEndIndex) - Math.round((pageSizeBy4));\n                if (isNullOrUndefined(infoType.startIndex) || (exactEndIndex >\n                    (infoType.startIndex + Math.round((this.parent.pageSettings.pageSize / 2 + pageSizeBy4)))\n                    && infoType.endIndex !== this.count)) {\n                    infoType.startIndex = sIndex >= 0 ? Math.round(sIndex) : 0;\n                    infoType.startIndex = infoType.startIndex > exactTopIndex ? Math.floor(exactTopIndex) : infoType.startIndex;\n                    var eIndex = infoType.startIndex + this.parent.pageSettings.pageSize;\n                    infoType.startIndex = eIndex < exactEndIndex ? (Math.ceil(exactEndIndex) - this.parent.pageSettings.pageSize)\n                        : infoType.startIndex;\n                    infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n                    infoType.startIndex = eIndex >= this.count ?\n                        infoType.endIndex - this.parent.pageSettings.pageSize : infoType.startIndex;\n                    infoType.currentPage = Math.ceil(infoType.endIndex / this.parent.pageSettings.pageSize);\n                    this.setKeyboardNavIndex();\n                }\n            }\n            else if (infoType.direction === 'up') {\n                if (infoType.startIndex && infoType.endIndex) {\n                    var loadAtIndex = Math.round(((infoType.startIndex * rowHeight) + (pageSizeBy4 * rowHeight)) / rowHeight);\n                    if (exactTopIndex < loadAtIndex) {\n                        var idxAddedToExactTop = (pageSizeBy4) > noOfInViewIndexes ? pageSizeBy4 :\n                            (noOfInViewIndexes + noOfInViewIndexes / 4);\n                        var eIndex = Math.round(exactTopIndex + idxAddedToExactTop);\n                        infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n                        var sIndex = infoType.endIndex - this.parent.pageSettings.pageSize;\n                        infoType.startIndex = sIndex > 0 ? sIndex : 0;\n                        infoType.endIndex = sIndex < 0 ? this.parent.pageSettings.pageSize : infoType.endIndex;\n                        infoType.currentPage = Math.ceil(infoType.startIndex / this.parent.pageSettings.pageSize);\n                        this.setKeyboardNavIndex();\n                    }\n                }\n            }\n            this.preStartIndex = this.startIndex = infoType.startIndex;\n            this.preEndIndex = infoType.endIndex;\n            infoType.event = (infoType.currentPage !== this.parent.pageSettings.currentPage) ? modelChanged : refreshVirtualBlock;\n        }\n        return infoType;\n    };\n    VirtualContentRenderer.prototype.setKeyboardNavIndex = function () {\n        this.blazorDataLoad = true;\n        if (this.activeKey === 'downArrow' || this.activeKey === 'upArrow') {\n            this.blzRowIndex = this.activeKey === 'downArrow' ? this.rowIndex + 1 : this.rowIndex - 1;\n            document.activeElement.blur();\n        }\n    };\n    VirtualContentRenderer.prototype.ensureBlocks = function (info) {\n        var _this = this;\n        var index = info.blockIndexes[info.block];\n        var mIdx;\n        var old = index;\n        var max = Math.max;\n        var indexes = info.direction === 'down' ? [max(index, 1), ++index, ++index] : [max(index - 1, 1), index, index + 1];\n        if (this.parent.enableColumnVirtualization && this.parent.isFrozenGrid()) {\n            // To avoid frozen content white space issue\n            if (info.sentinelInfo.axis === 'X' || (info.sentinelInfo.axis === 'Y' && (info.page === this.prevInfo.page))) {\n                indexes = this.prevInfo.blockIndexes;\n            }\n        }\n        indexes = indexes.filter(function (val, ind) { return indexes.indexOf(val) === ind; });\n        if (this.prevInfo.blockIndexes.toString() === indexes.toString()) {\n            return indexes;\n        }\n        if (info.loadSelf || (info.direction === 'down' && this.isEndBlock(old))) {\n            indexes = this.vgenerator.getBlockIndexes(info.page);\n        }\n        indexes.some(function (val, ind) {\n            var result = val === (isGroupAdaptive(_this.parent) ? _this.getGroupedTotalBlocks() : _this.getTotalBlocks());\n            if (result) {\n                mIdx = ind;\n            }\n            return result;\n        });\n        if (mIdx !== undefined) {\n            indexes = indexes.slice(0, mIdx + 1);\n            if (info.block === 0 && indexes.length === 1 && this.vgenerator.isBlockAvailable(indexes[0] - 1)) {\n                indexes = [indexes[0] - 1, indexes[0]];\n            }\n        }\n        return indexes;\n    };\n    // tslint:disable-next-line:max-func-body-length\n    VirtualContentRenderer.prototype.appendContent = function (target, newChild, e) {\n        var _this = this;\n        // currentInfo value will be used if there are multiple dom updates happened due to mousewheel\n        var isFrozen = this.parent.isFrozenGrid();\n        var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n        var colVFtable = this.parent.enableColumnVirtualization && isFrozen;\n        this.checkFirstBlockColIndexes(e);\n        var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && this.currentInfo.page &&\n            this.currentInfo.page !== e.virtualInfo.page ? this.currentInfo : e.virtualInfo;\n        this.prevInfo = this.prevInfo || e.virtualInfo;\n        var cBlock = (info.columnIndexes[0]) - 1;\n        if (colVFtable && info.columnIndexes[0] === frzCols) {\n            cBlock = (info.columnIndexes[0] - frzCols) - 1;\n        }\n        var cOffset = this.getColumnOffset(cBlock);\n        var width;\n        var blocks = info.blockIndexes;\n        if (this.parent.groupSettings.columns.length) {\n            this.refreshOffsets();\n        }\n        if (this.parent.height === '100%') {\n            this.parent.element.style.height = '100%';\n        }\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height :\n            this.parent.element.getBoundingClientRect().height;\n        if (!this.requestTypes.some(function (value) { return value === _this.requestType; })) {\n            var translate = this.getTranslateY(this.content.scrollTop, vHeight, info);\n            this.virtualEle.adjustTable(colVFtable ? 0 : cOffset, translate);\n            if (colVFtable) {\n                this.virtualEle.adjustMovableTable(cOffset, 0);\n            }\n        }\n        if (this.parent.enableColumnVirtualization) {\n            this.header.virtualEle.adjustTable(colVFtable ? 0 : cOffset, 0);\n            if (colVFtable) {\n                this.header.virtualEle.adjustMovableTable(cOffset, 0);\n            }\n        }\n        if (this.parent.enableColumnVirtualization) {\n            var cIndex = info.columnIndexes;\n            width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n            if (colVFtable) {\n                this.header.virtualEle.setMovableWrapperWidth(width);\n            }\n            else {\n                this.header.virtualEle.setWrapperWidth(width);\n            }\n        }\n        if (colVFtable) {\n            this.virtualEle.setMovableWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n        }\n        else {\n            this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n        }\n        if (!isNullOrUndefined(target.parentNode)) {\n            remove(target);\n        }\n        var tbody;\n        if (isFrozen) {\n            if (e.renderFrozenRightContent) {\n                tbody = this.parent.getContent().querySelector('.e-frozen-right-content').querySelector('tbody');\n            }\n            else if (!e.renderMovableContent) {\n                tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n            }\n            else if (e.renderMovableContent) {\n                tbody = this.parent.getMovableVirtualContent().querySelector('tbody');\n            }\n        }\n        else {\n            tbody = this.parent.element.querySelector('.e-content').querySelector('tbody');\n        }\n        if (tbody) {\n            remove(tbody);\n            target = null;\n        }\n        var isReact = this.parent.isReact && !isNullOrUndefined(this.parent.rowTemplate);\n        if (!isReact) {\n            target = this.parent.createElement('tbody');\n            target.appendChild(newChild);\n        }\n        else {\n            target = newChild;\n        }\n        if (this.parent.frozenRows && e.requestType === 'virtualscroll' && this.parent.pageSettings.currentPage === 1) {\n            for (var i = 0; i < this.parent.frozenRows; i++) {\n                target.children[0].remove();\n            }\n        }\n        if (isFrozen) {\n            if (e.renderFrozenRightContent) {\n                this.parent.getContent().querySelector('.e-frozen-right-content').querySelector('.e-table').appendChild(target);\n                this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n            }\n            else if (!e.renderMovableContent) {\n                this.parent.getFrozenVirtualContent().querySelector('.e-table').appendChild(target);\n            }\n            else if (e.renderMovableContent) {\n                this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(target);\n                if (this.parent.getFrozenMode() !== 'Left-Right') {\n                    this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n                }\n            }\n            if (this.vfColIndex.length) {\n                e.virtualInfo.columnIndexes = info.columnIndexes = extend([], this.vfColIndex);\n                this.vfColIndex = e.renderMovableContent ? [] : this.vfColIndex;\n            }\n        }\n        else {\n            this.getTable().appendChild(target);\n            this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n        }\n        if (this.parent.groupSettings.columns.length) {\n            if (!isGroupAdaptive(this.parent) && info.direction === 'up') {\n                var blk = this.offsets[this.getTotalBlocks()] - this.prevHeight;\n                this.preventEvent = true;\n                var sTop = this.content.scrollTop;\n                this.content.scrollTop = sTop + blk;\n            }\n            this.setVirtualHeight();\n            this.observer.setPageHeight(this.getOffset(blocks[blocks.length - 1]) - this.getOffset(blocks[0] - 1));\n        }\n        this.prevInfo = info;\n        if (this.isFocused && this.activeKey !== 'downArrow' && this.activeKey !== 'upArrow') {\n            this.content.focus();\n        }\n        var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n        if (this.isBottom) {\n            this.isBottom = false;\n            this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 1];\n        }\n        if ((this.parent.pageSettings.currentPage === lastPage) && blocks.length === 1) {\n            this.isBottom = true;\n            this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 2];\n        }\n        if (e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n            this.parent.notify(events.autoCol, {});\n        }\n        this.focusCell(e);\n        this.restoreEdit(e);\n        this.restoreAdd(e);\n    };\n    VirtualContentRenderer.prototype.checkFirstBlockColIndexes = function (e) {\n        if (this.parent.enableColumnVirtualization && this.parent.isFrozenGrid() && e.virtualInfo.columnIndexes[0] === 0) {\n            var indexes = [];\n            var frozenCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n            if (!e.renderMovableContent && e.virtualInfo.columnIndexes.length > frozenCols) {\n                this.vfColIndex = e.virtualInfo.columnIndexes;\n                for (var i = 0; i < frozenCols; i++) {\n                    indexes.push(i);\n                }\n                e.virtualInfo.columnIndexes = indexes;\n            }\n            else if (e.renderMovableContent) {\n                if (!this.vfColIndex.length) {\n                    this.vfColIndex = extend([], e.virtualInfo.columnIndexes);\n                }\n                e.virtualInfo.columnIndexes = extend([], this.vfColIndex);\n                e.virtualInfo.columnIndexes.splice(0, frozenCols);\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.focusCell = function (e) {\n        if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            return;\n        }\n        var row = this.parent.getRowByIndex(this.rowIndex);\n        // tslint:disable-next-line:no-any\n        var cell = row.cells[this.cellIndex];\n        cell.focus({ preventScroll: true });\n        this.parent.selectRow(parseInt(row.getAttribute('aria-rowindex'), 10));\n        this.activeKey = this.empty;\n    };\n    VirtualContentRenderer.prototype.restoreEdit = function (e) {\n        if (this.isNormaledit) {\n            var left = this.parent.getFrozenColumns();\n            var isFrozen = e && this.parent.isFrozenGrid();\n            var table = this.parent.getFrozenMode();\n            var trigger = e && (left || table === 'Left' || table === 'Right' ? e.renderMovableContent\n                : e.renderFrozenRightContent);\n            if ((!isFrozen || (isFrozen && trigger)) && this.parent.editSettings.allowEditing\n                && this.parent.editModule && !isNullOrUndefined(this.editedRowIndex)) {\n                var row = this.getRowByIndex(this.editedRowIndex);\n                if (Object.keys(this.virtualData).length && row && !this.content.querySelector('.e-editedrow')) {\n                    var top_1 = row.getBoundingClientRect().top;\n                    if (top_1 < this.content.offsetHeight && top_1 > this.parent.getRowHeight()) {\n                        this.parent.isEdit = false;\n                        this.parent.editModule.startEdit(row);\n                    }\n                }\n                if (row && this.content.querySelector('.e-editedrow') && !Object.keys(this.virtualData).length) {\n                    var rowData = extend({}, this.getRowObjectByIndex(this.editedRowIndex));\n                    this.virtualData = this.getVirtualEditedData(rowData);\n                }\n            }\n            this.restoreAdd(e);\n        }\n    };\n    VirtualContentRenderer.prototype.getVirtualEditedData = function (rowData) {\n        var editForms = [].slice.call(this.parent.element.querySelectorAll('.e-gridform'));\n        var isFrozen = this.parent.isFrozenGrid();\n        var data = this.parent.editModule.getCurrentEditedData(editForms[0], rowData);\n        if (isFrozen) {\n            if (this.parent.getTablesCount() === 2) {\n                data = this.parent.editModule.getCurrentEditedData(editForms[1], rowData);\n            }\n            if (this.parent.getTablesCount() === 3) {\n                data = this.parent.editModule.getCurrentEditedData(editForms[1], rowData);\n                data = this.parent.editModule.getCurrentEditedData(editForms[2], rowData);\n            }\n        }\n        return data;\n    };\n    VirtualContentRenderer.prototype.restoreAdd = function (e) {\n        var left = this.parent.getFrozenColumns();\n        var isFrozen = e && this.parent.isFrozenGrid();\n        var table = this.parent.getFrozenMode();\n        var trigger = e && (left || table === 'Left' || table === 'Right' ? e.renderMovableContent : e.renderFrozenRightContent);\n        if ((!isFrozen || (isFrozen && trigger)) && this.isNormaledit && this.isAdd && !this.parent.element.querySelector('.e-addedrow')) {\n            var isTop = this.parent.editSettings.newRowPosition === 'Top' && this.content.scrollTop < this.parent.getRowHeight();\n            var isBottom = this.parent.editSettings.newRowPosition === 'Bottom'\n                && this.parent.pageSettings.currentPage === this.maxPage;\n            if (isTop || isBottom) {\n                this.parent.isEdit = false;\n                this.parent.addRecord();\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.onDataReady = function (e) {\n        if (!isNullOrUndefined(e.count)) {\n            this.count = e.count;\n            this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n        }\n        this.vgenerator.checkAndResetCache(e.requestType);\n        if (['refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', undefined]\n            .some(function (value) { return e.requestType === value; })) {\n            this.refreshOffsets();\n        }\n        this.setVirtualHeight();\n        this.resetScrollPosition(e.requestType);\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.setVirtualHeight = function (height) {\n        var width = this.parent.enableColumnVirtualization ?\n            this.getColumnOffset(this.parent.columns.length + this.parent.groupSettings.columns.length - 1) + 'px' : '100%';\n        if (this.parent.isFrozenGrid()) {\n            var virtualHeightTemp = (this.parent.pageSettings.currentPage === 1 && Object.keys(this.offsets).length <= 2) ?\n                this.offsets[1] : this.offsets[this.getTotalBlocks() - 2];\n            var scrollableElementHeight = this.content.clientHeight;\n            virtualHeightTemp = virtualHeightTemp > scrollableElementHeight ? virtualHeightTemp : 0;\n            // To overcome the white space issue in last page (instead of position absolute)\n            this.virtualEle.setVirtualHeight(virtualHeightTemp, width);\n        }\n        else {\n            var virtualHeight = (isBlazor() && this.parent.isServerRendered && this.parent.groupSettings.columns.length && height)\n                ? height : (this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]);\n            this.virtualEle.setVirtualHeight(virtualHeight, width);\n        }\n        if (this.parent.enableColumnVirtualization) {\n            this.header.virtualEle.setVirtualHeight(1, width);\n            if (this.parent.isFrozenGrid()) {\n                this.virtualEle.setMovableVirtualHeight(1, width);\n                this.header.virtualEle.setMovableVirtualHeight(1, width);\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {\n        var _this = this;\n        var total = (isGroupAdaptive(this.parent)) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n        var page = 0;\n        var extra = this.offsets[total] - this.prevHeight;\n        this.offsetKeys.some(function (offset) {\n            var iOffset = Number(offset);\n            var border = sTop <= _this.offsets[offset] || (iOffset === total && sTop > _this.offsets[offset]);\n            if (border) {\n                if (_this.offsetKeys.length % 2 !== 0 && iOffset.toString() === _this.offsetKeys[_this.offsetKeys.length - 2]\n                    && sTop <= _this.offsets[_this.offsetKeys.length - 1]) {\n                    iOffset = iOffset + 1;\n                }\n                info.block = iOffset % 2 === 0 ? 1 : 0;\n                page = Math.max(1, Math.min(_this.vgenerator.getPage(iOffset), _this.maxPage));\n            }\n            return border;\n        });\n        return page;\n    };\n    VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n        if (info === undefined) {\n            info = { page: this.getPageFromTop(sTop, {}) };\n            info.blockIndexes = this.vgenerator.getBlockIndexes(info.page);\n        }\n        var block = (info.blockIndexes[0] || 1) - 1;\n        var translate = this.getOffset(block);\n        var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);\n        if (isOnenter) {\n            info = this.prevInfo;\n        }\n        var result = translate > sTop ?\n            this.getOffset(block - 1) : endTranslate < (sTop + cHeight) ? this.getOffset(block + 1) : translate;\n        var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] -\n            this.tmpOffsets[info.blockIndexes[0]];\n        if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]) {\n            result -= (result + blockHeight) - this.offsets[this.getTotalBlocks()];\n        }\n        return result;\n    };\n    VirtualContentRenderer.prototype.getOffset = function (block) {\n        return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);\n    };\n    VirtualContentRenderer.prototype.onEntered = function () {\n        var _this = this;\n        return function (element, current, direction, e, isWheel, check) {\n            if (Browser.isIE && !isWheel && check && !_this.preventEvent) {\n                _this.parent.showSpinner();\n            }\n            var colVFtable = _this.parent.enableColumnVirtualization && _this.parent.isFrozenGrid();\n            var xAxis = current.axis === 'X';\n            var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;\n            var height = _this.content.getBoundingClientRect().height;\n            var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n            var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);\n            if (isBlazor() && _this.parent.isServerRendered && _this.currentInfo && _this.currentInfo.startIndex && xAxis) {\n                y = _this.currentInfo.startIndex * _this.parent.getRowHeight();\n            }\n            _this.virtualEle.adjustTable(colVFtable ? 0 : x, Math.min(y, _this.offsets[_this.maxBlock]));\n            if (colVFtable) {\n                _this.virtualEle.adjustMovableTable(x, 0);\n            }\n            if (isBlazor() && _this.parent.isServerRendered && xAxis) {\n                _this.parent.notify('setcolumnstyles', { refresh: true });\n            }\n            if (_this.parent.enableColumnVirtualization && (!isBlazor() || (isBlazor() && !_this.parent.isServerRendered))) {\n                _this.header.virtualEle.adjustTable(colVFtable ? 0 : x, 0);\n                if (colVFtable) {\n                    _this.header.virtualEle.adjustMovableTable(x, 0);\n                }\n            }\n        };\n    };\n    VirtualContentRenderer.prototype.dataBound = function () {\n        this.parent.notify(events.refreshVirtualFrozenHeight, {});\n        if (this.isSelection && this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            this.parent.selectRow(this.selectedRowIndex);\n        }\n        else if (!isBlazor()) {\n            this.activeKey = this.empty;\n        }\n    };\n    VirtualContentRenderer.prototype.rowSelected = function () {\n        this.isSelection = false;\n    };\n    VirtualContentRenderer.prototype.eventListener = function (action) {\n        var _this = this;\n        this.parent[action](dataReady, this.onDataReady, this);\n        this.parent.addEventListener(events.dataBound, this.dataBound.bind(this));\n        this.parent.addEventListener(events.actionBegin, this.actionBegin.bind(this));\n        this.parent.addEventListener(events.actionComplete, this.actionComplete.bind(this));\n        this.parent.addEventListener(events.rowSelected, this.rowSelected.bind(this));\n        this.parent[action](refreshVirtualBlock, this.refreshContentRows, this);\n        this.parent[action](events.selectVirtualRow, this.selectVirtualRow, this);\n        this.parent[action](events.virtaulCellFocus, this.virtualCellFocus, this);\n        this.parent[action](events.virtualScrollEditActionBegin, this.editActionBegin, this);\n        this.parent[action](events.virtualScrollAddActionBegin, this.addActionBegin, this);\n        this.parent[action](events.virtualScrollEdit, this.restoreEdit, this);\n        this.parent[action](events.virtualScrollEditSuccess, this.editSuccess, this);\n        this.parent[action](events.refreshVirtualCache, this.refreshCache, this);\n        this.parent[action](events.editReset, this.resetIsedit, this);\n        this.parent[action](events.getVirtualData, this.getVirtualData, this);\n        this.parent[action](events.virtualScrollEditCancel, this.editCancel, this);\n        var event = this.actions;\n        for (var i = 0; i < event.length; i++) {\n            this.parent[action](event[i] + \"-begin\", this.onActionBegin, this);\n        }\n        var fn = function () {\n            _this.observer.observe(function (scrollArgs) { return _this.scrollListener(scrollArgs); }, _this.onEntered());\n            var gObj = _this.parent;\n            if (gObj.enablePersistence && gObj.scrollPosition) {\n                _this.content.scrollTop = gObj.scrollPosition.top;\n                var scrollValues = { direction: 'down', sentinel: _this.observer.sentinelInfo.down,\n                    offset: gObj.scrollPosition, focusElement: gObj.element };\n                _this.scrollListener(scrollValues);\n                if (gObj.enableColumnVirtualization) {\n                    _this.content.scrollLeft = gObj.scrollPosition.left;\n                }\n            }\n            _this.parent.off(contentReady, fn);\n        };\n        this.parent.on(contentReady, fn, this);\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.getVirtualData = function (data) {\n        data.virtualData = this.virtualData;\n        data.isAdd = this.isAdd;\n        data.isCancel = this.isCancel;\n    };\n    VirtualContentRenderer.prototype.editCancel = function (args) {\n        var dataIndex = getEditedDataIndex(this.parent, args.data);\n        if (!isNullOrUndefined(dataIndex)) {\n            args.data = this.parent.getCurrentViewRecords()[dataIndex];\n        }\n    };\n    VirtualContentRenderer.prototype.editSuccess = function (args) {\n        if (this.isNormaledit) {\n            if (!this.isAdd && args.data) {\n                this.updateCurrentViewData(args.data);\n            }\n            this.isAdd = false;\n        }\n    };\n    VirtualContentRenderer.prototype.updateCurrentViewData = function (data) {\n        var dataIndex = getEditedDataIndex(this.parent, data);\n        if (!isNullOrUndefined(dataIndex)) {\n            this.parent.getCurrentViewRecords()[dataIndex] = data;\n        }\n    };\n    VirtualContentRenderer.prototype.actionBegin = function (args) {\n        if (args.requestType !== 'virtualscroll') {\n            this.requestType = args.requestType;\n        }\n        if (!args.cancel) {\n            this.parent.notify(events.refreshVirtualFrozenRows, args);\n        }\n    };\n    VirtualContentRenderer.prototype.virtualCellFocus = function (e) {\n        // To decide the action (select or scroll), when using arrow keys for cell focus\n        var ele = document.activeElement;\n        if (ele.classList.contains('e-rowcell')\n            && e && (e.action === 'upArrow' || e.action === 'downArrow')) {\n            var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n            if (e && (e.action === 'downArrow' || e.action === 'upArrow')) {\n                var scrollEle = this.parent.getContent().firstElementChild;\n                e.action === 'downArrow' ? rowIndex += 1 : rowIndex -= 1;\n                this.rowIndex = rowIndex;\n                this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n                var row = this.parent.getRowByIndex(rowIndex);\n                var page = this.parent.pageSettings.currentPage;\n                var visibleRowCount = Math.floor(scrollEle.offsetHeight / this.parent.getRowHeight()) - 1;\n                var emptyRow = false;\n                if (isNullOrUndefined(row)) {\n                    emptyRow = true;\n                    if ((e.action === 'downArrow' && page === this.maxPage - 1) || (e.action === 'upArrow' && page === 1)) {\n                        emptyRow = false;\n                    }\n                }\n                if (emptyRow || (ensureLastRow(row, this.parent) && e.action === 'downArrow')\n                    || (ensureFirstRow(row, this.parent.getRowHeight() * 2) && e.action === 'upArrow')) {\n                    this.activeKey = e.action;\n                    scrollEle.scrollTop = e.action === 'downArrow' ?\n                        (rowIndex - visibleRowCount) * this.parent.getRowHeight() : rowIndex * this.parent.getRowHeight();\n                }\n                else {\n                    this.activeKey = this.empty;\n                }\n                if (!isBlazor() || (isBlazor() && !this.blazorDataLoad)) {\n                    this.parent.selectRow(rowIndex);\n                }\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.editActionBegin = function (e) {\n        this.editedRowIndex = e.index;\n        var rowData = extend({}, this.getRowObjectByIndex(e.index));\n        e.data = Object.keys(this.virtualData).length ? this.virtualData : rowData;\n    };\n    VirtualContentRenderer.prototype.refreshCache = function (data) {\n        var block = Math.ceil((this.editedRowIndex + 1) / this.getBlockSize());\n        var index = this.editedRowIndex - ((block - 1) * this.getBlockSize());\n        this.vgenerator.cache[block][index].data = data;\n        if (this.vgenerator.movableCache[block]) {\n            this.vgenerator.movableCache[block][index].data = data;\n        }\n        if (this.vgenerator.frozenRightCache[block]) {\n            this.vgenerator.frozenRightCache[block][index].data = data;\n        }\n    };\n    VirtualContentRenderer.prototype.actionComplete = function (args) {\n        if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n            this.refreshOffsets();\n            this.refreshVirtualElement();\n            if (this.isNormaledit) {\n                if (args.requestType === 'cancel') {\n                    this.isCancel = true;\n                }\n                this.isAdd = false;\n                this.editedRowIndex = this.empty;\n                this.virtualData = {};\n                this.parent.editModule.previousVirtualData = {};\n            }\n        }\n        if (this.parent.enableColumnVirtualization && args.requestType === 'filterafteropen'\n            && this.currentInfo.columnIndexes && this.currentInfo.columnIndexes[0] > 0) {\n            this.parent.resetFilterDlgPosition(args.columnName);\n        }\n    };\n    VirtualContentRenderer.prototype.resetIsedit = function () {\n        if (this.parent.enableVirtualization && this.isNormaledit) {\n            if ((this.parent.editSettings.allowEditing && Object.keys(this.virtualData).length)\n                || (this.parent.editSettings.allowAdding && this.isAdd)) {\n                this.parent.isEdit = true;\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.scrollAfterEdit = function () {\n        if (this.parent.editModule && this.parent.editSettings.allowEditing && this.isNormaledit) {\n            if (this.parent.element.querySelector('.e-gridform')) {\n                var editForm = this.parent.element.querySelector('.e-editedrow');\n                var addForm = this.parent.element.querySelector('.e-addedrow');\n                if (editForm || addForm) {\n                    var rowData = editForm ? extend({}, this.getRowObjectByIndex(this.editedRowIndex))\n                        : extend({}, this.emptyRowData);\n                    this.virtualData = this.getVirtualEditedData(rowData);\n                }\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.createEmptyRowdata = function () {\n        var _this = this;\n        this.parent.getColumns().filter(function (e) {\n            _this.emptyRowData[e.field] = _this.empty;\n        });\n    };\n    VirtualContentRenderer.prototype.addActionBegin = function (args) {\n        if (this.isNormaledit) {\n            if (!Object.keys(this.emptyRowData).length) {\n                this.createEmptyRowdata();\n            }\n            this.isAdd = true;\n            var page = this.parent.pageSettings.currentPage;\n            if (page > 1 && this.parent.editSettings.newRowPosition === 'Top') {\n                this.isAdd = true;\n                this.onActionBegin();\n                args.startEdit = false;\n                this.content.scrollTop = 0;\n            }\n            if (page < this.maxPage - 1 && this.parent.editSettings.newRowPosition === 'Bottom') {\n                this.isAdd = true;\n                this.parent.setProperties({ pageSettings: { currentPage: this.maxPage - 1 } }, true);\n                args.startEdit = false;\n                this.content.scrollTop = this.offsets[this.offsetKeys.length];\n            }\n        }\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.getRowObjectByIndex = function (index) {\n        var data = this.getRowCollection(index, false, true);\n        return data;\n    };\n    VirtualContentRenderer.prototype.getBlockSize = function () {\n        return this.parent.pageSettings.pageSize >> 1;\n    };\n    VirtualContentRenderer.prototype.getBlockHeight = function () {\n        return this.getBlockSize() * this.parent.getRowHeight();\n    };\n    VirtualContentRenderer.prototype.isEndBlock = function (index) {\n        var totalBlocks = this.getTotalBlocks();\n        return index >= totalBlocks || index === totalBlocks - 1;\n    };\n    VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {\n        var rows = this.parent.vcRows;\n        return Math.floor((rows.length / this.getBlockSize()) < 1 ? 1 : rows.length / this.getBlockSize());\n    };\n    VirtualContentRenderer.prototype.getTotalBlocks = function () {\n        return Math.ceil(this.count / this.getBlockSize());\n    };\n    VirtualContentRenderer.prototype.getColumnOffset = function (block) {\n        return this.vgenerator.cOffsets[block] | 0;\n    };\n    VirtualContentRenderer.prototype.getModelGenerator = function () {\n        return new VirtualRowModelGenerator(this.parent);\n    };\n    VirtualContentRenderer.prototype.resetScrollPosition = function (action) {\n        if (this.actions.some(function (value) { return value === action; })) {\n            this.preventEvent = this.content.scrollTop !== 0;\n            this.content.scrollTop = 0;\n        }\n        if (action !== 'virtualscroll') {\n            this.isAdd = false;\n        }\n    };\n    VirtualContentRenderer.prototype.onActionBegin = function (e) {\n        //Update property silently..\n        this.parent.setProperties({ pageSettings: { currentPage: 1 } }, true);\n    };\n    VirtualContentRenderer.prototype.getRows = function () {\n        return this.vgenerator.getRows();\n    };\n    VirtualContentRenderer.prototype.getRowByIndex = function (index) {\n        if (isGroupAdaptive(this.parent)) {\n            return this.parent.getDataRows()[index];\n        }\n        return this.getRowCollection(index, false);\n    };\n    VirtualContentRenderer.prototype.getMovableVirtualRowByIndex = function (index) {\n        return this.getRowCollection(index, true);\n    };\n    VirtualContentRenderer.prototype.getFrozenRightVirtualRowByIndex = function (index) {\n        return this.getRowCollection(index, false, false, true);\n    };\n    VirtualContentRenderer.prototype.getRowCollection = function (index, isMovable, isRowObject, isFrozenRight) {\n        var prev = this.prevInfo.blockIndexes;\n        var startIdx = (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) ?\n            (prev[0] - 1) * this.getBlockSize() : this.startIndex;\n        var rowCollection = isMovable ? this.parent.getMovableDataRows() : this.parent.getDataRows();\n        rowCollection = isFrozenRight ? this.parent.getFrozenRightDataRows() : rowCollection;\n        var collection = isRowObject ? this.parent.getCurrentViewRecords() : rowCollection;\n        var selectedRow = collection[index - startIdx];\n        if (this.parent.frozenRows && this.parent.pageSettings.currentPage > 1) {\n            if (!isRowObject) {\n                selectedRow = index <= this.parent.frozenRows ? rowCollection[index]\n                    : rowCollection[(index - startIdx) + this.parent.frozenRows];\n            }\n            else {\n                selectedRow = index <= this.parent.frozenRows ? this.parent.getRowsObject()[index].data : selectedRow;\n            }\n        }\n        return selectedRow;\n    };\n    VirtualContentRenderer.prototype.getVirtualRowIndex = function (index) {\n        var prev = this.prevInfo.blockIndexes;\n        var startIdx = (prev[0] - 1) * this.getBlockSize();\n        return startIdx + index;\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.refreshOffsets = function () {\n        var gObj = this.parent;\n        var row = 0;\n        var bSize = this.getBlockSize();\n        var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n        this.prevHeight = this.offsets[total];\n        this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;\n        this.offsets = {};\n        //Row offset update\n        var blocks = Array.apply(null, Array(total)).map(function () { return ++row; });\n        for (var i = 0; i < blocks.length; i++) {\n            var tmp = (this.vgenerator.cache[blocks[i]] || []).length;\n            var rem = !isGroupAdaptive(this.parent) ? this.count % bSize : (gObj.vcRows.length % bSize);\n            var size = !isGroupAdaptive(this.parent) && blocks[i] in this.vgenerator.cache ?\n                tmp * this.parent.getRowHeight() : rem && blocks[i] === total ? rem * this.parent.getRowHeight() :\n                this.getBlockHeight();\n            // let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?\n            // tmp * getRowHeight() : this.getBlockHeight();\n            this.offsets[blocks[i]] = (this.offsets[blocks[i] - 1] | 0) + size;\n            this.tmpOffsets[blocks[i]] = this.offsets[blocks[i] - 1] | 0;\n        }\n        this.offsetKeys = Object.keys(this.offsets);\n        if (isGroupAdaptive(this.parent)) {\n            this.parent.vGroupOffsets = this.offsets;\n        }\n        //Column offset update\n        if (this.parent.enableColumnVirtualization) {\n            this.vgenerator.refreshColOffsets();\n        }\n    };\n    VirtualContentRenderer.prototype.refreshVirtualElement = function () {\n        this.vgenerator.refreshColOffsets();\n        this.setVirtualHeight();\n    };\n    VirtualContentRenderer.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var frozenCols = this.parent.getFrozenColumns();\n        var fcntColGrp;\n        var mcntColGrp;\n        if (frozenCols) {\n            fcntColGrp = [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('col'));\n            mcntColGrp = [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('col'));\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            this.parent.notify('setvisibility', columns);\n        }\n        var rows = [];\n        rows = this.getRows();\n        var testRow;\n        rows.some(function (r) { if (r.isDataRow) {\n            testRow = r;\n        } return r.isDataRow; });\n        var needFullRefresh = true;\n        if (!gObj.groupSettings.columns.length && testRow) {\n            needFullRefresh = false;\n        }\n        var tr = gObj.getDataRows();\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            var idx = gObj.getNormalizedColumnIndex(column.uid);\n            var displayVal = column.visible === true ? '' : 'none';\n            var colGrp = void 0;\n            if (fcntColGrp && mcntColGrp) {\n                if (idx >= frozenCols) {\n                    colGrp = mcntColGrp;\n                    tr = this.parent.getMovableRows();\n                    idx = idx - frozenCols;\n                }\n                else {\n                    colGrp = fcntColGrp;\n                }\n            }\n            else {\n                colGrp = this.getColGroup().children;\n            }\n            if (idx !== -1 && testRow && idx < testRow.cells.length) {\n                setStyleAttribute(colGrp[idx], { 'display': displayVal });\n            }\n            if (!needFullRefresh) {\n                var width = void 0;\n                if (column.visible) {\n                    width = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n                }\n                else {\n                    width = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n                }\n                if (width > gObj.width) {\n                    this.setDisplayNone(tr, idx, displayVal, rows);\n                    if (this.parent.enableColumnVirtualization) {\n                        this.virtualEle.setWrapperWidth(width + '');\n                    }\n                    this.refreshVirtualElement();\n                }\n                else {\n                    needFullRefresh = true;\n                }\n            }\n            if (!this.parent.invokedFromMedia && column.hideAtMedia) {\n                this.parent.updateMediaColumns(column);\n            }\n            this.parent.invokedFromMedia = false;\n        }\n        if (isBlazor() && this.parent.isServerRendered && needFullRefresh) {\n            var inViewIdx = this.parent.inViewIndexes;\n            var translateX = this.getColumnOffset(inViewIdx[0] - 1);\n            var width = this.getColumnOffset(inViewIdx[inViewIdx.length - 1]) - translateX + '';\n            this.parent.notify('refresh-virtual-indices', { requestType: 'virtualScrollRefresh',\n                startColumnIndex: inViewIdx[0], endColumnIndex: inViewIdx[inViewIdx.length - 1], axis: 'X',\n                VTablewidth: width, translateX: translateX });\n            this.parent.notify('setcolumnstyles', {});\n        }\n        if (needFullRefresh || frozenCols) {\n            this.refreshContentRows({ requestType: 'refresh' });\n        }\n        else {\n            this.parent.notify(events.partialRefresh, { rows: rows, args: { isFrozen: false, rows: rows } });\n        }\n    };\n    VirtualContentRenderer.prototype.selectVirtualRow = function (args) {\n        var _this = this;\n        if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow'\n            && !this.requestTypes.some(function (value) { return value === _this.requestType; }) && !this.parent.selectionModule.isInteracted) {\n            var selectedRow = this.parent.getRowByIndex(args.selectedIndex);\n            var rowHeight = this.parent.getRowHeight();\n            var eleOffsHeight = this.content.offsetHeight;\n            if (!selectedRow || this.isRowInView(args.selectedIndex, selectedRow, this.content, eleOffsHeight, rowHeight)) {\n                this.isSelection = true;\n                this.selectedRowIndex = args.selectedIndex;\n                var scrollTop = (args.selectedIndex + 1) * rowHeight;\n                if (!isNullOrUndefined(scrollTop)) {\n                    this.content.scrollTop = scrollTop;\n                }\n            }\n        }\n        if (this.parent.isFrozenGrid() && this.requestType) {\n            if (this.parent.getTablesCount() === this.frzIdx) {\n                this.requestType = this.empty;\n                this.frzIdx = 1;\n            }\n            else {\n                this.frzIdx++;\n            }\n        }\n        else {\n            this.requestType = this.empty;\n        }\n    };\n    VirtualContentRenderer.prototype.isRowInView = function (index, selectedRow, ele, eleOffsHeight, rowHeight) {\n        if (isBlazor()) {\n            var exactTopIndex = ele.scrollTop / rowHeight;\n            var exactEndIndex = exactTopIndex + (eleOffsHeight / rowHeight);\n            return (index < exactTopIndex || index > exactEndIndex);\n        }\n        else {\n            if (this.parent.frozenRows && index < this.parent.frozenRows) {\n                return false;\n            }\n            var rectTop = selectedRow ? selectedRow.getBoundingClientRect().top : 0;\n            return (rectTop < rowHeight || rectTop > eleOffsHeight);\n        }\n    };\n    return VirtualContentRenderer;\n}(ContentRender));\nexport { VirtualContentRenderer };\n/**\n * @hidden\n */\nvar VirtualHeaderRenderer = /** @class */ (function (_super) {\n    __extends(VirtualHeaderRenderer, _super);\n    function VirtualHeaderRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.virtualEle = new VirtualElementHandler();\n        _this.isMovable = false;\n        _this.gen = new VirtualRowModelGenerator(_this.parent);\n        _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n        _this.parent.on(refreshVirtualBlock, function (e) { return e.virtualInfo.sentinelInfo.axis === 'X' ? _this.refreshUI() : null; }, _this);\n        return _this;\n    }\n    VirtualHeaderRenderer.prototype.renderTable = function () {\n        this.gen.refreshColOffsets();\n        this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n        if (isBlazor() && this.parent.isServerRendered) {\n            this.parent.notify('refresh-virtual-indices', {\n                startColumnIndex: this.parent.contentModule.startColIndex,\n                endColumnIndex: this.parent.contentModule.endColIndex, axis: 'X'\n            });\n        }\n        _super.prototype.renderTable.call(this);\n        this.virtualEle.table = this.getTable();\n        this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');\n        this.virtualEle.content.style.position = 'relative';\n        this.virtualEle.renderWrapper();\n        this.virtualEle.renderPlaceHolder('absolute');\n    };\n    VirtualHeaderRenderer.prototype.appendContent = function (table) {\n        if (!this.isMovable) {\n            this.virtualEle.wrapper.appendChild(table);\n        }\n        else {\n            this.virtualEle.movableWrapper.appendChild(table);\n            this.isMovable = false;\n        }\n    };\n    VirtualHeaderRenderer.prototype.refreshUI = function () {\n        this.isMovable = this.parent.isFrozenGrid();\n        this.setFrozenTable(this.parent.getMovableVirtualContent());\n        this.gen.refreshColOffsets();\n        this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n        _super.prototype.refreshUI.call(this);\n        this.setFrozenTable(this.parent.getFrozenVirtualContent());\n    };\n    VirtualHeaderRenderer.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var displayVal;\n        var idx;\n        var needFullRefresh;\n        var frozenCols = this.parent.getFrozenColumns();\n        var fhdrColGrp;\n        var mhdrColGrp;\n        if (frozenCols) {\n            fhdrColGrp = [].slice.call(this.parent.getFrozenVirtualHeader().querySelectorAll('col'));\n            mhdrColGrp = [].slice.call(this.parent.getMovableVirtualHeader().querySelectorAll('col'));\n        }\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            idx = gObj.getNormalizedColumnIndex(column.uid);\n            displayVal = column.visible ? '' : 'none';\n            var colGrp = void 0;\n            if (fhdrColGrp && mhdrColGrp) {\n                if (idx >= frozenCols) {\n                    colGrp = mhdrColGrp;\n                    idx = idx - frozenCols;\n                }\n                else {\n                    colGrp = fhdrColGrp;\n                }\n            }\n            else {\n                colGrp = this.getColGroup().children;\n            }\n            setStyleAttribute(colGrp[idx], { 'display': displayVal });\n            if (gObj.enableColumnVirtualization && !gObj.groupSettings.columns.length) {\n                var tablewidth = void 0;\n                if (column.visible) {\n                    tablewidth = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n                }\n                else {\n                    tablewidth = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n                }\n                if (tablewidth > gObj.width) {\n                    this.setDisplayNone(column, displayVal);\n                    this.virtualEle.setWrapperWidth(tablewidth + '');\n                    this.gen.refreshColOffsets();\n                }\n                else {\n                    needFullRefresh = true;\n                }\n            }\n            else {\n                needFullRefresh = true;\n            }\n            if (needFullRefresh && !frozenCols) {\n                this.refreshUI();\n            }\n        }\n        if (frozenCols) {\n            this.parent.notify(events.columnPositionChanged, {});\n        }\n    };\n    VirtualHeaderRenderer.prototype.setFrozenTable = function (content) {\n        if (this.parent.isFrozenGrid() && this.parent.enableColumnVirtualization\n            && this.parent.contentModule.isXaxis()) {\n            this.parent.contentModule\n                .setTable(content.querySelector('.e-table'));\n        }\n    };\n    VirtualHeaderRenderer.prototype.setDisplayNone = function (col, displayVal) {\n        var frozenCols = this.parent.isFrozenGrid();\n        var table = this.getTable();\n        if (frozenCols && col.getFreezeTableName() === 'movable') {\n            table = this.parent.getMovableVirtualHeader().querySelector('.e-table');\n        }\n        for (var _i = 0, _a = [].slice.apply(table.querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n            var ele = _a[_i];\n            if (ele.querySelector('[e-mappinguid]') &&\n                ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === col.uid) {\n                setStyleAttribute(ele, { 'display': displayVal });\n                if (displayVal === '') {\n                    removeClass([ele], 'e-hide');\n                }\n                break;\n            }\n        }\n    };\n    return VirtualHeaderRenderer;\n}(HeaderRender));\nexport { VirtualHeaderRenderer };\n/**\n * @hidden\n */\nvar VirtualElementHandler = /** @class */ (function () {\n    function VirtualElementHandler() {\n    }\n    VirtualElementHandler.prototype.renderWrapper = function (height) {\n        if (isBlazor()) {\n            this.wrapper = this.content.querySelector('.e-virtualtable') ? this.content.querySelector('.e-virtualtable') :\n                createElement('div', { className: 'e-virtualtable' });\n            this.wrapper.setAttribute('styles', \"min-height:\" + formatUnit(height));\n        }\n        else {\n            this.wrapper = createElement('div', { className: 'e-virtualtable', styles: \"min-height:\" + formatUnit(height) });\n        }\n        this.wrapper.appendChild(this.table);\n        this.content.appendChild(this.wrapper);\n    };\n    VirtualElementHandler.prototype.renderPlaceHolder = function (position) {\n        if (position === void 0) { position = 'relative'; }\n        if (isBlazor()) {\n            this.placeholder = this.content.querySelector('.e-virtualtrack') ? this.content.querySelector('.e-virtualtrack') :\n                createElement('div', { className: 'e-virtualtrack' });\n            this.placeholder.setAttribute('styles', \"position:\" + position);\n        }\n        else {\n            this.placeholder = createElement('div', { className: 'e-virtualtrack', styles: \"position:\" + position });\n        }\n        this.content.appendChild(this.placeholder);\n    };\n    VirtualElementHandler.prototype.renderFrozenWrapper = function (height) {\n        this.wrapper = createElement('div', { className: 'e-virtualtable', styles: \"min-height:\" + formatUnit(height) + \"; display: flex\" });\n        this.content.appendChild(this.wrapper);\n    };\n    VirtualElementHandler.prototype.renderFrozenPlaceHolder = function () {\n        this.placeholder = createElement('div', { className: 'e-virtualtrack' });\n        this.content.appendChild(this.placeholder);\n    };\n    VirtualElementHandler.prototype.renderMovableWrapper = function (height) {\n        this.movableWrapper = createElement('div', { className: 'e-virtualtable', styles: \"min-height:\" + formatUnit(height) });\n        this.movableContent.appendChild(this.movableWrapper);\n    };\n    VirtualElementHandler.prototype.renderMovablePlaceHolder = function () {\n        this.movablePlaceholder = createElement('div', { className: 'e-virtualtrack' });\n        this.movableContent.appendChild(this.movablePlaceholder);\n    };\n    VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {\n        this.wrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n    };\n    VirtualElementHandler.prototype.adjustMovableTable = function (xValue, yValue) {\n        this.movableWrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n    };\n    VirtualElementHandler.prototype.setMovableWrapperWidth = function (width, full) {\n        this.movableWrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n    };\n    VirtualElementHandler.prototype.setMovableVirtualHeight = function (height, width) {\n        this.movablePlaceholder.style.height = height + \"px\";\n        this.movablePlaceholder.style.width = width;\n    };\n    VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {\n        this.wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n    };\n    VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {\n        this.placeholder.style.height = height + \"px\";\n        this.placeholder.style.width = width;\n    };\n    VirtualElementHandler.prototype.setFreezeWrapperWidth = function (wrapper, width, full) {\n        wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n    };\n    return VirtualElementHandler;\n}());\nexport { VirtualElementHandler };\n"]},"metadata":{},"sourceType":"module"}