{"ast":null,"code":"import { Draggable, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent, getGridRowElements } from '../base/util';\nimport { gridActionHandler } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\n\nvar RowDD =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid print module\n   * @hidden\n   */\n  function RowDD(parent) {\n    var _this = this;\n\n    this.selectedRows = [];\n    this.isOverflowBorder = true;\n    this.selectedRowColls = [];\n    this.isRefresh = true;\n    this.isReplaceDragEle = true;\n    /* tslint:disable-next-line:max-line-length */\n    // tslint:disable-next-line:max-func-body-length\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = _this.draggable.currentStateTarget;\n\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n        styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n      });\n\n      var table = _this.parent.createElement('table', {\n        styles: 'width:' + gObj.element.offsetWidth\n      });\n\n      var tbody = _this.parent.createElement('tbody');\n\n      if (document.getElementsByClassName('e-griddragarea').length || gObj.rowDropSettings.targetID && !target.classList.contains('e-selectionbackground') && gObj.selectionSettings.type !== 'Single' || !gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop')) {\n        return false;\n      }\n\n      if (gObj.rowDropSettings.targetID && gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n        gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n      }\n\n      _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n\n      var frzCols = _this.parent.isFrozenGrid();\n\n      if (frzCols) {\n        var rowIndex_1 = parseInt(closestElement(target, 'tr').getAttribute('aria-rowindex'), 10);\n        var rows = getGridRowElements(_this.parent);\n        _this.startedRow.innerHTML = '';\n        gridActionHandler(_this.parent, function (freezeTable, rows) {\n          _this.startedRow.innerHTML += rows[rowIndex_1].innerHTML;\n        }, rows);\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        selectedRow: _this.rows,\n        dragelement: target,\n        cloneElement: visualElement,\n        cancel: false,\n        data: _this.rowData\n      };\n      var selectedRows = gObj.getSelectedRows();\n      gObj.trigger(events.rowDragStartHelper, args);\n      var cancel = 'cancel';\n      var cloneElement = 'cloneElement';\n\n      if (args[cancel]) {\n        return false;\n      }\n\n      removeElement(_this.startedRow, '.e-indentcell');\n      removeElement(_this.startedRow, '.e-detailrowcollapse');\n      removeElement(_this.startedRow, '.e-detailrowexpand');\n\n      _this.removeCell(_this.startedRow, 'e-gridchkbox');\n\n      var exp = new RegExp('e-active', 'g'); //high contrast issue\n\n      _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n      tbody.appendChild(_this.startedRow);\n\n      if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n        var dropCountEle = _this.parent.createElement('span', {\n          className: 'e-dropitemscount',\n          innerHTML: frzCols ? '' + selectedRows.length / 2 : '' + selectedRows.length\n        });\n\n        visualElement.appendChild(dropCountEle);\n      }\n\n      var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n\n      if (ele) {\n        ele.classList.add('e-dragstartrow');\n      }\n\n      table.appendChild(tbody);\n      visualElement.appendChild(table);\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n\n      if (document.getElementsByClassName('e-griddragarea').length) {\n        return;\n      }\n\n      var target = e.target;\n\n      var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n\n      if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n        spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table').offsetWidth - 5 + 'px';\n      }\n\n      _this.processArgs(target);\n\n      gObj.trigger(events.rowDragStart, {\n        rows: isBlazor() ? null : _this.rows,\n        target: isBlazor() ? null : e.target,\n        draggableType: 'rows',\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        data: Object.keys(_this.rowData[0]).length > 0 ? _this.rowData : _this.currentViewData()\n      });\n\n      if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n      }\n\n      _this.dragStartData = _this.rowData;\n      var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances && dropElem.ej2_instances[0].getModuleName() === 'grid') {\n        dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n      }\n    };\n\n    this.drag = function (e) {\n      var gObj = _this.parent;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      var target = _this.getElementFromPosition(cloneElement, e.event);\n\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n      _this.isOverflowBorder = true;\n      _this.hoverState = gObj.enableHover;\n      var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n      gObj.enableHover = false;\n\n      if (!e.target) {\n        return;\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        rows: _this.rows,\n        target: target,\n        draggableType: 'rows',\n        data: _this.rowData,\n        originalEvent: e,\n        cancel: false\n      };\n      gObj.trigger(events.rowDrag, args);\n\n      _this.stopTimer();\n\n      if (args.cancel) {\n        return;\n      }\n\n      gObj.element.classList.add('e-rowdrag');\n      _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ? parseInt(trElement.getAttribute('aria-rowindex'), 10) : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n\n      if (gObj.rowDropSettings.targetID) {\n        if (!parentsUntil(target, 'e-grid') || parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        }\n      } else {\n        var elem = parentsUntil(target, 'e-grid');\n\n        if (elem && elem.id === cloneElement.parentElement.id) {\n          classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n        }\n      }\n\n      if (!gObj.rowDropSettings.targetID && (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n        if (parentsUntil(target, 'e-grid')) {\n          _this.updateScrollPostion(e.event, target);\n        }\n\n        if ((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) && parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n          _this.moveDragRows(e, _this.startedRow, trElement);\n        } else {\n          if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') === trElement.getAttribute('data-uid')) {\n            var bottomborder = _this.parent.createElement('div', {\n              className: 'e-lastrow-dragborder'\n            });\n\n            var gridcontentEle = _this.parent.getContent();\n\n            bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n\n            if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n              gridcontentEle.classList.add('e-grid-relative');\n              gridcontentEle.appendChild(bottomborder);\n              bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n            }\n          }\n\n          _this.removeBorder(trElement);\n        }\n      }\n    };\n\n    this.dragStop = function (e) {\n      if (isActionPrevent(_this.parent)) {\n        _this.parent.notify(events.preventBatch, {\n          instance: _this,\n          handler: _this.processDragStop,\n          arg1: e\n        });\n      } else {\n        _this.processDragStop(e);\n      }\n    };\n\n    this.processDragStop = function (e) {\n      var gObj = _this.parent;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      var targetEle = _this.getElementFromPosition(e.helper, e.event);\n\n      var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ? targetEle : e.target;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      gObj.element.classList.remove('e-rowdrag');\n      var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances && dropElement.ej2_instances[0].getModuleName() === 'grid') {\n        dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n      }\n\n      if (gObj.isRowDragable()) {\n        _this.stopTimer();\n\n        gObj.enableHover = _this.hoverState;\n\n        _this.parent.getContent().classList.remove('e-grid-relative');\n\n        _this.removeBorder(targetEle);\n\n        var stRow = gObj.element.querySelector('.e-dragstartrow');\n\n        if (stRow) {\n          stRow.classList.remove('e-dragstartrow');\n        }\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        target: isBlazor() ? null : target,\n        draggableType: 'rows',\n        cancel: false,\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        dropIndex: _this.dragTarget,\n        rows: isBlazor() ? null : _this.rows,\n        data: Object.keys(_this.dragStartData[0]).length > 0 ? _this.dragStartData : _this.currentViewData()\n      };\n      gObj.trigger(events.rowDrop, args, function () {\n        if (!(parentsUntil(target, 'e-row') || parentsUntil(target, 'e-emptyrow')) || args.cancel) {\n          _this.dragTarget = null;\n          remove(e.helper);\n          return;\n        }\n\n        _this.isRefresh = false;\n\n        var selectedIndexes = _this.parent.getSelectedRowIndexes();\n\n        if (gObj.isRowDragable()) {\n          if (!isBlazor()) {\n            if (!_this.parent.rowDropSettings.targetID && _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 && selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n              _this.reorderRows(selectedIndexes, args.dropIndex);\n            } else {\n              _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n            }\n          } else {\n            var draggedData = _this.parent.getSelectedRecords().length ? _this.parent.getSelectedRecords() : _this.currentViewData();\n            var changeRecords = {\n              addedRecords: [],\n              deletedRecords: draggedData,\n              changedRecords: []\n            };\n            var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n            var dragDropDestinationIndex = 'dragDropDestinationIndex';\n            var query = new Query();\n            query[dragDropDestinationIndex] = toIdx;\n\n            _this.saveChange(changeRecords, query);\n\n            changeRecords.deletedRecords = [];\n            changeRecords.addedRecords = draggedData;\n\n            _this.saveChange(changeRecords, query);\n          }\n\n          _this.dragTarget = null;\n\n          if (!gObj.rowDropSettings.targetID) {\n            remove(e.helper);\n\n            _this.rowOrder(args);\n          }\n        }\n\n        _this.isRefresh = true;\n      });\n    };\n\n    this.removeCell = function (targetRow, className) {\n      return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n        if (cell.classList.contains(className)) {\n          targetRow.deleteCell(cell.cellIndex);\n        }\n      });\n    };\n\n    this.parent = parent;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialEnd, this.initializeDrag, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.onDataBoundFn = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n  }\n\n  RowDD.prototype.refreshRow = function (args, tbody, mtbody) {\n    var gObj = this.parent;\n    var target;\n    var mTarget;\n    var frzCols = this.parent.getFrozenColumns();\n    var tbodyMovableHeader;\n    var tbodyMovableContent;\n    var tbodyContent = gObj.getContentTable().querySelector('tbody');\n    var tbodyHeader = gObj.getHeaderContent().querySelector('tbody');\n\n    if (frzCols) {\n      tbodyMovableHeader = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n      tbodyMovableContent = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n    }\n\n    var targetIdx = parseInt(args.target.parentElement.getAttribute('aria-rowindex'), 10);\n\n    if (args.fromIndex < args.dropIndex || args.fromIndex === args.dropIndex) {\n      targetIdx = targetIdx + 1;\n    }\n\n    target = tbody.querySelectorAll('.e-row')[targetIdx];\n\n    if (frzCols) {\n      mTarget = mtbody.querySelectorAll('.e-row')[targetIdx];\n    }\n\n    for (var i = 0, len = args.rows.length; i < len; i++) {\n      if (frzCols) {\n        if (args.rows.length === 1) {\n          args.rows[i] = tbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n          args.rows[i + 1] = mtbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n        } else {\n          if (i % 2 === 0) {\n            args.rows[i] = tbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n          } else {\n            args.rows[i] = mtbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n          }\n        }\n      } else {\n        args.rows[i] = tbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n      }\n    }\n\n    for (var i = 0, len = args.rows.length; i < len; i++) {\n      if (frzCols) {\n        if (i % 2 === 0) {\n          tbody.insertBefore(args.rows[i], target);\n        } else {\n          mtbody.insertBefore(args.rows[i], mTarget);\n        }\n      } else {\n        tbody.insertBefore(args.rows[i], target);\n      }\n    }\n\n    var tr = [].slice.call(tbody.querySelectorAll('.e-row'));\n    var mtr;\n\n    if (frzCols) {\n      mtr = [].slice.call(mtbody.querySelectorAll('.e-row'));\n    }\n\n    this.refreshData(tr, mtr);\n\n    if (this.parent.frozenRows) {\n      for (var i = 0, len = tr.length; i < len; i++) {\n        if (i < this.parent.frozenRows) {\n          tbodyHeader.appendChild(tr[i]);\n\n          if (this.parent.getFrozenColumns()) {\n            tbodyMovableHeader.appendChild(mtr[i]);\n          }\n        } else {\n          tbodyContent.appendChild(tr[i]);\n\n          if (this.parent.getFrozenColumns()) {\n            tbodyMovableContent.appendChild(mtr[i]);\n          }\n        }\n      }\n    }\n  };\n\n  RowDD.prototype.updateFrozenRowreOrder = function (args) {\n    var gObj = this.parent;\n    var tbodyMovH;\n    var tbodyMovC;\n    var frzCols = this.parent.getFrozenColumns();\n    var tbodyC = gObj.getContentTable().querySelector('tbody');\n    var tbodyH = gObj.getHeaderContent().querySelector('tbody');\n\n    if (frzCols) {\n      tbodyMovH = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n      tbodyMovC = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n    }\n\n    var tr = [].slice.call(tbodyH.querySelectorAll('.e-row')).concat([].slice.call(tbodyC.querySelectorAll('.e-row')));\n    var mtr;\n\n    if (frzCols) {\n      mtr = [].slice.call(tbodyMovH.querySelectorAll('.e-row')).concat([].slice.call(tbodyMovC.querySelectorAll('.e-row')));\n    }\n\n    var tbody = gObj.createElement('tbody');\n    var mtbody = gObj.createElement('tbody');\n    this.parent.clearSelection();\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      tbody.appendChild(tr[i]);\n\n      if (frzCols) {\n        mtbody.appendChild(mtr[i]);\n      }\n    }\n\n    this.refreshRow(args, tbody, mtbody);\n  };\n\n  RowDD.prototype.updateFrozenColumnreOrder = function (args) {\n    var gObj = this.parent;\n    var mtbody;\n    var frzCols = this.parent.getFrozenColumns();\n    var tbody = gObj.getContentTable().querySelector('tbody');\n\n    if (frzCols) {\n      mtbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n    }\n\n    this.parent.clearSelection();\n    this.refreshRow(args, tbody, mtbody);\n  };\n\n  RowDD.prototype.refreshData = function (tr, mtr) {\n    var rowObj = {};\n    var movobj = {};\n    var recordobj = {};\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      var index = parseInt(tr[i].getAttribute('aria-rowindex'), 10);\n      rowObj[i] = this.parent.getRowsObject()[index];\n      recordobj[i] = this.parent.getCurrentViewRecords()[index];\n\n      if (this.parent.frozenColumns) {\n        movobj[i] = this.parent.getMovableRowsObject()[index];\n      }\n    }\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      tr[i].setAttribute('aria-rowindex', i.toString());\n      tr[i].setAttribute('data-uid', 'grid-row' + i.toString());\n      this.parent.getRows()[i] = tr[i];\n      this.parent.getRowsObject()[i] = rowObj[i];\n      this.parent.getRowsObject()[i].uid = 'grid-row' + i.toString();\n      this.parent.getRowsObject()[i].index = i;\n      this.parent.getCurrentViewRecords()[i] = recordobj[i];\n\n      if (this.parent.frozenColumns) {\n        mtr[i].setAttribute('aria-rowindex', i.toString());\n        mtr[i].setAttribute('data-uid', 'grid-row' + (i + tr.length).toString());\n        this.parent.getMovableRows()[i] = mtr[i];\n        this.parent.getMovableRowsObject()[i] = movobj[i];\n        this.parent.getMovableRowsObject()[i].uid = 'grid-row' + (i + tr.length).toString();\n        this.parent.getMovableRowsObject()[i].index = i;\n      }\n    }\n  };\n\n  RowDD.prototype.rowOrder = function (args) {\n    if (args.target.classList.contains('e-rowcelldrag')) {\n      args.target = args.target.parentElement;\n    }\n\n    if (this.parent.frozenRows) {\n      this.updateFrozenRowreOrder(args);\n    } else {\n      this.updateFrozenColumnreOrder(args);\n    }\n\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.currentViewData = function () {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var currentVdata = [];\n    var fromIdx = parseInt(this.startedRow.getAttribute('aria-rowindex'), 10);\n\n    for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n      var currentV = 'currentViewData';\n      currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n    }\n\n    if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n      currentVdata[0] = this.parent.currentViewData[fromIdx];\n    }\n\n    return currentVdata;\n  };\n\n  RowDD.prototype.saveChange = function (changeRecords, query) {\n    var _this = this;\n\n    this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n      _this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }).catch(function (e) {\n      var error = 'error';\n      var message = 'message';\n\n      if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n        e[error] = e[error][message];\n      }\n\n      _this.parent.trigger(events.actionFailure, e);\n    });\n  };\n\n  RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var selectedRecords = [];\n    var draggedRecords = [];\n    var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n    var dropIdx = toIndex;\n    var actualIdx = fromIndexes[0];\n\n    for (var i = 0, len = fromIndexes.length; i < len; i++) {\n      draggedRecords[i] = currentViewData[fromIndexes[i]];\n    }\n\n    for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n      selectedRecords[i] = currentViewData[selectedIndexes[i]];\n    }\n\n    for (var i = 0, len = draggedRecords.length; i < len; i++) {\n      if (i !== 0) {\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i])) {\n            actualIdx = j;\n            break;\n          }\n        }\n\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n            if (actualIdx > j) {\n              dropIdx = j + 1;\n            }\n\n            break;\n          }\n        }\n      }\n\n      this.reorderRow(actualIdx, dropIdx);\n    }\n\n    if (this.isRefresh) {\n      this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n\n    for (var i = 0, len = selectedRecords.length; i < len; i++) {\n      for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n        if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n          selectedIndexes[i] = j;\n          break;\n        }\n      }\n    }\n\n    this.selectedRowColls = selectedIndexes;\n  };\n\n  RowDD.prototype.stopTimer = function () {\n    window.clearInterval(this.timer);\n  };\n\n  RowDD.prototype.initializeDrag = function () {\n    var gObj = this.parent;\n    this.draggable = new Draggable(gObj.element, {\n      dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop,\n      isReplaceDragEle: this.isReplaceDragEle\n    });\n  };\n\n  RowDD.prototype.updateScrollPostion = function (e, target) {\n    var _this = this;\n\n    var y = getPosition(e).y;\n    var cliRect = this.parent.getContent().getBoundingClientRect();\n    var rowHeight = this.parent.getRowHeight() - 15;\n    var scrollElem = this.parent.getContent().firstElementChild;\n\n    if (cliRect.top + rowHeight >= y) {\n      var scrollPixel_1 = -this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_1, true);\n      }, 200);\n    } else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n      var scrollPixel_2 = this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_2, true);\n      }, 200);\n    }\n  };\n\n  RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n    scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n  };\n\n  RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    var element = closestElement(e.target, 'tr');\n\n    if (parentsUntil(element, 'e-grid') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      var targetElement = element ? element : this.startedRow;\n      this.setBorder(targetElement, e.event, startedRow, targetRow);\n    }\n  };\n\n  RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n    var node = this.parent.element;\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n\n    if (parentsUntil(element, 'e-grid') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n      var rowElement_1 = [];\n      var targetRowIndex = parseInt(targetRow.getAttribute('aria-rowindex'), 10);\n\n      if (targetRow && targetRowIndex === 0) {\n        var div = this.parent.createElement('div', {\n          className: 'e-firstrow-dragborder'\n        });\n        var gridheaderEle = this.parent.getHeaderContent();\n        gridheaderEle.classList.add('e-grid-relative');\n        div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n\n        if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n          gridheaderEle.appendChild(div);\n        }\n      } else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRowIndex) {\n        element = this.parent.getRowByIndex(targetRowIndex - 1);\n        rowElement_1 = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else {\n        rowElement_1 = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      }\n\n      var frzCols = this.parent.isFrozenGrid();\n\n      if (targetRow && targetRowIndex !== 0 && frzCols) {\n        var rowIndex_2 = parseInt(element.getAttribute('aria-rowindex'), 10);\n        var selector_1 = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n        rowElement_1 = [];\n        gridActionHandler(this.parent, function (tableName, rows) {\n          rowElement_1 = rowElement_1.concat([].slice.call(rows[rowIndex_2].querySelectorAll(selector_1)));\n        }, getGridRowElements(this.parent));\n      }\n\n      if (rowElement_1.length > 0) {\n        addRemoveActiveClasses(rowElement_1, true, 'e-dragborder');\n      }\n    }\n  };\n\n  RowDD.prototype.getScrollWidth = function () {\n    var scrollElem = this.parent.getContent().firstElementChild;\n    return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n  };\n\n  RowDD.prototype.removeFirstRowBorder = function (element) {\n    if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element && element.rowIndex !== 0) {\n      remove(this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0]);\n    }\n  };\n\n  RowDD.prototype.removeLastRowBorder = function (element) {\n    var islastRowIndex = element && this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !== element.getAttribute('data-uid');\n\n    if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n      remove(this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0]);\n    }\n  };\n\n  RowDD.prototype.removeBorder = function (element) {\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n    element = this.parent.getRows().filter(function (row) {\n      return row.querySelector('td.e-dragborder');\n    })[0];\n\n    if (element) {\n      var rowElement_2 = [].slice.call(element.querySelectorAll('.e-dragborder'));\n\n      if (this.parent.isFrozenGrid()) {\n        var rowIndex_3 = parseInt(element.getAttribute('aria-rowindex'), 10);\n        rowElement_2 = [];\n        gridActionHandler(this.parent, function (tableName, rows) {\n          rowElement_2 = rowElement_2.concat([].slice.call(rows[rowIndex_3].querySelectorAll('.e-dragborder')));\n        }, getGridRowElements(this.parent));\n      }\n\n      addRemoveActiveClasses(rowElement_2, false, 'e-dragborder');\n    }\n  };\n\n  RowDD.prototype.getElementFromPosition = function (element, event) {\n    var target;\n    var position = getPosition(event);\n    element.style.display = 'none';\n    target = document.elementFromPoint(position.x, position.y);\n    element.style.display = '';\n    return target;\n  };\n\n  RowDD.prototype.onDataBound = function (e) {\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.getTargetIdx = function (targetRow) {\n    return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n  };\n\n  RowDD.prototype.singleRowDrop = function (e) {\n    var targetRow = closestElement(e.target, 'tr');\n    var currentIndex;\n    var srcControl;\n    srcControl = e.droppedElement.parentElement.ej2_instances[0];\n    currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n    this.reorderRow(this.startedRowIndex, currentIndex);\n  };\n\n  RowDD.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n    var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n\n    if (e.droppedElement.getAttribute('action') !== 'grouping' && (parentsUntil(e.target, 'e-row') || parentsUntil(e.target, 'e-emptyrow'))) {\n      var targetRow = closestElement(e.target, 'tr');\n      var srcControl_1;\n      var currentIndex = void 0;\n\n      if (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' && e.droppedElement.parentElement.id === gObj.element.id || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' && e.droppedElement.parentElement.id !== gObj.element.id) {\n        return;\n      }\n\n      if (e.droppedElement.parentElement.id !== gObj.element.id) {\n        srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n      } else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n        this.singleRowDrop(e);\n        return;\n      }\n\n      if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n        return;\n      }\n\n      var records = srcControl_1.getSelectedRecords();\n      var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n      var count = 0;\n\n      if (isNaN(targetIndex)) {\n        targetIndex = currentIndex = 0;\n      }\n\n      if (gObj.allowPaging) {\n        targetIndex = targetIndex + gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize;\n      } //Todo: drag and drop mapper & BatchChanges\n\n\n      if (!isBlazor()) {\n        gObj.notify(events.rowsAdded, {\n          toIndex: targetIndex,\n          records: records\n        });\n        gObj.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n        var selectedRows = srcControl_1.getSelectedRowIndexes();\n        var skip = srcControl_1.allowPaging ? srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize - srcControl_1.pageSettings.pageSize : 0;\n        this.selectedRows = [];\n\n        for (var i = 0, len = records.length; i < len; i++) {\n          this.selectedRows.push(skip + selectedRows[i]);\n        }\n\n        srcControl_1.notify(events.rowsRemoved, {\n          indexes: this.selectedRows,\n          records: records\n        });\n        srcControl_1.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n      } else {\n        var currentVdata = [];\n        var selectedIndex = srcControl_1.getSelectedRowIndexes();\n\n        for (var i = 0; i < selectedIndex.length; i++) {\n          currentVdata[i] = srcControl_1.currentViewData[selectedIndex[i]];\n        }\n\n        records = currentVdata;\n        var changes = {\n          addedRecords: records,\n          deletedRecords: [],\n          changedRecords: []\n        };\n        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n        var query = new Query();\n        query[dragDropDestinationIndex] = targetIndex;\n        gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          gObj.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          var message = 'message';\n          var error = 'error';\n\n          if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n            e[error] = e[error][message];\n          }\n\n          gObj.trigger(events.actionFailure, e);\n        });\n        changes.deletedRecords = records;\n        changes.addedRecords = [];\n        srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          srcControl_1.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          var error = 'error';\n          var msg = 'message';\n\n          if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][msg])) {\n            e[error] = e[error][msg];\n          }\n\n          srcControl_1.trigger(events.actionFailure, e);\n        });\n      }\n    }\n  };\n\n  RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n    var gObj = this.parent;\n\n    if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n      //Todo: drag and drop mapper & BatchChanges                 \n      var skip = gObj.allowPaging ? gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize : 0;\n      var fromIndex = fromIndexes;\n      toIndex = toIndex + skip;\n      this.selectedRows = gObj.getSelectedRowIndexes();\n      gObj.notify(events.rowPositionChanged, {\n        fromIndex: fromIndexes + skip,\n        toIndex: toIndex\n      });\n    }\n  };\n\n  RowDD.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.initializeDrag();\n    }\n  };\n  /**\n   * To destroy the print\n   * @return {void}\n   * @hidden\n   */\n\n\n  RowDD.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (this.parent.isDestroyed || !gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    }\n\n    this.draggable.destroy();\n    this.parent.off(events.initialEnd, this.initializeDrag);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.off(events.uiUpdate, this.enableAfterRender); //destory ejdrag and drop\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  RowDD.prototype.getModuleName = function () {\n    return 'rowDragAndDrop';\n  };\n\n  RowDD.prototype.processArgs = function (target) {\n    var gObj = this.parent;\n\n    if (gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false || gObj.getSelectedRecords().length === 0) {\n      this.rows = [this.startedRow];\n      this.rowData = [this.parent.getRowInfo(this.startedRow.querySelector('.e-rowcell')).rowData];\n    } else {\n      this.rows = gObj.getSelectedRows();\n      this.rowData = gObj.getSelectedRecords();\n    }\n  };\n\n  return RowDD;\n}();\n\nexport { RowDD };","map":{"version":3,"sources":["C:/Users/appsk/Documents/Projects/PredictiveMaintenance/React PDM/env/frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/row-reorder.js"],"names":["Draggable","isBlazor","isNullOrUndefined","removeClass","remove","closest","closestElement","classList","parentsUntil","removeElement","getPosition","addRemoveActiveClasses","isActionPrevent","getGridRowElements","gridActionHandler","events","Scroll","Query","RowDD","parent","_this","selectedRows","isOverflowBorder","selectedRowColls","isRefresh","isReplaceDragEle","helper","e","gObj","target","draggable","currentStateTarget","visualElement","createElement","className","styles","element","offsetWidth","table","tbody","document","getElementsByClassName","length","rowDropSettings","targetID","contains","selectionSettings","type","sender","mode","selectRow","parseInt","parentElement","getAttribute","startedRow","cloneNode","frzCols","isFrozenGrid","rowIndex_1","rows","innerHTML","freezeTable","processArgs","args","selectedRow","dragelement","cloneElement","cancel","data","rowData","getSelectedRows","trigger","rowDragStartHelper","removeCell","exp","RegExp","replace","appendChild","getSelectedRowIndexes","hasAttribute","dropCountEle","ele","querySelector","add","dragStart","spanCssEle","getSelectedRecords","style","left","rowDragStart","draggableType","fromIndex","Object","keys","currentViewData","bindEvents","dragElement","dragStartData","dropElem","getElementById","ej2_instances","getModuleName","getContent","drag","getElementFromPosition","event","hoverState","enableHover","trElement","originalEvent","rowDrag","stopTimer","dragTarget","id","elem","groupSettings","columns","updateScrollPostion","frozenRows","moveDragRows","getRowByIndex","getCurrentViewRecords","bottomborder","gridcontentEle","width","getScrollWidth","querySelectorAll","bottom","removeBorder","dragStop","notify","preventBatch","instance","handler","processDragStop","arg1","isDestroyed","targetEle","dropElement","isRowDragable","stRow","dropIndex","rowDrop","selectedIndexes","reorderRows","draggedData","changeRecords","addedRecords","deletedRecords","changedRecords","toIdx","dragDropDestinationIndex","query","saveChange","rowOrder","targetRow","slice","call","filter","cell","deleteCell","cellIndex","on","initialEnd","initializeDrag","columnDrop","onDataBoundFn","onDataBound","bind","addEventListener","dataBound","uiUpdate","enableAfterRender","prototype","refreshRow","mtbody","mTarget","getFrozenColumns","tbodyMovableHeader","tbodyMovableContent","tbodyContent","getContentTable","tbodyHeader","getHeaderContent","targetIdx","i","len","children","insertBefore","tr","mtr","refreshData","updateFrozenRowreOrder","tbodyMovH","tbodyMovC","tbodyC","tbodyH","concat","clearSelection","updateFrozenColumnreOrder","rowObj","movobj","recordobj","index","getRowsObject","frozenColumns","getMovableRowsObject","setAttribute","toString","getRows","uid","getMovableRows","selectRows","currentVdata","fromIdx","n","currentV","getDataModule","saveChanges","getPrimaryKeyFieldNames","then","modelChanged","actionBegin","requestType","catch","error","message","actionFailure","fromIndexes","toIndex","selectedRecords","draggedRecords","renderModule","dataManager","dataSource","json","dropIdx","actualIdx","j","len1","JSON","stringify","reorderRow","window","clearInterval","timer","distance","y","cliRect","getBoundingClientRect","rowHeight","getRowHeight","scrollElem","firstElementChild","top","scrollPixel_1","setInterval","setScrollDown","clientHeight","scrollPixel_2","scrollPixel","isLeft","scrollTop","targetElement","setBorder","node","removeFirstRowBorder","removeLastRowBorder","rowElement_1","targetRowIndex","div","gridheaderEle","rowIndex_2","selector_1","tableName","scrollWidth","getScrollBarWidth","rowIndex","islastRowIndex","row","rowElement_2","rowIndex_3","position","display","elementFromPoint","x","getTargetIdx","singleRowDrop","currentIndex","srcControl","droppedElement","startedRowIndex","draggObj","srcControl_1","isSingleRowDragDrop","records","targetIndex","count","isNaN","allowPaging","pageSettings","currentPage","pageSize","rowsAdded","skip","push","rowsRemoved","indexes","selectedIndex","changes","msg","sortSettings","filterSettings","rowPositionChanged","module","enable","destroy","gridElement","off","removeEventListener","cells","getRowInfo"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,QAApB,EAA8BC,iBAA9B,QAAuD,sBAAvD;AACA,SAASC,WAAT,QAA4B,sBAA5B;AACA,SAASC,MAAT,EAAiBC,OAAO,IAAIC,cAA5B,EAA4CC,SAA5C,QAA6D,sBAA7D;AACA,SAASC,YAAT,EAAuBC,aAAvB,EAAsCC,WAAtC,EAAmDC,sBAAnD,EAA2EC,eAA3E,EAA4FC,kBAA5F,QAAsH,cAAtH;AACA,SAASC,iBAAT,QAAkC,cAAlC;AACA,OAAO,KAAKC,MAAZ,MAAwB,kBAAxB;AACA,SAASC,MAAT,QAAuB,mBAAvB;AACA,SAASC,KAAT,QAAsB,sBAAtB;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,KAAK;AAAG;AAAe,YAAY;AACnC;AACJ;AACA;AACA;AACI,WAASA,KAAT,CAAeC,MAAf,EAAuB;AACnB,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,gBAAL,GAAwB,EAAxB;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA;AACA;;AACA,SAAKC,MAAL,GAAc,UAAUC,CAAV,EAAa;AACvB,UAAIC,IAAI,GAAGR,KAAK,CAACD,MAAjB;AACA,UAAIU,MAAM,GAAGT,KAAK,CAACU,SAAN,CAAgBC,kBAA7B;;AACA,UAAIC,aAAa,GAAGZ,KAAK,CAACD,MAAN,CAAac,aAAb,CAA2B,KAA3B,EAAkC;AAClDC,QAAAA,SAAS,EAAE,oDADuC;AAElDC,QAAAA,MAAM,EAAE,qCAAqCP,IAAI,CAACQ,OAAL,CAAaC;AAFR,OAAlC,CAApB;;AAIA,UAAIC,KAAK,GAAGlB,KAAK,CAACD,MAAN,CAAac,aAAb,CAA2B,OAA3B,EAAoC;AAAEE,QAAAA,MAAM,EAAE,WAAWP,IAAI,CAACQ,OAAL,CAAaC;AAAlC,OAApC,CAAZ;;AACA,UAAIE,KAAK,GAAGnB,KAAK,CAACD,MAAN,CAAac,aAAb,CAA2B,OAA3B,CAAZ;;AACA,UAAIO,QAAQ,CAACC,sBAAT,CAAgC,gBAAhC,EAAkDC,MAAlD,IACCd,IAAI,CAACe,eAAL,CAAqBC,QAArB,IAAkC,CAACf,MAAM,CAACtB,SAAP,CAAiBsC,QAAjB,CAA0B,uBAA1B,CAAD,IAC5BjB,IAAI,CAACkB,iBAAL,CAAuBC,IAAvB,KAAgC,QAFvC,IAGC,CAACnB,IAAI,CAACe,eAAL,CAAqBC,QAAtB,IAAkC,CAACpC,YAAY,CAACmB,CAAC,CAACqB,MAAF,CAASnB,MAAV,EAAkB,eAAlB,CAHpD,EAGyF;AACrF,eAAO,KAAP;AACH;;AACD,UAAID,IAAI,CAACe,eAAL,CAAqBC,QAArB,IACAhB,IAAI,CAACkB,iBAAL,CAAuBG,IAAvB,KAAgC,KADhC,IACyCrB,IAAI,CAACkB,iBAAL,CAAuBC,IAAvB,KAAgC,QAD7E,EACuF;AACnFnB,QAAAA,IAAI,CAACsB,SAAL,CAAeC,QAAQ,CAAC/B,KAAK,CAACU,SAAN,CAAgBC,kBAAhB,CAAmCqB,aAAnC,CAAiDC,YAAjD,CAA8D,eAA9D,CAAD,EAAiF,EAAjF,CAAvB;AACH;;AACDjC,MAAAA,KAAK,CAACkC,UAAN,GAAmBhD,cAAc,CAACuB,MAAD,EAAS,IAAT,CAAd,CAA6B0B,SAA7B,CAAuC,IAAvC,CAAnB;;AACA,UAAIC,OAAO,GAAGpC,KAAK,CAACD,MAAN,CAAasC,YAAb,EAAd;;AACA,UAAID,OAAJ,EAAa;AACT,YAAIE,UAAU,GAAGP,QAAQ,CAAC7C,cAAc,CAACuB,MAAD,EAAS,IAAT,CAAd,CAA6BwB,YAA7B,CAA0C,eAA1C,CAAD,EAA6D,EAA7D,CAAzB;AACA,YAAIM,IAAI,GAAG9C,kBAAkB,CAACO,KAAK,CAACD,MAAP,CAA7B;AACAC,QAAAA,KAAK,CAACkC,UAAN,CAAiBM,SAAjB,GAA6B,EAA7B;AACA9C,QAAAA,iBAAiB,CAACM,KAAK,CAACD,MAAP,EAAe,UAAU0C,WAAV,EAAuBF,IAAvB,EAA6B;AACzDvC,UAAAA,KAAK,CAACkC,UAAN,CAAiBM,SAAjB,IAA8BD,IAAI,CAACD,UAAD,CAAJ,CAAiBE,SAA/C;AACH,SAFgB,EAEdD,IAFc,CAAjB;AAGH;;AACDvC,MAAAA,KAAK,CAAC0C,WAAN,CAAkBjC,MAAlB;;AACA,UAAIkC,IAAI,GAAG;AACPC,QAAAA,WAAW,EAAE5C,KAAK,CAACuC,IADZ;AACkBM,QAAAA,WAAW,EAAEpC,MAD/B;AAEPqC,QAAAA,YAAY,EAAElC,aAFP;AAEsBmC,QAAAA,MAAM,EAAE,KAF9B;AAEqCC,QAAAA,IAAI,EAAEhD,KAAK,CAACiD;AAFjD,OAAX;AAIA,UAAIhD,YAAY,GAAGO,IAAI,CAAC0C,eAAL,EAAnB;AACA1C,MAAAA,IAAI,CAAC2C,OAAL,CAAaxD,MAAM,CAACyD,kBAApB,EAAwCT,IAAxC;AACA,UAAII,MAAM,GAAG,QAAb;AACA,UAAID,YAAY,GAAG,cAAnB;;AACA,UAAIH,IAAI,CAACI,MAAD,CAAR,EAAkB;AACd,eAAO,KAAP;AACH;;AACD1D,MAAAA,aAAa,CAACW,KAAK,CAACkC,UAAP,EAAmB,eAAnB,CAAb;AACA7C,MAAAA,aAAa,CAACW,KAAK,CAACkC,UAAP,EAAmB,sBAAnB,CAAb;AACA7C,MAAAA,aAAa,CAACW,KAAK,CAACkC,UAAP,EAAmB,oBAAnB,CAAb;;AACAlC,MAAAA,KAAK,CAACqD,UAAN,CAAiBrD,KAAK,CAACkC,UAAvB,EAAmC,cAAnC;;AACA,UAAIoB,GAAG,GAAG,IAAIC,MAAJ,CAAW,UAAX,EAAuB,GAAvB,CAAV,CA7CuB,CA6CgB;;AACvCvD,MAAAA,KAAK,CAACkC,UAAN,CAAiBM,SAAjB,GAA6BxC,KAAK,CAACkC,UAAN,CAAiBM,SAAjB,CAA2BgB,OAA3B,CAAmCF,GAAnC,EAAwC,EAAxC,CAA7B;AACAnC,MAAAA,KAAK,CAACsC,WAAN,CAAkBzD,KAAK,CAACkC,UAAxB;;AACA,UAAI1B,IAAI,CAACkD,qBAAL,GAA6BpC,MAA7B,GAAsC,CAAtC,IAA2CtB,KAAK,CAACkC,UAAN,CAAiByB,YAAjB,CAA8B,eAA9B,CAA/C,EAA+F;AAC3F,YAAIC,YAAY,GAAG5D,KAAK,CAACD,MAAN,CAAac,aAAb,CAA2B,MAA3B,EAAmC;AAClDC,UAAAA,SAAS,EAAE,kBADuC;AACnB0B,UAAAA,SAAS,EAAEJ,OAAO,GAAG,KAAKnC,YAAY,CAACqB,MAAb,GAAsB,CAA9B,GAAkC,KAAKrB,YAAY,CAACqB;AADnD,SAAnC,CAAnB;;AAGAV,QAAAA,aAAa,CAAC6C,WAAd,CAA0BG,YAA1B;AACH;;AACD,UAAIC,GAAG,GAAG3E,cAAc,CAACuB,MAAD,EAAS,IAAT,CAAd,CAA6BqD,aAA7B,CAA2C,qBAA3C,CAAV;;AACA,UAAID,GAAJ,EAAS;AACLA,QAAAA,GAAG,CAAC1E,SAAJ,CAAc4E,GAAd,CAAkB,gBAAlB;AACH;;AACD7C,MAAAA,KAAK,CAACuC,WAAN,CAAkBtC,KAAlB;AACAP,MAAAA,aAAa,CAAC6C,WAAd,CAA0BvC,KAA1B;AACAV,MAAAA,IAAI,CAACQ,OAAL,CAAayC,WAAb,CAAyB7C,aAAzB;AACA,aAAOA,aAAP;AACH,KA9DD;;AA+DA,SAAKoD,SAAL,GAAiB,UAAUzD,CAAV,EAAa;AAC1B,UAAIC,IAAI,GAAGR,KAAK,CAACD,MAAjB;;AACA,UAAIqB,QAAQ,CAACC,sBAAT,CAAgC,gBAAhC,EAAkDC,MAAtD,EAA8D;AAC1D;AACH;;AACD,UAAIb,MAAM,GAAGF,CAAC,CAACE,MAAf;;AACA,UAAIwD,UAAU,GAAGjE,KAAK,CAACD,MAAN,CAAaiB,OAAb,CAAqB8C,aAArB,CAAmC,mBAAnC,CAAjB;;AACA,UAAI9D,KAAK,CAACD,MAAN,CAAamE,kBAAb,GAAkC5C,MAAlC,GAA2C,CAA3C,IAAgD2C,UAApD,EAAgE;AAC5DA,QAAAA,UAAU,CAACE,KAAX,CAAiBC,IAAjB,GAAwBpE,KAAK,CAACD,MAAN,CAAaiB,OAAb,CAAqB8C,aAArB,CAAmC,0BAAnC,EACnB7C,WADmB,GACL,CADK,GACD,IADvB;AAEH;;AACDjB,MAAAA,KAAK,CAAC0C,WAAN,CAAkBjC,MAAlB;;AACAD,MAAAA,IAAI,CAAC2C,OAAL,CAAaxD,MAAM,CAAC0E,YAApB,EAAkC;AAC9B9B,QAAAA,IAAI,EAAG1D,QAAQ,EAAT,GAAe,IAAf,GAAsBmB,KAAK,CAACuC,IADJ;AACU9B,QAAAA,MAAM,EAAG5B,QAAQ,EAAT,GAAe,IAAf,GAAsB0B,CAAC,CAACE,MAD1C;AAE9B6D,QAAAA,aAAa,EAAE,MAFe;AAEPC,QAAAA,SAAS,EAAExC,QAAQ,CAAC/B,KAAK,CAACuC,IAAN,CAAW,CAAX,EAAcN,YAAd,CAA2B,eAA3B,CAAD,EAA8C,EAA9C,CAFZ;AAG9Be,QAAAA,IAAI,EAAGwB,MAAM,CAACC,IAAP,CAAYzE,KAAK,CAACiD,OAAN,CAAc,CAAd,CAAZ,EAA8B3B,MAA9B,GAAuC,CAAxC,GAA6CtB,KAAK,CAACiD,OAAnD,GAA6DjD,KAAK,CAAC0E,eAAN;AAHrC,OAAlC;;AAKA,UAAI7F,QAAQ,EAAZ,EAAgB;AACZ0B,QAAAA,CAAC,CAACoE,UAAF,CAAapE,CAAC,CAACqE,WAAf;AACH;;AACD5E,MAAAA,KAAK,CAAC6E,aAAN,GAAsB7E,KAAK,CAACiD,OAA5B;AACA,UAAI6B,QAAQ,GAAG1D,QAAQ,CAAC2D,cAAT,CAAwBvE,IAAI,CAACe,eAAL,CAAqBC,QAA7C,CAAf;;AACA,UAAIhB,IAAI,CAACe,eAAL,CAAqBC,QAArB,IAAiCsD,QAAjC,IAA6CA,QAAQ,CAACE,aAAtD,IACAF,QAAQ,CAACE,aAAT,CAAuB,CAAvB,EAA0BC,aAA1B,OAA8C,MADlD,EAC0D;AACtDH,QAAAA,QAAQ,CAACE,aAAT,CAAuB,CAAvB,EAA0BE,UAA1B,GAAuC/F,SAAvC,CAAiD4E,GAAjD,CAAqD,gBAArD;AACH;AACJ,KA1BD;;AA2BA,SAAKoB,IAAL,GAAY,UAAU5E,CAAV,EAAa;AACrB,UAAIC,IAAI,GAAGR,KAAK,CAACD,MAAjB;;AACA,UAAI+C,YAAY,GAAG9C,KAAK,CAACD,MAAN,CAAaiB,OAAb,CAAqB8C,aAArB,CAAmC,oBAAnC,CAAnB;;AACA,UAAIrD,MAAM,GAAGT,KAAK,CAACoF,sBAAN,CAA6BtC,YAA7B,EAA2CvC,CAAC,CAAC8E,KAA7C,CAAb;;AACAlG,MAAAA,SAAS,CAAC2D,YAAD,EAAe,CAAC,cAAD,CAAf,EAAiC,CAAC,iBAAD,EAAoB,WAApB,CAAjC,CAAT;AACA9C,MAAAA,KAAK,CAACE,gBAAN,GAAyB,IAAzB;AACAF,MAAAA,KAAK,CAACsF,UAAN,GAAmB9E,IAAI,CAAC+E,WAAxB;AACA,UAAIC,SAAS,GAAGpG,YAAY,CAACqB,MAAD,EAAS,QAAT,CAAZ,GAAiCvB,cAAc,CAACqB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA/C,GAAkE,IAAlF;AACAD,MAAAA,IAAI,CAAC+E,WAAL,GAAmB,KAAnB;;AACA,UAAI,CAAChF,CAAC,CAACE,MAAP,EAAe;AACX;AACH;;AACDT,MAAAA,KAAK,CAAC0C,WAAN,CAAkBjC,MAAlB;;AACA,UAAIkC,IAAI,GAAG;AACPJ,QAAAA,IAAI,EAAEvC,KAAK,CAACuC,IADL;AACW9B,QAAAA,MAAM,EAAEA,MADnB;AAC2B6D,QAAAA,aAAa,EAAE,MAD1C;AAEPtB,QAAAA,IAAI,EAAEhD,KAAK,CAACiD,OAFL;AAEcwC,QAAAA,aAAa,EAAElF,CAF7B;AAEgCwC,QAAAA,MAAM,EAAE;AAFxC,OAAX;AAIAvC,MAAAA,IAAI,CAAC2C,OAAL,CAAaxD,MAAM,CAAC+F,OAApB,EAA6B/C,IAA7B;;AACA3C,MAAAA,KAAK,CAAC2F,SAAN;;AACA,UAAIhD,IAAI,CAACI,MAAT,EAAiB;AACb;AACH;;AACDvC,MAAAA,IAAI,CAACQ,OAAL,CAAa7B,SAAb,CAAuB4E,GAAvB,CAA2B,WAA3B;AACA/D,MAAAA,KAAK,CAAC4F,UAAN,GAAmBJ,SAAS,IAAIpG,YAAY,CAACqB,MAAD,EAAS,QAAT,CAAZ,CAA+BoF,EAA/B,KAAsC/C,YAAY,CAACd,aAAb,CAA2B6D,EAA9E,GACf9D,QAAQ,CAACyD,SAAS,CAACvD,YAAV,CAAuB,eAAvB,CAAD,EAA0C,EAA1C,CADO,GACyCF,QAAQ,CAAC/B,KAAK,CAACkC,UAAN,CAAiBD,YAAjB,CAA8B,eAA9B,CAAD,EAAiD,EAAjD,CADpE;;AAEA,UAAIzB,IAAI,CAACe,eAAL,CAAqBC,QAAzB,EAAmC;AAC/B,YAAI,CAACpC,YAAY,CAACqB,MAAD,EAAS,QAAT,CAAb,IACArB,YAAY,CAAC0D,YAAY,CAACd,aAAd,EAA6B,QAA7B,CAAZ,CAAmD6D,EAAnD,KAA0DzG,YAAY,CAACqB,MAAD,EAAS,QAAT,CAAZ,CAA+BoF,EAD7F,EACiG;AAC7F1G,UAAAA,SAAS,CAAC2D,YAAD,EAAe,CAAC,iBAAD,CAAf,EAAoC,CAAC,cAAD,CAApC,CAAT;AACH,SAHD,MAIK;AACD3D,UAAAA,SAAS,CAAC2D,YAAD,EAAe,CAAC,cAAD,CAAf,EAAiC,CAAC,iBAAD,CAAjC,CAAT;AACH;AACJ,OARD,MASK;AACD,YAAIgD,IAAI,GAAG1G,YAAY,CAACqB,MAAD,EAAS,QAAT,CAAvB;;AACA,YAAIqF,IAAI,IAAIA,IAAI,CAACD,EAAL,KAAY/C,YAAY,CAACd,aAAb,CAA2B6D,EAAnD,EAAuD;AACnD1G,UAAAA,SAAS,CAAC2D,YAAD,EAAe,CAAC,WAAD,CAAf,EAA8B,CAAC,cAAD,CAA9B,CAAT;AACH,SAFD,MAGK;AACD3D,UAAAA,SAAS,CAAC2D,YAAD,EAAe,CAAC,iBAAD,CAAf,EAAoC,CAAC,WAAD,CAApC,CAAT;AACH;AACJ;;AACD,UAAI,CAACtC,IAAI,CAACe,eAAL,CAAqBC,QAAtB,KACC,CAAChB,IAAI,CAACuF,aAAL,CAAmBC,OAAnB,CAA2B1E,MAA5B,IAAsCf,CAAC,CAACE,MAAF,CAAStB,SAAT,CAAmBsC,QAAnB,CAA4B,uBAA5B,CADvC,CAAJ,EACkG;AAC9F,YAAIrC,YAAY,CAACqB,MAAD,EAAS,QAAT,CAAhB,EAAoC;AAChCT,UAAAA,KAAK,CAACiG,mBAAN,CAA0B1F,CAAC,CAAC8E,KAA5B,EAAmC5E,MAAnC;AACH;;AACD,YAAI,CAACT,KAAK,CAACE,gBAAN,IAA0BF,KAAK,CAACD,MAAN,CAAamG,UAAb,GAA0BlG,KAAK,CAAC4F,UAA3D,KACA7D,QAAQ,CAAC/B,KAAK,CAACkC,UAAN,CAAiBD,YAAjB,CAA8B,eAA9B,CAAD,EAAiD,EAAjD,CAAR,KAAiEjC,KAAK,CAAC4F,UAD3E,EACuF;AACnF5F,UAAAA,KAAK,CAACmG,YAAN,CAAmB5F,CAAnB,EAAsBP,KAAK,CAACkC,UAA5B,EAAwCsD,SAAxC;AACH,SAHD,MAIK;AACD,cAAIA,SAAS,IAAIxF,KAAK,CAACD,MAAN,CAAaqG,aAAb,CAA2BpG,KAAK,CAACD,MAAN,CAAasG,qBAAb,GAAqC/E,MAArC,GAA8C,CAAzE,EAA4EW,YAA5E,CAAyF,UAAzF,MACbuD,SAAS,CAACvD,YAAV,CAAuB,UAAvB,CADJ,EACwC;AACpC,gBAAIqE,YAAY,GAAGtG,KAAK,CAACD,MAAN,CAAac,aAAb,CAA2B,KAA3B,EAAkC;AAAEC,cAAAA,SAAS,EAAE;AAAb,aAAlC,CAAnB;;AACA,gBAAIyF,cAAc,GAAGvG,KAAK,CAACD,MAAN,CAAamF,UAAb,EAArB;;AACAoB,YAAAA,YAAY,CAACnC,KAAb,CAAmBqC,KAAnB,GAA2BxG,KAAK,CAACD,MAAN,CAAaiB,OAAb,CAAqBC,WAArB,GAAmCjB,KAAK,CAACyG,cAAN,EAAnC,GAA4D,IAAvF;;AACA,gBAAI,CAACF,cAAc,CAACG,gBAAf,CAAgC,uBAAhC,EAAyDpF,MAA9D,EAAsE;AAClEiF,cAAAA,cAAc,CAACpH,SAAf,CAAyB4E,GAAzB,CAA6B,iBAA7B;AACAwC,cAAAA,cAAc,CAAC9C,WAAf,CAA2B6C,YAA3B;AACAA,cAAAA,YAAY,CAACnC,KAAb,CAAmBwC,MAAnB,GAA4B3G,KAAK,CAACyG,cAAN,KAAyB,IAArD;AACH;AACJ;;AACDzG,UAAAA,KAAK,CAAC4G,YAAN,CAAmBpB,SAAnB;AACH;AACJ;AACJ,KAnED;;AAoEA,SAAKqB,QAAL,GAAgB,UAAUtG,CAAV,EAAa;AACzB,UAAIf,eAAe,CAACQ,KAAK,CAACD,MAAP,CAAnB,EAAmC;AAC/BC,QAAAA,KAAK,CAACD,MAAN,CAAa+G,MAAb,CAAoBnH,MAAM,CAACoH,YAA3B,EAAyC;AACrCC,UAAAA,QAAQ,EAAEhH,KAD2B;AACpBiH,UAAAA,OAAO,EAAEjH,KAAK,CAACkH,eADK;AACYC,UAAAA,IAAI,EAAE5G;AADlB,SAAzC;AAGH,OAJD,MAKK;AACDP,QAAAA,KAAK,CAACkH,eAAN,CAAsB3G,CAAtB;AACH;AACJ,KATD;;AAUA,SAAK2G,eAAL,GAAuB,UAAU3G,CAAV,EAAa;AAChC,UAAIC,IAAI,GAAGR,KAAK,CAACD,MAAjB;;AACA,UAAIC,KAAK,CAACD,MAAN,CAAaqH,WAAjB,EAA8B;AAC1B;AACH;;AACD,UAAIC,SAAS,GAAGrH,KAAK,CAACoF,sBAAN,CAA6B7E,CAAC,CAACD,MAA/B,EAAuCC,CAAC,CAAC8E,KAAzC,CAAhB;;AACA,UAAI5E,MAAM,GAAG4G,SAAS,IAAI,CAACA,SAAS,CAAClI,SAAV,CAAoBsC,QAApB,CAA6B,eAA7B,CAAd,GACT4F,SADS,GACG9G,CAAC,CAACE,MADlB;;AAEA,UAAIqC,YAAY,GAAG9C,KAAK,CAACD,MAAN,CAAaiB,OAAb,CAAqB8C,aAArB,CAAmC,oBAAnC,CAAnB;;AACAtD,MAAAA,IAAI,CAACQ,OAAL,CAAa7B,SAAb,CAAuBH,MAAvB,CAA8B,WAA9B;AACA,UAAIsI,WAAW,GAAGlG,QAAQ,CAAC2D,cAAT,CAAwBvE,IAAI,CAACe,eAAL,CAAqBC,QAA7C,CAAlB;;AACA,UAAIhB,IAAI,CAACe,eAAL,CAAqBC,QAArB,IAAiC8F,WAAjC,IAAgDA,WAAW,CAACtC,aAA5D,IACAsC,WAAW,CAACtC,aAAZ,CAA0B,CAA1B,EAA6BC,aAA7B,OAAiD,MADrD,EAC6D;AACzDqC,QAAAA,WAAW,CAACtC,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,GAA0C/F,SAA1C,CAAoDH,MAApD,CAA2D,gBAA3D;AACH;;AACD,UAAIwB,IAAI,CAAC+G,aAAL,EAAJ,EAA0B;AACtBvH,QAAAA,KAAK,CAAC2F,SAAN;;AACAnF,QAAAA,IAAI,CAAC+E,WAAL,GAAmBvF,KAAK,CAACsF,UAAzB;;AACAtF,QAAAA,KAAK,CAACD,MAAN,CAAamF,UAAb,GAA0B/F,SAA1B,CAAoCH,MAApC,CAA2C,iBAA3C;;AACAgB,QAAAA,KAAK,CAAC4G,YAAN,CAAmBS,SAAnB;;AACA,YAAIG,KAAK,GAAGhH,IAAI,CAACQ,OAAL,CAAa8C,aAAb,CAA2B,iBAA3B,CAAZ;;AACA,YAAI0D,KAAJ,EAAW;AACPA,UAAAA,KAAK,CAACrI,SAAN,CAAgBH,MAAhB,CAAuB,gBAAvB;AACH;AACJ;;AACDgB,MAAAA,KAAK,CAAC0C,WAAN,CAAkBjC,MAAlB;;AACA,UAAIkC,IAAI,GAAG;AACPlC,QAAAA,MAAM,EAAG5B,QAAQ,EAAT,GAAe,IAAf,GAAsB4B,MADvB;AAC+B6D,QAAAA,aAAa,EAAE,MAD9C;AAEPvB,QAAAA,MAAM,EAAE,KAFD;AAGPwB,QAAAA,SAAS,EAAExC,QAAQ,CAAC/B,KAAK,CAACuC,IAAN,CAAW,CAAX,EAAcN,YAAd,CAA2B,eAA3B,CAAD,EAA8C,EAA9C,CAHZ;AAIPwF,QAAAA,SAAS,EAAEzH,KAAK,CAAC4F,UAJV;AAIsBrD,QAAAA,IAAI,EAAG1D,QAAQ,EAAT,GAAe,IAAf,GAAsBmB,KAAK,CAACuC,IAJxD;AAKPS,QAAAA,IAAI,EAAGwB,MAAM,CAACC,IAAP,CAAYzE,KAAK,CAAC6E,aAAN,CAAoB,CAApB,CAAZ,EAAoCvD,MAApC,GAA6C,CAA9C,GAAmDtB,KAAK,CAAC6E,aAAzD,GAAyE7E,KAAK,CAAC0E,eAAN;AALxE,OAAX;AAOAlE,MAAAA,IAAI,CAAC2C,OAAL,CAAaxD,MAAM,CAAC+H,OAApB,EAA6B/E,IAA7B,EAAmC,YAAY;AAC3C,YAAI,EAAEvD,YAAY,CAACqB,MAAD,EAAS,OAAT,CAAZ,IAAiCrB,YAAY,CAACqB,MAAD,EAAS,YAAT,CAA/C,KAA0EkC,IAAI,CAACI,MAAnF,EAA2F;AACvF/C,UAAAA,KAAK,CAAC4F,UAAN,GAAmB,IAAnB;AACA5G,UAAAA,MAAM,CAACuB,CAAC,CAACD,MAAH,CAAN;AACA;AACH;;AACDN,QAAAA,KAAK,CAACI,SAAN,GAAkB,KAAlB;;AACA,YAAIuH,eAAe,GAAG3H,KAAK,CAACD,MAAN,CAAa2D,qBAAb,EAAtB;;AACA,YAAIlD,IAAI,CAAC+G,aAAL,EAAJ,EAA0B;AACtB,cAAI,CAAC1I,QAAQ,EAAb,EAAiB;AACb,gBAAI,CAACmB,KAAK,CAACD,MAAN,CAAawB,eAAb,CAA6BC,QAA9B,IACAxB,KAAK,CAACkC,UAAN,CAAiB4B,aAAjB,CAA+B,0BAA/B,CADA,IAC8D6D,eAAe,CAACrG,MAAhB,GAAyB,CADvF,IAEAqG,eAAe,CAACrG,MAAhB,KAA2BtB,KAAK,CAACD,MAAN,CAAasG,qBAAb,GAAqC/E,MAFpE,EAE4E;AACxEtB,cAAAA,KAAK,CAAC4H,WAAN,CAAkBD,eAAlB,EAAmChF,IAAI,CAAC8E,SAAxC;AACH,aAJD,MAKK;AACDzH,cAAAA,KAAK,CAAC4H,WAAN,CAAkB,CAAC7F,QAAQ,CAAC/B,KAAK,CAACkC,UAAN,CAAiBD,YAAjB,CAA8B,eAA9B,CAAD,EAAiD,EAAjD,CAAT,CAAlB,EAAkFjC,KAAK,CAAC4F,UAAxF;AACH;AACJ,WATD,MAUK;AACD,gBAAIiC,WAAW,GAAG7H,KAAK,CAACD,MAAN,CAAamE,kBAAb,GAAkC5C,MAAlC,GACdtB,KAAK,CAACD,MAAN,CAAamE,kBAAb,EADc,GACsBlE,KAAK,CAAC0E,eAAN,EADxC;AAEA,gBAAIoD,aAAa,GAAG;AAChBC,cAAAA,YAAY,EAAE,EADE;AAEhBC,cAAAA,cAAc,EAAEH,WAFA;AAGhBI,cAAAA,cAAc,EAAE;AAHA,aAApB;AAKA,gBAAIC,KAAK,GAAGlI,KAAK,CAAC4F,UAAN,GAAmB5F,KAAK,CAAC4F,UAAzB,GAAsCjD,IAAI,CAAC8E,SAAvD;AACA,gBAAIU,wBAAwB,GAAG,0BAA/B;AACA,gBAAIC,KAAK,GAAG,IAAIvI,KAAJ,EAAZ;AACAuI,YAAAA,KAAK,CAACD,wBAAD,CAAL,GAAkCD,KAAlC;;AACAlI,YAAAA,KAAK,CAACqI,UAAN,CAAiBP,aAAjB,EAAgCM,KAAhC;;AACAN,YAAAA,aAAa,CAACE,cAAd,GAA+B,EAA/B;AACAF,YAAAA,aAAa,CAACC,YAAd,GAA6BF,WAA7B;;AACA7H,YAAAA,KAAK,CAACqI,UAAN,CAAiBP,aAAjB,EAAgCM,KAAhC;AACH;;AACDpI,UAAAA,KAAK,CAAC4F,UAAN,GAAmB,IAAnB;;AACA,cAAI,CAACpF,IAAI,CAACe,eAAL,CAAqBC,QAA1B,EAAoC;AAChCxC,YAAAA,MAAM,CAACuB,CAAC,CAACD,MAAH,CAAN;;AACAN,YAAAA,KAAK,CAACsI,QAAN,CAAe3F,IAAf;AACH;AACJ;;AACD3C,QAAAA,KAAK,CAACI,SAAN,GAAkB,IAAlB;AACH,OA3CD;AA4CH,KA7ED;;AA8EA,SAAKiD,UAAL,GAAkB,UAAUkF,SAAV,EAAqBzH,SAArB,EAAgC;AAC9C,aAAO,GAAG0H,KAAH,CAASC,IAAT,CAAcF,SAAS,CAAC7B,gBAAV,CAA2B,IAA3B,CAAd,EAAgDgC,MAAhD,CAAuD,UAAUC,IAAV,EAAgB;AAC1E,YAAIA,IAAI,CAACxJ,SAAL,CAAesC,QAAf,CAAwBX,SAAxB,CAAJ,EAAwC;AACpCyH,UAAAA,SAAS,CAACK,UAAV,CAAqBD,IAAI,CAACE,SAA1B;AACH;AACJ,OAJM,CAAP;AAKH,KAND;;AAOA,SAAK9I,MAAL,GAAcA,MAAd;;AACA,QAAI,KAAKA,MAAL,CAAYqH,WAAhB,EAA6B;AACzB;AACH;;AACD,SAAKrH,MAAL,CAAY+I,EAAZ,CAAenJ,MAAM,CAACoJ,UAAtB,EAAkC,KAAKC,cAAvC,EAAuD,IAAvD;AACA,SAAKjJ,MAAL,CAAY+I,EAAZ,CAAenJ,MAAM,CAACsJ,UAAtB,EAAkC,KAAKA,UAAvC,EAAmD,IAAnD;AACA,SAAKC,aAAL,GAAqB,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAArB;AACA,SAAKrJ,MAAL,CAAYsJ,gBAAZ,CAA6B1J,MAAM,CAAC2J,SAApC,EAA+C,KAAKJ,aAApD;AACA,SAAKnJ,MAAL,CAAY+I,EAAZ,CAAenJ,MAAM,CAAC4J,QAAtB,EAAgC,KAAKC,iBAArC,EAAwD,IAAxD;AACH;;AACD1J,EAAAA,KAAK,CAAC2J,SAAN,CAAgBC,UAAhB,GAA6B,UAAU/G,IAAV,EAAgBxB,KAAhB,EAAuBwI,MAAvB,EAA+B;AACxD,QAAInJ,IAAI,GAAG,KAAKT,MAAhB;AACA,QAAIU,MAAJ;AACA,QAAImJ,OAAJ;AACA,QAAIxH,OAAO,GAAG,KAAKrC,MAAL,CAAY8J,gBAAZ,EAAd;AACA,QAAIC,kBAAJ;AACA,QAAIC,mBAAJ;AACA,QAAIC,YAAY,GAAGxJ,IAAI,CAACyJ,eAAL,GAAuBnG,aAAvB,CAAqC,OAArC,CAAnB;AACA,QAAIoG,WAAW,GAAG1J,IAAI,CAAC2J,gBAAL,GAAwBrG,aAAxB,CAAsC,OAAtC,CAAlB;;AACA,QAAI1B,OAAJ,EAAa;AACT0H,MAAAA,kBAAkB,GAAGtJ,IAAI,CAAC2J,gBAAL,GAAwBrG,aAAxB,CAAsC,kBAAtC,EAA0DA,aAA1D,CAAwE,OAAxE,CAArB;AACAiG,MAAAA,mBAAmB,GAAGvJ,IAAI,CAAC0E,UAAL,GAAkBpB,aAAlB,CAAgC,mBAAhC,EAAqDA,aAArD,CAAmE,OAAnE,CAAtB;AACH;;AACD,QAAIsG,SAAS,GAAGrI,QAAQ,CAACY,IAAI,CAAClC,MAAL,CAAYuB,aAAZ,CAA0BC,YAA1B,CAAuC,eAAvC,CAAD,EAA0D,EAA1D,CAAxB;;AACA,QAAIU,IAAI,CAAC4B,SAAL,GAAiB5B,IAAI,CAAC8E,SAAtB,IAAmC9E,IAAI,CAAC4B,SAAL,KAAmB5B,IAAI,CAAC8E,SAA/D,EAA0E;AACtE2C,MAAAA,SAAS,GAAGA,SAAS,GAAG,CAAxB;AACH;;AACD3J,IAAAA,MAAM,GAAGU,KAAK,CAACuF,gBAAN,CAAuB,QAAvB,EAAiC0D,SAAjC,CAAT;;AACA,QAAIhI,OAAJ,EAAa;AACTwH,MAAAA,OAAO,GAAGD,MAAM,CAACjD,gBAAP,CAAwB,QAAxB,EAAkC0D,SAAlC,CAAV;AACH;;AACD,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG3H,IAAI,CAACJ,IAAL,CAAUjB,MAAhC,EAAwC+I,CAAC,GAAGC,GAA5C,EAAiDD,CAAC,EAAlD,EAAsD;AAClD,UAAIjI,OAAJ,EAAa;AACT,YAAIO,IAAI,CAACJ,IAAL,CAAUjB,MAAV,KAAqB,CAAzB,EAA4B;AACxBqB,UAAAA,IAAI,CAACJ,IAAL,CAAU8H,CAAV,IAAelJ,KAAK,CAACoJ,QAAN,CAAexI,QAAQ,CAACY,IAAI,CAACJ,IAAL,CAAU8H,CAAV,EAAapI,YAAb,CAA0B,eAA1B,CAAD,EAA6C,EAA7C,CAAvB,CAAf;AACAU,UAAAA,IAAI,CAACJ,IAAL,CAAU8H,CAAC,GAAG,CAAd,IAAmBV,MAAM,CAACY,QAAP,CAAgBxI,QAAQ,CAACY,IAAI,CAACJ,IAAL,CAAU8H,CAAV,EAAapI,YAAb,CAA0B,eAA1B,CAAD,EAA6C,EAA7C,CAAxB,CAAnB;AACH,SAHD,MAIK;AACD,cAAIoI,CAAC,GAAG,CAAJ,KAAU,CAAd,EAAiB;AACb1H,YAAAA,IAAI,CAACJ,IAAL,CAAU8H,CAAV,IAAelJ,KAAK,CAACoJ,QAAN,CAAexI,QAAQ,CAACY,IAAI,CAACJ,IAAL,CAAU8H,CAAV,EAAapI,YAAb,CAA0B,eAA1B,CAAD,EAA6C,EAA7C,CAAvB,CAAf;AACH,WAFD,MAGK;AACDU,YAAAA,IAAI,CAACJ,IAAL,CAAU8H,CAAV,IAAeV,MAAM,CAACY,QAAP,CAAgBxI,QAAQ,CAACY,IAAI,CAACJ,IAAL,CAAU8H,CAAV,EAAapI,YAAb,CAA0B,eAA1B,CAAD,EAA6C,EAA7C,CAAxB,CAAf;AACH;AACJ;AACJ,OAbD,MAcK;AACDU,QAAAA,IAAI,CAACJ,IAAL,CAAU8H,CAAV,IAAelJ,KAAK,CAACoJ,QAAN,CAAexI,QAAQ,CAACY,IAAI,CAACJ,IAAL,CAAU8H,CAAV,EAAapI,YAAb,CAA0B,eAA1B,CAAD,EAA6C,EAA7C,CAAvB,CAAf;AACH;AACJ;;AACD,SAAK,IAAIoI,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG3H,IAAI,CAACJ,IAAL,CAAUjB,MAAhC,EAAwC+I,CAAC,GAAGC,GAA5C,EAAiDD,CAAC,EAAlD,EAAsD;AAClD,UAAIjI,OAAJ,EAAa;AACT,YAAIiI,CAAC,GAAG,CAAJ,KAAU,CAAd,EAAiB;AACblJ,UAAAA,KAAK,CAACqJ,YAAN,CAAmB7H,IAAI,CAACJ,IAAL,CAAU8H,CAAV,CAAnB,EAAiC5J,MAAjC;AACH,SAFD,MAGK;AACDkJ,UAAAA,MAAM,CAACa,YAAP,CAAoB7H,IAAI,CAACJ,IAAL,CAAU8H,CAAV,CAApB,EAAkCT,OAAlC;AACH;AACJ,OAPD,MAQK;AACDzI,QAAAA,KAAK,CAACqJ,YAAN,CAAmB7H,IAAI,CAACJ,IAAL,CAAU8H,CAAV,CAAnB,EAAiC5J,MAAjC;AACH;AACJ;;AACD,QAAIgK,EAAE,GAAG,GAAGjC,KAAH,CAASC,IAAT,CAActH,KAAK,CAACuF,gBAAN,CAAuB,QAAvB,CAAd,CAAT;AACA,QAAIgE,GAAJ;;AACA,QAAItI,OAAJ,EAAa;AACTsI,MAAAA,GAAG,GAAG,GAAGlC,KAAH,CAASC,IAAT,CAAckB,MAAM,CAACjD,gBAAP,CAAwB,QAAxB,CAAd,CAAN;AACH;;AACD,SAAKiE,WAAL,CAAiBF,EAAjB,EAAqBC,GAArB;;AACA,QAAI,KAAK3K,MAAL,CAAYmG,UAAhB,EAA4B;AACxB,WAAK,IAAImE,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGG,EAAE,CAACnJ,MAAzB,EAAiC+I,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,YAAIA,CAAC,GAAG,KAAKtK,MAAL,CAAYmG,UAApB,EAAgC;AAC5BgE,UAAAA,WAAW,CAACzG,WAAZ,CAAwBgH,EAAE,CAACJ,CAAD,CAA1B;;AACA,cAAI,KAAKtK,MAAL,CAAY8J,gBAAZ,EAAJ,EAAoC;AAChCC,YAAAA,kBAAkB,CAACrG,WAAnB,CAA+BiH,GAAG,CAACL,CAAD,CAAlC;AACH;AACJ,SALD,MAMK;AACDL,UAAAA,YAAY,CAACvG,WAAb,CAAyBgH,EAAE,CAACJ,CAAD,CAA3B;;AACA,cAAI,KAAKtK,MAAL,CAAY8J,gBAAZ,EAAJ,EAAoC;AAChCE,YAAAA,mBAAmB,CAACtG,WAApB,CAAgCiH,GAAG,CAACL,CAAD,CAAnC;AACH;AACJ;AACJ;AACJ;AACJ,GA3ED;;AA4EAvK,EAAAA,KAAK,CAAC2J,SAAN,CAAgBmB,sBAAhB,GAAyC,UAAUjI,IAAV,EAAgB;AACrD,QAAInC,IAAI,GAAG,KAAKT,MAAhB;AACA,QAAI8K,SAAJ;AACA,QAAIC,SAAJ;AACA,QAAI1I,OAAO,GAAG,KAAKrC,MAAL,CAAY8J,gBAAZ,EAAd;AACA,QAAIkB,MAAM,GAAGvK,IAAI,CAACyJ,eAAL,GAAuBnG,aAAvB,CAAqC,OAArC,CAAb;AACA,QAAIkH,MAAM,GAAGxK,IAAI,CAAC2J,gBAAL,GAAwBrG,aAAxB,CAAsC,OAAtC,CAAb;;AACA,QAAI1B,OAAJ,EAAa;AACTyI,MAAAA,SAAS,GAAGrK,IAAI,CAAC2J,gBAAL,GAAwBrG,aAAxB,CAAsC,kBAAtC,EAA0DA,aAA1D,CAAwE,OAAxE,CAAZ;AACAgH,MAAAA,SAAS,GAAGtK,IAAI,CAAC0E,UAAL,GAAkBpB,aAAlB,CAAgC,mBAAhC,EAAqDA,aAArD,CAAmE,OAAnE,CAAZ;AACH;;AACD,QAAI2G,EAAE,GAAG,GAAGjC,KAAH,CAASC,IAAT,CAAcuC,MAAM,CAACtE,gBAAP,CAAwB,QAAxB,CAAd,EAAiDuE,MAAjD,CAAwD,GAAGzC,KAAH,CAASC,IAAT,CAAcsC,MAAM,CAACrE,gBAAP,CAAwB,QAAxB,CAAd,CAAxD,CAAT;AACA,QAAIgE,GAAJ;;AACA,QAAItI,OAAJ,EAAa;AACTsI,MAAAA,GAAG,GAAG,GAAGlC,KAAH,CAASC,IAAT,CAAcoC,SAAS,CAACnE,gBAAV,CAA2B,QAA3B,CAAd,EAAoDuE,MAApD,CAA2D,GAAGzC,KAAH,CAASC,IAAT,CAAcqC,SAAS,CAACpE,gBAAV,CAA2B,QAA3B,CAAd,CAA3D,CAAN;AACH;;AACD,QAAIvF,KAAK,GAAGX,IAAI,CAACK,aAAL,CAAmB,OAAnB,CAAZ;AACA,QAAI8I,MAAM,GAAGnJ,IAAI,CAACK,aAAL,CAAmB,OAAnB,CAAb;AACA,SAAKd,MAAL,CAAYmL,cAAZ;;AACA,SAAK,IAAIb,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGG,EAAE,CAACnJ,MAAzB,EAAiC+I,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3ClJ,MAAAA,KAAK,CAACsC,WAAN,CAAkBgH,EAAE,CAACJ,CAAD,CAApB;;AACA,UAAIjI,OAAJ,EAAa;AACTuH,QAAAA,MAAM,CAAClG,WAAP,CAAmBiH,GAAG,CAACL,CAAD,CAAtB;AACH;AACJ;;AACD,SAAKX,UAAL,CAAgB/G,IAAhB,EAAsBxB,KAAtB,EAA6BwI,MAA7B;AACH,GA1BD;;AA2BA7J,EAAAA,KAAK,CAAC2J,SAAN,CAAgB0B,yBAAhB,GAA4C,UAAUxI,IAAV,EAAgB;AACxD,QAAInC,IAAI,GAAG,KAAKT,MAAhB;AACA,QAAI4J,MAAJ;AACA,QAAIvH,OAAO,GAAG,KAAKrC,MAAL,CAAY8J,gBAAZ,EAAd;AACA,QAAI1I,KAAK,GAAGX,IAAI,CAACyJ,eAAL,GAAuBnG,aAAvB,CAAqC,OAArC,CAAZ;;AACA,QAAI1B,OAAJ,EAAa;AACTuH,MAAAA,MAAM,GAAGnJ,IAAI,CAAC0E,UAAL,GAAkBpB,aAAlB,CAAgC,mBAAhC,EAAqDA,aAArD,CAAmE,OAAnE,CAAT;AACH;;AACD,SAAK/D,MAAL,CAAYmL,cAAZ;AACA,SAAKxB,UAAL,CAAgB/G,IAAhB,EAAsBxB,KAAtB,EAA6BwI,MAA7B;AACH,GAVD;;AAWA7J,EAAAA,KAAK,CAAC2J,SAAN,CAAgBkB,WAAhB,GAA8B,UAAUF,EAAV,EAAcC,GAAd,EAAmB;AAC7C,QAAIU,MAAM,GAAG,EAAb;AACA,QAAIC,MAAM,GAAG,EAAb;AACA,QAAIC,SAAS,GAAG,EAAhB;;AACA,SAAK,IAAIjB,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGG,EAAE,CAACnJ,MAAzB,EAAiC+I,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,UAAIkB,KAAK,GAAGxJ,QAAQ,CAAC0I,EAAE,CAACJ,CAAD,CAAF,CAAMpI,YAAN,CAAmB,eAAnB,CAAD,EAAsC,EAAtC,CAApB;AACAmJ,MAAAA,MAAM,CAACf,CAAD,CAAN,GAAY,KAAKtK,MAAL,CAAYyL,aAAZ,GAA4BD,KAA5B,CAAZ;AACAD,MAAAA,SAAS,CAACjB,CAAD,CAAT,GAAe,KAAKtK,MAAL,CAAYsG,qBAAZ,GAAoCkF,KAApC,CAAf;;AACA,UAAI,KAAKxL,MAAL,CAAY0L,aAAhB,EAA+B;AAC3BJ,QAAAA,MAAM,CAAChB,CAAD,CAAN,GAAY,KAAKtK,MAAL,CAAY2L,oBAAZ,GAAmCH,KAAnC,CAAZ;AACH;AACJ;;AACD,SAAK,IAAIlB,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGG,EAAE,CAACnJ,MAAzB,EAAiC+I,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3CI,MAAAA,EAAE,CAACJ,CAAD,CAAF,CAAMsB,YAAN,CAAmB,eAAnB,EAAoCtB,CAAC,CAACuB,QAAF,EAApC;AACAnB,MAAAA,EAAE,CAACJ,CAAD,CAAF,CAAMsB,YAAN,CAAmB,UAAnB,EAA+B,aAAatB,CAAC,CAACuB,QAAF,EAA5C;AACA,WAAK7L,MAAL,CAAY8L,OAAZ,GAAsBxB,CAAtB,IAA2BI,EAAE,CAACJ,CAAD,CAA7B;AACA,WAAKtK,MAAL,CAAYyL,aAAZ,GAA4BnB,CAA5B,IAAiCe,MAAM,CAACf,CAAD,CAAvC;AACA,WAAKtK,MAAL,CAAYyL,aAAZ,GAA4BnB,CAA5B,EAA+ByB,GAA/B,GAAqC,aAAazB,CAAC,CAACuB,QAAF,EAAlD;AACA,WAAK7L,MAAL,CAAYyL,aAAZ,GAA4BnB,CAA5B,EAA+BkB,KAA/B,GAAuClB,CAAvC;AACA,WAAKtK,MAAL,CAAYsG,qBAAZ,GAAoCgE,CAApC,IAAyCiB,SAAS,CAACjB,CAAD,CAAlD;;AACA,UAAI,KAAKtK,MAAL,CAAY0L,aAAhB,EAA+B;AAC3Bf,QAAAA,GAAG,CAACL,CAAD,CAAH,CAAOsB,YAAP,CAAoB,eAApB,EAAqCtB,CAAC,CAACuB,QAAF,EAArC;AACAlB,QAAAA,GAAG,CAACL,CAAD,CAAH,CAAOsB,YAAP,CAAoB,UAApB,EAAgC,aAAa,CAACtB,CAAC,GAAGI,EAAE,CAACnJ,MAAR,EAAgBsK,QAAhB,EAA7C;AACA,aAAK7L,MAAL,CAAYgM,cAAZ,GAA6B1B,CAA7B,IAAkCK,GAAG,CAACL,CAAD,CAArC;AACA,aAAKtK,MAAL,CAAY2L,oBAAZ,GAAmCrB,CAAnC,IAAwCgB,MAAM,CAAChB,CAAD,CAA9C;AACA,aAAKtK,MAAL,CAAY2L,oBAAZ,GAAmCrB,CAAnC,EAAsCyB,GAAtC,GAA4C,aAAa,CAACzB,CAAC,GAAGI,EAAE,CAACnJ,MAAR,EAAgBsK,QAAhB,EAAzD;AACA,aAAK7L,MAAL,CAAY2L,oBAAZ,GAAmCrB,CAAnC,EAAsCkB,KAAtC,GAA8ClB,CAA9C;AACH;AACJ;AACJ,GA7BD;;AA8BAvK,EAAAA,KAAK,CAAC2J,SAAN,CAAgBnB,QAAhB,GAA2B,UAAU3F,IAAV,EAAgB;AACvC,QAAIA,IAAI,CAAClC,MAAL,CAAYtB,SAAZ,CAAsBsC,QAAtB,CAA+B,eAA/B,CAAJ,EAAqD;AACjDkB,MAAAA,IAAI,CAAClC,MAAL,GAAckC,IAAI,CAAClC,MAAL,CAAYuB,aAA1B;AACH;;AACD,QAAI,KAAKjC,MAAL,CAAYmG,UAAhB,EAA4B;AACxB,WAAK0E,sBAAL,CAA4BjI,IAA5B;AACH,KAFD,MAGK;AACD,WAAKwI,yBAAL,CAA+BxI,IAA/B;AACH;;AACD,QAAI,KAAKxC,gBAAL,CAAsBmB,MAAtB,GAA+B,CAAnC,EAAsC;AAClC,WAAKvB,MAAL,CAAYiM,UAAZ,CAAuB,KAAK7L,gBAA5B;AACA,WAAKA,gBAAL,GAAwB,EAAxB;AACH;AACJ,GAdD;;AAeAL,EAAAA,KAAK,CAAC2J,SAAN,CAAgB/E,eAAhB,GAAkC,YAAY;AAC1C,QAAIiD,eAAe,GAAG,KAAK5H,MAAL,CAAY2D,qBAAZ,EAAtB;AACA,QAAIuI,YAAY,GAAG,EAAnB;AACA,QAAIC,OAAO,GAAGnK,QAAQ,CAAC,KAAKG,UAAL,CAAgBD,YAAhB,CAA6B,eAA7B,CAAD,EAAgD,EAAhD,CAAtB;;AACA,SAAK,IAAIoI,CAAC,GAAG,CAAR,EAAW8B,CAAC,GAAGxE,eAAe,CAACrG,MAApC,EAA4C+I,CAAC,GAAG8B,CAAhD,EAAmD9B,CAAC,EAApD,EAAwD;AACpD,UAAI+B,QAAQ,GAAG,iBAAf;AACAH,MAAAA,YAAY,CAAC5B,CAAD,CAAZ,GAAkB,KAAKtK,MAAL,CAAYqM,QAAZ,EAAsBzE,eAAe,CAAC0C,CAAD,CAArC,CAAlB;AACH;;AACD,QAAI,CAAC,KAAKtK,MAAL,CAAYwB,eAAZ,CAA4BC,QAA7B,IAAyCmG,eAAe,CAACrG,MAAhB,KAA2B,CAAxE,EAA2E;AACvE2K,MAAAA,YAAY,CAAC,CAAD,CAAZ,GAAkB,KAAKlM,MAAL,CAAY2E,eAAZ,CAA4BwH,OAA5B,CAAlB;AACH;;AACD,WAAOD,YAAP;AACH,GAZD;;AAaAnM,EAAAA,KAAK,CAAC2J,SAAN,CAAgBpB,UAAhB,GAA6B,UAAUP,aAAV,EAAyBM,KAAzB,EAAgC;AACzD,QAAIpI,KAAK,GAAG,IAAZ;;AACA,SAAKD,MAAL,CAAYsM,aAAZ,GAA4BC,WAA5B,CAAwCxE,aAAxC,EAAuD,KAAK/H,MAAL,CAAYwM,uBAAZ,GAAsC,CAAtC,CAAvD,EAAiG,EAAjG,EAAqGnE,KAArG,EACKoE,IADL,CACU,YAAY;AAClBxM,MAAAA,KAAK,CAACD,MAAN,CAAa+G,MAAb,CAAoBnH,MAAM,CAAC8M,YAA3B,EAAyC;AACrC9K,QAAAA,IAAI,EAAEhC,MAAM,CAAC+M,WADwB;AACXC,QAAAA,WAAW,EAAE;AADF,OAAzC;AAGH,KALD,EAKGC,KALH,CAKS,UAAUrM,CAAV,EAAa;AAClB,UAAIsM,KAAK,GAAG,OAAZ;AACA,UAAIC,OAAO,GAAG,SAAd;;AACA,UAAI,CAAChO,iBAAiB,CAACyB,CAAC,CAACsM,KAAD,CAAF,CAAlB,IAAgC,CAAC/N,iBAAiB,CAACyB,CAAC,CAACsM,KAAD,CAAD,CAASC,OAAT,CAAD,CAAtD,EAA2E;AACvEvM,QAAAA,CAAC,CAACsM,KAAD,CAAD,GAAWtM,CAAC,CAACsM,KAAD,CAAD,CAASC,OAAT,CAAX;AACH;;AACD9M,MAAAA,KAAK,CAACD,MAAN,CAAaoD,OAAb,CAAqBxD,MAAM,CAACoN,aAA5B,EAA2CxM,CAA3C;AACH,KAZD;AAaH,GAfD;;AAgBAT,EAAAA,KAAK,CAAC2J,SAAN,CAAgB7B,WAAhB,GAA8B,UAAUoF,WAAV,EAAuBC,OAAvB,EAAgC;AAC1D,QAAItF,eAAe,GAAG,KAAK5H,MAAL,CAAY2D,qBAAZ,EAAtB;AACA,QAAIwJ,eAAe,GAAG,EAAtB;AACA,QAAIC,cAAc,GAAG,EAArB;AACA,QAAIzI,eAAe,GAAG,KAAK3E,MAAL,CAAYqN,YAAZ,CAAyBpK,IAAzB,CAA8BqK,WAA9B,CAA0CC,UAA1C,CAAqDC,IAA3E;AACA,QAAIC,OAAO,GAAGP,OAAd;AACA,QAAIQ,SAAS,GAAGT,WAAW,CAAC,CAAD,CAA3B;;AACA,SAAK,IAAI3C,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG0C,WAAW,CAAC1L,MAAlC,EAA0C+I,CAAC,GAAGC,GAA9C,EAAmDD,CAAC,EAApD,EAAwD;AACpD8C,MAAAA,cAAc,CAAC9C,CAAD,CAAd,GAAoB3F,eAAe,CAACsI,WAAW,CAAC3C,CAAD,CAAZ,CAAnC;AACH;;AACD,SAAK,IAAIA,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG3C,eAAe,CAACrG,MAAtC,EAA8C+I,CAAC,GAAGC,GAAlD,EAAuDD,CAAC,EAAxD,EAA4D;AACxD6C,MAAAA,eAAe,CAAC7C,CAAD,CAAf,GAAqB3F,eAAe,CAACiD,eAAe,CAAC0C,CAAD,CAAhB,CAApC;AACH;;AACD,SAAK,IAAIA,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG6C,cAAc,CAAC7L,MAArC,EAA6C+I,CAAC,GAAGC,GAAjD,EAAsDD,CAAC,EAAvD,EAA2D;AACvD,UAAIA,CAAC,KAAK,CAAV,EAAa;AACT,aAAK,IAAIqD,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGjJ,eAAe,CAACpD,MAAvC,EAA+CoM,CAAC,GAAGC,IAAnD,EAAyDD,CAAC,EAA1D,EAA8D;AAC1D,cAAIE,IAAI,CAACC,SAAL,CAAe,KAAK9N,MAAL,CAAYqN,YAAZ,CAAyBpK,IAAzB,CAA8BqK,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0DG,CAA1D,CAAf,MACAE,IAAI,CAACC,SAAL,CAAeV,cAAc,CAAC9C,CAAD,CAA7B,CADJ,EACuC;AACnCoD,YAAAA,SAAS,GAAGC,CAAZ;AACA;AACH;AACJ;;AACD,aAAK,IAAIA,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGjJ,eAAe,CAACpD,MAAvC,EAA+CoM,CAAC,GAAGC,IAAnD,EAAyDD,CAAC,EAA1D,EAA8D;AAC1D,cAAIE,IAAI,CAACC,SAAL,CAAe,KAAK9N,MAAL,CAAYqN,YAAZ,CAAyBpK,IAAzB,CAA8BqK,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0DG,CAA1D,CAAf,MAAiFE,IAAI,CAACC,SAAL,CAAeV,cAAc,CAAC9C,CAAC,GAAG,CAAL,CAA7B,CAArF,EAA4H;AACxH,gBAAIoD,SAAS,GAAGC,CAAhB,EAAmB;AACfF,cAAAA,OAAO,GAAGE,CAAC,GAAG,CAAd;AACH;;AACD;AACH;AACJ;AACJ;;AACD,WAAKI,UAAL,CAAgBL,SAAhB,EAA2BD,OAA3B;AACH;;AACD,QAAI,KAAKpN,SAAT,EAAoB;AAChB,WAAKL,MAAL,CAAY+G,MAAZ,CAAmBnH,MAAM,CAAC8M,YAA1B,EAAwC;AACpC9K,QAAAA,IAAI,EAAEhC,MAAM,CAAC+M,WADuB;AACVC,QAAAA,WAAW,EAAE;AADH,OAAxC;AAGH;;AACD,SAAK,IAAItC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG4C,eAAe,CAAC5L,MAAtC,EAA8C+I,CAAC,GAAGC,GAAlD,EAAuDD,CAAC,EAAxD,EAA4D;AACxD,WAAK,IAAIqD,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGjJ,eAAe,CAACpD,MAAvC,EAA+CoM,CAAC,GAAGC,IAAnD,EAAyDD,CAAC,EAA1D,EAA8D;AAC1D,YAAIE,IAAI,CAACC,SAAL,CAAe,KAAK9N,MAAL,CAAYqN,YAAZ,CAAyBpK,IAAzB,CAA8BqK,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0DG,CAA1D,CAAf,MAAiFE,IAAI,CAACC,SAAL,CAAeX,eAAe,CAAC7C,CAAD,CAA9B,CAArF,EAAyH;AACrH1C,UAAAA,eAAe,CAAC0C,CAAD,CAAf,GAAqBqD,CAArB;AACA;AACH;AACJ;AACJ;;AACD,SAAKvN,gBAAL,GAAwBwH,eAAxB;AACH,GA/CD;;AAgDA7H,EAAAA,KAAK,CAAC2J,SAAN,CAAgB9D,SAAhB,GAA4B,YAAY;AACpCoI,IAAAA,MAAM,CAACC,aAAP,CAAqB,KAAKC,KAA1B;AACH,GAFD;;AAGAnO,EAAAA,KAAK,CAAC2J,SAAN,CAAgBT,cAAhB,GAAiC,YAAY;AACzC,QAAIxI,IAAI,GAAG,KAAKT,MAAhB;AACA,SAAKW,SAAL,GAAiB,IAAI9B,SAAJ,CAAc4B,IAAI,CAACQ,OAAnB,EAA4B;AACzC4E,MAAAA,UAAU,EAAE,4CAD6B;AAEzCsI,MAAAA,QAAQ,EAAE,CAF+B;AAGzC5N,MAAAA,MAAM,EAAE,KAAKA,MAH4B;AAIzC0D,MAAAA,SAAS,EAAE,KAAKA,SAJyB;AAKzCmB,MAAAA,IAAI,EAAE,KAAKA,IAL8B;AAMzC0B,MAAAA,QAAQ,EAAE,KAAKA,QAN0B;AAOzCxG,MAAAA,gBAAgB,EAAE,KAAKA;AAPkB,KAA5B,CAAjB;AASH,GAXD;;AAYAP,EAAAA,KAAK,CAAC2J,SAAN,CAAgBxD,mBAAhB,GAAsC,UAAU1F,CAAV,EAAaE,MAAb,EAAqB;AACvD,QAAIT,KAAK,GAAG,IAAZ;;AACA,QAAImO,CAAC,GAAG7O,WAAW,CAACiB,CAAD,CAAX,CAAe4N,CAAvB;AACA,QAAIC,OAAO,GAAG,KAAKrO,MAAL,CAAYmF,UAAZ,GAAyBmJ,qBAAzB,EAAd;AACA,QAAIC,SAAS,GAAG,KAAKvO,MAAL,CAAYwO,YAAZ,KAA6B,EAA7C;AACA,QAAIC,UAAU,GAAG,KAAKzO,MAAL,CAAYmF,UAAZ,GAAyBuJ,iBAA1C;;AACA,QAAIL,OAAO,CAACM,GAAR,GAAcJ,SAAd,IAA2BH,CAA/B,EAAkC;AAC9B,UAAIQ,aAAa,GAAG,CAAE,KAAK5O,MAAL,CAAYwO,YAAZ,EAAtB;AACA,WAAKrO,gBAAL,GAAwB,KAAxB;AACA,WAAK+N,KAAL,GAAaF,MAAM,CAACa,WAAP,CAAmB,YAAY;AAAE5O,QAAAA,KAAK,CAAC6O,aAAN,CAAoBL,UAApB,EAAgCG,aAAhC,EAA+C,IAA/C;AAAuD,OAAxF,EAA0F,GAA1F,CAAb;AACH,KAJD,MAKK,IAAIP,OAAO,CAACM,GAAR,GAAc,KAAK3O,MAAL,CAAYmF,UAAZ,GAAyB4J,YAAvC,GAAsDR,SAAtD,GAAkE,EAAlE,IAAwEH,CAA5E,EAA+E;AAChF,UAAIY,aAAa,GAAI,KAAKhP,MAAL,CAAYwO,YAAZ,EAArB;AACA,WAAKrO,gBAAL,GAAwB,KAAxB;AACA,WAAK+N,KAAL,GAAaF,MAAM,CAACa,WAAP,CAAmB,YAAY;AAAE5O,QAAAA,KAAK,CAAC6O,aAAN,CAAoBL,UAApB,EAAgCO,aAAhC,EAA+C,IAA/C;AAAuD,OAAxF,EAA0F,GAA1F,CAAb;AACH;AACJ,GAhBD;;AAiBAjP,EAAAA,KAAK,CAAC2J,SAAN,CAAgBoF,aAAhB,GAAgC,UAAUL,UAAV,EAAsBQ,WAAtB,EAAmCC,MAAnC,EAA2C;AACvET,IAAAA,UAAU,CAACU,SAAX,GAAuBV,UAAU,CAACU,SAAX,GAAuBF,WAA9C;AACH,GAFD;;AAGAlP,EAAAA,KAAK,CAAC2J,SAAN,CAAgBtD,YAAhB,GAA+B,UAAU5F,CAAV,EAAa2B,UAAb,EAAyBqG,SAAzB,EAAoC;AAC/D,QAAIzF,YAAY,GAAG,KAAK/C,MAAL,CAAYiB,OAAZ,CAAoB8C,aAApB,CAAkC,oBAAlC,CAAnB;AACA,QAAI9C,OAAO,GAAG9B,cAAc,CAACqB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA5B;;AACA,QAAIrB,YAAY,CAAC4B,OAAD,EAAU,QAAV,CAAZ,IACA5B,YAAY,CAAC0D,YAAY,CAACd,aAAd,EAA6B,QAA7B,CAAZ,CAAmD6D,EAAnD,KAA0DzG,YAAY,CAAC4B,OAAD,EAAU,QAAV,CAAZ,CAAgC6E,EAD9F,EACkG;AAC9F,UAAIsJ,aAAa,GAAGnO,OAAO,GACvBA,OADuB,GACb,KAAKkB,UADnB;AAEA,WAAKkN,SAAL,CAAeD,aAAf,EAA8B5O,CAAC,CAAC8E,KAAhC,EAAuCnD,UAAvC,EAAmDqG,SAAnD;AACH;AACJ,GATD;;AAUAzI,EAAAA,KAAK,CAAC2J,SAAN,CAAgB2F,SAAhB,GAA4B,UAAUpO,OAAV,EAAmBqE,KAAnB,EAA0BnD,UAA1B,EAAsCqG,SAAtC,EAAiD;AACzE,QAAI8G,IAAI,GAAG,KAAKtP,MAAL,CAAYiB,OAAvB;AACA,QAAI8B,YAAY,GAAG,KAAK/C,MAAL,CAAYiB,OAAZ,CAAoB8C,aAApB,CAAkC,oBAAlC,CAAnB;AACA,SAAKwL,oBAAL,CAA0BtO,OAA1B;AACA,SAAKuO,mBAAL,CAAyBvO,OAAzB;;AACA,QAAI5B,YAAY,CAAC4B,OAAD,EAAU,QAAV,CAAZ,IACA5B,YAAY,CAAC0D,YAAY,CAACd,aAAd,EAA6B,QAA7B,CAAZ,CAAmD6D,EAAnD,KAA0DzG,YAAY,CAAC4B,OAAD,EAAU,QAAV,CAAZ,CAAgC6E,EAD9F,EACkG;AAC9F9G,MAAAA,WAAW,CAACsQ,IAAI,CAAC3I,gBAAL,CAAsB,2BAAtB,CAAD,EAAqD,CAAC,cAAD,CAArD,CAAX;AACA,UAAI8I,YAAY,GAAG,EAAnB;AACA,UAAIC,cAAc,GAAG1N,QAAQ,CAACwG,SAAS,CAACtG,YAAV,CAAuB,eAAvB,CAAD,EAA0C,EAA1C,CAA7B;;AACA,UAAIsG,SAAS,IAAIkH,cAAc,KAAK,CAApC,EAAuC;AACnC,YAAIC,GAAG,GAAG,KAAK3P,MAAL,CAAYc,aAAZ,CAA0B,KAA1B,EAAiC;AAAEC,UAAAA,SAAS,EAAE;AAAb,SAAjC,CAAV;AACA,YAAI6O,aAAa,GAAG,KAAK5P,MAAL,CAAYoK,gBAAZ,EAApB;AACAwF,QAAAA,aAAa,CAACxQ,SAAd,CAAwB4E,GAAxB,CAA4B,iBAA5B;AACA2L,QAAAA,GAAG,CAACvL,KAAJ,CAAUqC,KAAV,GAAkB6I,IAAI,CAACpO,WAAL,GAAmB,KAAKwF,cAAL,EAAnB,GAA2C,IAA7D;;AACA,YAAI,CAACkJ,aAAa,CAACjJ,gBAAd,CAA+B,wBAA/B,EAAyDpF,MAA9D,EAAsE;AAClEqO,UAAAA,aAAa,CAAClM,WAAd,CAA0BiM,GAA1B;AACH;AACJ,OARD,MASK,IAAInH,SAAS,IAAIxG,QAAQ,CAACG,UAAU,CAACD,YAAX,CAAwB,eAAxB,CAAD,EAA2C,EAA3C,CAAR,GAAyDwN,cAA1E,EAA0F;AAC3FzO,QAAAA,OAAO,GAAG,KAAKjB,MAAL,CAAYqG,aAAZ,CAA0BqJ,cAAc,GAAG,CAA3C,CAAV;AACAD,QAAAA,YAAY,GAAG,GAAGhH,KAAH,CAASC,IAAT,CAAczH,OAAO,CAAC0F,gBAAR,CAAyB,gDAAzB,CAAd,CAAf;AACH,OAHI,MAIA;AACD8I,QAAAA,YAAY,GAAG,GAAGhH,KAAH,CAASC,IAAT,CAAczH,OAAO,CAAC0F,gBAAR,CAAyB,gDAAzB,CAAd,CAAf;AACH;;AACD,UAAItE,OAAO,GAAG,KAAKrC,MAAL,CAAYsC,YAAZ,EAAd;;AACA,UAAIkG,SAAS,IAAIkH,cAAc,KAAK,CAAhC,IAAqCrN,OAAzC,EAAkD;AAC9C,YAAIwN,UAAU,GAAG7N,QAAQ,CAACf,OAAO,CAACiB,YAAR,CAAqB,eAArB,CAAD,EAAwC,EAAxC,CAAzB;AACA,YAAI4N,UAAU,GAAG,gDAAjB;AACAL,QAAAA,YAAY,GAAG,EAAf;AACA9P,QAAAA,iBAAiB,CAAC,KAAKK,MAAN,EAAc,UAAU+P,SAAV,EAAqBvN,IAArB,EAA2B;AACtDiN,UAAAA,YAAY,GAAGA,YAAY,CAACvE,MAAb,CAAoB,GAAGzC,KAAH,CAASC,IAAT,CAAclG,IAAI,CAACqN,UAAD,CAAJ,CAAiBlJ,gBAAjB,CAAkCmJ,UAAlC,CAAd,CAApB,CAAf;AACH,SAFgB,EAEdpQ,kBAAkB,CAAC,KAAKM,MAAN,CAFJ,CAAjB;AAGH;;AACD,UAAIyP,YAAY,CAAClO,MAAb,GAAsB,CAA1B,EAA6B;AACzB/B,QAAAA,sBAAsB,CAACiQ,YAAD,EAAe,IAAf,EAAqB,cAArB,CAAtB;AACH;AACJ;AACJ,GAvCD;;AAwCA1P,EAAAA,KAAK,CAAC2J,SAAN,CAAgBhD,cAAhB,GAAiC,YAAY;AACzC,QAAI+H,UAAU,GAAG,KAAKzO,MAAL,CAAYmF,UAAZ,GAAyBuJ,iBAA1C;AACA,WAAOD,UAAU,CAACuB,WAAX,GAAyBvB,UAAU,CAACvN,WAApC,GAAkDrB,MAAM,CAACoQ,iBAAP,EAAlD,GAA+E,CAAtF;AACH,GAHD;;AAIAlQ,EAAAA,KAAK,CAAC2J,SAAN,CAAgB6F,oBAAhB,GAAuC,UAAUtO,OAAV,EAAmB;AACtD,QAAI,KAAKjB,MAAL,CAAYiB,OAAZ,CAAoBK,sBAApB,CAA2C,uBAA3C,EAAoEC,MAApE,GAA6E,CAA7E,IAAkFN,OAAlF,IACAA,OAAO,CAACiP,QAAR,KAAqB,CADzB,EAC4B;AACxBjR,MAAAA,MAAM,CAAC,KAAKe,MAAL,CAAYiB,OAAZ,CAAoBK,sBAApB,CAA2C,uBAA3C,EAAoE,CAApE,CAAD,CAAN;AACH;AACJ,GALD;;AAMAvB,EAAAA,KAAK,CAAC2J,SAAN,CAAgB8F,mBAAhB,GAAsC,UAAUvO,OAAV,EAAmB;AACrD,QAAIkP,cAAc,GAAGlP,OAAO,IACxB,KAAKjB,MAAL,CAAYqG,aAAZ,CAA0B,KAAKrG,MAAL,CAAYsG,qBAAZ,GAAoC/E,MAApC,GAA6C,CAAvE,EAA0EW,YAA1E,CAAuF,UAAvF,MACIjB,OAAO,CAACiB,YAAR,CAAqB,UAArB,CAFR;;AAGA,QAAI,KAAKlC,MAAL,CAAYiB,OAAZ,CAAoBK,sBAApB,CAA2C,sBAA3C,EAAmEC,MAAnE,GAA4E,CAA5E,IAAiFN,OAAjF,IAA4FkP,cAAhG,EAAgH;AAC5GlR,MAAAA,MAAM,CAAC,KAAKe,MAAL,CAAYiB,OAAZ,CAAoBK,sBAApB,CAA2C,sBAA3C,EAAmE,CAAnE,CAAD,CAAN;AACH;AACJ,GAPD;;AAQAvB,EAAAA,KAAK,CAAC2J,SAAN,CAAgB7C,YAAhB,GAA+B,UAAU5F,OAAV,EAAmB;AAC9C,SAAKsO,oBAAL,CAA0BtO,OAA1B;AACA,SAAKuO,mBAAL,CAAyBvO,OAAzB;AACAA,IAAAA,OAAO,GAAG,KAAKjB,MAAL,CAAY8L,OAAZ,GAAsBnD,MAAtB,CAA6B,UAAUyH,GAAV,EAAe;AAClD,aAAOA,GAAG,CAACrM,aAAJ,CAAkB,iBAAlB,CAAP;AACH,KAFS,EAEP,CAFO,CAAV;;AAGA,QAAI9C,OAAJ,EAAa;AACT,UAAIoP,YAAY,GAAG,GAAG5H,KAAH,CAASC,IAAT,CAAczH,OAAO,CAAC0F,gBAAR,CAAyB,eAAzB,CAAd,CAAnB;;AACA,UAAI,KAAK3G,MAAL,CAAYsC,YAAZ,EAAJ,EAAgC;AAC5B,YAAIgO,UAAU,GAAGtO,QAAQ,CAACf,OAAO,CAACiB,YAAR,CAAqB,eAArB,CAAD,EAAwC,EAAxC,CAAzB;AACAmO,QAAAA,YAAY,GAAG,EAAf;AACA1Q,QAAAA,iBAAiB,CAAC,KAAKK,MAAN,EAAc,UAAU+P,SAAV,EAAqBvN,IAArB,EAA2B;AACtD6N,UAAAA,YAAY,GAAGA,YAAY,CAACnF,MAAb,CAAoB,GAAGzC,KAAH,CAASC,IAAT,CAAclG,IAAI,CAAC8N,UAAD,CAAJ,CAAiB3J,gBAAjB,CAAkC,eAAlC,CAAd,CAApB,CAAf;AACH,SAFgB,EAEdjH,kBAAkB,CAAC,KAAKM,MAAN,CAFJ,CAAjB;AAGH;;AACDR,MAAAA,sBAAsB,CAAC6Q,YAAD,EAAe,KAAf,EAAsB,cAAtB,CAAtB;AACH;AACJ,GAjBD;;AAkBAtQ,EAAAA,KAAK,CAAC2J,SAAN,CAAgBrE,sBAAhB,GAAyC,UAAUpE,OAAV,EAAmBqE,KAAnB,EAA0B;AAC/D,QAAI5E,MAAJ;AACA,QAAI6P,QAAQ,GAAGhR,WAAW,CAAC+F,KAAD,CAA1B;AACArE,IAAAA,OAAO,CAACmD,KAAR,CAAcoM,OAAd,GAAwB,MAAxB;AACA9P,IAAAA,MAAM,GAAGW,QAAQ,CAACoP,gBAAT,CAA0BF,QAAQ,CAACG,CAAnC,EAAsCH,QAAQ,CAACnC,CAA/C,CAAT;AACAnN,IAAAA,OAAO,CAACmD,KAAR,CAAcoM,OAAd,GAAwB,EAAxB;AACA,WAAO9P,MAAP;AACH,GAPD;;AAQAX,EAAAA,KAAK,CAAC2J,SAAN,CAAgBN,WAAhB,GAA8B,UAAU5I,CAAV,EAAa;AACvC,QAAI,KAAKJ,gBAAL,CAAsBmB,MAAtB,GAA+B,CAAnC,EAAsC;AAClC,WAAKvB,MAAL,CAAYiM,UAAZ,CAAuB,KAAK7L,gBAA5B;AACA,WAAKA,gBAAL,GAAwB,EAAxB;AACH;AACJ,GALD;;AAMAL,EAAAA,KAAK,CAAC2J,SAAN,CAAgBiH,YAAhB,GAA+B,UAAUnI,SAAV,EAAqB;AAChD,WAAOA,SAAS,GAAGxG,QAAQ,CAACwG,SAAS,CAACtG,YAAV,CAAuB,eAAvB,CAAD,EAA0C,EAA1C,CAAX,GAA2D,CAA3E;AACH,GAFD;;AAGAnC,EAAAA,KAAK,CAAC2J,SAAN,CAAgBkH,aAAhB,GAAgC,UAAUpQ,CAAV,EAAa;AACzC,QAAIgI,SAAS,GAAGrJ,cAAc,CAACqB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA9B;AACA,QAAImQ,YAAJ;AACA,QAAIC,UAAJ;AACAA,IAAAA,UAAU,GAAGtQ,CAAC,CAACuQ,cAAF,CAAiB9O,aAAjB,CAA+BgD,aAA/B,CAA6C,CAA7C,CAAb;AACA4L,IAAAA,YAAY,GAAGrI,SAAS,GAAGA,SAAS,CAAC0H,QAAb,GAAwBY,UAAU,CAACnM,eAAX,CAA2BpD,MAA3B,GAAoC,CAApF;AACA,SAAKwM,UAAL,CAAgB,KAAKiD,eAArB,EAAsCH,YAAtC;AACH,GAPD;;AAQA9Q,EAAAA,KAAK,CAAC2J,SAAN,CAAgBR,UAAhB,GAA6B,UAAU1I,CAAV,EAAa;AACtC,QAAIC,IAAI,GAAG,KAAKT,MAAhB;AACA,QAAIiR,QAAQ,GAAGzQ,CAAC,CAACuQ,cAAF,CAAiB9O,aAAjB,CAA+BgD,aAA/B,CAA6C,CAA7C,CAAf;;AACA,QAAIzE,CAAC,CAACuQ,cAAF,CAAiB7O,YAAjB,CAA8B,QAA9B,MAA4C,UAA5C,KACC7C,YAAY,CAACmB,CAAC,CAACE,MAAH,EAAW,OAAX,CAAZ,IAAmCrB,YAAY,CAACmB,CAAC,CAACE,MAAH,EAAW,YAAX,CADhD,CAAJ,EAC+E;AAC3E,UAAI8H,SAAS,GAAGrJ,cAAc,CAACqB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA9B;AACA,UAAIwQ,YAAJ;AACA,UAAIL,YAAY,GAAG,KAAK,CAAxB;;AACA,UAAKrQ,CAAC,CAACuQ,cAAF,CAAiBhN,aAAjB,CAA+B,IAA/B,EAAqC7B,YAArC,CAAkD,gBAAlD,MAAwE,MAAxE,IACD1B,CAAC,CAACuQ,cAAF,CAAiB9O,aAAjB,CAA+B6D,EAA/B,KAAsCrF,IAAI,CAACQ,OAAL,CAAa6E,EADnD,IAEItF,CAAC,CAACuQ,cAAF,CAAiBhN,aAAjB,CAA+B,IAA/B,EAAqC7B,YAArC,CAAkD,gBAAlD,MAAwE,MAAxE,IACA1B,CAAC,CAACuQ,cAAF,CAAiB9O,aAAjB,CAA+B6D,EAA/B,KAAsCrF,IAAI,CAACQ,OAAL,CAAa6E,EAH3D,EAGgE;AAC5D;AACH;;AACD,UAAItF,CAAC,CAACuQ,cAAF,CAAiB9O,aAAjB,CAA+B6D,EAA/B,KAAsCrF,IAAI,CAACQ,OAAL,CAAa6E,EAAvD,EAA2D;AACvDoL,QAAAA,YAAY,GAAG1Q,CAAC,CAACuQ,cAAF,CAAiB9O,aAAjB,CAA+BgD,aAA/B,CAA6C,CAA7C,CAAf;AACH,OAFD,MAGK,IAAI,KAAKkM,mBAAL,IAA4B3Q,CAAC,CAACuQ,cAAF,CAAiBhN,aAAjB,CAA+B,IAA/B,EAAqC7B,YAArC,CAAkD,gBAAlD,MAAwE,MAAxG,EAAgH;AACjH,aAAK0O,aAAL,CAAmBpQ,CAAnB;AACA;AACH;;AACD,UAAI0Q,YAAY,CAACjQ,OAAb,CAAqB6E,EAArB,KAA4BrF,IAAI,CAACQ,OAAL,CAAa6E,EAAzC,IAA+CoL,YAAY,CAAC1P,eAAb,CAA6BC,QAA7B,KAA0ChB,IAAI,CAACQ,OAAL,CAAa6E,EAA1G,EAA8G;AAC1G;AACH;;AACD,UAAIsL,OAAO,GAAGF,YAAY,CAAC/M,kBAAb,EAAd;AACA,UAAIkN,WAAW,GAAGR,YAAY,GAAG,KAAKF,YAAL,CAAkBnI,SAAlB,CAAjC;AACA,UAAI8I,KAAK,GAAG,CAAZ;;AACA,UAAIC,KAAK,CAACF,WAAD,CAAT,EAAwB;AACpBA,QAAAA,WAAW,GAAGR,YAAY,GAAG,CAA7B;AACH;;AACD,UAAIpQ,IAAI,CAAC+Q,WAAT,EAAsB;AAClBH,QAAAA,WAAW,GAAGA,WAAW,GAAI5Q,IAAI,CAACgR,YAAL,CAAkBC,WAAlB,GAAgCjR,IAAI,CAACgR,YAAL,CAAkBE,QAAjE,GAA6ElR,IAAI,CAACgR,YAAL,CAAkBE,QAA7G;AACH,OA5B0E,CA6B3E;;;AACA,UAAI,CAAC7S,QAAQ,EAAb,EAAiB;AACb2B,QAAAA,IAAI,CAACsG,MAAL,CAAYnH,MAAM,CAACgS,SAAnB,EAA8B;AAAE1E,UAAAA,OAAO,EAAEmE,WAAX;AAAwBD,UAAAA,OAAO,EAAEA;AAAjC,SAA9B;AACA3Q,QAAAA,IAAI,CAACsG,MAAL,CAAYnH,MAAM,CAAC8M,YAAnB,EAAiC;AAC7B9K,UAAAA,IAAI,EAAEhC,MAAM,CAAC+M,WADgB;AACHC,UAAAA,WAAW,EAAE;AADV,SAAjC;AAGA,YAAI1M,YAAY,GAAGgR,YAAY,CAACvN,qBAAb,EAAnB;AACA,YAAIkO,IAAI,GAAGX,YAAY,CAACM,WAAb,GACNN,YAAY,CAACO,YAAb,CAA0BC,WAA1B,GAAwCR,YAAY,CAACO,YAAb,CAA0BE,QAAnE,GAA+ET,YAAY,CAACO,YAAb,CAA0BE,QADlG,GAC6G,CADxH;AAEA,aAAKzR,YAAL,GAAoB,EAApB;;AACA,aAAK,IAAIoK,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG6G,OAAO,CAAC7P,MAA9B,EAAsC+I,CAAC,GAAGC,GAA1C,EAA+CD,CAAC,EAAhD,EAAoD;AAChD,eAAKpK,YAAL,CAAkB4R,IAAlB,CAAuBD,IAAI,GAAG3R,YAAY,CAACoK,CAAD,CAA1C;AACH;;AACD4G,QAAAA,YAAY,CAACnK,MAAb,CAAoBnH,MAAM,CAACmS,WAA3B,EAAwC;AAAEC,UAAAA,OAAO,EAAE,KAAK9R,YAAhB;AAA8BkR,UAAAA,OAAO,EAAEA;AAAvC,SAAxC;AACAF,QAAAA,YAAY,CAACnK,MAAb,CAAoBnH,MAAM,CAAC8M,YAA3B,EAAyC;AACrC9K,UAAAA,IAAI,EAAEhC,MAAM,CAAC+M,WADwB;AACXC,UAAAA,WAAW,EAAE;AADF,SAAzC;AAGH,OAhBD,MAiBK;AACD,YAAIV,YAAY,GAAG,EAAnB;AACA,YAAI+F,aAAa,GAAGf,YAAY,CAACvN,qBAAb,EAApB;;AACA,aAAK,IAAI2G,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2H,aAAa,CAAC1Q,MAAlC,EAA0C+I,CAAC,EAA3C,EAA+C;AAC3C4B,UAAAA,YAAY,CAAC5B,CAAD,CAAZ,GAAkB4G,YAAY,CAACvM,eAAb,CAA6BsN,aAAa,CAAC3H,CAAD,CAA1C,CAAlB;AACH;;AACD8G,QAAAA,OAAO,GAAGlF,YAAV;AACA,YAAIgG,OAAO,GAAG;AACVlK,UAAAA,YAAY,EAAEoJ,OADJ;AAEVnJ,UAAAA,cAAc,EAAE,EAFN;AAGVC,UAAAA,cAAc,EAAE;AAHN,SAAd;AAKA,YAAIE,wBAAwB,GAAG,0BAA/B;AACA,YAAIC,KAAK,GAAG,IAAIvI,KAAJ,EAAZ;AACAuI,QAAAA,KAAK,CAACD,wBAAD,CAAL,GAAkCiJ,WAAlC;AACA5Q,QAAAA,IAAI,CAAC6L,aAAL,GAAqBC,WAArB,CAAiC2F,OAAjC,EAA0CzR,IAAI,CAAC+L,uBAAL,GAA+B,CAA/B,CAA1C,EAA6E,EAA7E,EAAiFnE,KAAjF,EACKoE,IADL,CACU,YAAY;AAClBhM,UAAAA,IAAI,CAACsG,MAAL,CAAYnH,MAAM,CAAC8M,YAAnB,EAAiC;AAC7B9K,YAAAA,IAAI,EAAEhC,MAAM,CAAC+M,WADgB;AACHC,YAAAA,WAAW,EAAE;AADV,WAAjC;AAGH,SALD,EAKGC,KALH,CAKS,UAAUrM,CAAV,EAAa;AAClB,cAAIuM,OAAO,GAAG,SAAd;AACA,cAAID,KAAK,GAAG,OAAZ;;AACA,cAAI,CAAC/N,iBAAiB,CAACyB,CAAC,CAACsM,KAAD,CAAF,CAAlB,IAAgC,CAAC/N,iBAAiB,CAACyB,CAAC,CAACsM,KAAD,CAAD,CAASC,OAAT,CAAD,CAAtD,EAA2E;AACvEvM,YAAAA,CAAC,CAACsM,KAAD,CAAD,GAAWtM,CAAC,CAACsM,KAAD,CAAD,CAASC,OAAT,CAAX;AACH;;AACDtM,UAAAA,IAAI,CAAC2C,OAAL,CAAaxD,MAAM,CAACoN,aAApB,EAAmCxM,CAAnC;AACH,SAZD;AAaA0R,QAAAA,OAAO,CAACjK,cAAR,GAAyBmJ,OAAzB;AACAc,QAAAA,OAAO,CAAClK,YAAR,GAAuB,EAAvB;AACAkJ,QAAAA,YAAY,CAAC5E,aAAb,GAA6BC,WAA7B,CAAyC2F,OAAzC,EAAkDhB,YAAY,CAAC1E,uBAAb,GAAuC,CAAvC,CAAlD,EAA6F,EAA7F,EAAiGnE,KAAjG,EACKoE,IADL,CACU,YAAY;AAClByE,UAAAA,YAAY,CAACnK,MAAb,CAAoBnH,MAAM,CAAC8M,YAA3B,EAAyC;AACrC9K,YAAAA,IAAI,EAAEhC,MAAM,CAAC+M,WADwB;AACXC,YAAAA,WAAW,EAAE;AADF,WAAzC;AAGH,SALD,EAKGC,KALH,CAKS,UAAUrM,CAAV,EAAa;AAClB,cAAIsM,KAAK,GAAG,OAAZ;AACA,cAAIqF,GAAG,GAAG,SAAV;;AACA,cAAI,CAACpT,iBAAiB,CAACyB,CAAC,CAACsM,KAAD,CAAF,CAAlB,IAAgC,CAAC/N,iBAAiB,CAACyB,CAAC,CAACsM,KAAD,CAAD,CAASqF,GAAT,CAAD,CAAtD,EAAuE;AACnE3R,YAAAA,CAAC,CAACsM,KAAD,CAAD,GAAWtM,CAAC,CAACsM,KAAD,CAAD,CAASqF,GAAT,CAAX;AACH;;AACDjB,UAAAA,YAAY,CAAC9N,OAAb,CAAqBxD,MAAM,CAACoN,aAA5B,EAA2CxM,CAA3C;AACH,SAZD;AAaH;AACJ;AACJ,GAhGD;;AAiGAT,EAAAA,KAAK,CAAC2J,SAAN,CAAgBqE,UAAhB,GAA6B,UAAUd,WAAV,EAAuBC,OAAvB,EAAgC;AACzD,QAAIzM,IAAI,GAAG,KAAKT,MAAhB;;AACA,QAAI,CAACS,IAAI,CAAC2R,YAAL,CAAkBnM,OAAlB,CAA0B1E,MAA3B,IAAqC,CAACd,IAAI,CAACuF,aAAL,CAAmBC,OAAnB,CAA2B1E,MAAjE,IAA2E,CAACd,IAAI,CAAC4R,cAAL,CAAoBpM,OAApB,CAA4B1E,MAA5G,EAAoH;AAChH;AACA,UAAIsQ,IAAI,GAAGpR,IAAI,CAAC+Q,WAAL,GACN/Q,IAAI,CAACgR,YAAL,CAAkBC,WAAlB,GAAgCjR,IAAI,CAACgR,YAAL,CAAkBE,QAAnD,GAA+DlR,IAAI,CAACgR,YAAL,CAAkBE,QAD1E,GACqF,CADhG;AAEA,UAAInN,SAAS,GAAGyI,WAAhB;AACAC,MAAAA,OAAO,GAAGA,OAAO,GAAG2E,IAApB;AACA,WAAK3R,YAAL,GAAoBO,IAAI,CAACkD,qBAAL,EAApB;AACAlD,MAAAA,IAAI,CAACsG,MAAL,CAAYnH,MAAM,CAAC0S,kBAAnB,EAAuC;AACnC9N,QAAAA,SAAS,EAAEyI,WAAW,GAAG4E,IADU;AAEnC3E,QAAAA,OAAO,EAAEA;AAF0B,OAAvC;AAIH;AACJ,GAdD;;AAeAnN,EAAAA,KAAK,CAAC2J,SAAN,CAAgBD,iBAAhB,GAAoC,UAAUjJ,CAAV,EAAa;AAC7C,QAAIA,CAAC,CAAC+R,MAAF,KAAa,KAAKrN,aAAL,EAAb,IAAqC1E,CAAC,CAACgS,MAA3C,EAAmD;AAC/C,WAAKvJ,cAAL;AACH;AACJ,GAJD;AAKA;AACJ;AACA;AACA;AACA;;;AACIlJ,EAAAA,KAAK,CAAC2J,SAAN,CAAgB+I,OAAhB,GAA0B,YAAY;AAClC,QAAIC,WAAW,GAAG,KAAK1S,MAAL,CAAYiB,OAA9B;;AACA,QAAI,KAAKjB,MAAL,CAAYqH,WAAZ,IAA2B,CAACqL,WAA5B,IAA4C,CAACA,WAAW,CAAC3O,aAAZ,CAA0B,eAA1B,CAAD,IAC5C,CAAC2O,WAAW,CAAC3O,aAAZ,CAA0B,gBAA1B,CADL,EACmD;AAC/C;AACH;;AACD,SAAKpD,SAAL,CAAe8R,OAAf;AACA,SAAKzS,MAAL,CAAY2S,GAAZ,CAAgB/S,MAAM,CAACoJ,UAAvB,EAAmC,KAAKC,cAAxC;AACA,SAAKjJ,MAAL,CAAY2S,GAAZ,CAAgB/S,MAAM,CAACsJ,UAAvB,EAAmC,KAAKA,UAAxC;AACA,SAAKlJ,MAAL,CAAY4S,mBAAZ,CAAgChT,MAAM,CAAC2J,SAAvC,EAAkD,KAAKJ,aAAvD;AACA,SAAKnJ,MAAL,CAAY2S,GAAZ,CAAgB/S,MAAM,CAAC4J,QAAvB,EAAiC,KAAKC,iBAAtC,EAVkC,CAWlC;AACH,GAZD;AAaA;AACJ;AACA;AACA;;;AACI1J,EAAAA,KAAK,CAAC2J,SAAN,CAAgBxE,aAAhB,GAAgC,YAAY;AACxC,WAAO,gBAAP;AACH,GAFD;;AAGAnF,EAAAA,KAAK,CAAC2J,SAAN,CAAgB/G,WAAhB,GAA8B,UAAUjC,MAAV,EAAkB;AAC5C,QAAID,IAAI,GAAG,KAAKT,MAAhB;;AACA,QAAKS,IAAI,CAAC0D,kBAAL,GAA0B5C,MAA1B,GAAmC,CAAnC,IAAwC,KAAKY,UAAL,CAAgB0Q,KAAhB,CAAsB,CAAtB,EAAyBzT,SAAzB,CAAmCsC,QAAnC,CAA4C,uBAA5C,MAAyE,KAAlH,IACGjB,IAAI,CAAC0D,kBAAL,GAA0B5C,MAA1B,KAAqC,CAD5C,EAC+C;AAC3C,WAAKiB,IAAL,GAAY,CAAC,KAAKL,UAAN,CAAZ;AACA,WAAKe,OAAL,GAAe,CAAC,KAAKlD,MAAL,CAAY8S,UAAZ,CAAwB,KAAK3Q,UAAN,CAAkB4B,aAAlB,CAAgC,YAAhC,CAAvB,EAAsEb,OAAvE,CAAf;AACH,KAJD,MAKK;AACD,WAAKV,IAAL,GAAY/B,IAAI,CAAC0C,eAAL,EAAZ;AACA,WAAKD,OAAL,GAAezC,IAAI,CAAC0D,kBAAL,EAAf;AACH;AACJ,GAXD;;AAYA,SAAOpE,KAAP;AACH,CA9yB0B,EAA3B;;AA+yBA,SAASA,KAAT","sourcesContent":["import { Draggable, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent, getGridRowElements } from '../base/util';\nimport { gridActionHandler } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\nvar RowDD = /** @class */ (function () {\n    /**\n     * Constructor for the Grid print module\n     * @hidden\n     */\n    function RowDD(parent) {\n        var _this = this;\n        this.selectedRows = [];\n        this.isOverflowBorder = true;\n        this.selectedRowColls = [];\n        this.isRefresh = true;\n        this.isReplaceDragEle = true;\n        /* tslint:disable-next-line:max-line-length */\n        // tslint:disable-next-line:max-func-body-length\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = _this.draggable.currentStateTarget;\n            var visualElement = _this.parent.createElement('div', {\n                className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n                styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n            });\n            var table = _this.parent.createElement('table', { styles: 'width:' + gObj.element.offsetWidth });\n            var tbody = _this.parent.createElement('tbody');\n            if (document.getElementsByClassName('e-griddragarea').length ||\n                (gObj.rowDropSettings.targetID && (!target.classList.contains('e-selectionbackground')\n                    && gObj.selectionSettings.type !== 'Single')) ||\n                (!gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop'))) {\n                return false;\n            }\n            if (gObj.rowDropSettings.targetID &&\n                gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n                gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n            }\n            _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n            var frzCols = _this.parent.isFrozenGrid();\n            if (frzCols) {\n                var rowIndex_1 = parseInt(closestElement(target, 'tr').getAttribute('aria-rowindex'), 10);\n                var rows = getGridRowElements(_this.parent);\n                _this.startedRow.innerHTML = '';\n                gridActionHandler(_this.parent, function (freezeTable, rows) {\n                    _this.startedRow.innerHTML += rows[rowIndex_1].innerHTML;\n                }, rows);\n            }\n            _this.processArgs(target);\n            var args = {\n                selectedRow: _this.rows, dragelement: target,\n                cloneElement: visualElement, cancel: false, data: _this.rowData\n            };\n            var selectedRows = gObj.getSelectedRows();\n            gObj.trigger(events.rowDragStartHelper, args);\n            var cancel = 'cancel';\n            var cloneElement = 'cloneElement';\n            if (args[cancel]) {\n                return false;\n            }\n            removeElement(_this.startedRow, '.e-indentcell');\n            removeElement(_this.startedRow, '.e-detailrowcollapse');\n            removeElement(_this.startedRow, '.e-detailrowexpand');\n            _this.removeCell(_this.startedRow, 'e-gridchkbox');\n            var exp = new RegExp('e-active', 'g'); //high contrast issue\n            _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n            tbody.appendChild(_this.startedRow);\n            if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n                var dropCountEle = _this.parent.createElement('span', {\n                    className: 'e-dropitemscount', innerHTML: frzCols ? '' + selectedRows.length / 2 : '' + selectedRows.length,\n                });\n                visualElement.appendChild(dropCountEle);\n            }\n            var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n            if (ele) {\n                ele.classList.add('e-dragstartrow');\n            }\n            table.appendChild(tbody);\n            visualElement.appendChild(table);\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            if (document.getElementsByClassName('e-griddragarea').length) {\n                return;\n            }\n            var target = e.target;\n            var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n            if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n                spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table')\n                    .offsetWidth - 5 + 'px';\n            }\n            _this.processArgs(target);\n            gObj.trigger(events.rowDragStart, {\n                rows: (isBlazor()) ? null : _this.rows, target: (isBlazor()) ? null : e.target,\n                draggableType: 'rows', fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                data: (Object.keys(_this.rowData[0]).length > 0) ? _this.rowData : _this.currentViewData()\n            });\n            if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n            }\n            _this.dragStartData = _this.rowData;\n            var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances &&\n                dropElem.ej2_instances[0].getModuleName() === 'grid') {\n                dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            var target = _this.getElementFromPosition(cloneElement, e.event);\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n            _this.isOverflowBorder = true;\n            _this.hoverState = gObj.enableHover;\n            var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n            gObj.enableHover = false;\n            if (!e.target) {\n                return;\n            }\n            _this.processArgs(target);\n            var args = {\n                rows: _this.rows, target: target, draggableType: 'rows',\n                data: _this.rowData, originalEvent: e, cancel: false\n            };\n            gObj.trigger(events.rowDrag, args);\n            _this.stopTimer();\n            if (args.cancel) {\n                return;\n            }\n            gObj.element.classList.add('e-rowdrag');\n            _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ?\n                parseInt(trElement.getAttribute('aria-rowindex'), 10) : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n            if (gObj.rowDropSettings.targetID) {\n                if (!parentsUntil(target, 'e-grid') ||\n                    parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n                }\n            }\n            else {\n                var elem = parentsUntil(target, 'e-grid');\n                if (elem && elem.id === cloneElement.parentElement.id) {\n                    classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n                }\n            }\n            if (!gObj.rowDropSettings.targetID &&\n                (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n                if (parentsUntil(target, 'e-grid')) {\n                    _this.updateScrollPostion(e.event, target);\n                }\n                if ((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) &&\n                    parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n                    _this.moveDragRows(e, _this.startedRow, trElement);\n                }\n                else {\n                    if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') ===\n                        trElement.getAttribute('data-uid')) {\n                        var bottomborder = _this.parent.createElement('div', { className: 'e-lastrow-dragborder' });\n                        var gridcontentEle = _this.parent.getContent();\n                        bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n                        if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n                            gridcontentEle.classList.add('e-grid-relative');\n                            gridcontentEle.appendChild(bottomborder);\n                            bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n                        }\n                    }\n                    _this.removeBorder(trElement);\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            if (isActionPrevent(_this.parent)) {\n                _this.parent.notify(events.preventBatch, {\n                    instance: _this, handler: _this.processDragStop, arg1: e\n                });\n            }\n            else {\n                _this.processDragStop(e);\n            }\n        };\n        this.processDragStop = function (e) {\n            var gObj = _this.parent;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            var targetEle = _this.getElementFromPosition(e.helper, e.event);\n            var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ?\n                targetEle : e.target;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            gObj.element.classList.remove('e-rowdrag');\n            var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances &&\n                dropElement.ej2_instances[0].getModuleName() === 'grid') {\n                dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n            }\n            if (gObj.isRowDragable()) {\n                _this.stopTimer();\n                gObj.enableHover = _this.hoverState;\n                _this.parent.getContent().classList.remove('e-grid-relative');\n                _this.removeBorder(targetEle);\n                var stRow = gObj.element.querySelector('.e-dragstartrow');\n                if (stRow) {\n                    stRow.classList.remove('e-dragstartrow');\n                }\n            }\n            _this.processArgs(target);\n            var args = {\n                target: (isBlazor()) ? null : target, draggableType: 'rows',\n                cancel: false,\n                fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                dropIndex: _this.dragTarget, rows: (isBlazor()) ? null : _this.rows,\n                data: (Object.keys(_this.dragStartData[0]).length > 0) ? _this.dragStartData : _this.currentViewData()\n            };\n            gObj.trigger(events.rowDrop, args, function () {\n                if (!(parentsUntil(target, 'e-row') || parentsUntil(target, 'e-emptyrow')) || args.cancel) {\n                    _this.dragTarget = null;\n                    remove(e.helper);\n                    return;\n                }\n                _this.isRefresh = false;\n                var selectedIndexes = _this.parent.getSelectedRowIndexes();\n                if (gObj.isRowDragable()) {\n                    if (!isBlazor()) {\n                        if (!_this.parent.rowDropSettings.targetID &&\n                            _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 &&\n                            selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n                            _this.reorderRows(selectedIndexes, args.dropIndex);\n                        }\n                        else {\n                            _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n                        }\n                    }\n                    else {\n                        var draggedData = _this.parent.getSelectedRecords().length ?\n                            _this.parent.getSelectedRecords() : _this.currentViewData();\n                        var changeRecords = {\n                            addedRecords: [],\n                            deletedRecords: draggedData,\n                            changedRecords: []\n                        };\n                        var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n                        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                        var query = new Query;\n                        query[dragDropDestinationIndex] = toIdx;\n                        _this.saveChange(changeRecords, query);\n                        changeRecords.deletedRecords = [];\n                        changeRecords.addedRecords = draggedData;\n                        _this.saveChange(changeRecords, query);\n                    }\n                    _this.dragTarget = null;\n                    if (!gObj.rowDropSettings.targetID) {\n                        remove(e.helper);\n                        _this.rowOrder(args);\n                    }\n                }\n                _this.isRefresh = true;\n            });\n        };\n        this.removeCell = function (targetRow, className) {\n            return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n                if (cell.classList.contains(className)) {\n                    targetRow.deleteCell(cell.cellIndex);\n                }\n            });\n        };\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialEnd, this.initializeDrag, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.onDataBoundFn = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    }\n    RowDD.prototype.refreshRow = function (args, tbody, mtbody) {\n        var gObj = this.parent;\n        var target;\n        var mTarget;\n        var frzCols = this.parent.getFrozenColumns();\n        var tbodyMovableHeader;\n        var tbodyMovableContent;\n        var tbodyContent = gObj.getContentTable().querySelector('tbody');\n        var tbodyHeader = gObj.getHeaderContent().querySelector('tbody');\n        if (frzCols) {\n            tbodyMovableHeader = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n            tbodyMovableContent = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n        }\n        var targetIdx = parseInt(args.target.parentElement.getAttribute('aria-rowindex'), 10);\n        if (args.fromIndex < args.dropIndex || args.fromIndex === args.dropIndex) {\n            targetIdx = targetIdx + 1;\n        }\n        target = tbody.querySelectorAll('.e-row')[targetIdx];\n        if (frzCols) {\n            mTarget = mtbody.querySelectorAll('.e-row')[targetIdx];\n        }\n        for (var i = 0, len = args.rows.length; i < len; i++) {\n            if (frzCols) {\n                if (args.rows.length === 1) {\n                    args.rows[i] = tbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n                    args.rows[i + 1] = mtbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n                }\n                else {\n                    if (i % 2 === 0) {\n                        args.rows[i] = tbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n                    }\n                    else {\n                        args.rows[i] = mtbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n                    }\n                }\n            }\n            else {\n                args.rows[i] = tbody.children[parseInt(args.rows[i].getAttribute('aria-rowindex'), 10)];\n            }\n        }\n        for (var i = 0, len = args.rows.length; i < len; i++) {\n            if (frzCols) {\n                if (i % 2 === 0) {\n                    tbody.insertBefore(args.rows[i], target);\n                }\n                else {\n                    mtbody.insertBefore(args.rows[i], mTarget);\n                }\n            }\n            else {\n                tbody.insertBefore(args.rows[i], target);\n            }\n        }\n        var tr = [].slice.call(tbody.querySelectorAll('.e-row'));\n        var mtr;\n        if (frzCols) {\n            mtr = [].slice.call(mtbody.querySelectorAll('.e-row'));\n        }\n        this.refreshData(tr, mtr);\n        if (this.parent.frozenRows) {\n            for (var i = 0, len = tr.length; i < len; i++) {\n                if (i < this.parent.frozenRows) {\n                    tbodyHeader.appendChild(tr[i]);\n                    if (this.parent.getFrozenColumns()) {\n                        tbodyMovableHeader.appendChild(mtr[i]);\n                    }\n                }\n                else {\n                    tbodyContent.appendChild(tr[i]);\n                    if (this.parent.getFrozenColumns()) {\n                        tbodyMovableContent.appendChild(mtr[i]);\n                    }\n                }\n            }\n        }\n    };\n    RowDD.prototype.updateFrozenRowreOrder = function (args) {\n        var gObj = this.parent;\n        var tbodyMovH;\n        var tbodyMovC;\n        var frzCols = this.parent.getFrozenColumns();\n        var tbodyC = gObj.getContentTable().querySelector('tbody');\n        var tbodyH = gObj.getHeaderContent().querySelector('tbody');\n        if (frzCols) {\n            tbodyMovH = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n            tbodyMovC = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n        }\n        var tr = [].slice.call(tbodyH.querySelectorAll('.e-row')).concat([].slice.call(tbodyC.querySelectorAll('.e-row')));\n        var mtr;\n        if (frzCols) {\n            mtr = [].slice.call(tbodyMovH.querySelectorAll('.e-row')).concat([].slice.call(tbodyMovC.querySelectorAll('.e-row')));\n        }\n        var tbody = gObj.createElement('tbody');\n        var mtbody = gObj.createElement('tbody');\n        this.parent.clearSelection();\n        for (var i = 0, len = tr.length; i < len; i++) {\n            tbody.appendChild(tr[i]);\n            if (frzCols) {\n                mtbody.appendChild(mtr[i]);\n            }\n        }\n        this.refreshRow(args, tbody, mtbody);\n    };\n    RowDD.prototype.updateFrozenColumnreOrder = function (args) {\n        var gObj = this.parent;\n        var mtbody;\n        var frzCols = this.parent.getFrozenColumns();\n        var tbody = gObj.getContentTable().querySelector('tbody');\n        if (frzCols) {\n            mtbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n        }\n        this.parent.clearSelection();\n        this.refreshRow(args, tbody, mtbody);\n    };\n    RowDD.prototype.refreshData = function (tr, mtr) {\n        var rowObj = {};\n        var movobj = {};\n        var recordobj = {};\n        for (var i = 0, len = tr.length; i < len; i++) {\n            var index = parseInt(tr[i].getAttribute('aria-rowindex'), 10);\n            rowObj[i] = this.parent.getRowsObject()[index];\n            recordobj[i] = this.parent.getCurrentViewRecords()[index];\n            if (this.parent.frozenColumns) {\n                movobj[i] = this.parent.getMovableRowsObject()[index];\n            }\n        }\n        for (var i = 0, len = tr.length; i < len; i++) {\n            tr[i].setAttribute('aria-rowindex', i.toString());\n            tr[i].setAttribute('data-uid', 'grid-row' + i.toString());\n            this.parent.getRows()[i] = tr[i];\n            this.parent.getRowsObject()[i] = rowObj[i];\n            this.parent.getRowsObject()[i].uid = 'grid-row' + i.toString();\n            this.parent.getRowsObject()[i].index = i;\n            this.parent.getCurrentViewRecords()[i] = recordobj[i];\n            if (this.parent.frozenColumns) {\n                mtr[i].setAttribute('aria-rowindex', i.toString());\n                mtr[i].setAttribute('data-uid', 'grid-row' + (i + tr.length).toString());\n                this.parent.getMovableRows()[i] = mtr[i];\n                this.parent.getMovableRowsObject()[i] = movobj[i];\n                this.parent.getMovableRowsObject()[i].uid = 'grid-row' + (i + tr.length).toString();\n                this.parent.getMovableRowsObject()[i].index = i;\n            }\n        }\n    };\n    RowDD.prototype.rowOrder = function (args) {\n        if (args.target.classList.contains('e-rowcelldrag')) {\n            args.target = args.target.parentElement;\n        }\n        if (this.parent.frozenRows) {\n            this.updateFrozenRowreOrder(args);\n        }\n        else {\n            this.updateFrozenColumnreOrder(args);\n        }\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.currentViewData = function () {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var currentVdata = [];\n        var fromIdx = parseInt(this.startedRow.getAttribute('aria-rowindex'), 10);\n        for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n            var currentV = 'currentViewData';\n            currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n        }\n        if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n            currentVdata[0] = this.parent.currentViewData[fromIdx];\n        }\n        return currentVdata;\n    };\n    RowDD.prototype.saveChange = function (changeRecords, query) {\n        var _this = this;\n        this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n            .then(function () {\n            _this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }).catch(function (e) {\n            var error = 'error';\n            var message = 'message';\n            if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                e[error] = e[error][message];\n            }\n            _this.parent.trigger(events.actionFailure, e);\n        });\n    };\n    RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var selectedRecords = [];\n        var draggedRecords = [];\n        var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n        var dropIdx = toIndex;\n        var actualIdx = fromIndexes[0];\n        for (var i = 0, len = fromIndexes.length; i < len; i++) {\n            draggedRecords[i] = currentViewData[fromIndexes[i]];\n        }\n        for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n            selectedRecords[i] = currentViewData[selectedIndexes[i]];\n        }\n        for (var i = 0, len = draggedRecords.length; i < len; i++) {\n            if (i !== 0) {\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) ===\n                        JSON.stringify(draggedRecords[i])) {\n                        actualIdx = j;\n                        break;\n                    }\n                }\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n                        if (actualIdx > j) {\n                            dropIdx = j + 1;\n                        }\n                        break;\n                    }\n                }\n            }\n            this.reorderRow(actualIdx, dropIdx);\n        }\n        if (this.isRefresh) {\n            this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n        for (var i = 0, len = selectedRecords.length; i < len; i++) {\n            for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n                    selectedIndexes[i] = j;\n                    break;\n                }\n            }\n        }\n        this.selectedRowColls = selectedIndexes;\n    };\n    RowDD.prototype.stopTimer = function () {\n        window.clearInterval(this.timer);\n    };\n    RowDD.prototype.initializeDrag = function () {\n        var gObj = this.parent;\n        this.draggable = new Draggable(gObj.element, {\n            dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop,\n            isReplaceDragEle: this.isReplaceDragEle,\n        });\n    };\n    RowDD.prototype.updateScrollPostion = function (e, target) {\n        var _this = this;\n        var y = getPosition(e).y;\n        var cliRect = this.parent.getContent().getBoundingClientRect();\n        var rowHeight = this.parent.getRowHeight() - 15;\n        var scrollElem = this.parent.getContent().firstElementChild;\n        if (cliRect.top + rowHeight >= y) {\n            var scrollPixel_1 = -(this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_1, true); }, 200);\n        }\n        else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n            var scrollPixel_2 = (this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_2, true); }, 200);\n        }\n    };\n    RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n        scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n    };\n    RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        var element = closestElement(e.target, 'tr');\n        if (parentsUntil(element, 'e-grid') &&\n            parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n            var targetElement = element ?\n                element : this.startedRow;\n            this.setBorder(targetElement, e.event, startedRow, targetRow);\n        }\n    };\n    RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n        var node = this.parent.element;\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        if (parentsUntil(element, 'e-grid') &&\n            parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n            removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n            var rowElement_1 = [];\n            var targetRowIndex = parseInt(targetRow.getAttribute('aria-rowindex'), 10);\n            if (targetRow && targetRowIndex === 0) {\n                var div = this.parent.createElement('div', { className: 'e-firstrow-dragborder' });\n                var gridheaderEle = this.parent.getHeaderContent();\n                gridheaderEle.classList.add('e-grid-relative');\n                div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n                if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n                    gridheaderEle.appendChild(div);\n                }\n            }\n            else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRowIndex) {\n                element = this.parent.getRowByIndex(targetRowIndex - 1);\n                rowElement_1 = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else {\n                rowElement_1 = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            var frzCols = this.parent.isFrozenGrid();\n            if (targetRow && targetRowIndex !== 0 && frzCols) {\n                var rowIndex_2 = parseInt(element.getAttribute('aria-rowindex'), 10);\n                var selector_1 = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n                rowElement_1 = [];\n                gridActionHandler(this.parent, function (tableName, rows) {\n                    rowElement_1 = rowElement_1.concat([].slice.call(rows[rowIndex_2].querySelectorAll(selector_1)));\n                }, getGridRowElements(this.parent));\n            }\n            if (rowElement_1.length > 0) {\n                addRemoveActiveClasses(rowElement_1, true, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.getScrollWidth = function () {\n        var scrollElem = this.parent.getContent().firstElementChild;\n        return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n    };\n    RowDD.prototype.removeFirstRowBorder = function (element) {\n        if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element &&\n            element.rowIndex !== 0) {\n            remove(this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0]);\n        }\n    };\n    RowDD.prototype.removeLastRowBorder = function (element) {\n        var islastRowIndex = element &&\n            this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !==\n                element.getAttribute('data-uid');\n        if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n            remove(this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0]);\n        }\n    };\n    RowDD.prototype.removeBorder = function (element) {\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        element = this.parent.getRows().filter(function (row) {\n            return row.querySelector('td.e-dragborder');\n        })[0];\n        if (element) {\n            var rowElement_2 = [].slice.call(element.querySelectorAll('.e-dragborder'));\n            if (this.parent.isFrozenGrid()) {\n                var rowIndex_3 = parseInt(element.getAttribute('aria-rowindex'), 10);\n                rowElement_2 = [];\n                gridActionHandler(this.parent, function (tableName, rows) {\n                    rowElement_2 = rowElement_2.concat([].slice.call(rows[rowIndex_3].querySelectorAll('.e-dragborder')));\n                }, getGridRowElements(this.parent));\n            }\n            addRemoveActiveClasses(rowElement_2, false, 'e-dragborder');\n        }\n    };\n    RowDD.prototype.getElementFromPosition = function (element, event) {\n        var target;\n        var position = getPosition(event);\n        element.style.display = 'none';\n        target = document.elementFromPoint(position.x, position.y);\n        element.style.display = '';\n        return target;\n    };\n    RowDD.prototype.onDataBound = function (e) {\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.getTargetIdx = function (targetRow) {\n        return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n    };\n    RowDD.prototype.singleRowDrop = function (e) {\n        var targetRow = closestElement(e.target, 'tr');\n        var currentIndex;\n        var srcControl;\n        srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n        this.reorderRow(this.startedRowIndex, currentIndex);\n    };\n    RowDD.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n        if (e.droppedElement.getAttribute('action') !== 'grouping' &&\n            (parentsUntil(e.target, 'e-row') || parentsUntil(e.target, 'e-emptyrow'))) {\n            var targetRow = closestElement(e.target, 'tr');\n            var srcControl_1;\n            var currentIndex = void 0;\n            if ((e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' &&\n                e.droppedElement.parentElement.id === gObj.element.id)\n                || (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' &&\n                    e.droppedElement.parentElement.id !== gObj.element.id)) {\n                return;\n            }\n            if (e.droppedElement.parentElement.id !== gObj.element.id) {\n                srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n            }\n            else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n                this.singleRowDrop(e);\n                return;\n            }\n            if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n                return;\n            }\n            var records = srcControl_1.getSelectedRecords();\n            var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n            var count = 0;\n            if (isNaN(targetIndex)) {\n                targetIndex = currentIndex = 0;\n            }\n            if (gObj.allowPaging) {\n                targetIndex = targetIndex + (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize;\n            }\n            //Todo: drag and drop mapper & BatchChanges\n            if (!isBlazor()) {\n                gObj.notify(events.rowsAdded, { toIndex: targetIndex, records: records });\n                gObj.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n                var selectedRows = srcControl_1.getSelectedRowIndexes();\n                var skip = srcControl_1.allowPaging ?\n                    (srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize) - srcControl_1.pageSettings.pageSize : 0;\n                this.selectedRows = [];\n                for (var i = 0, len = records.length; i < len; i++) {\n                    this.selectedRows.push(skip + selectedRows[i]);\n                }\n                srcControl_1.notify(events.rowsRemoved, { indexes: this.selectedRows, records: records });\n                srcControl_1.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n            }\n            else {\n                var currentVdata = [];\n                var selectedIndex = srcControl_1.getSelectedRowIndexes();\n                for (var i = 0; i < selectedIndex.length; i++) {\n                    currentVdata[i] = srcControl_1.currentViewData[selectedIndex[i]];\n                }\n                records = currentVdata;\n                var changes = {\n                    addedRecords: records,\n                    deletedRecords: [],\n                    changedRecords: []\n                };\n                var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                var query = new Query;\n                query[dragDropDestinationIndex] = targetIndex;\n                gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    gObj.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    var message = 'message';\n                    var error = 'error';\n                    if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                        e[error] = e[error][message];\n                    }\n                    gObj.trigger(events.actionFailure, e);\n                });\n                changes.deletedRecords = records;\n                changes.addedRecords = [];\n                srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    srcControl_1.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    var error = 'error';\n                    var msg = 'message';\n                    if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][msg])) {\n                        e[error] = e[error][msg];\n                    }\n                    srcControl_1.trigger(events.actionFailure, e);\n                });\n            }\n        }\n    };\n    RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n        var gObj = this.parent;\n        if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n            //Todo: drag and drop mapper & BatchChanges                 \n            var skip = gObj.allowPaging ?\n                (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize : 0;\n            var fromIndex = fromIndexes;\n            toIndex = toIndex + skip;\n            this.selectedRows = gObj.getSelectedRowIndexes();\n            gObj.notify(events.rowPositionChanged, {\n                fromIndex: fromIndexes + skip,\n                toIndex: toIndex\n            });\n        }\n    };\n    RowDD.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.initializeDrag();\n        }\n    };\n    /**\n     * To destroy the print\n     * @return {void}\n     * @hidden\n     */\n    RowDD.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (this.parent.isDestroyed || !gridElement || (!gridElement.querySelector('.e-gridheader') &&\n            !gridElement.querySelector('.e-gridcontent'))) {\n            return;\n        }\n        this.draggable.destroy();\n        this.parent.off(events.initialEnd, this.initializeDrag);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        //destory ejdrag and drop\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    RowDD.prototype.getModuleName = function () {\n        return 'rowDragAndDrop';\n    };\n    RowDD.prototype.processArgs = function (target) {\n        var gObj = this.parent;\n        if ((gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false)\n            || gObj.getSelectedRecords().length === 0) {\n            this.rows = [this.startedRow];\n            this.rowData = [this.parent.getRowInfo((this.startedRow).querySelector('.e-rowcell')).rowData];\n        }\n        else {\n            this.rows = gObj.getSelectedRows();\n            this.rowData = gObj.getSelectedRecords();\n        }\n    };\n    return RowDD;\n}());\nexport { RowDD };\n"]},"metadata":{},"sourceType":"module"}