{"ast":null,"code":"import { extend, addClass, removeClass, setValue, isBlazor, closest, select } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, gridActionHandler } from '../base/util';\nimport { splitFrozenRowObjectCells, getGridRowElements } from '../base/util';\nimport { sliceElements, getCellByColAndRowIndex, getMovableTbody, getFrozenRightTbody } from '../base/util';\nimport { getGridRowObjects } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\n\nvar BatchEdit =\n/** @class */\nfunction () {\n  function BatchEdit(parent, serviceLocator, renderer) {\n    this.cellDetails = {};\n    this.originalCell = {};\n    this.cloneCell = {};\n    this.editNext = false;\n    this.preventSaveCell = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = renderer;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n  }\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.dblclick, this.dblClickHandler, this);\n    this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n    this.parent.on(events.cellFocused, this.onCellFocused, this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.batchCancelFunction = this.batchCancel.bind(this);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n    this.parent.on(events.doubleTap, this.dblClickHandler, this);\n    this.parent.on(events.keyPressed, this.keyDownHandler, this);\n    this.parent.on(events.editNextValCell, this.editNextValCell, this);\n    this.parent.on('closebatch', this.closeForm, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.dblclick, this.dblClickHandler);\n    this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n    this.parent.off(events.cellFocused, this.onCellFocused);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n    this.parent.off(events.doubleTap, this.dblClickHandler);\n    this.parent.off(events.keyPressed, this.keyDownHandler);\n    this.parent.off(events.editNextValCell, this.editNextValCell);\n    this.parent.off('closebatch', this.closeForm);\n  };\n\n  BatchEdit.prototype.batchCancel = function (args) {\n    this.parent.focusModule.restoreFocus();\n  };\n\n  BatchEdit.prototype.dataBound = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  BatchEdit.prototype.clickHandler = function (e) {\n    if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n      if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td')) {\n        this.saveCell();\n        this.editNextValCell();\n      }\n\n      if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n        this.setCellIdx(e.target);\n      }\n    }\n  };\n\n  BatchEdit.prototype.dblClickHandler = function (e) {\n    var target = parentsUntil(e.target, 'e-rowcell');\n    var tr = parentsUntil(e.target, 'e-row');\n\n    if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10)) && !target.parentElement.classList.contains('e-editedrow')) {\n      this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n    }\n  };\n\n  BatchEdit.prototype.onBeforeCellFocused = function (e) {\n    if (this.parent.isEdit && this.validateFormObj() && (e.byClick || ['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1)) {\n      e.cancel = true;\n\n      if (e.byClick) {\n        e.clickArgs.preventDefault();\n      } else {\n        e.keyArgs.preventDefault();\n      }\n    }\n  };\n\n  BatchEdit.prototype.onCellFocused = function (e) {\n    var frzCols = this.parent.getFrozenLeftCount();\n    var frzRightCols = this.parent.getFrozenRightColumnsCount();\n    var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n    var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n    var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n\n    if (!e.byKey || clear) {\n      if (this.parent.isEdit && clear) {\n        this.saveCell();\n      }\n\n      return;\n    }\n\n    var _a = e.container.indexes,\n        rowIndex = _a[0],\n        cellIndex = _a[1];\n\n    if (frzCols && (mCont.contains(e.element) || this.parent.frozenRows && mHdr.contains(e.element))) {\n      cellIndex += frzCols;\n    }\n\n    if (frzRightCols) {\n      var frHdr = this.parent.getHeaderContent().querySelector('.e-frozen-right-header');\n      var frCont = this.parent.getContent().querySelector('.e-frozen-right-content');\n\n      if (frCont.contains(e.element) || this.parent.frozenRows && frHdr.contains(e.element)) {\n        cellIndex += frzCols + this.parent.getMovableColumnsCount();\n      }\n    }\n\n    if (this.parent.frozenRows && e.container.isContent) {\n      rowIndex += this.parent.frozenRows;\n    }\n\n    var isEdit = this.parent.isEdit;\n\n    if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n      isEdit = isEdit && !this.validateFormObj();\n\n      switch (e.keyArgs.action) {\n        case 'tab':\n        case 'shiftTab':\n          var col = this.parent.getColumns()[e.indexes[1]];\n\n          if (col && !this.parent.isEdit) {\n            this.editCell(e.indexes[0], col.field);\n          }\n\n          if (isEdit || this.parent.isLastCellPrimaryKey) {\n            this.editCellFromIndex(rowIndex, cellIndex);\n          }\n\n          break;\n\n        case 'enter':\n        case 'shiftEnter':\n          e.keyArgs.preventDefault();\n\n          if (isEdit) {\n            this.editCell(rowIndex, this.cellDetails.column.field);\n          }\n\n          break;\n\n        case 'f2':\n          this.editCellFromIndex(rowIndex, cellIndex);\n          this.focus.focus();\n          break;\n      }\n    }\n  };\n\n  BatchEdit.prototype.isAddRow = function (index) {\n    return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n  };\n\n  BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n    this.cellDetails.rowIndex = rowIdx;\n    this.cellDetails.cellIndex = cellIdx;\n    this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.closeEdit = function () {\n    var _this = this;\n\n    var gObj = this.parent;\n    var rows = this.parent.getRowsObject();\n    var argument = {\n      cancel: false,\n      batchChanges: this.getBatchChanges()\n    };\n    gObj.notify(events.beforeBatchCancel, argument);\n\n    if (argument.cancel) {\n      return;\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n        }\n      }\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    gObj.clearSelection();\n    var allRows = getGridRowObjects(this.parent);\n\n    var _loop_1 = function (i) {\n      var isInsert = false;\n      var isDirty = rows[i].isDirty;\n      gridActionHandler(this_1.parent, function (tableName, rows) {\n        isInsert = _this.removeBatchElementChanges(rows[i], isDirty);\n\n        if (isInsert) {\n          rows.splice(i, 1);\n        }\n      }, allRows);\n\n      if (isInsert) {\n        i--;\n      }\n\n      out_i_1 = i;\n    };\n\n    var this_1 = this,\n        out_i_1;\n\n    for (var i = 0; i < rows.length; i++) {\n      _loop_1(i);\n\n      i = out_i_1;\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      gObj.selectRow(gObj.selectionModule.prevRowIndex);\n    }\n\n    if (!gObj.getContentTable().querySelector('tr.e-row')) {\n      gObj.renderModule.renderEmptyRow();\n    }\n\n    var args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.notify(events.batchCancel, {\n      rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() : [new Row({\n        isDataRow: true,\n        cells: [new Cell({\n          isDataCell: true,\n          visible: true\n        })]\n      })]\n    });\n    gObj.selectRow(this.cellDetails.rowIndex);\n    this.refreshRowIdx();\n    gObj.notify(events.toolbarRefresh, {});\n    this.parent.notify(events.tooltipDestroy, {});\n    args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.trigger(events.batchCancel, args);\n  };\n\n  BatchEdit.prototype.removeBatchElementChanges = function (row, isDirty) {\n    var gObj = this.parent;\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var isInstertedRemoved = false;\n\n    if (isDirty) {\n      row.isDirty = isDirty;\n      var tr = gObj.getRowElementByUID(row.uid);\n\n      if (tr) {\n        if (tr.classList.contains('e-insertedrow')) {\n          remove(tr);\n          isInstertedRemoved = true;\n        } else {\n          refreshForeignData(row, this.parent.getForeignKeyColumns(), row.data);\n          delete row.changes;\n          delete row.edit;\n          row.isDirty = false;\n\n          if (isBlazor() && gObj.isServerRendered) {\n            this.removeHideAndSelection(tr);\n            this.closeForm();\n          } else {\n            classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n            rowRenderer.refresh(row, gObj.getColumns(), false);\n          }\n        }\n\n        if (this.parent.aggregates.length > 0) {\n          var type = 'type';\n          var editType = [];\n          editType[type] = 'cancel';\n          this.parent.notify(events.refreshFooterRenderer, editType);\n\n          if (this.parent.groupSettings.columns.length > 0) {\n            this.parent.notify(events.groupAggregates, editType);\n          }\n        }\n      }\n    }\n\n    return isInstertedRemoved;\n  };\n\n  BatchEdit.prototype.removeHideAndSelection = function (tr) {\n    if (tr.classList.contains('e-hiddenrow')) {\n      tr.removeAttribute('aria-selected');\n      var tdElements = [].slice.call(tr.querySelectorAll('.e-selectionbackground'));\n\n      for (var i = 0; i < tdElements.length; i++) {\n        removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n      }\n    }\n\n    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n  };\n\n  BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.saveCell();\n\n    if (this.validateFormObj()) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    this.bulkDelete(fieldname, data);\n\n    if (this.parent.aggregates.length > 0) {\n      this.parent.notify(events.refreshFooterRenderer, {});\n\n      if (this.parent.groupSettings.columns.length > 0) {\n        this.parent.notify(events.groupAggregates, {});\n      }\n    }\n  };\n\n  BatchEdit.prototype.addRecord = function (data) {\n    this.bulkAddRow(data);\n  };\n\n  BatchEdit.prototype.endEdit = function (data) {\n    if (this.parent.isEdit && this.validateFormObj()) {\n      return;\n    }\n\n    this.batchSave();\n  };\n\n  BatchEdit.prototype.closeForm = function () {\n    for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n      for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n        if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n          this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n\n          if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n            this.originalCell[Object.keys(this.originalCell)[i]].classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n          }\n        }\n      }\n    }\n\n    this.cloneCell = {};\n    this.originalCell = {};\n  };\n\n  BatchEdit.prototype.validateFormObj = function () {\n    return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n  };\n\n  BatchEdit.prototype.batchSave = function () {\n    var _this = this;\n\n    var gObj = this.parent;\n    var deletedRecords = 'deletedRecords';\n\n    if (gObj.isCheckBoxSelection) {\n      var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n\n      if (checkAllBox.classList.contains('e-checkbox-disabled') && gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n        removeClass([checkAllBox], ['e-checkbox-disabled']);\n      }\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          blazorTemplates[this.parent.element.id + col.uid] = [];\n          resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n        }\n      }\n    }\n\n    this.saveCell();\n\n    if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n      return;\n    }\n\n    var changes = this.getBatchChanges();\n\n    if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length && this.parent.selectionSettings.persistSelection) {\n      changes[deletedRecords] = this.removeSelectedData;\n      this.removeSelectedData = [];\n    }\n\n    var original = {\n      changedRecords: this.parent.getRowsObject().filter(function (row) {\n        return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1;\n      }).map(function (row) {\n        return row.data;\n      })\n    };\n    var args = {\n      batchChanges: changes,\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n      if (beforeBatchSaveArgs.cancel) {\n        return;\n      }\n\n      if (isBlazor() && _this.parent.isServerRendered) {\n        var content = _this.parent.getContent();\n\n        _this.closeForm();\n\n        removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n\n        if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n          removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n          var insertedRow = [].slice.call(content.querySelectorAll('.e-insertedrow'));\n\n          for (var i = 0; i < insertedRow.length; i++) {\n            insertedRow[i].remove();\n          }\n        }\n\n        _this.refreshRowIdx();\n      }\n\n      gObj.showSpinner();\n      gObj.notify(events.bulkSave, {\n        changes: changes,\n        original: original\n      });\n    });\n  };\n\n  BatchEdit.prototype.getBatchChanges = function () {\n    var changes = {\n      addedRecords: [],\n      deletedRecords: [],\n      changedRecords: []\n    };\n    var rows = this.parent.getRowsObject();\n\n    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n      var row = rows_1[_i];\n\n      if (row.isDirty) {\n        switch (row.edit) {\n          case 'add':\n            changes.addedRecords.push(row.changes);\n            break;\n\n          case 'delete':\n            changes.deletedRecords.push(row.data);\n            break;\n\n          default:\n            changes.changedRecords.push(row.changes);\n        }\n      }\n    }\n\n    return changes;\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n    var rows = this.parent.getRowsObject();\n    var i = 0;\n\n    for (var len = rows.length; i < len; i++) {\n      if (rows[i].uid === uid) {\n        break;\n      }\n    }\n\n    gridActionHandler(this.parent, function (tableName, rows) {\n      rows.splice(i, 1);\n    }, getGridRowObjects(this.parent));\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addRowObject = function (row) {\n    var gObj = this.parent;\n    var isTop = gObj.editSettings.newRowPosition === 'Top';\n    gridActionHandler(this.parent, function (tableName, rows) {\n      var rowClone = row.clone();\n      rowClone.cells = splitFrozenRowObjectCells(gObj, rowClone.cells, tableName);\n      isTop ? rows.unshift(rowClone) : rows.push(rowClone);\n    }, getGridRowObjects(this.parent), true);\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n    var _this = this;\n\n    this.removeSelectedData = [];\n    var gObj = this.parent;\n    var index = gObj.selectedRowIndex;\n    var selectedRows = gObj.getSelectedRows();\n    var args = {\n      primaryKey: this.parent.getPrimaryKeyFieldNames(),\n      rowIndex: index,\n      rowData: data ? data : gObj.getSelectedRecords()[0],\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      if (data) {\n        args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid) : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n      } else {\n        args.row = data ? gObj.getRows()[index] : selectedRows[0];\n      }\n\n      if (!args.row) {\n        return;\n      }\n    } // tslint:disable-next-line:max-func-body-length\n\n\n    gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n      if (beforeBatchDeleteArgs.cancel) {\n        return;\n      }\n\n      _this.removeSelectedData = gObj.getSelectedRecords();\n      gObj.clearSelection();\n      beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ? beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n\n      if (_this.parent.isFrozenGrid()) {\n        if (data) {\n          index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n          selectedRows = [];\n          selectedRows.push(gObj.getRowByIndex(index));\n          selectedRows.push(gObj.getMovableRowByIndex(index));\n\n          if (gObj.getFrozenMode() === 'Left-Right') {\n            selectedRows.push(gObj.getFrozenRightRowByIndex(index));\n          }\n        }\n\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uid);\n\n            remove(selectedRows[i]);\n          } else {\n            var rowObj = gObj.getRowObjectFromUID(uid);\n            rowObj.isDirty = true;\n            rowObj.edit = 'delete';\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n              gObj.getMovableHeaderTbody().appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n              gObj.getFrozenHeaderTbody().appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n\n              if (gObj.getFrozenMode() === 'Left-Right') {\n                gObj.getFrozenRightHeaderTbody().appendChild(gObj.getFrozenRightRowByIndex(gObj.frozenRows - 1));\n              }\n            }\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderTable().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n          }\n\n          delete selectedRows[i];\n        }\n      } else if (!_this.parent.isFrozenGrid() && (selectedRows.length === 1 || data)) {\n        var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n        uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n\n        if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n          _this.removeRowObjectFromUID(uid);\n\n          remove(beforeBatchDeleteArgs.row);\n        } else {\n          var rowObj = gObj.getRowObjectFromUID(uid);\n          rowObj.isDirty = true;\n          rowObj.edit = 'delete';\n          classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n        }\n\n        delete beforeBatchDeleteArgs.row;\n      } else {\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uniqueid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uniqueid);\n\n            remove(selectedRows[i]);\n          } else {\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n            var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n            selectedRow.isDirty = true;\n            selectedRow.edit = 'delete';\n            delete selectedRows[i];\n          }\n        }\n      }\n\n      _this.refreshRowIdx();\n\n      if (data) {\n        gObj.editModule.deleteRowUid = undefined;\n\n        if (gObj.getSelectedRows().length) {\n          index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n        }\n      }\n\n      if (!gObj.isCheckBoxSelection) {\n        gObj.selectRow(index);\n      }\n\n      gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n      gObj.notify(events.batchDelete, {\n        rows: _this.parent.getRowsObject()\n      });\n      gObj.notify(events.toolbarRefresh, {});\n    });\n  };\n\n  BatchEdit.prototype.refreshRowIdx = function () {\n    var gObj = this.parent;\n    var rows = gObj.getAllDataRows(true);\n    var dataRows = getGridRowElements(this.parent);\n\n    var _loop_2 = function (i, j, len) {\n      if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n        gridActionHandler(this_2.parent, function (tableName, rowElements) {\n          rowElements[i].setAttribute('aria-rowindex', j.toString());\n        }, dataRows);\n        j++;\n      } else {\n        gridActionHandler(this_2.parent, function (tableName, rowElements) {\n          rowElements[i].removeAttribute('aria-rowindex');\n        }, dataRows);\n      }\n\n      out_j_1 = j;\n    };\n\n    var this_2 = this,\n        out_j_1;\n\n    for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n      _loop_2(i, j, len);\n\n      j = out_j_1;\n    }\n  };\n\n  BatchEdit.prototype.getIndexFromData = function (data) {\n    return inArray(data, this.parent.getCurrentViewRecords());\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.bulkAddRow = function (data) {\n    var _this = this;\n\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowAdding) {\n      return;\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n    var defaultData = data ? data : this.getDefaultData();\n    var args = {\n      defaultData: defaultData,\n      primaryKey: gObj.getPrimaryKeyFieldNames(),\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n      if (beforeBatchAddArgs.cancel) {\n        return;\n      }\n\n      _this.isAdded = true;\n      gObj.clearSelection();\n      var mTr;\n      var frTr;\n      var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n      var model = new RowModelGenerator(_this.parent);\n      var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n      var tr = row.render(modelData[0], gObj.getColumns());\n      var col;\n      var index;\n\n      for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n        tr.insertBefore(_this.parent.createElement('td', {\n          className: 'e-indentcell'\n        }), tr.firstChild);\n        modelData[0].cells.unshift(new Cell({\n          cellType: CellType.Indent\n        }));\n      }\n\n      var tbody = gObj.getContentTable().querySelector('tbody');\n      tr.classList.add('e-insertedrow');\n\n      if (tbody.querySelector('.e-emptyrow')) {\n        var emptyRow = tbody.querySelector('.e-emptyrow');\n        emptyRow.parentNode.removeChild(emptyRow);\n\n        _this.removeFrozenTbody();\n      }\n\n      if (gObj.isFrozenGrid()) {\n        frTr = tr.cloneNode(true);\n        mTr = _this.renderMovable(tr, frTr);\n        tr = gObj.getFrozenMode() === 'Right' ? frTr : tr;\n\n        _this.renderFrozenAddRow(tr, mTr, frTr);\n      }\n\n      if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n        tbody = gObj.getHeaderTable().querySelector('tbody');\n      } else {\n        tbody = gObj.getContentTable().querySelector('tbody');\n      }\n\n      _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n      addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n      modelData[0].isDirty = true;\n      modelData[0].changes = extend({}, {}, modelData[0].data, true);\n      modelData[0].edit = 'add';\n\n      _this.addRowObject(modelData[0]);\n\n      _this.refreshRowIdx();\n\n      _this.focus.forgetPrevious();\n\n      gObj.notify(events.batchAdd, {\n        rows: _this.parent.getRowsObject(),\n        args: {\n          isFrozen: _this.parent.isFrozenGrid()\n        }\n      });\n\n      var changes = _this.getBatchChanges();\n\n      var addedRecords = 'addedRecords';\n      var dRecords = 'deletedRecords';\n      var btmIdx = _this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n      _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(btmIdx);\n\n      if (!data) {\n        index = _this.findNextEditableCell(0, true);\n        col = gObj.getColumns()[index];\n        _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) : _this.editCell(btmIdx, col.field, true);\n      }\n\n      if (_this.parent.aggregates.length > 0 && (data || changes[addedRecords].length)) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n      }\n\n      var args1 = {\n        defaultData: beforeBatchAddArgs.defaultData,\n        row: tr,\n        columnObject: col,\n        columnIndex: index,\n        primaryKey: beforeBatchAddArgs.primaryKey,\n        cell: tr.cells[index]\n      };\n      gObj.trigger(events.batchAdd, args1);\n\n      if (gObj.isFrozenGrid()) {\n        alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n      }\n\n      if (isBlazor()) {\n        _this.parent.notify(events.toolbarRefresh, {});\n\n        _this.parent.notify('start-add', {});\n      }\n    });\n  };\n\n  BatchEdit.prototype.renderFrozenAddRow = function (tr, mTr, frTr) {\n    var gObj = this.parent;\n    var mTbody = getMovableTbody(this.parent);\n    var frTbody = getFrozenRightTbody(this.parent);\n    gObj.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n    addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n\n    if (frTbody && frTr) {\n      gObj.editSettings.newRowPosition === 'Top' ? frTbody.insertBefore(frTr, frTbody.firstChild) : frTbody.appendChild(frTr);\n      addClass(frTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n      alignFrozenEditForm(frTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n    }\n\n    if (gObj.height === 'auto') {\n      gObj.notify(events.frozenHeight, {});\n    }\n  };\n\n  BatchEdit.prototype.removeFrozenTbody = function () {\n    var gObj = this.parent;\n\n    if (gObj.isFrozenGrid()) {\n      var moveTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n      moveTbody.firstElementChild.parentNode.removeChild(moveTbody.firstElementChild);\n\n      if (gObj.getFrozenMode() === 'Left-Right') {\n        var frTbody = gObj.getContent().querySelector('.e-frozen-right-content').querySelector('tbody');\n        frTbody.firstElementChild.parentNode.removeChild(frTbody.firstElementChild);\n      }\n    }\n  };\n\n  BatchEdit.prototype.renderMovable = function (ele, rightEle) {\n    var mEle = ele.cloneNode(true);\n    var movable = this.parent.getMovableColumnsCount();\n    var left = this.parent.getFrozenLeftCount();\n    var right = this.parent.getFrozenRightColumnsCount();\n    sliceElements(ele, 0, left);\n    sliceElements(mEle, left, right ? mEle.children.length - right : mEle.children.length);\n    sliceElements(rightEle, left + movable, rightEle.children.length);\n    return mEle;\n  };\n\n  BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n    var cols = this.parent.getColumns();\n    var endIndex = cols.length;\n    var validation;\n\n    for (var i = columnIndex; i < endIndex; i++) {\n      validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n\n      if (!isAdd && this.checkNPCell(cols[i])) {\n        return i;\n      } else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing && !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.checkNPCell = function (col) {\n    return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n  };\n\n  BatchEdit.prototype.getDefaultData = function () {\n    var gObj = this.parent;\n    var data = {};\n    var dValues = {\n      'number': 0,\n      'string': null,\n      'boolean': false,\n      'date': null,\n      'datetime': null\n    };\n\n    for (var _i = 0, _a = gObj.columnModel; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.field) {\n        setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n      }\n    }\n\n    return data;\n  };\n\n  BatchEdit.prototype.setCellIdx = function (target) {\n    var gLen = 0;\n\n    if (this.parent.allowGrouping) {\n      gLen = this.parent.groupSettings.columns.length;\n    }\n\n    this.cellDetails.cellIndex = target.cellIndex - gLen;\n    this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n  };\n\n  BatchEdit.prototype.editCell = function (index, field, isAdd) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    this.index = index;\n    this.field = field;\n    this.isAdd = isAdd;\n    var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field && this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index);\n\n    if (isBlazor() && col.template && !isAdd) {\n      resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n    }\n\n    if (gObj.editSettings.allowEditing) {\n      if (!checkEdit && col.allowEditing) {\n        this.editCellExtend(index, field, isAdd);\n      } else if (checkEdit) {\n        this.editNext = true;\n        this.saveCell();\n      }\n    }\n  };\n\n  BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var keys = gObj.getPrimaryKeyFieldNames();\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    var row;\n    var mRowData;\n    var rowData = extend({}, {}, this.getDataByIndex(index), true);\n\n    if (col.getFreezeTableName() === 'movable' || col.getFreezeTableName() === 'frozen-right') {\n      row = col.getFreezeTableName() === 'movable' ? gObj.getMovableDataRows()[index] : gObj.getFrozenRightDataRows()[index];\n      mRowData = this.parent.getRowObjectFromUID(row.getAttribute('data-uid'));\n      rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : rowData;\n    } else {\n      row = gObj.getDataRows()[index];\n      rowData = extend({}, {}, this.getDataByIndex(index), true);\n    }\n\n    if (keys[0] === col.field && !row.classList.contains('e-insertedrow') || col.columns || col.isPrimaryKey && col.isIdentity) {\n      this.parent.isLastCellPrimaryKey = true;\n      return;\n    }\n\n    this.parent.isLastCellPrimaryKey = false;\n    this.parent.element.classList.add('e-editing');\n    var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n    var cells = [].slice.apply(row.cells);\n    var args = {\n      columnName: col.field,\n      isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n      primaryKey: keys,\n      rowData: rowData,\n      validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n      value: getObject(col.field, rowData),\n      type: !isAdd ? 'edit' : 'add',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n      args.row = row;\n      args.columnObject = col;\n\n      if (!args.cell) {\n        return;\n      }\n    }\n\n    gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n      if (cellEditArgs.cancel) {\n        return;\n      }\n\n      cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n      cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n      cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n      cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n      _this.cellDetails = {\n        rowData: rowData,\n        column: col,\n        value: cellEditArgs.value,\n        isForeignKey: cellEditArgs.isForeignKey,\n        rowIndex: index,\n        cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n        foreignKeyData: cellEditArgs.foreignKeyData\n      };\n\n      if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n        _this.isColored = true;\n        cellEditArgs.cell.classList.remove('e-updatedtd');\n      }\n\n      if (isBlazor() && gObj.isServerRendered) {\n        var cell = 'cells';\n        var cloneCell = 'cloneCell';\n        var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n        _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n\n        if (parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent')) {\n          cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n          cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n        } else {\n          cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n          cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n        }\n\n        _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n        removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n      }\n\n      gObj.isEdit = true;\n      gObj.clearSelection();\n\n      if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n        gObj.selectRow(_this.cellDetails.rowIndex, true);\n      }\n\n      _this.renderer.update(cellEditArgs);\n\n      _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n\n      _this.form = select('#' + gObj.element.id + 'EditForm', gObj.element);\n      gObj.editModule.applyFormValidation([col]);\n      _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    });\n  };\n\n  BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var index = gObj.getColumnIndexByField(field);\n\n    if (col && !col.isPrimaryKey) {\n      var td = getCellByColAndRowIndex(this.parent, col, rowIndex, index);\n      var rowObj = col.getFreezeTableName() === 'movable' ? this.parent.getMovableRowsObject()[rowIndex] : col.getFreezeTableName() === 'frozen-right' ? gObj.getFrozenRightRowsObject()[rowIndex] : gObj.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n      this.refreshTD(td, col, rowObj, value);\n      this.parent.trigger(events.queryCellInfo, {\n        cell: td,\n        column: col,\n        data: rowObj.changes\n      });\n    }\n  };\n\n  BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n    var currentRowObj;\n\n    if (!this.parent.isFrozenGrid()) {\n      if (!rowObj.changes) {\n        rowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        DataUtil.setValue(field, value, rowObj.changes);\n      }\n\n      if (rowObj.data[field] !== value) {\n        rowObj.isDirty = true;\n      }\n    } else {\n      var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n      var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n      currentRowObj = this.parent.getRowsObject()[rowIndex];\n\n      if (!currentRowObj.changes) {\n        currentRowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        setValue(field, value, currentRowObj.changes);\n      }\n\n      var movableRowObject = void 0;\n\n      if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') || parentsUntil(td, 'e-movablecontent'))) {\n        var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n        var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n        movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n      } else {\n        movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n      }\n\n      movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n      if (rowObj.data[field] !== value) {\n        movableRowObject.isDirty = true;\n        currentRowObj.isDirty = true;\n      }\n\n      if (this.parent.getFrozenMode() === 'Left-Right') {\n        var frRowObject = this.parent.getFrozenRightRowsObject()[rowIndex];\n        frRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n        if (rowObj.data[field] !== value) {\n          frRowObject.isDirty = true;\n        }\n      }\n    }\n  };\n\n  BatchEdit.prototype.updateRow = function (index, data) {\n    var keys = Object.keys(data);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var col = keys_1[_i];\n      this.updateCell(index, col, data[col]);\n    }\n  };\n\n  BatchEdit.prototype.getCellIdx = function (uid) {\n    var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    return cIdx;\n  };\n\n  BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n    var cell = new CellRenderer(this.parent, this.serviceLocator);\n    var rowcell;\n    value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n    this.setChanges(rowObj, column.field, value, td);\n    var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount() || this.parent.getFrozenRightColumnsCount();\n    frzCols = frzCols && this.parent.isRowDragable() ? frzCols + 1 : frzCols;\n    refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n\n    if (frzCols && column.getFreezeTableName() === 'movable' && this.parent.getColumns().length === rowObj.cells.length) {\n      rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n    } else {\n      rowcell = rowObj.cells;\n    }\n\n    var parentElement;\n    var cellIndex;\n\n    if (this.parent.isReact) {\n      parentElement = td.parentElement;\n      cellIndex = td.cellIndex;\n    }\n\n    var index = 0;\n\n    if (frzCols) {\n      index = column.getFreezeTableName() === 'movable' && this.parent.getFrozenMode() !== 'Right' ? frzCols : column.getFreezeTableName() === 'frozen-right' ? this.parent.getFrozenLeftColumnsCount() + this.parent.getMovableColumnsCount() : index;\n    }\n\n    cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - index], rowObj.changes, {\n      'index': this.getCellIdx(column.uid)\n    });\n\n    if (this.parent.isReact) {\n      this.newReactTd = parentElement.cells[cellIndex];\n      parentElement.cells[cellIndex].classList.add('e-updatedtd');\n    } else {\n      td.classList.add('e-updatedtd');\n    }\n\n    td.classList.add('e-updatedtd');\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n\n  BatchEdit.prototype.getColIndex = function (cells, index) {\n    var cIdx = 0;\n\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n      cIdx = this.parent.groupSettings.columns.length;\n    }\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    for (var m = 0; m < cells.length; m++) {\n      var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n\n      if (colIndex === index - cIdx) {\n        return m;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.editNextValCell = function () {\n    var gObj = this.parent;\n    var changes = this.getBatchChanges();\n    var addedRecords = 'addedRecords';\n    var dRecords = 'deletedRecords';\n    var btmIdx = this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n\n    if (this.isAdded && !gObj.isEdit) {\n      for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n        if (gObj.isEdit) {\n          return;\n        }\n\n        var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n        var col = gObj.getColumns()[index];\n\n        if (col) {\n          if (this.parent.editSettings.newRowPosition === 'Bottom') {\n            this.editCell(btmIdx, col.field, true);\n          } else {\n            var args = {\n              index: 0,\n              column: col\n            };\n            this.parent.notify(events.nextCellIndex, args);\n            this.editCell(args.index, col.field, true);\n          }\n\n          this.saveCell();\n        }\n      }\n\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    }\n  };\n\n  BatchEdit.prototype.escapeCellEdit = function () {\n    var args = this.generateCellArgs();\n    args.value = args.previousValue;\n    this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n  };\n\n  BatchEdit.prototype.generateCellArgs = function () {\n    var gObj = this.parent;\n    this.parent.element.classList.remove('e-editing');\n    var column = this.cellDetails.column;\n    var obj = {};\n    obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n    var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n    var cloneEditedData = extend({}, editedData);\n    editedData = extend({}, editedData, this.cellDetails.rowData);\n    var value = getObject(column.field, cloneEditedData);\n\n    if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n      setValue(column.field, value, editedData);\n    }\n\n    var args = {\n      columnName: column.field,\n      value: getObject(column.field, editedData),\n      rowData: this.cellDetails.rowData,\n      column: column,\n      previousValue: this.cellDetails.value,\n      isForeignKey: this.cellDetails.isForeignKey,\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = this.form.parentElement;\n      args.columnObject = column;\n    }\n\n    return args;\n  };\n\n  BatchEdit.prototype.saveCell = function (isForceSave) {\n    if (this.preventSaveCell) {\n      return;\n    }\n\n    var gObj = this.parent;\n\n    if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n      return;\n    }\n\n    this.preventSaveCell = true;\n    var args = this.generateCellArgs();\n    var tr = isBlazor() ? parentsUntil(this.form, 'e-row') : args.cell.parentElement;\n    var col = isBlazor() ? this.cellDetails.column : args.column;\n\n    if (isBlazor()) {\n      delete args.column;\n    }\n\n    if (!isForceSave) {\n      gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n      gObj.notify(events.batchForm, {\n        formObj: this.form\n      });\n    } else {\n      this.successCallBack(args, tr, col)(args);\n    }\n  };\n\n  BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n    var _this = this;\n\n    return function (cellSaveArgs) {\n      var gObj = _this.parent;\n      cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n      cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n      cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n\n      if (cellSaveArgs.cancel) {\n        _this.preventSaveCell = false;\n\n        if (_this.editNext) {\n          _this.editNext = false;\n\n          if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n            return;\n          }\n\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n\n        return;\n      }\n\n      gObj.editModule.destroyWidgets([column]);\n      gObj.isEdit = false;\n      gObj.editModule.destroyForm();\n\n      if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n      }\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') || parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n        _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n      } else {\n        var rowObj = parentsUntil(cellSaveArgs.cell, 'e-movablecontent') || parentsUntil(cellSaveArgs.cell, 'e-movableheader') ? gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), true) : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n\n        if (gObj.getFrozenMode() === 'Left-Right' && (parentsUntil(cellSaveArgs.cell, 'e-frozen-right-header') || parentsUntil(cellSaveArgs.cell, 'e-frozen-right-content'))) {\n          rowObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), false, true);\n        }\n\n        _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n\n        if (_this.parent.isReact) {\n          cellSaveArgs.cell = _this.newReactTd;\n        }\n      }\n\n      removeClass([tr], ['e-editedrow', 'e-batchrow']);\n      removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n\n      if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored || isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        cellSaveArgs.cell.classList.remove('e-updatedtd');\n\n        if (isBlazor() && gObj.isServerRendered && (!isNullOrUndefined(cellSaveArgs.value) ? cellSaveArgs.value : '').toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n          if (_this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.contains('e-selectionbackground')) {\n            _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.add('e-selectionbackground', 'e-active');\n          } else {\n            _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.remove('e-selectionbackground', 'e-active');\n          }\n\n          _this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].replaceWith(_this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]);\n        }\n      }\n\n      if (isNullOrUndefined(isEscapeCellEdit)) {\n        gObj.trigger(events.cellSaved, cellSaveArgs);\n      }\n\n      gObj.notify(events.toolbarRefresh, {});\n      _this.isColored = false;\n\n      if (_this.parent.aggregates.length > 0) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n\n        if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n          _this.parent.notify(events.groupAggregates, {});\n        }\n      }\n\n      _this.preventSaveCell = false;\n\n      if (_this.editNext) {\n        _this.editNext = false;\n\n        if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n          return;\n        }\n\n        var col = gObj.getColumnByField(_this.field);\n\n        if (col && col.allowEditing) {\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n      }\n\n      if (isEscapeCellEdit) {\n        gObj.notify(events.restoreFocus, {});\n      }\n    };\n  };\n\n  BatchEdit.prototype.getDataByIndex = function (index) {\n    var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n    return row.changes ? row.changes : row.data;\n  };\n\n  BatchEdit.prototype.keyDownHandler = function (e) {\n    if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n      var gObj = this.parent;\n      var changes = this.getBatchChanges();\n      var addedRecords = 'addedRecords';\n      var dRecords = 'deletedRecords';\n      var btmIdx = this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n      var rowcell = parentsUntil(e.target, 'e-rowcell');\n\n      if (rowcell) {\n        var cell = rowcell.querySelector('.e-field');\n\n        if (cell) {\n          var visibleColumns = this.parent.getVisibleColumns();\n          var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n\n          if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n            if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n              if (gObj.editSettings.newRowPosition === 'Top') {\n                gObj.editSettings.newRowPosition = 'Bottom';\n                this.addRecord();\n                gObj.editSettings.newRowPosition = 'Top';\n              } else {\n                this.addRecord();\n              }\n            } else {\n              this.saveCell();\n            }\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addCancelWhilePaging = function () {\n    if (this.validateFormObj()) {\n      this.parent.notify(events.destroyForm, {});\n      this.parent.isEdit = false;\n      this.isColored = false;\n    }\n  };\n\n  return BatchEdit;\n}();\n\nexport { BatchEdit };","map":{"version":3,"sources":["C:/Users/appsk/Documents/Projects/PredictiveMaintenance/React PDM/env/frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/batch-edit.js"],"names":["extend","addClass","removeClass","setValue","isBlazor","closest","select","remove","classList","updateBlazorTemplate","blazorTemplates","resetBlazorTemplate","isNullOrUndefined","isUndefined","CellType","parentsUntil","inArray","refreshForeignData","getObject","alignFrozenEditForm","gridActionHandler","splitFrozenRowObjectCells","getGridRowElements","sliceElements","getCellByColAndRowIndex","getMovableTbody","getFrozenRightTbody","getGridRowObjects","events","RowRenderer","CellRenderer","Row","Cell","RowModelGenerator","DataUtil","BatchEdit","parent","serviceLocator","renderer","cellDetails","originalCell","cloneCell","editNext","preventSaveCell","focus","getService","addEventListener","prototype","isDestroyed","on","click","clickHandler","dblclick","dblClickHandler","beforeCellFocused","onBeforeCellFocused","cellFocused","onCellFocused","dataBoundFunction","dataBound","bind","batchCancelFunction","batchCancel","doubleTap","keyPressed","keyDownHandler","editNextValCell","closeForm","removeEventListener","off","args","focusModule","restoreFocus","notify","toolbarRefresh","destroy","e","target","element","id","isEdit","form","saveCell","setCellIdx","tr","isNaN","parseInt","getAttribute","parentElement","contains","editCell","getColumns","field","isAddRow","validateFormObj","byClick","indexOf","keyArgs","action","cancel","clickArgs","preventDefault","frzCols","getFrozenLeftCount","frzRightCols","getFrozenRightColumnsCount","mCont","getContent","querySelector","mHdr","getHeaderContent","clear","container","isContent","isDataCell","frozenRows","isHeader","byKey","_a","indexes","rowIndex","cellIndex","frHdr","frCont","getMovableColumnsCount","querySelectorAll","length","col","isLastCellPrimaryKey","editCellFromIndex","column","index","getDataRows","rowIdx","cellIdx","closeEdit","_this","gObj","rows","getRowsObject","argument","batchChanges","getBatchChanges","beforeBatchCancel","cols","i","template","uid","isAdded","clearSelection","allRows","_loop_1","isInsert","isDirty","this_1","tableName","removeBatchElementChanges","splice","out_i_1","isServerRendered","selectRow","selectionModule","prevRowIndex","getContentTable","renderModule","renderEmptyRow","requestType","isDataRow","cells","visible","refreshRowIdx","tooltipDestroy","trigger","row","rowRenderer","isInstertedRemoved","getRowElementByUID","getForeignKeyColumns","data","changes","edit","removeHideAndSelection","refresh","aggregates","type","editType","refreshFooterRenderer","groupSettings","columns","groupAggregates","removeAttribute","tdElements","slice","call","deleteRecord","fieldname","bulkDelete","addRecord","bulkAddRow","endEdit","batchSave","Object","keys","j","replaceWith","editModule","formObj","validate","deletedRecords","isCheckBoxSelection","checkAllBox","pageSettings","totalRecordsCount","currentViewData","selectionSettings","persistSelection","removeSelectedData","original","changedRecords","filter","map","beforeBatchSave","beforeBatchSaveArgs","content","insertedRow","showSpinner","bulkSave","addedRecords","_i","rows_1","push","removeRowObjectFromUID","len","addRowObject","isTop","editSettings","newRowPosition","rowClone","clone","unshift","selectedRowIndex","selectedRows","getSelectedRows","primaryKey","getPrimaryKeyFieldNames","rowData","getSelectedRecords","isJsComponent","deleteRowUid","getRows","getCurrentViewRecords","beforeBatchDelete","beforeBatchDeleteArgs","isFrozenGrid","getRowByIndex","getMovableRowByIndex","getFrozenMode","getFrozenRightRowByIndex","rowObj","getRowObjectFromUID","getMovableDataRows","getMovableHeaderTbody","appendChild","getFrozenHeaderTbody","getFrozenRightHeaderTbody","getHeaderTable","uniqueid","selectedRow","undefined","batchDelete","getAllDataRows","dataRows","_loop_2","this_2","rowElements","setAttribute","toString","out_j_1","getIndexFromData","allowAdding","add","defaultData","getDefaultData","beforeBatchAdd","beforeBatchAddArgs","mTr","frTr","model","modelData","generateRows","render","insertBefore","createElement","className","firstChild","cellType","Indent","tbody","emptyRow","parentNode","removeChild","removeFrozenTbody","cloneNode","renderMovable","renderFrozenAddRow","forgetPrevious","batchAdd","isFrozen","dRecords","btmIdx","findNextEditableCell","args1","columnObject","columnIndex","cell","mTbody","frTbody","height","frozenHeight","moveTbody","firstElementChild","ele","rightEle","mEle","movable","left","right","children","isAdd","isValOnly","endIndex","validation","validationRules","checkNPCell","allowEditing","isIdentity","isPrimaryKey","dValues","columnModel","defaultValue","gLen","allowGrouping","getColumnByField","checkEdit","editCellExtend","mRowData","getDataByIndex","getFreezeTableName","getFrozenRightDataRows","apply","columnName","isForeignKey","foreignKeyValue","value","foreignKeyData","getColIndex","getCellIdx","cellEdit","cellEditArgs","isColored","indent","insertCell","getFrozenColumns","replaceChild","isPersistSelection","update","batchEditFormRendered","applyFormValidation","style","display","updateCell","getColumnIndexByField","td","getMovableRowsObject","getFrozenRightRowsObject","refreshTD","queryCellInfo","setChanges","currentRowObj","rowEle","movableRowObject","movRowEle","movRowIndex","frRowObject","updateRow","keys_1","cIdx","getColumnIndexByUid","detailTemplate","childGrid","isRowDragable","rowcell","parseFloat","getFrozenLeftColumnsCount","isReact","newReactTd","m","colIndex","nextCellIndex","escapeCellEdit","generateCellArgs","previousValue","successCallBack","obj","editedData","getCurrentEditedData","cloneEditedData","isForceSave","cellSave","batchForm","cellSaveArgs","isEscapeCellEdit","destroyWidgets","destroyForm","cellSaved","visibleColumns","getVisibleColumns","addCancelWhilePaging"],"mappings":"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","sourcesContent":["import { extend, addClass, removeClass, setValue, isBlazor, closest, select } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, gridActionHandler } from '../base/util';\nimport { splitFrozenRowObjectCells, getGridRowElements } from '../base/util';\nimport { sliceElements, getCellByColAndRowIndex, getMovableTbody, getFrozenRightTbody } from '../base/util';\nimport { getGridRowObjects } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\nvar BatchEdit = /** @class */ (function () {\n    function BatchEdit(parent, serviceLocator, renderer) {\n        this.cellDetails = {};\n        this.originalCell = {};\n        this.cloneCell = {};\n        this.editNext = false;\n        this.preventSaveCell = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = renderer;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n    }\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.dblclick, this.dblClickHandler, this);\n        this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n        this.parent.on(events.cellFocused, this.onCellFocused, this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.batchCancelFunction = this.batchCancel.bind(this);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n        this.parent.on(events.doubleTap, this.dblClickHandler, this);\n        this.parent.on(events.keyPressed, this.keyDownHandler, this);\n        this.parent.on(events.editNextValCell, this.editNextValCell, this);\n        this.parent.on('closebatch', this.closeForm, this);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.dblclick, this.dblClickHandler);\n        this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n        this.parent.off(events.cellFocused, this.onCellFocused);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n        this.parent.off(events.doubleTap, this.dblClickHandler);\n        this.parent.off(events.keyPressed, this.keyDownHandler);\n        this.parent.off(events.editNextValCell, this.editNextValCell);\n        this.parent.off('closebatch', this.closeForm);\n    };\n    BatchEdit.prototype.batchCancel = function (args) {\n        this.parent.focusModule.restoreFocus();\n    };\n    BatchEdit.prototype.dataBound = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    BatchEdit.prototype.clickHandler = function (e) {\n        if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n            if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td')) {\n                this.saveCell();\n                this.editNextValCell();\n            }\n            if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n                this.setCellIdx(e.target);\n            }\n        }\n    };\n    BatchEdit.prototype.dblClickHandler = function (e) {\n        var target = parentsUntil(e.target, 'e-rowcell');\n        var tr = parentsUntil(e.target, 'e-row');\n        if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10))\n            && !target.parentElement.classList.contains('e-editedrow')) {\n            this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n        }\n    };\n    BatchEdit.prototype.onBeforeCellFocused = function (e) {\n        if (this.parent.isEdit && this.validateFormObj() &&\n            (e.byClick || (['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1))) {\n            e.cancel = true;\n            if (e.byClick) {\n                e.clickArgs.preventDefault();\n            }\n            else {\n                e.keyArgs.preventDefault();\n            }\n        }\n    };\n    BatchEdit.prototype.onCellFocused = function (e) {\n        var frzCols = this.parent.getFrozenLeftCount();\n        var frzRightCols = this.parent.getFrozenRightColumnsCount();\n        var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n        var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n        var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n        if (!e.byKey || clear) {\n            if (this.parent.isEdit && clear) {\n                this.saveCell();\n            }\n            return;\n        }\n        var _a = e.container.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        if (frzCols && (mCont.contains(e.element) || (this.parent.frozenRows && mHdr.contains(e.element)))) {\n            cellIndex += frzCols;\n        }\n        if (frzRightCols) {\n            var frHdr = this.parent.getHeaderContent().querySelector('.e-frozen-right-header');\n            var frCont = this.parent.getContent().querySelector('.e-frozen-right-content');\n            if (frCont.contains(e.element) || (this.parent.frozenRows && frHdr.contains(e.element))) {\n                cellIndex += (frzCols + this.parent.getMovableColumnsCount());\n            }\n        }\n        if (this.parent.frozenRows && e.container.isContent) {\n            rowIndex += this.parent.frozenRows;\n        }\n        var isEdit = this.parent.isEdit;\n        if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n            isEdit = isEdit && !this.validateFormObj();\n            switch (e.keyArgs.action) {\n                case 'tab':\n                case 'shiftTab':\n                    var col = this.parent.getColumns()[e.indexes[1]];\n                    if (col && !this.parent.isEdit) {\n                        this.editCell(e.indexes[0], col.field);\n                    }\n                    if (isEdit || this.parent.isLastCellPrimaryKey) {\n                        this.editCellFromIndex(rowIndex, cellIndex);\n                    }\n                    break;\n                case 'enter':\n                case 'shiftEnter':\n                    e.keyArgs.preventDefault();\n                    if (isEdit) {\n                        this.editCell(rowIndex, this.cellDetails.column.field);\n                    }\n                    break;\n                case 'f2':\n                    this.editCellFromIndex(rowIndex, cellIndex);\n                    this.focus.focus();\n                    break;\n            }\n        }\n    };\n    BatchEdit.prototype.isAddRow = function (index) {\n        return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n    };\n    BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n        this.cellDetails.rowIndex = rowIdx;\n        this.cellDetails.cellIndex = cellIdx;\n        this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.closeEdit = function () {\n        var _this = this;\n        var gObj = this.parent;\n        var rows = this.parent.getRowsObject();\n        var argument = { cancel: false, batchChanges: this.getBatchChanges() };\n        gObj.notify(events.beforeBatchCancel, argument);\n        if (argument.cancel) {\n            return;\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n                }\n            }\n        }\n        if (gObj.isEdit) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        gObj.clearSelection();\n        var allRows = getGridRowObjects(this.parent);\n        var _loop_1 = function (i) {\n            var isInsert = false;\n            var isDirty = rows[i].isDirty;\n            gridActionHandler(this_1.parent, function (tableName, rows) {\n                isInsert = _this.removeBatchElementChanges(rows[i], isDirty);\n                if (isInsert) {\n                    rows.splice(i, 1);\n                }\n            }, allRows);\n            if (isInsert) {\n                i--;\n            }\n            out_i_1 = i;\n        };\n        var this_1 = this, out_i_1;\n        for (var i = 0; i < rows.length; i++) {\n            _loop_1(i);\n            i = out_i_1;\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            gObj.selectRow(gObj.selectionModule.prevRowIndex);\n        }\n        if (!gObj.getContentTable().querySelector('tr.e-row')) {\n            gObj.renderModule.renderEmptyRow();\n        }\n        var args = {\n            requestType: 'batchCancel', rows: this.parent.getRowsObject()\n        };\n        gObj.notify(events.batchCancel, {\n            rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() :\n                [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })]\n        });\n        gObj.selectRow(this.cellDetails.rowIndex);\n        this.refreshRowIdx();\n        gObj.notify(events.toolbarRefresh, {});\n        this.parent.notify(events.tooltipDestroy, {});\n        args = { requestType: 'batchCancel', rows: this.parent.getRowsObject() };\n        gObj.trigger(events.batchCancel, args);\n    };\n    BatchEdit.prototype.removeBatchElementChanges = function (row, isDirty) {\n        var gObj = this.parent;\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var isInstertedRemoved = false;\n        if (isDirty) {\n            row.isDirty = isDirty;\n            var tr = gObj.getRowElementByUID(row.uid);\n            if (tr) {\n                if (tr.classList.contains('e-insertedrow')) {\n                    remove(tr);\n                    isInstertedRemoved = true;\n                }\n                else {\n                    refreshForeignData(row, this.parent.getForeignKeyColumns(), row.data);\n                    delete row.changes;\n                    delete row.edit;\n                    row.isDirty = false;\n                    if (isBlazor() && gObj.isServerRendered) {\n                        this.removeHideAndSelection(tr);\n                        this.closeForm();\n                    }\n                    else {\n                        classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n                        rowRenderer.refresh(row, gObj.getColumns(), false);\n                    }\n                }\n                if (this.parent.aggregates.length > 0) {\n                    var type = 'type';\n                    var editType = [];\n                    editType[type] = 'cancel';\n                    this.parent.notify(events.refreshFooterRenderer, editType);\n                    if (this.parent.groupSettings.columns.length > 0) {\n                        this.parent.notify(events.groupAggregates, editType);\n                    }\n                }\n            }\n        }\n        return isInstertedRemoved;\n    };\n    BatchEdit.prototype.removeHideAndSelection = function (tr) {\n        if (tr.classList.contains('e-hiddenrow')) {\n            tr.removeAttribute('aria-selected');\n            var tdElements = [].slice.call(tr.querySelectorAll('.e-selectionbackground'));\n            for (var i = 0; i < tdElements.length; i++) {\n                removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n            }\n        }\n        classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n    };\n    BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.saveCell();\n        if (this.validateFormObj()) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        this.bulkDelete(fieldname, data);\n        if (this.parent.aggregates.length > 0) {\n            this.parent.notify(events.refreshFooterRenderer, {});\n            if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, {});\n            }\n        }\n    };\n    BatchEdit.prototype.addRecord = function (data) {\n        this.bulkAddRow(data);\n    };\n    BatchEdit.prototype.endEdit = function (data) {\n        if (this.parent.isEdit && this.validateFormObj()) {\n            return;\n        }\n        this.batchSave();\n    };\n    BatchEdit.prototype.closeForm = function () {\n        for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n            for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n                if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n                    this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n                    if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n                        this.originalCell[Object.keys(this.originalCell)[i]]\n                            .classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n                    }\n                }\n            }\n        }\n        this.cloneCell = {};\n        this.originalCell = {};\n    };\n    BatchEdit.prototype.validateFormObj = function () {\n        return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n    };\n    BatchEdit.prototype.batchSave = function () {\n        var _this = this;\n        var gObj = this.parent;\n        var deletedRecords = 'deletedRecords';\n        if (gObj.isCheckBoxSelection) {\n            var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n            if (checkAllBox.classList.contains('e-checkbox-disabled') &&\n                gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n                removeClass([checkAllBox], ['e-checkbox-disabled']);\n            }\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    blazorTemplates[this.parent.element.id + col.uid] = [];\n                    resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n                }\n            }\n        }\n        this.saveCell();\n        if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n            return;\n        }\n        var changes = this.getBatchChanges();\n        if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length &&\n            this.parent.selectionSettings.persistSelection) {\n            changes[deletedRecords] = this.removeSelectedData;\n            this.removeSelectedData = [];\n        }\n        var original = {\n            changedRecords: this.parent.getRowsObject()\n                .filter(function (row) { return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1; })\n                .map(function (row) { return row.data; })\n        };\n        var args = { batchChanges: changes, cancel: false };\n        gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n            if (beforeBatchSaveArgs.cancel) {\n                return;\n            }\n            if (isBlazor() && _this.parent.isServerRendered) {\n                var content = _this.parent.getContent();\n                _this.closeForm();\n                removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n                if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n                    removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n                    var insertedRow = [].slice.call(content.querySelectorAll('.e-insertedrow'));\n                    for (var i = 0; i < insertedRow.length; i++) {\n                        insertedRow[i].remove();\n                    }\n                }\n                _this.refreshRowIdx();\n            }\n            gObj.showSpinner();\n            gObj.notify(events.bulkSave, { changes: changes, original: original });\n        });\n    };\n    BatchEdit.prototype.getBatchChanges = function () {\n        var changes = {\n            addedRecords: [],\n            deletedRecords: [],\n            changedRecords: []\n        };\n        var rows = this.parent.getRowsObject();\n        for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n            var row = rows_1[_i];\n            if (row.isDirty) {\n                switch (row.edit) {\n                    case 'add':\n                        changes.addedRecords.push(row.changes);\n                        break;\n                    case 'delete':\n                        changes.deletedRecords.push(row.data);\n                        break;\n                    default:\n                        changes.changedRecords.push(row.changes);\n                }\n            }\n        }\n        return changes;\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n        var rows = this.parent.getRowsObject();\n        var i = 0;\n        for (var len = rows.length; i < len; i++) {\n            if (rows[i].uid === uid) {\n                break;\n            }\n        }\n        gridActionHandler(this.parent, function (tableName, rows) {\n            rows.splice(i, 1);\n        }, getGridRowObjects(this.parent));\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addRowObject = function (row) {\n        var gObj = this.parent;\n        var isTop = gObj.editSettings.newRowPosition === 'Top';\n        gridActionHandler(this.parent, function (tableName, rows) {\n            var rowClone = row.clone();\n            rowClone.cells = splitFrozenRowObjectCells(gObj, rowClone.cells, tableName);\n            isTop ? rows.unshift(rowClone) : rows.push(rowClone);\n        }, getGridRowObjects(this.parent), true);\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n        var _this = this;\n        this.removeSelectedData = [];\n        var gObj = this.parent;\n        var index = gObj.selectedRowIndex;\n        var selectedRows = gObj.getSelectedRows();\n        var args = {\n            primaryKey: this.parent.getPrimaryKeyFieldNames(),\n            rowIndex: index,\n            rowData: data ? data : gObj.getSelectedRecords()[0],\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            if (data) {\n                args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid)\n                    : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n            }\n            else {\n                args.row = data ? gObj.getRows()[index] : selectedRows[0];\n            }\n            if (!args.row) {\n                return;\n            }\n        }\n        // tslint:disable-next-line:max-func-body-length\n        gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n            if (beforeBatchDeleteArgs.cancel) {\n                return;\n            }\n            _this.removeSelectedData = gObj.getSelectedRecords();\n            gObj.clearSelection();\n            beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ?\n                beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n            if (_this.parent.isFrozenGrid()) {\n                if (data) {\n                    index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n                    selectedRows = [];\n                    selectedRows.push(gObj.getRowByIndex(index));\n                    selectedRows.push(gObj.getMovableRowByIndex(index));\n                    if (gObj.getFrozenMode() === 'Left-Right') {\n                        selectedRows.push(gObj.getFrozenRightRowByIndex(index));\n                    }\n                }\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        var rowObj = gObj.getRowObjectFromUID(uid);\n                        rowObj.isDirty = true;\n                        rowObj.edit = 'delete';\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n                            gObj.getMovableHeaderTbody().appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n                            gObj.getFrozenHeaderTbody().appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                            if (gObj.getFrozenMode() === 'Left-Right') {\n                                gObj.getFrozenRightHeaderTbody().appendChild(gObj.getFrozenRightRowByIndex(gObj.frozenRows - 1));\n                            }\n                        }\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderTable().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                    }\n                    delete selectedRows[i];\n                }\n            }\n            else if (!_this.parent.isFrozenGrid() && (selectedRows.length === 1 || data)) {\n                var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n                uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n                if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n                    _this.removeRowObjectFromUID(uid);\n                    remove(beforeBatchDeleteArgs.row);\n                }\n                else {\n                    var rowObj = gObj.getRowObjectFromUID(uid);\n                    rowObj.isDirty = true;\n                    rowObj.edit = 'delete';\n                    classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            else {\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uniqueid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uniqueid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n                        selectedRow.isDirty = true;\n                        selectedRow.edit = 'delete';\n                        delete selectedRows[i];\n                    }\n                }\n            }\n            _this.refreshRowIdx();\n            if (data) {\n                gObj.editModule.deleteRowUid = undefined;\n                if (gObj.getSelectedRows().length) {\n                    index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n                }\n            }\n            if (!gObj.isCheckBoxSelection) {\n                gObj.selectRow(index);\n            }\n            gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n            gObj.notify(events.batchDelete, { rows: _this.parent.getRowsObject() });\n            gObj.notify(events.toolbarRefresh, {});\n        });\n    };\n    BatchEdit.prototype.refreshRowIdx = function () {\n        var gObj = this.parent;\n        var rows = gObj.getAllDataRows(true);\n        var dataRows = getGridRowElements(this.parent);\n        var _loop_2 = function (i, j, len) {\n            if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n                gridActionHandler(this_2.parent, function (tableName, rowElements) {\n                    rowElements[i].setAttribute('aria-rowindex', j.toString());\n                }, dataRows);\n                j++;\n            }\n            else {\n                gridActionHandler(this_2.parent, function (tableName, rowElements) {\n                    rowElements[i].removeAttribute('aria-rowindex');\n                }, dataRows);\n            }\n            out_j_1 = j;\n        };\n        var this_2 = this, out_j_1;\n        for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n            _loop_2(i, j, len);\n            j = out_j_1;\n        }\n    };\n    BatchEdit.prototype.getIndexFromData = function (data) {\n        return inArray(data, this.parent.getCurrentViewRecords());\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkAddRow = function (data) {\n        var _this = this;\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowAdding) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        var defaultData = data ? data : this.getDefaultData();\n        var args = {\n            defaultData: defaultData,\n            primaryKey: gObj.getPrimaryKeyFieldNames(),\n            cancel: false\n        };\n        gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n            if (beforeBatchAddArgs.cancel) {\n                return;\n            }\n            _this.isAdded = true;\n            gObj.clearSelection();\n            var mTr;\n            var frTr;\n            var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n            var model = new RowModelGenerator(_this.parent);\n            var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n            var tr = row.render(modelData[0], gObj.getColumns());\n            var col;\n            var index;\n            for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n                tr.insertBefore(_this.parent.createElement('td', { className: 'e-indentcell' }), tr.firstChild);\n                modelData[0].cells.unshift(new Cell({ cellType: CellType.Indent }));\n            }\n            var tbody = gObj.getContentTable().querySelector('tbody');\n            tr.classList.add('e-insertedrow');\n            if (tbody.querySelector('.e-emptyrow')) {\n                var emptyRow = tbody.querySelector('.e-emptyrow');\n                emptyRow.parentNode.removeChild(emptyRow);\n                _this.removeFrozenTbody();\n            }\n            if (gObj.isFrozenGrid()) {\n                frTr = tr.cloneNode(true);\n                mTr = _this.renderMovable(tr, frTr);\n                tr = gObj.getFrozenMode() === 'Right' ? frTr : tr;\n                _this.renderFrozenAddRow(tr, mTr, frTr);\n            }\n            if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                tbody = gObj.getHeaderTable().querySelector('tbody');\n            }\n            else {\n                tbody = gObj.getContentTable().querySelector('tbody');\n            }\n            _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n            addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n            modelData[0].isDirty = true;\n            modelData[0].changes = extend({}, {}, modelData[0].data, true);\n            modelData[0].edit = 'add';\n            _this.addRowObject(modelData[0]);\n            _this.refreshRowIdx();\n            _this.focus.forgetPrevious();\n            gObj.notify(events.batchAdd, { rows: _this.parent.getRowsObject(), args: { isFrozen: _this.parent.isFrozenGrid() } });\n            var changes = _this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            var dRecords = 'deletedRecords';\n            var btmIdx = _this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n            _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(btmIdx);\n            if (!data) {\n                index = _this.findNextEditableCell(0, true);\n                col = gObj.getColumns()[index];\n                _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) :\n                    _this.editCell(btmIdx, col.field, true);\n            }\n            if (_this.parent.aggregates.length > 0 && (data || changes[addedRecords].length)) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            var args1 = {\n                defaultData: beforeBatchAddArgs.defaultData, row: tr,\n                columnObject: col, columnIndex: index, primaryKey: beforeBatchAddArgs.primaryKey, cell: tr.cells[index]\n            };\n            gObj.trigger(events.batchAdd, args1);\n            if (gObj.isFrozenGrid()) {\n                alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n            }\n            if (isBlazor()) {\n                _this.parent.notify(events.toolbarRefresh, {});\n                _this.parent.notify('start-add', {});\n            }\n        });\n    };\n    BatchEdit.prototype.renderFrozenAddRow = function (tr, mTr, frTr) {\n        var gObj = this.parent;\n        var mTbody = getMovableTbody(this.parent);\n        var frTbody = getFrozenRightTbody(this.parent);\n        gObj.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n        addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n        if (frTbody && frTr) {\n            gObj.editSettings.newRowPosition === 'Top' ? frTbody.insertBefore(frTr, frTbody.firstChild)\n                : frTbody.appendChild(frTr);\n            addClass(frTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n            alignFrozenEditForm(frTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n        }\n        if (gObj.height === 'auto') {\n            gObj.notify(events.frozenHeight, {});\n        }\n    };\n    BatchEdit.prototype.removeFrozenTbody = function () {\n        var gObj = this.parent;\n        if (gObj.isFrozenGrid()) {\n            var moveTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n            (moveTbody.firstElementChild).parentNode.removeChild(moveTbody.firstElementChild);\n            if (gObj.getFrozenMode() === 'Left-Right') {\n                var frTbody = gObj.getContent().querySelector('.e-frozen-right-content').querySelector('tbody');\n                (frTbody.firstElementChild).parentNode.removeChild(frTbody.firstElementChild);\n            }\n        }\n    };\n    BatchEdit.prototype.renderMovable = function (ele, rightEle) {\n        var mEle = ele.cloneNode(true);\n        var movable = this.parent.getMovableColumnsCount();\n        var left = this.parent.getFrozenLeftCount();\n        var right = this.parent.getFrozenRightColumnsCount();\n        sliceElements(ele, 0, left);\n        sliceElements(mEle, left, right ? mEle.children.length - right : mEle.children.length);\n        sliceElements(rightEle, left + movable, rightEle.children.length);\n        return mEle;\n    };\n    BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n        var cols = this.parent.getColumns();\n        var endIndex = cols.length;\n        var validation;\n        for (var i = columnIndex; i < endIndex; i++) {\n            validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n            if (!isAdd && this.checkNPCell(cols[i])) {\n                return i;\n            }\n            else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing &&\n                !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.checkNPCell = function (col) {\n        return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n    };\n    BatchEdit.prototype.getDefaultData = function () {\n        var gObj = this.parent;\n        var data = {};\n        var dValues = { 'number': 0, 'string': null, 'boolean': false, 'date': null, 'datetime': null };\n        for (var _i = 0, _a = (gObj.columnModel); _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.field) {\n                setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n            }\n        }\n        return data;\n    };\n    BatchEdit.prototype.setCellIdx = function (target) {\n        var gLen = 0;\n        if (this.parent.allowGrouping) {\n            gLen = this.parent.groupSettings.columns.length;\n        }\n        this.cellDetails.cellIndex = target.cellIndex - gLen;\n        this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n    };\n    BatchEdit.prototype.editCell = function (index, field, isAdd) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        this.index = index;\n        this.field = field;\n        this.isAdd = isAdd;\n        var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field\n            && (this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index));\n        if (isBlazor() && col.template && !isAdd) {\n            resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n        }\n        if (gObj.editSettings.allowEditing) {\n            if (!checkEdit && col.allowEditing) {\n                this.editCellExtend(index, field, isAdd);\n            }\n            else if (checkEdit) {\n                this.editNext = true;\n                this.saveCell();\n            }\n        }\n    };\n    BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n        var _this = this;\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var keys = gObj.getPrimaryKeyFieldNames();\n        if (gObj.isEdit) {\n            return;\n        }\n        var row;\n        var mRowData;\n        var rowData = extend({}, {}, this.getDataByIndex(index), true);\n        if (col.getFreezeTableName() === 'movable' || col.getFreezeTableName() === 'frozen-right') {\n            row = col.getFreezeTableName() === 'movable' ? gObj.getMovableDataRows()[index] : gObj.getFrozenRightDataRows()[index];\n            mRowData = this.parent.getRowObjectFromUID(row.getAttribute('data-uid'));\n            rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : rowData;\n        }\n        else {\n            row = gObj.getDataRows()[index];\n            rowData = extend({}, {}, this.getDataByIndex(index), true);\n        }\n        if ((keys[0] === col.field && !row.classList.contains('e-insertedrow')) || col.columns ||\n            (col.isPrimaryKey && col.isIdentity)) {\n            this.parent.isLastCellPrimaryKey = true;\n            return;\n        }\n        this.parent.isLastCellPrimaryKey = false;\n        this.parent.element.classList.add('e-editing');\n        var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n        var cells = [].slice.apply(row.cells);\n        var args = {\n            columnName: col.field, isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n            primaryKey: keys, rowData: rowData,\n            validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n            value: getObject(col.field, rowData),\n            type: !isAdd ? 'edit' : 'add', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n            args.row = row;\n            args.columnObject = col;\n            if (!args.cell) {\n                return;\n            }\n        }\n        gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n            if (cellEditArgs.cancel) {\n                return;\n            }\n            cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n            cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n            cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n            cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n            _this.cellDetails = {\n                rowData: rowData, column: col, value: cellEditArgs.value, isForeignKey: cellEditArgs.isForeignKey, rowIndex: index,\n                cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n                foreignKeyData: cellEditArgs.foreignKeyData\n            };\n            if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n                _this.isColored = true;\n                cellEditArgs.cell.classList.remove('e-updatedtd');\n            }\n            if (isBlazor() && gObj.isServerRendered) {\n                var cell = 'cells';\n                var cloneCell = 'cloneCell';\n                var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n                _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                    cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n                if ((parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent'))) {\n                    cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n                    cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n                }\n                else {\n                    cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n                    cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n                }\n                _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                    cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n                removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n            }\n            gObj.isEdit = true;\n            gObj.clearSelection();\n            if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n                gObj.selectRow(_this.cellDetails.rowIndex, true);\n            }\n            _this.renderer.update(cellEditArgs);\n            _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n            _this.form = select('#' + gObj.element.id + 'EditForm', gObj.element);\n            gObj.editModule.applyFormValidation([col]);\n            _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        });\n    };\n    BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var index = gObj.getColumnIndexByField(field);\n        if (col && !col.isPrimaryKey) {\n            var td = getCellByColAndRowIndex(this.parent, col, rowIndex, index);\n            var rowObj = col.getFreezeTableName() === 'movable' ? this.parent.getMovableRowsObject()[rowIndex] :\n                col.getFreezeTableName() === 'frozen-right' ? gObj.getFrozenRightRowsObject()[rowIndex]\n                    : gObj.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n            this.refreshTD(td, col, rowObj, value);\n            this.parent.trigger(events.queryCellInfo, {\n                cell: td, column: col, data: rowObj.changes\n            });\n        }\n    };\n    BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n        var currentRowObj;\n        if (!this.parent.isFrozenGrid()) {\n            if (!rowObj.changes) {\n                rowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                DataUtil.setValue(field, value, rowObj.changes);\n            }\n            if (rowObj.data[field] !== value) {\n                rowObj.isDirty = true;\n            }\n        }\n        else {\n            var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n            var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n            currentRowObj = this.parent.getRowsObject()[rowIndex];\n            if (!currentRowObj.changes) {\n                currentRowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                setValue(field, value, currentRowObj.changes);\n            }\n            var movableRowObject = void 0;\n            if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') ||\n                parentsUntil(td, 'e-movablecontent'))) {\n                var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n                var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n                movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n            }\n            else {\n                movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n            }\n            movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n            if (rowObj.data[field] !== value) {\n                movableRowObject.isDirty = true;\n                currentRowObj.isDirty = true;\n            }\n            if (this.parent.getFrozenMode() === 'Left-Right') {\n                var frRowObject = this.parent.getFrozenRightRowsObject()[rowIndex];\n                frRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n                if (rowObj.data[field] !== value) {\n                    frRowObject.isDirty = true;\n                }\n            }\n        }\n    };\n    BatchEdit.prototype.updateRow = function (index, data) {\n        var keys = Object.keys(data);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var col = keys_1[_i];\n            this.updateCell(index, col, data[col]);\n        }\n    };\n    BatchEdit.prototype.getCellIdx = function (uid) {\n        var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        return cIdx;\n    };\n    BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n        var cell = new CellRenderer(this.parent, this.serviceLocator);\n        var rowcell;\n        value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n        this.setChanges(rowObj, column.field, value, td);\n        var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount()\n            || this.parent.getFrozenRightColumnsCount();\n        frzCols = frzCols && this.parent.isRowDragable() ? frzCols + 1 : frzCols;\n        refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n        if (frzCols && column.getFreezeTableName() === 'movable' && this.parent.getColumns().length === rowObj.cells.length) {\n            rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n        }\n        else {\n            rowcell = rowObj.cells;\n        }\n        var parentElement;\n        var cellIndex;\n        if (this.parent.isReact) {\n            parentElement = td.parentElement;\n            cellIndex = td.cellIndex;\n        }\n        var index = 0;\n        if (frzCols) {\n            index = column.getFreezeTableName() === 'movable' && this.parent.getFrozenMode() !== 'Right'\n                ? frzCols : column.getFreezeTableName() === 'frozen-right'\n                ? this.parent.getFrozenLeftColumnsCount() + this.parent.getMovableColumnsCount() : index;\n        }\n        cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - index], rowObj.changes, { 'index': this.getCellIdx(column.uid) });\n        if (this.parent.isReact) {\n            this.newReactTd = parentElement.cells[cellIndex];\n            parentElement.cells[cellIndex].classList.add('e-updatedtd');\n        }\n        else {\n            td.classList.add('e-updatedtd');\n        }\n        td.classList.add('e-updatedtd');\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    BatchEdit.prototype.getColIndex = function (cells, index) {\n        var cIdx = 0;\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n            cIdx = this.parent.groupSettings.columns.length;\n        }\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        for (var m = 0; m < cells.length; m++) {\n            var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n            if (colIndex === index - cIdx) {\n                return m;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.editNextValCell = function () {\n        var gObj = this.parent;\n        var changes = this.getBatchChanges();\n        var addedRecords = 'addedRecords';\n        var dRecords = 'deletedRecords';\n        var btmIdx = (this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length) - 1;\n        if (this.isAdded && !gObj.isEdit) {\n            for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n                if (gObj.isEdit) {\n                    return;\n                }\n                var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n                var col = gObj.getColumns()[index];\n                if (col) {\n                    if (this.parent.editSettings.newRowPosition === 'Bottom') {\n                        this.editCell(btmIdx, col.field, true);\n                    }\n                    else {\n                        var args = { index: 0, column: col };\n                        this.parent.notify(events.nextCellIndex, args);\n                        this.editCell(args.index, col.field, true);\n                    }\n                    this.saveCell();\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n    };\n    BatchEdit.prototype.escapeCellEdit = function () {\n        var args = this.generateCellArgs();\n        args.value = args.previousValue;\n        this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n    };\n    BatchEdit.prototype.generateCellArgs = function () {\n        var gObj = this.parent;\n        this.parent.element.classList.remove('e-editing');\n        var column = this.cellDetails.column;\n        var obj = {};\n        obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n        var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n        var cloneEditedData = extend({}, editedData);\n        editedData = extend({}, editedData, this.cellDetails.rowData);\n        var value = getObject(column.field, cloneEditedData);\n        if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n            setValue(column.field, value, editedData);\n        }\n        var args = {\n            columnName: column.field,\n            value: getObject(column.field, editedData),\n            rowData: this.cellDetails.rowData,\n            column: column,\n            previousValue: this.cellDetails.value,\n            isForeignKey: this.cellDetails.isForeignKey,\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = this.form.parentElement;\n            args.columnObject = column;\n        }\n        return args;\n    };\n    BatchEdit.prototype.saveCell = function (isForceSave) {\n        if (this.preventSaveCell) {\n            return;\n        }\n        var gObj = this.parent;\n        if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n            return;\n        }\n        this.preventSaveCell = true;\n        var args = this.generateCellArgs();\n        var tr = isBlazor() ? parentsUntil(this.form, 'e-row') : args.cell.parentElement;\n        var col = isBlazor() ? this.cellDetails.column : args.column;\n        if (isBlazor()) {\n            delete args.column;\n        }\n        if (!isForceSave) {\n            gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n            gObj.notify(events.batchForm, { formObj: this.form });\n        }\n        else {\n            this.successCallBack(args, tr, col)(args);\n        }\n    };\n    BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n        var _this = this;\n        return function (cellSaveArgs) {\n            var gObj = _this.parent;\n            cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n            cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n            cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n            if (cellSaveArgs.cancel) {\n                _this.preventSaveCell = false;\n                if (_this.editNext) {\n                    _this.editNext = false;\n                    if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                        return;\n                    }\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n                return;\n            }\n            gObj.editModule.destroyWidgets([column]);\n            gObj.isEdit = false;\n            gObj.editModule.destroyForm();\n            if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n                updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n            }\n            _this.parent.notify(events.tooltipDestroy, {});\n            if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') ||\n                parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n                _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n            }\n            else {\n                var rowObj = parentsUntil(cellSaveArgs.cell, 'e-movablecontent')\n                    || parentsUntil(cellSaveArgs.cell, 'e-movableheader') ? gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), true)\n                    : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n                if (gObj.getFrozenMode() === 'Left-Right' && (parentsUntil(cellSaveArgs.cell, 'e-frozen-right-header')\n                    || parentsUntil(cellSaveArgs.cell, 'e-frozen-right-content'))) {\n                    rowObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), false, true);\n                }\n                _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n                if (_this.parent.isReact) {\n                    cellSaveArgs.cell = _this.newReactTd;\n                }\n            }\n            removeClass([tr], ['e-editedrow', 'e-batchrow']);\n            removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n            if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() ===\n                (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored\n                || (isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) &&\n                    !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow'))) {\n                cellSaveArgs.cell.classList.remove('e-updatedtd');\n                if (isBlazor() && gObj.isServerRendered && (!isNullOrUndefined(cellSaveArgs.value) ? cellSaveArgs.value : '').toString() ===\n                    (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n                    if (_this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                        classList.contains('e-selectionbackground')) {\n                        _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                            classList.add('e-selectionbackground', 'e-active');\n                    }\n                    else {\n                        _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                            classList.remove('e-selectionbackground', 'e-active');\n                    }\n                    _this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]\n                        .replaceWith(_this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs\n                        .columnObject.index]);\n                }\n            }\n            if (isNullOrUndefined(isEscapeCellEdit)) {\n                gObj.trigger(events.cellSaved, cellSaveArgs);\n            }\n            gObj.notify(events.toolbarRefresh, {});\n            _this.isColored = false;\n            if (_this.parent.aggregates.length > 0) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n                if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n                    _this.parent.notify(events.groupAggregates, {});\n                }\n            }\n            _this.preventSaveCell = false;\n            if (_this.editNext) {\n                _this.editNext = false;\n                if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                    return;\n                }\n                var col = gObj.getColumnByField(_this.field);\n                if (col && col.allowEditing) {\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n            }\n            if (isEscapeCellEdit) {\n                gObj.notify(events.restoreFocus, {});\n            }\n        };\n    };\n    BatchEdit.prototype.getDataByIndex = function (index) {\n        var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n        return row.changes ? row.changes : row.data;\n    };\n    BatchEdit.prototype.keyDownHandler = function (e) {\n        if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n            var gObj = this.parent;\n            var changes = this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            var dRecords = 'deletedRecords';\n            var btmIdx = (this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length) - 1;\n            var rowcell = parentsUntil(e.target, 'e-rowcell');\n            if (rowcell) {\n                var cell = rowcell.querySelector('.e-field');\n                if (cell) {\n                    var visibleColumns = this.parent.getVisibleColumns();\n                    var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n                    if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n                        if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n                            if (gObj.editSettings.newRowPosition === 'Top') {\n                                gObj.editSettings.newRowPosition = 'Bottom';\n                                this.addRecord();\n                                gObj.editSettings.newRowPosition = 'Top';\n                            }\n                            else {\n                                this.addRecord();\n                            }\n                        }\n                        else {\n                            this.saveCell();\n                        }\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addCancelWhilePaging = function () {\n        if (this.validateFormObj()) {\n            this.parent.notify(events.destroyForm, {});\n            this.parent.isEdit = false;\n            this.isColored = false;\n        }\n    };\n    return BatchEdit;\n}());\nexport { BatchEdit };\n"]},"metadata":{},"sourceType":"module"}