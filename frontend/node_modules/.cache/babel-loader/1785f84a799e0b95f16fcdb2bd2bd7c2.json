{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { isNullOrUndefined, remove } from '@syncfusion/ej2-base';\nimport { formatUnit } from '@syncfusion/ej2-base';\nimport { Browser } from '@syncfusion/ej2-base';\nimport { colGroupRefresh, columnWidthChanged, scroll, columnVisibilityChanged, refreshFooterRenderer } from '../base/constant';\nimport { ContentRender } from './content-renderer';\nimport { RowRenderer } from './row-renderer';\nimport { SummaryModelGenerator } from '../services/summary-model-generator';\nimport { renderMovable, calculateAggregate, iterateExtend } from '../base/util';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * Footer module is used to render grid content\n * @hidden\n */\n\nvar FooterRenderer =\n/** @class */\nfunction (_super) {\n  __extends(FooterRenderer, _super);\n\n  function FooterRenderer(gridModule, serviceLocator) {\n    var _this = _super.call(this, gridModule, serviceLocator) || this;\n\n    _this.aggregates = {};\n    _this.parent = gridModule;\n    _this.locator = serviceLocator;\n    _this.modelGenerator = new SummaryModelGenerator(_this.parent);\n\n    _this.addEventListener();\n\n    return _this;\n  }\n  /**\n   * The function is used to render grid footer div\n   */\n\n\n  FooterRenderer.prototype.renderPanel = function () {\n    var div = this.parent.createElement('div', {\n      className: 'e-gridfooter'\n    });\n    var innerDiv = this.parent.createElement('div', {\n      className: 'e-summarycontent'\n    });\n    var movableContent = innerDiv;\n\n    if (this.parent.isFrozenGrid()) {\n      var fDiv = this.parent.createElement('div', {\n        className: 'e-frozenfootercontent e-frozen-left-footercontent'\n      });\n      var mDiv = this.parent.createElement('div', {\n        className: 'e-movablefootercontent'\n      });\n      var frDiv = this.parent.createElement('div', {\n        className: 'e-frozenfootercontent e-frozen-right-footercontent'\n      });\n\n      if (this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount()) {\n        innerDiv.appendChild(fDiv);\n        this.frozenContent = fDiv;\n      }\n\n      innerDiv.appendChild(mDiv);\n      this.movableContent = mDiv;\n      movableContent = mDiv;\n\n      if (this.parent.getFrozenRightColumnsCount()) {\n        innerDiv.appendChild(frDiv);\n        this.frozenRightContent = frDiv;\n      }\n    }\n\n    if (Browser.isDevice) {\n      movableContent.style.overflowX = 'scroll';\n    }\n\n    div.appendChild(innerDiv);\n    this.setPanel(div);\n\n    if (this.parent.getPager() != null) {\n      this.parent.element.insertBefore(div, this.parent.getPager());\n    } else {\n      this.parent.element.appendChild(div);\n    }\n  };\n  /**\n   * The function is used to render grid footer table\n   */\n\n\n  FooterRenderer.prototype.renderTable = function () {\n    var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n    var innerDiv = this.createContentTable('_footer_table');\n    var table = innerDiv.querySelector('.e-table');\n    var tFoot = this.parent.createElement('tfoot');\n    table.appendChild(tFoot);\n\n    if (this.parent.isFrozenGrid()) {\n      var freezeTable = table.cloneNode(true);\n      var frTable = table.cloneNode(true);\n\n      if (frzCols) {\n        this.frozenContent.appendChild(freezeTable);\n        this.freezeTable = freezeTable;\n      }\n\n      if (this.parent.getFrozenRightColumnsCount()) {\n        remove(frTable.querySelector('colgroup'));\n        var hdr = this.parent.getHeaderContent().querySelector('.e-frozen-right-header');\n        var frCol = hdr.querySelector('colgroup').cloneNode(true);\n        frTable.insertBefore(frCol, frTable.querySelector('tbody'));\n        this.frozenRightContent.appendChild(frTable);\n        this.frTable = frTable;\n      }\n\n      this.movableContent.appendChild(table);\n      remove(table.querySelector('colgroup'));\n      var colGroup = this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup').cloneNode(true);\n      table.insertBefore(colGroup, table.querySelector('tbody'));\n      this.setColGroup(colGroup);\n    }\n\n    this.setTable(table);\n  };\n\n  FooterRenderer.prototype.renderSummaryContent = function (e, table, cStart, cEnd) {\n    var input = this.parent.dataSource instanceof Array ? this.parent.dataSource : this.parent.currentViewData;\n    var summaries = this.modelGenerator.getData();\n    var dummies = isNullOrUndefined(cStart) ? this.modelGenerator.getColumns() : this.modelGenerator.getColumns(cStart, cEnd);\n    var rows = isNullOrUndefined(cStart) ? this.modelGenerator.generateRows(input, e || this.aggregates) : this.modelGenerator.generateRows(input, e || this.aggregates, cStart, cEnd);\n    var fragment = document.createDocumentFragment();\n    var rowrenderer = new RowRenderer(this.locator, null, this.parent);\n    rowrenderer.element = this.parent.createElement('TR', {\n      className: 'e-summaryrow'\n    });\n\n    for (var srow = 0, len = summaries.length; srow < len; srow++) {\n      var row = rows[srow];\n\n      if (!row) {\n        continue;\n      }\n\n      var tr = rowrenderer.render(row, dummies);\n      fragment.appendChild(tr);\n    }\n\n    table.tFoot.appendChild(fragment);\n    this.aggregates = !isNullOrUndefined(e) ? e : this.aggregates;\n  };\n\n  FooterRenderer.prototype.refresh = function (e) {\n    var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n    var movable = this.parent.getMovableColumnsCount();\n    var right = this.parent.getFrozenRightColumnsCount();\n\n    if (this.parent.isFrozenGrid()) {\n      remove(this.getPanel());\n      this.renderPanel();\n      this.renderTable();\n\n      if (frzCols) {\n        this.freezeTable.tFoot.innerHTML = '';\n        this.renderSummaryContent(e, this.freezeTable, 0, frzCols);\n      }\n    }\n\n    this.getTable().tFoot.innerHTML = '';\n    this.renderSummaryContent(e, this.getTable(), frzCols, right ? frzCols + movable : undefined);\n\n    if (this.parent.getFrozenRightColumnsCount()) {\n      this.frTable.tFoot.innerHTML = '';\n      this.renderSummaryContent(e, this.frTable, frzCols + movable, frzCols + movable + right);\n      var movableLastCell = [].slice.call(this.getTable().querySelectorAll('.e-lastsummarycell'));\n\n      if (movableLastCell.length) {\n        for (var i = 0; i < movableLastCell.length; i++) {\n          movableLastCell[i].style.borderRight = '0px';\n        }\n      }\n    } // check freeze content have no row case\n\n\n    if (this.parent.isFrozenGrid()) {\n      var movableCnt = [].slice.call(this.parent.element.querySelector('.e-movablefootercontent').querySelectorAll('.e-summaryrow'));\n      var frozenCnt = void 0;\n\n      if (frzCols) {\n        frozenCnt = [].slice.call(this.parent.element.querySelector('.e-frozen-left-footercontent').querySelectorAll('.e-summaryrow'));\n        this.refreshHeight(frozenCnt, movableCnt);\n        var frozenDiv = this.frozenContent;\n\n        if (!frozenDiv.offsetHeight) {\n          frozenDiv.style.height = this.getTable().offsetHeight + 'px';\n        }\n      }\n\n      if (right) {\n        var frCnt = [].slice.call(this.parent.element.querySelector('.e-frozen-right-footercontent').querySelectorAll('.e-summaryrow'));\n        this.refreshHeight(frCnt, movableCnt);\n\n        if (frozenCnt) {\n          this.refreshHeight(frCnt, frozenCnt);\n        }\n\n        var frDiv = this.frTable;\n\n        if (!frDiv.offsetHeight) {\n          frDiv.style.height = this.getTable().offsetHeight + 'px';\n        }\n      }\n\n      if (this.parent.allowResizing) {\n        this.updateFooterTableWidth(this.getTable());\n      }\n    }\n\n    this.onScroll();\n  };\n\n  FooterRenderer.prototype.refreshHeight = function (frozenCnt, movableCnt) {\n    for (var i = 0; i < frozenCnt.length; i++) {\n      var frozenHeight = frozenCnt[i].getBoundingClientRect().height;\n      var movableHeight = movableCnt[i].getBoundingClientRect().height;\n\n      if (frozenHeight < movableHeight) {\n        frozenCnt[i].classList.remove('e-hide');\n        frozenCnt[i].style.height = movableHeight + 'px';\n      } else if (frozenHeight > movableHeight) {\n        movableCnt[i].classList.remove('e-hide');\n        movableCnt[i].style.height = frozenHeight + 'px';\n      }\n    }\n  };\n\n  FooterRenderer.prototype.refreshCol = function () {\n    // frozen table \n    var mheaderCol;\n    var fheaderCol = mheaderCol = this.parent.element.querySelector('.e-gridheader').querySelector('colgroup').cloneNode(true);\n\n    if (this.parent.getFrozenColumns()) {\n      var isXaxis = this.parent.enableColumnVirtualization && this.parent.contentModule.isXaxis();\n\n      if (isXaxis) {\n        mheaderCol = this.parent.getMovableVirtualHeader().querySelector('colgroup').cloneNode(true);\n      } else {\n        mheaderCol = renderMovable(fheaderCol, this.parent.getFrozenColumns(), this.parent);\n        this.freezeTable.replaceChild(fheaderCol, this.freezeTable.querySelector('colGroup'));\n      }\n    }\n\n    this.getTable().replaceChild(mheaderCol, this.getColGroup());\n    this.setColGroup(mheaderCol);\n  };\n\n  FooterRenderer.prototype.onWidthChange = function (args) {\n    this.getColFromIndex(args.index).style.width = formatUnit(args.width);\n\n    if (this.parent.allowResizing && args.module === 'resize') {\n      this.updateFooterTableWidth(this.getTable());\n    }\n  };\n\n  FooterRenderer.prototype.onScroll = function (e) {\n    if (e === void 0) {\n      e = {\n        left: this.parent.isFrozenGrid() ? this.parent.getContent().querySelector('.e-movablecontent').scrollLeft : this.parent.getContent().firstChild.scrollLeft\n      };\n    }\n\n    this.getTable().parentElement.scrollLeft = e.left;\n  };\n\n  FooterRenderer.prototype.getColFromIndex = function (index) {\n    var fCol = this.parent.getFrozenColumns();\n    fCol = fCol && this.parent.isRowDragable() ? fCol + 1 : fCol;\n\n    if (fCol && fCol > index) {\n      return this.freezeTable.querySelector('colGroup').children[index];\n    }\n\n    return this.getColGroup().children[index - fCol];\n  };\n\n  FooterRenderer.prototype.columnVisibilityChanged = function () {\n    this.refresh();\n  };\n\n  FooterRenderer.prototype.addEventListener = function () {\n    this.parent.on(colGroupRefresh, this.refreshCol, this);\n    this.parent.on(columnWidthChanged, this.onWidthChange, this);\n    this.parent.on(scroll, this.onScroll, this);\n    this.parent.on(columnVisibilityChanged, this.columnVisibilityChanged, this);\n    this.parent.on(refreshFooterRenderer, this.refreshFooterRenderer, this);\n  };\n\n  FooterRenderer.prototype.removeEventListener = function () {\n    this.parent.off(colGroupRefresh, this.refreshCol);\n    this.parent.off(columnWidthChanged, this.onWidthChange);\n    this.parent.off(scroll, this.onScroll);\n    this.parent.off(columnVisibilityChanged, this.columnVisibilityChanged);\n    this.parent.off(refreshFooterRenderer, this.refreshFooterRenderer);\n  };\n\n  FooterRenderer.prototype.updateFooterTableWidth = function (tFoot) {\n    var tHead = this.parent.getHeaderTable();\n\n    if (tHead && tFoot) {\n      tFoot.style.width = tHead.style.width;\n    }\n  };\n\n  FooterRenderer.prototype.refreshFooterRenderer = function (editedData) {\n    var aggregates = this.onAggregates(editedData);\n    this.refresh(aggregates);\n  };\n\n  FooterRenderer.prototype.getIndexByKey = function (data, ds) {\n    var key = this.parent.getPrimaryKeyFieldNames()[0];\n\n    for (var i = 0; i < ds.length; i++) {\n      if (ds[i][key] === data[key]) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  FooterRenderer.prototype.onAggregates = function (editedData) {\n    editedData = editedData instanceof Array ? editedData : [];\n    var field = this.parent.getPrimaryKeyFieldNames()[0];\n    var dataSource = [];\n    var isModified = false;\n    var batchChanges = {};\n    var gridData = 'dataSource';\n    var changedRecords = 'changedRecords';\n    var addedRecords = 'addedRecords';\n    var deletedRecords = 'deletedRecords';\n    var currentViewData = this.parent.dataSource instanceof Array ? this.parent.dataSource : this.parent.dataSource[gridData].json.length ? this.parent.dataSource[gridData].json : this.parent.getCurrentViewRecords();\n\n    if (this.parent.editModule) {\n      batchChanges = this.parent.editModule.getBatchChanges();\n    }\n\n    if (Object.keys(batchChanges).length) {\n      for (var i = 0; i < currentViewData.length; i++) {\n        isModified = false;\n\n        if (batchChanges[changedRecords].length && this.getIndexByKey(currentViewData[i], batchChanges[changedRecords]) > -1) {\n          isModified = true;\n          dataSource.push(batchChanges[changedRecords][this.getIndexByKey(currentViewData[i], batchChanges[changedRecords])]);\n        }\n\n        if (batchChanges[deletedRecords].length && this.getIndexByKey(currentViewData[i], batchChanges[deletedRecords]) > -1) {\n          isModified = true;\n        } else if (!isModified) {\n          dataSource.push(currentViewData[i]);\n        }\n      }\n\n      if (batchChanges[addedRecords].length) {\n        for (var i = 0; i < batchChanges[addedRecords].length; i++) {\n          dataSource.push(batchChanges[addedRecords][i]);\n        }\n      }\n    } else {\n      if (editedData.length) {\n        var data = iterateExtend(currentViewData);\n        dataSource = data.map(function (item) {\n          var idVal = DataUtil.getObject(field, item);\n          var value;\n          var hasVal = editedData.some(function (cItem) {\n            value = cItem;\n            return idVal === DataUtil.getObject(field, cItem);\n          });\n          return hasVal ? value : item;\n        });\n      } else {\n        dataSource = currentViewData;\n      }\n    }\n\n    var eData = editedData;\n\n    if (eData.type && eData.type === 'cancel') {\n      dataSource = currentViewData;\n    }\n\n    var aggregate = {};\n    var agrVal;\n    var aggregateRows = this.parent.aggregates;\n\n    for (var i = 0; i < aggregateRows.length; i++) {\n      for (var j = 0; j < aggregateRows[i].columns.length; j++) {\n        var data = [];\n        var type = aggregateRows[i].columns[j].type.toString();\n        data = dataSource;\n        agrVal = calculateAggregate(type, data, aggregateRows[i].columns[j], this.parent);\n        aggregate[aggregateRows[i].columns[j].field + ' - ' + type.toLowerCase()] = agrVal;\n      }\n    }\n\n    var result = {\n      result: dataSource,\n      count: dataSource.length,\n      aggregates: aggregate\n    };\n    return result;\n  };\n\n  return FooterRenderer;\n}(ContentRender);\n\nexport { FooterRenderer };","map":{"version":3,"sources":["C:/Users/appsk/Documents/Projects/PredictiveMaintenance/React PDM/env/frontend/node_modules/@syncfusion/ej2-grids/src/grid/renderer/footer-renderer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","isNullOrUndefined","remove","formatUnit","Browser","colGroupRefresh","columnWidthChanged","scroll","columnVisibilityChanged","refreshFooterRenderer","ContentRender","RowRenderer","SummaryModelGenerator","renderMovable","calculateAggregate","iterateExtend","DataUtil","FooterRenderer","_super","gridModule","serviceLocator","_this","call","aggregates","parent","locator","modelGenerator","addEventListener","renderPanel","div","createElement","className","innerDiv","movableContent","isFrozenGrid","fDiv","mDiv","frDiv","getFrozenColumns","getFrozenLeftColumnsCount","appendChild","frozenContent","getFrozenRightColumnsCount","frozenRightContent","isDevice","style","overflowX","setPanel","getPager","element","insertBefore","renderTable","frzCols","createContentTable","table","querySelector","tFoot","freezeTable","cloneNode","frTable","hdr","getHeaderContent","frCol","colGroup","setColGroup","setTable","renderSummaryContent","e","cStart","cEnd","input","dataSource","currentViewData","summaries","getData","dummies","getColumns","rows","generateRows","fragment","document","createDocumentFragment","rowrenderer","srow","len","length","row","tr","render","refresh","movable","getMovableColumnsCount","right","getPanel","innerHTML","getTable","undefined","movableLastCell","slice","querySelectorAll","i","borderRight","movableCnt","frozenCnt","refreshHeight","frozenDiv","offsetHeight","height","frCnt","allowResizing","updateFooterTableWidth","onScroll","frozenHeight","getBoundingClientRect","movableHeight","classList","refreshCol","mheaderCol","fheaderCol","isXaxis","enableColumnVirtualization","contentModule","getMovableVirtualHeader","replaceChild","getColGroup","onWidthChange","args","getColFromIndex","index","width","module","left","getContent","scrollLeft","firstChild","parentElement","fCol","isRowDragable","children","on","removeEventListener","off","tHead","getHeaderTable","editedData","onAggregates","getIndexByKey","data","ds","key","getPrimaryKeyFieldNames","field","isModified","batchChanges","gridData","changedRecords","addedRecords","deletedRecords","json","getCurrentViewRecords","editModule","getBatchChanges","keys","push","map","item","idVal","getObject","value","hasVal","some","cItem","eData","type","aggregate","agrVal","aggregateRows","j","columns","toString","toLowerCase","result","count"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { isNullOrUndefined, remove } from '@syncfusion/ej2-base';\nimport { formatUnit } from '@syncfusion/ej2-base';\nimport { Browser } from '@syncfusion/ej2-base';\nimport { colGroupRefresh, columnWidthChanged, scroll, columnVisibilityChanged, refreshFooterRenderer } from '../base/constant';\nimport { ContentRender } from './content-renderer';\nimport { RowRenderer } from './row-renderer';\nimport { SummaryModelGenerator } from '../services/summary-model-generator';\nimport { renderMovable, calculateAggregate, iterateExtend } from '../base/util';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * Footer module is used to render grid content\n * @hidden\n */\nvar FooterRenderer = /** @class */ (function (_super) {\n    __extends(FooterRenderer, _super);\n    function FooterRenderer(gridModule, serviceLocator) {\n        var _this = _super.call(this, gridModule, serviceLocator) || this;\n        _this.aggregates = {};\n        _this.parent = gridModule;\n        _this.locator = serviceLocator;\n        _this.modelGenerator = new SummaryModelGenerator(_this.parent);\n        _this.addEventListener();\n        return _this;\n    }\n    /**\n     * The function is used to render grid footer div\n     */\n    FooterRenderer.prototype.renderPanel = function () {\n        var div = this.parent.createElement('div', { className: 'e-gridfooter' });\n        var innerDiv = this.parent.createElement('div', { className: 'e-summarycontent' });\n        var movableContent = innerDiv;\n        if (this.parent.isFrozenGrid()) {\n            var fDiv = this.parent.createElement('div', { className: 'e-frozenfootercontent e-frozen-left-footercontent' });\n            var mDiv = this.parent.createElement('div', { className: 'e-movablefootercontent' });\n            var frDiv = this.parent.createElement('div', { className: 'e-frozenfootercontent e-frozen-right-footercontent' });\n            if (this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount()) {\n                innerDiv.appendChild(fDiv);\n                this.frozenContent = fDiv;\n            }\n            innerDiv.appendChild(mDiv);\n            this.movableContent = mDiv;\n            movableContent = mDiv;\n            if (this.parent.getFrozenRightColumnsCount()) {\n                innerDiv.appendChild(frDiv);\n                this.frozenRightContent = frDiv;\n            }\n        }\n        if (Browser.isDevice) {\n            movableContent.style.overflowX = 'scroll';\n        }\n        div.appendChild(innerDiv);\n        this.setPanel(div);\n        if (this.parent.getPager() != null) {\n            this.parent.element.insertBefore(div, this.parent.getPager());\n        }\n        else {\n            this.parent.element.appendChild(div);\n        }\n    };\n    /**\n     * The function is used to render grid footer table\n     */\n    FooterRenderer.prototype.renderTable = function () {\n        var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n        var innerDiv = this.createContentTable('_footer_table');\n        var table = innerDiv.querySelector('.e-table');\n        var tFoot = this.parent.createElement('tfoot');\n        table.appendChild(tFoot);\n        if (this.parent.isFrozenGrid()) {\n            var freezeTable = table.cloneNode(true);\n            var frTable = table.cloneNode(true);\n            if (frzCols) {\n                this.frozenContent.appendChild(freezeTable);\n                this.freezeTable = freezeTable;\n            }\n            if (this.parent.getFrozenRightColumnsCount()) {\n                remove(frTable.querySelector('colgroup'));\n                var hdr = this.parent.getHeaderContent().querySelector('.e-frozen-right-header');\n                var frCol = (hdr.querySelector('colgroup').cloneNode(true));\n                frTable.insertBefore(frCol, frTable.querySelector('tbody'));\n                this.frozenRightContent.appendChild(frTable);\n                this.frTable = frTable;\n            }\n            this.movableContent.appendChild(table);\n            remove(table.querySelector('colgroup'));\n            var colGroup = ((this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup')).cloneNode(true));\n            table.insertBefore(colGroup, table.querySelector('tbody'));\n            this.setColGroup(colGroup);\n        }\n        this.setTable(table);\n    };\n    FooterRenderer.prototype.renderSummaryContent = function (e, table, cStart, cEnd) {\n        var input = this.parent.dataSource instanceof Array ? this.parent.dataSource : this.parent.currentViewData;\n        var summaries = this.modelGenerator.getData();\n        var dummies = isNullOrUndefined(cStart) ? this.modelGenerator.getColumns() :\n            this.modelGenerator.getColumns(cStart, cEnd);\n        var rows = isNullOrUndefined(cStart) ? this.modelGenerator.generateRows(input, e || this.aggregates) :\n            this.modelGenerator.generateRows(input, e || this.aggregates, cStart, cEnd);\n        var fragment = document.createDocumentFragment();\n        var rowrenderer = new RowRenderer(this.locator, null, this.parent);\n        rowrenderer.element = this.parent.createElement('TR', { className: 'e-summaryrow' });\n        for (var srow = 0, len = summaries.length; srow < len; srow++) {\n            var row = rows[srow];\n            if (!row) {\n                continue;\n            }\n            var tr = rowrenderer.render(row, dummies);\n            fragment.appendChild(tr);\n        }\n        table.tFoot.appendChild(fragment);\n        this.aggregates = !isNullOrUndefined(e) ? e : this.aggregates;\n    };\n    FooterRenderer.prototype.refresh = function (e) {\n        var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount();\n        var movable = this.parent.getMovableColumnsCount();\n        var right = this.parent.getFrozenRightColumnsCount();\n        if (this.parent.isFrozenGrid()) {\n            remove(this.getPanel());\n            this.renderPanel();\n            this.renderTable();\n            if (frzCols) {\n                this.freezeTable.tFoot.innerHTML = '';\n                this.renderSummaryContent(e, this.freezeTable, 0, frzCols);\n            }\n        }\n        this.getTable().tFoot.innerHTML = '';\n        this.renderSummaryContent(e, this.getTable(), frzCols, right ? frzCols + movable : undefined);\n        if (this.parent.getFrozenRightColumnsCount()) {\n            this.frTable.tFoot.innerHTML = '';\n            this.renderSummaryContent(e, this.frTable, frzCols + movable, frzCols + movable + right);\n            var movableLastCell = [].slice.call(this.getTable().querySelectorAll('.e-lastsummarycell'));\n            if (movableLastCell.length) {\n                for (var i = 0; i < movableLastCell.length; i++) {\n                    movableLastCell[i].style.borderRight = '0px';\n                }\n            }\n        }\n        // check freeze content have no row case\n        if (this.parent.isFrozenGrid()) {\n            var movableCnt = [].slice.call(this.parent.element.querySelector('.e-movablefootercontent')\n                .querySelectorAll('.e-summaryrow'));\n            var frozenCnt = void 0;\n            if (frzCols) {\n                frozenCnt = [].slice.call(this.parent.element.querySelector('.e-frozen-left-footercontent')\n                    .querySelectorAll('.e-summaryrow'));\n                this.refreshHeight(frozenCnt, movableCnt);\n                var frozenDiv = this.frozenContent;\n                if (!frozenDiv.offsetHeight) {\n                    frozenDiv.style.height = this.getTable().offsetHeight + 'px';\n                }\n            }\n            if (right) {\n                var frCnt = [].slice.call(this.parent.element.querySelector('.e-frozen-right-footercontent')\n                    .querySelectorAll('.e-summaryrow'));\n                this.refreshHeight(frCnt, movableCnt);\n                if (frozenCnt) {\n                    this.refreshHeight(frCnt, frozenCnt);\n                }\n                var frDiv = this.frTable;\n                if (!frDiv.offsetHeight) {\n                    frDiv.style.height = this.getTable().offsetHeight + 'px';\n                }\n            }\n            if (this.parent.allowResizing) {\n                this.updateFooterTableWidth(this.getTable());\n            }\n        }\n        this.onScroll();\n    };\n    FooterRenderer.prototype.refreshHeight = function (frozenCnt, movableCnt) {\n        for (var i = 0; i < frozenCnt.length; i++) {\n            var frozenHeight = frozenCnt[i].getBoundingClientRect().height;\n            var movableHeight = movableCnt[i].getBoundingClientRect().height;\n            if (frozenHeight < movableHeight) {\n                frozenCnt[i].classList.remove('e-hide');\n                frozenCnt[i].style.height = movableHeight + 'px';\n            }\n            else if (frozenHeight > movableHeight) {\n                movableCnt[i].classList.remove('e-hide');\n                movableCnt[i].style.height = frozenHeight + 'px';\n            }\n        }\n    };\n    FooterRenderer.prototype.refreshCol = function () {\n        // frozen table \n        var mheaderCol;\n        var fheaderCol = mheaderCol = this.parent.element.querySelector('.e-gridheader').querySelector('colgroup').cloneNode(true);\n        if (this.parent.getFrozenColumns()) {\n            var isXaxis = this.parent.enableColumnVirtualization && this.parent.contentModule.isXaxis();\n            if (isXaxis) {\n                mheaderCol = this.parent.getMovableVirtualHeader().querySelector('colgroup').cloneNode(true);\n            }\n            else {\n                mheaderCol = renderMovable(fheaderCol, this.parent.getFrozenColumns(), this.parent);\n                this.freezeTable.replaceChild(fheaderCol, this.freezeTable.querySelector('colGroup'));\n            }\n        }\n        this.getTable().replaceChild(mheaderCol, this.getColGroup());\n        this.setColGroup(mheaderCol);\n    };\n    FooterRenderer.prototype.onWidthChange = function (args) {\n        this.getColFromIndex(args.index).style.width = formatUnit(args.width);\n        if (this.parent.allowResizing && args.module === 'resize') {\n            this.updateFooterTableWidth(this.getTable());\n        }\n    };\n    FooterRenderer.prototype.onScroll = function (e) {\n        if (e === void 0) { e = {\n            left: this.parent.isFrozenGrid() ? this.parent.getContent().querySelector('.e-movablecontent').scrollLeft :\n                this.parent.getContent().firstChild.scrollLeft\n        }; }\n        this.getTable().parentElement.scrollLeft = e.left;\n    };\n    FooterRenderer.prototype.getColFromIndex = function (index) {\n        var fCol = this.parent.getFrozenColumns();\n        fCol = fCol && this.parent.isRowDragable() ? fCol + 1 : fCol;\n        if (fCol && fCol > index) {\n            return this.freezeTable.querySelector('colGroup').children[index];\n        }\n        return this.getColGroup().children[index - fCol];\n    };\n    FooterRenderer.prototype.columnVisibilityChanged = function () {\n        this.refresh();\n    };\n    FooterRenderer.prototype.addEventListener = function () {\n        this.parent.on(colGroupRefresh, this.refreshCol, this);\n        this.parent.on(columnWidthChanged, this.onWidthChange, this);\n        this.parent.on(scroll, this.onScroll, this);\n        this.parent.on(columnVisibilityChanged, this.columnVisibilityChanged, this);\n        this.parent.on(refreshFooterRenderer, this.refreshFooterRenderer, this);\n    };\n    FooterRenderer.prototype.removeEventListener = function () {\n        this.parent.off(colGroupRefresh, this.refreshCol);\n        this.parent.off(columnWidthChanged, this.onWidthChange);\n        this.parent.off(scroll, this.onScroll);\n        this.parent.off(columnVisibilityChanged, this.columnVisibilityChanged);\n        this.parent.off(refreshFooterRenderer, this.refreshFooterRenderer);\n    };\n    FooterRenderer.prototype.updateFooterTableWidth = function (tFoot) {\n        var tHead = this.parent.getHeaderTable();\n        if (tHead && tFoot) {\n            tFoot.style.width = tHead.style.width;\n        }\n    };\n    FooterRenderer.prototype.refreshFooterRenderer = function (editedData) {\n        var aggregates = this.onAggregates(editedData);\n        this.refresh(aggregates);\n    };\n    FooterRenderer.prototype.getIndexByKey = function (data, ds) {\n        var key = this.parent.getPrimaryKeyFieldNames()[0];\n        for (var i = 0; i < ds.length; i++) {\n            if (ds[i][key] === data[key]) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    FooterRenderer.prototype.onAggregates = function (editedData) {\n        editedData = editedData instanceof Array ? editedData : [];\n        var field = this.parent.getPrimaryKeyFieldNames()[0];\n        var dataSource = [];\n        var isModified = false;\n        var batchChanges = {};\n        var gridData = 'dataSource';\n        var changedRecords = 'changedRecords';\n        var addedRecords = 'addedRecords';\n        var deletedRecords = 'deletedRecords';\n        var currentViewData = this.parent.dataSource instanceof Array ?\n            this.parent.dataSource : this.parent.dataSource[gridData].json.length\n            ? this.parent.dataSource[gridData].json : this.parent.getCurrentViewRecords();\n        if (this.parent.editModule) {\n            batchChanges = this.parent.editModule.getBatchChanges();\n        }\n        if (Object.keys(batchChanges).length) {\n            for (var i = 0; i < currentViewData.length; i++) {\n                isModified = false;\n                if (batchChanges[changedRecords].length && this.getIndexByKey(currentViewData[i], batchChanges[changedRecords]) > -1) {\n                    isModified = true;\n                    dataSource.push(batchChanges[changedRecords][this.getIndexByKey(currentViewData[i], batchChanges[changedRecords])]);\n                }\n                if (batchChanges[deletedRecords].length && this.getIndexByKey(currentViewData[i], batchChanges[deletedRecords]) > -1) {\n                    isModified = true;\n                }\n                else if (!isModified) {\n                    dataSource.push(currentViewData[i]);\n                }\n            }\n            if (batchChanges[addedRecords].length) {\n                for (var i = 0; i < batchChanges[addedRecords].length; i++) {\n                    dataSource.push(batchChanges[addedRecords][i]);\n                }\n            }\n        }\n        else {\n            if (editedData.length) {\n                var data = iterateExtend(currentViewData);\n                dataSource = data.map(function (item) {\n                    var idVal = DataUtil.getObject(field, item);\n                    var value;\n                    var hasVal = editedData.some(function (cItem) {\n                        value = cItem;\n                        return idVal === DataUtil.getObject(field, cItem);\n                    });\n                    return hasVal ? value : item;\n                });\n            }\n            else {\n                dataSource = currentViewData;\n            }\n        }\n        var eData = editedData;\n        if ((eData.type && eData.type === 'cancel')) {\n            dataSource = currentViewData;\n        }\n        var aggregate = {};\n        var agrVal;\n        var aggregateRows = this.parent.aggregates;\n        for (var i = 0; i < aggregateRows.length; i++) {\n            for (var j = 0; j < aggregateRows[i].columns.length; j++) {\n                var data = [];\n                var type = aggregateRows[i].columns[j].type.toString();\n                data = dataSource;\n                agrVal = calculateAggregate(type, data, aggregateRows[i].columns[j], this.parent);\n                aggregate[aggregateRows[i].columns[j].field + ' - ' + type.toLowerCase()] = agrVal;\n            }\n        }\n        var result = {\n            result: dataSource,\n            count: dataSource.length,\n            aggregates: aggregate\n        };\n        return result;\n    };\n    return FooterRenderer;\n}(ContentRender));\nexport { FooterRenderer };\n"]},"metadata":{},"sourceType":"module"}