{"ast":null,"code":"import { Browser, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { isGroupAdaptive } from '../base/util';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { GroupModelGenerator } from '../services/group-model-generator';\n/**\n * Content module is used to render grid content\n */\n\nvar VirtualRowModelGenerator =\n/** @class */\nfunction () {\n  function VirtualRowModelGenerator(parent) {\n    this.cOffsets = {};\n    this.cache = {};\n    this.movableCache = {};\n    this.frozenRightCache = {};\n    this.rowCache = {};\n    this.data = {};\n    this.groups = {};\n    this.parent = parent;\n    this.model = this.parent.pageSettings;\n    this.rowModelGenerator = this.parent.allowGrouping ? new GroupModelGenerator(this.parent) : new RowModelGenerator(this.parent);\n  } // tslint:disable-next-line:max-func-body-length\n\n\n  VirtualRowModelGenerator.prototype.generateRows = function (data, e) {\n    var isFrozen = this.parent.isFrozenGrid();\n    var info = e.virtualInfo = e.virtualInfo || this.getData();\n    var xAxis = info.sentinelInfo && info.sentinelInfo.axis === 'X';\n    var page = !xAxis && info.loadNext && !info.loadSelf ? info.nextInfo.page : info.page;\n    var result = [];\n    var center = ~~(this.model.pageSize / 2);\n    var indexes = this.getBlockIndexes(page);\n    var loadedBlocks = [];\n\n    if (isFrozen && this.parent.getTablesCount() === 2 && !e.renderMovableContent || this.parent.getTablesCount() === 3 && !e.renderMovableContent && !e.renderFrozenRightContent || !isFrozen) {\n      this.checkAndResetCache(e.requestType);\n    }\n\n    if (isGroupAdaptive(this.parent) && this.parent.vcRows.length) {\n      return result = this.parent.vcRows;\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      for (var i = 0; i < info.blockIndexes.length; i++) {\n        if (this.isBlockAvailable(info.blockIndexes[i])) {\n          this.cache[info.blockIndexes[i]] = this.rowModelGenerator.refreshRows(this.cache[info.blockIndexes[i]]);\n        }\n\n        if (e.renderMovableContent && this.isMovableBlockAvailable(info.blockIndexes[i]) || e.renderFrozenRightContent && this.isFrozenRightBlockAvailable(info.blockIndexes[i])) {\n          var cache = e.renderMovableContent ? this.movableCache : this.frozenRightCache;\n          cache[info.blockIndexes[i]] = this.rowModelGenerator.refreshRows(cache[info.blockIndexes[i]]);\n        }\n      }\n    }\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      var virtualStartIdx = 'virtualStartIndex';\n      var startIndex = 'startIndex';\n      var endIndex = 'endIndex';\n\n      if (!e[virtualStartIdx] && Object.keys(this.rowCache).length === 0) {\n        for (var i = 0; i < data.length; i++) {\n          var args = [];\n          args.push(data[i]);\n          this.rowCache[i] = this.rowModelGenerator.generateRows(args, {\n            startIndex: i\n          })[0];\n        }\n\n        var j = 0;\n\n        for (var i = 0; i < this.parent.pageSettings.pageSize; i++) {\n          result[j] = this.rowCache[i];\n          j++;\n        }\n      } else if (e[virtualStartIdx]) {\n        var virtualStartIndex = e[startIndex];\n        var cacheindex = [];\n\n        for (var i = 0; i < Object.keys(this.rowCache).length; i++) {\n          cacheindex.push(Number(Object.keys(this.rowCache)[i]));\n        }\n\n        for (var i = 0; i < data.length; i++) {\n          var args = [];\n          var check = cacheindex.indexOf(virtualStartIndex);\n          args.push(data[i]);\n\n          if (check === -1) {\n            this.rowCache[virtualStartIndex] = this.rowModelGenerator.generateRows(args, {\n              startIndex: virtualStartIndex\n            })[0];\n          }\n\n          virtualStartIndex++;\n        }\n      }\n\n      if (!isNullOrUndefined(e[virtualStartIdx])) {\n        var j = 0;\n\n        for (var i = e[startIndex]; i < e[endIndex]; i++) {\n          result[j] = this.rowCache[i];\n          j++;\n        }\n      }\n    } else {\n      var values = info.blockIndexes;\n\n      for (var i = 0; i < values.length; i++) {\n        if (!this.isBlockAvailable(values[i])) {\n          var rows = this.rowModelGenerator.generateRows(data, {\n            virtualInfo: info,\n            startIndex: this.getStartIndex(values[i], data)\n          });\n\n          if (isGroupAdaptive(this.parent) && !this.parent.vcRows.length) {\n            this.parent.vRows = rows;\n            this.parent.vcRows = rows;\n          }\n\n          var median = void 0;\n\n          if (isGroupAdaptive(this.parent)) {\n            median = this.model.pageSize / 2;\n\n            if (!this.isBlockAvailable(indexes[0])) {\n              this.cache[indexes[0]] = rows.slice(0, median);\n            }\n\n            if (!this.isBlockAvailable(indexes[1])) {\n              this.cache[indexes[1]] = rows.slice(median, this.model.pageSize);\n            }\n          } else {\n            median = ~~Math.max(rows.length, this.model.pageSize) / 2;\n\n            if (!this.isBlockAvailable(indexes[0])) {\n              this.cache[indexes[0]] = rows.slice(0, median);\n            }\n\n            if (!this.isBlockAvailable(indexes[1])) {\n              this.cache[indexes[1]] = rows.slice(median);\n            }\n          }\n        }\n\n        if (this.parent.groupSettings.columns.length && !xAxis && this.cache[values[i]]) {\n          this.cache[values[i]] = this.updateGroupRow(this.cache[values[i]], values[i]);\n        }\n\n        if (e.renderMovableContent && !this.isMovableBlockAvailable(values[i]) || e.renderFrozenRightContent && !this.isFrozenRightBlockAvailable(values[i])) {\n          var cache = e.renderMovableContent ? this.movableCache : this.frozenRightCache;\n          var rows = this.rowModelGenerator.generateRows(data, {\n            virtualInfo: info,\n            startIndex: this.getStartIndex(values[i], data)\n          });\n          var median = ~~Math.max(rows.length, this.model.pageSize) / 2;\n\n          if (e.renderFrozenRightContent && !this.isFrozenRightBlockAvailable(indexes[0]) || e.renderMovableContent && !this.isMovableBlockAvailable(indexes[0])) {\n            cache[indexes[0]] = rows.slice(0, median);\n          }\n\n          if (e.renderFrozenRightContent && !this.isFrozenRightBlockAvailable(indexes[1]) || e.renderMovableContent && !this.isMovableBlockAvailable(indexes[1])) {\n            cache[indexes[1]] = rows.slice(median);\n          }\n        }\n\n        if (!e.renderMovableContent && !e.renderFrozenRightContent && this.cache[values[i]]) {\n          result.push.apply(result, this.cache[values[i]]);\n        } else {\n          var cache = e.renderMovableContent ? this.movableCache : this.frozenRightCache;\n\n          if (cache[values[i]]) {\n            result.push.apply(result, cache[values[i]]);\n          }\n        }\n\n        if (this.isBlockAvailable(values[i])) {\n          loadedBlocks.push(values[i]);\n        }\n      }\n\n      info.blockIndexes = loadedBlocks;\n    }\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      var grouping = 'records';\n\n      if (this.parent.allowGrouping) {\n        this.parent.currentViewData[grouping] = result.map(function (m) {\n          return m.data;\n        });\n      } else if (isFrozen) {\n        if (e.renderMovableContent && (this.parent.getFrozenMode() === 'Left' || this.parent.getFrozenMode() === 'Right' || this.parent.getFrozenColumns()) || e.renderFrozenRightContent) {\n          this.parent.currentViewData = result.map(function (m) {\n            return m.data;\n          });\n        }\n      } else {\n        this.parent.currentViewData = result.map(function (m) {\n          return m.data;\n        });\n      }\n    }\n\n    return result;\n  };\n\n  VirtualRowModelGenerator.prototype.getBlockIndexes = function (page) {\n    return [page + (page - 1), page * 2];\n  };\n\n  VirtualRowModelGenerator.prototype.getPage = function (block) {\n    return block % 2 === 0 ? block / 2 : (block + 1) / 2;\n  };\n\n  VirtualRowModelGenerator.prototype.isBlockAvailable = function (value) {\n    return value in this.cache;\n  };\n\n  VirtualRowModelGenerator.prototype.isMovableBlockAvailable = function (value) {\n    return value in this.movableCache;\n  };\n\n  VirtualRowModelGenerator.prototype.isFrozenRightBlockAvailable = function (value) {\n    return value in this.frozenRightCache;\n  };\n\n  VirtualRowModelGenerator.prototype.getData = function () {\n    return {\n      page: this.model.currentPage,\n      blockIndexes: this.getBlockIndexes(this.model.currentPage),\n      direction: 'down',\n      columnIndexes: this.parent.getColumnIndexesInView()\n    };\n  };\n\n  VirtualRowModelGenerator.prototype.getStartIndex = function (blk, data, full) {\n    if (full === void 0) {\n      full = true;\n    }\n\n    var page = this.getPage(blk);\n    var even = blk % 2 === 0;\n    var index = (page - 1) * this.model.pageSize;\n    return full || !even ? index : index + ~~(this.model.pageSize / 2);\n  };\n\n  VirtualRowModelGenerator.prototype.getColumnIndexes = function (content) {\n    var _this = this;\n\n    if (content === void 0) {\n      content = this.parent.getHeaderContent().querySelector('.e-headercontent');\n    }\n\n    if (this.parent.isFrozenGrid()) {\n      content = content.querySelector('.e-movableheader');\n    }\n\n    var indexes = [];\n    var sLeft = content.scrollLeft | 0;\n    var keys = Object.keys(this.cOffsets);\n    var cWidth = content.getBoundingClientRect().width;\n    sLeft = Math.min(this.cOffsets[keys.length - 1] - cWidth, sLeft);\n    var calWidth = Browser.isDevice ? 2 * cWidth : cWidth / 2;\n    var left = sLeft + cWidth + (sLeft === 0 ? calWidth : 0);\n    keys.some(function (offset, indx, input) {\n      var iOffset = Number(offset);\n      var offsetVal = _this.cOffsets[offset];\n      var border = sLeft - calWidth <= offsetVal && left + calWidth >= offsetVal;\n\n      if (border) {\n        indexes.push(iOffset);\n      }\n\n      return left + calWidth < offsetVal;\n    });\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      this.parent.contentModule.startColIndex = indexes[0];\n      this.parent.contentModule.endColIndex = indexes[indexes.length - 1];\n    }\n\n    this.addFrozenIndex(indexes);\n    return indexes;\n  };\n\n  VirtualRowModelGenerator.prototype.addFrozenIndex = function (indexes) {\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization && indexes[0] === 0) {\n      for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n        indexes.push(indexes[indexes.length - 1] + 1);\n      }\n    }\n  };\n\n  VirtualRowModelGenerator.prototype.checkAndResetCache = function (action) {\n    var actions = ['paging', 'refresh', 'sorting', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', 'save', 'delete'];\n\n    if (this.parent.getFrozenColumns() && this.parent.frozenRows && this.parent.enableColumnVirtualization && action === 'reorder') {\n      actions.splice(actions.indexOf(action), 1);\n    }\n\n    var clear = actions.some(function (value) {\n      return action === value;\n    });\n\n    if (clear) {\n      this.cache = {};\n      this.data = {};\n      this.groups = {};\n      this.movableCache = {};\n      this.frozenRightCache = {};\n    }\n\n    return clear;\n  };\n\n  VirtualRowModelGenerator.prototype.refreshColOffsets = function () {\n    var _this = this;\n\n    var col = 0;\n    this.cOffsets = {};\n    var gLen = this.parent.groupSettings.columns.length;\n    var cols = this.parent.columns;\n    var cLen = cols.length;\n\n    var isVisible = function (column) {\n      return column.visible && (!_this.parent.groupSettings.showGroupedColumn ? _this.parent.groupSettings.columns.indexOf(column.field) < 0 : column.visible);\n    };\n\n    var c = this.parent.groupSettings.columns;\n\n    for (var i = 0; i < c.length; i++) {\n      this.cOffsets[i] = (this.cOffsets[i - 1] | 0) + 30;\n    }\n\n    var blocks = Array.apply(null, Array(cLen)).map(function () {\n      return col++;\n    });\n\n    for (var j = 0; j < blocks.length; j++) {\n      blocks[j] = blocks[j] + gLen;\n      this.cOffsets[blocks[j]] = (this.cOffsets[blocks[j] - 1] | 0) + (isVisible(cols[j]) ? parseInt(cols[j].width, 10) : 0);\n    }\n  };\n\n  VirtualRowModelGenerator.prototype.updateGroupRow = function (current, block) {\n    var currentFirst = current[0];\n    var rows = [];\n    var keys = Object.keys(this.cache);\n\n    for (var i = 0; i < keys.length; i++) {\n      if (Number(keys[i]) < block) {\n        rows = rows.concat(this.cache[keys[i]]);\n      }\n    }\n\n    if (currentFirst && currentFirst.isDataRow || block % 2 === 0) {\n      return current;\n    }\n\n    return this.iterateGroup(current, rows);\n  };\n\n  VirtualRowModelGenerator.prototype.iterateGroup = function (current, rows) {\n    var currentFirst = current[0];\n    var offset = 0;\n\n    if (currentFirst && currentFirst.isDataRow) {\n      return current;\n    }\n\n    var isPresent = current.some(function (row) {\n      return rows.some(function (oRow, index) {\n        var res = oRow && oRow.data.field !== undefined && oRow.data.field === row.data.field && oRow.data.key === row.data.key;\n\n        if (res) {\n          offset = index;\n        }\n\n        return res;\n      });\n    });\n\n    if (isPresent) {\n      current.shift();\n      current = this.iterateGroup(current, rows.slice(offset));\n    }\n\n    return current;\n  };\n\n  VirtualRowModelGenerator.prototype.getRows = function () {\n    var rows = [];\n    var isBlazorServerRendered = isBlazor() && this.parent.isServerRendered ? true : false;\n    var keys = isBlazorServerRendered ? Object.keys(this.rowCache) : Object.keys(this.cache);\n\n    for (var i = 0; i < keys.length; i++) {\n      rows = isBlazorServerRendered ? rows.concat(this.rowCache[keys[i]]) : rows.concat(this.cache[keys[i]]);\n    }\n\n    return rows;\n  };\n\n  return VirtualRowModelGenerator;\n}();\n\nexport { VirtualRowModelGenerator };","map":{"version":3,"sources":["C:/Users/appsk/Documents/Projects/PredictiveMaintenance/React PDM/env/frontend/node_modules/@syncfusion/ej2-grids/src/grid/services/virtual-row-model-generator.js"],"names":["Browser","isBlazor","isNullOrUndefined","isGroupAdaptive","RowModelGenerator","GroupModelGenerator","VirtualRowModelGenerator","parent","cOffsets","cache","movableCache","frozenRightCache","rowCache","data","groups","model","pageSettings","rowModelGenerator","allowGrouping","prototype","generateRows","e","isFrozen","isFrozenGrid","info","virtualInfo","getData","xAxis","sentinelInfo","axis","page","loadNext","loadSelf","nextInfo","result","center","pageSize","indexes","getBlockIndexes","loadedBlocks","getTablesCount","renderMovableContent","renderFrozenRightContent","checkAndResetCache","requestType","vcRows","length","enableColumnVirtualization","i","blockIndexes","isBlockAvailable","refreshRows","isMovableBlockAvailable","isFrozenRightBlockAvailable","isServerRendered","virtualStartIdx","startIndex","endIndex","Object","keys","args","push","j","virtualStartIndex","cacheindex","Number","check","indexOf","values","rows","getStartIndex","vRows","median","slice","Math","max","groupSettings","columns","updateGroupRow","apply","grouping","currentViewData","map","m","getFrozenMode","getFrozenColumns","getPage","block","value","currentPage","direction","columnIndexes","getColumnIndexesInView","blk","full","even","index","getColumnIndexes","content","_this","getHeaderContent","querySelector","sLeft","scrollLeft","cWidth","getBoundingClientRect","width","min","calWidth","isDevice","left","some","offset","indx","input","iOffset","offsetVal","border","contentModule","startColIndex","endColIndex","addFrozenIndex","action","actions","frozenRows","splice","clear","refreshColOffsets","col","gLen","cols","cLen","isVisible","column","visible","showGroupedColumn","field","c","blocks","Array","parseInt","current","currentFirst","concat","isDataRow","iterateGroup","isPresent","row","oRow","res","undefined","key","shift","getRows","isBlazorServerRendered"],"mappings":"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","sourcesContent":["import { Browser, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { isGroupAdaptive } from '../base/util';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { GroupModelGenerator } from '../services/group-model-generator';\n/**\n * Content module is used to render grid content\n */\nvar VirtualRowModelGenerator = /** @class */ (function () {\n    function VirtualRowModelGenerator(parent) {\n        this.cOffsets = {};\n        this.cache = {};\n        this.movableCache = {};\n        this.frozenRightCache = {};\n        this.rowCache = {};\n        this.data = {};\n        this.groups = {};\n        this.parent = parent;\n        this.model = this.parent.pageSettings;\n        this.rowModelGenerator = this.parent.allowGrouping ? new GroupModelGenerator(this.parent) : new RowModelGenerator(this.parent);\n    }\n    // tslint:disable-next-line:max-func-body-length\n    VirtualRowModelGenerator.prototype.generateRows = function (data, e) {\n        var isFrozen = this.parent.isFrozenGrid();\n        var info = e.virtualInfo = e.virtualInfo || this.getData();\n        var xAxis = info.sentinelInfo && info.sentinelInfo.axis === 'X';\n        var page = !xAxis && info.loadNext && !info.loadSelf ? info.nextInfo.page : info.page;\n        var result = [];\n        var center = ~~(this.model.pageSize / 2);\n        var indexes = this.getBlockIndexes(page);\n        var loadedBlocks = [];\n        if ((isFrozen && (this.parent.getTablesCount() === 2 && !e.renderMovableContent)\n            || this.parent.getTablesCount() === 3 && !e.renderMovableContent && !e.renderFrozenRightContent) || !isFrozen) {\n            this.checkAndResetCache(e.requestType);\n        }\n        if (isGroupAdaptive(this.parent) && this.parent.vcRows.length) {\n            return result = this.parent.vcRows;\n        }\n        if (this.parent.enableColumnVirtualization) {\n            for (var i = 0; i < info.blockIndexes.length; i++) {\n                if (this.isBlockAvailable(info.blockIndexes[i])) {\n                    this.cache[info.blockIndexes[i]] = this.rowModelGenerator.refreshRows(this.cache[info.blockIndexes[i]]);\n                }\n                if ((e.renderMovableContent && this.isMovableBlockAvailable(info.blockIndexes[i]))\n                    || (e.renderFrozenRightContent && this.isFrozenRightBlockAvailable(info.blockIndexes[i]))) {\n                    var cache = e.renderMovableContent\n                        ? this.movableCache : this.frozenRightCache;\n                    cache[info.blockIndexes[i]] = this.rowModelGenerator.refreshRows(cache[info.blockIndexes[i]]);\n                }\n            }\n        }\n        if (isBlazor() && this.parent.isServerRendered) {\n            var virtualStartIdx = 'virtualStartIndex';\n            var startIndex = 'startIndex';\n            var endIndex = 'endIndex';\n            if (!e[virtualStartIdx] && Object.keys(this.rowCache).length === 0) {\n                for (var i = 0; i < data.length; i++) {\n                    var args = [];\n                    args.push(data[i]);\n                    this.rowCache[i] = this.rowModelGenerator.generateRows(args, { startIndex: i })[0];\n                }\n                var j = 0;\n                for (var i = 0; i < this.parent.pageSettings.pageSize; i++) {\n                    result[j] = this.rowCache[i];\n                    j++;\n                }\n            }\n            else if (e[virtualStartIdx]) {\n                var virtualStartIndex = e[startIndex];\n                var cacheindex = [];\n                for (var i = 0; i < Object.keys(this.rowCache).length; i++) {\n                    cacheindex.push(Number(Object.keys(this.rowCache)[i]));\n                }\n                for (var i = 0; i < data.length; i++) {\n                    var args = [];\n                    var check = cacheindex.indexOf(virtualStartIndex);\n                    args.push(data[i]);\n                    if (check === -1) {\n                        this.rowCache[virtualStartIndex] = this.rowModelGenerator.generateRows(args, { startIndex: virtualStartIndex })[0];\n                    }\n                    virtualStartIndex++;\n                }\n            }\n            if (!isNullOrUndefined(e[virtualStartIdx])) {\n                var j = 0;\n                for (var i = e[startIndex]; i < e[endIndex]; i++) {\n                    result[j] = this.rowCache[i];\n                    j++;\n                }\n            }\n        }\n        else {\n            var values = info.blockIndexes;\n            for (var i = 0; i < values.length; i++) {\n                if (!this.isBlockAvailable(values[i])) {\n                    var rows = this.rowModelGenerator.generateRows(data, {\n                        virtualInfo: info, startIndex: this.getStartIndex(values[i], data)\n                    });\n                    if (isGroupAdaptive(this.parent) && !this.parent.vcRows.length) {\n                        this.parent.vRows = rows;\n                        this.parent.vcRows = rows;\n                    }\n                    var median = void 0;\n                    if (isGroupAdaptive(this.parent)) {\n                        median = this.model.pageSize / 2;\n                        if (!this.isBlockAvailable(indexes[0])) {\n                            this.cache[indexes[0]] = rows.slice(0, median);\n                        }\n                        if (!this.isBlockAvailable(indexes[1])) {\n                            this.cache[indexes[1]] = rows.slice(median, this.model.pageSize);\n                        }\n                    }\n                    else {\n                        median = ~~Math.max(rows.length, this.model.pageSize) / 2;\n                        if (!this.isBlockAvailable(indexes[0])) {\n                            this.cache[indexes[0]] = rows.slice(0, median);\n                        }\n                        if (!this.isBlockAvailable(indexes[1])) {\n                            this.cache[indexes[1]] = rows.slice(median);\n                        }\n                    }\n                }\n                if (this.parent.groupSettings.columns.length && !xAxis && this.cache[values[i]]) {\n                    this.cache[values[i]] = this.updateGroupRow(this.cache[values[i]], values[i]);\n                }\n                if ((e.renderMovableContent && !this.isMovableBlockAvailable(values[i]))\n                    || (e.renderFrozenRightContent && !this.isFrozenRightBlockAvailable(values[i]))) {\n                    var cache = e.renderMovableContent\n                        ? this.movableCache : this.frozenRightCache;\n                    var rows = this.rowModelGenerator.generateRows(data, {\n                        virtualInfo: info, startIndex: this.getStartIndex(values[i], data)\n                    });\n                    var median = ~~Math.max(rows.length, this.model.pageSize) / 2;\n                    if ((e.renderFrozenRightContent && !this.isFrozenRightBlockAvailable(indexes[0]))\n                        || (e.renderMovableContent && !this.isMovableBlockAvailable(indexes[0]))) {\n                        cache[indexes[0]] = rows.slice(0, median);\n                    }\n                    if ((e.renderFrozenRightContent && !this.isFrozenRightBlockAvailable(indexes[1]))\n                        || (e.renderMovableContent && !this.isMovableBlockAvailable(indexes[1]))) {\n                        cache[indexes[1]] = rows.slice(median);\n                    }\n                }\n                if (!e.renderMovableContent && !e.renderFrozenRightContent && this.cache[values[i]]) {\n                    result.push.apply(result, this.cache[values[i]]);\n                }\n                else {\n                    var cache = e.renderMovableContent\n                        ? this.movableCache : this.frozenRightCache;\n                    if (cache[values[i]]) {\n                        result.push.apply(result, cache[values[i]]);\n                    }\n                }\n                if (this.isBlockAvailable(values[i])) {\n                    loadedBlocks.push(values[i]);\n                }\n            }\n            info.blockIndexes = loadedBlocks;\n        }\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            var grouping = 'records';\n            if (this.parent.allowGrouping) {\n                this.parent.currentViewData[grouping] = result.map(function (m) { return m.data; });\n            }\n            else if (isFrozen) {\n                if ((e.renderMovableContent && (this.parent.getFrozenMode() === 'Left'\n                    || this.parent.getFrozenMode() === 'Right' || this.parent.getFrozenColumns())) || e.renderFrozenRightContent) {\n                    this.parent.currentViewData = result.map(function (m) { return m.data; });\n                }\n            }\n            else {\n                this.parent.currentViewData = result.map(function (m) { return m.data; });\n            }\n        }\n        return result;\n    };\n    VirtualRowModelGenerator.prototype.getBlockIndexes = function (page) {\n        return [page + (page - 1), page * 2];\n    };\n    VirtualRowModelGenerator.prototype.getPage = function (block) {\n        return block % 2 === 0 ? block / 2 : (block + 1) / 2;\n    };\n    VirtualRowModelGenerator.prototype.isBlockAvailable = function (value) {\n        return value in this.cache;\n    };\n    VirtualRowModelGenerator.prototype.isMovableBlockAvailable = function (value) {\n        return value in this.movableCache;\n    };\n    VirtualRowModelGenerator.prototype.isFrozenRightBlockAvailable = function (value) {\n        return value in this.frozenRightCache;\n    };\n    VirtualRowModelGenerator.prototype.getData = function () {\n        return {\n            page: this.model.currentPage,\n            blockIndexes: this.getBlockIndexes(this.model.currentPage),\n            direction: 'down',\n            columnIndexes: this.parent.getColumnIndexesInView()\n        };\n    };\n    VirtualRowModelGenerator.prototype.getStartIndex = function (blk, data, full) {\n        if (full === void 0) { full = true; }\n        var page = this.getPage(blk);\n        var even = blk % 2 === 0;\n        var index = (page - 1) * this.model.pageSize;\n        return full || !even ? index : index + ~~(this.model.pageSize / 2);\n    };\n    VirtualRowModelGenerator.prototype.getColumnIndexes = function (content) {\n        var _this = this;\n        if (content === void 0) { content = this.parent.getHeaderContent().querySelector('.e-headercontent'); }\n        if (this.parent.isFrozenGrid()) {\n            content = content.querySelector('.e-movableheader');\n        }\n        var indexes = [];\n        var sLeft = content.scrollLeft | 0;\n        var keys = Object.keys(this.cOffsets);\n        var cWidth = content.getBoundingClientRect().width;\n        sLeft = Math.min(this.cOffsets[keys.length - 1] - cWidth, sLeft);\n        var calWidth = Browser.isDevice ? 2 * cWidth : cWidth / 2;\n        var left = sLeft + cWidth + (sLeft === 0 ? calWidth : 0);\n        keys.some(function (offset, indx, input) {\n            var iOffset = Number(offset);\n            var offsetVal = _this.cOffsets[offset];\n            var border = sLeft - calWidth <= offsetVal && left + calWidth >= offsetVal;\n            if (border) {\n                indexes.push(iOffset);\n            }\n            return left + calWidth < offsetVal;\n        });\n        if (isBlazor() && this.parent.isServerRendered) {\n            this.parent.contentModule.startColIndex = indexes[0];\n            this.parent.contentModule.endColIndex = indexes[indexes.length - 1];\n        }\n        this.addFrozenIndex(indexes);\n        return indexes;\n    };\n    VirtualRowModelGenerator.prototype.addFrozenIndex = function (indexes) {\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization && indexes[0] === 0) {\n            for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n                indexes.push(indexes[indexes.length - 1] + 1);\n            }\n        }\n    };\n    VirtualRowModelGenerator.prototype.checkAndResetCache = function (action) {\n        var actions = ['paging', 'refresh', 'sorting', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder',\n            'save', 'delete'];\n        if (this.parent.getFrozenColumns() && this.parent.frozenRows && this.parent.enableColumnVirtualization && action === 'reorder') {\n            actions.splice(actions.indexOf(action), 1);\n        }\n        var clear = actions.some(function (value) { return action === value; });\n        if (clear) {\n            this.cache = {};\n            this.data = {};\n            this.groups = {};\n            this.movableCache = {};\n            this.frozenRightCache = {};\n        }\n        return clear;\n    };\n    VirtualRowModelGenerator.prototype.refreshColOffsets = function () {\n        var _this = this;\n        var col = 0;\n        this.cOffsets = {};\n        var gLen = this.parent.groupSettings.columns.length;\n        var cols = this.parent.columns;\n        var cLen = cols.length;\n        var isVisible = function (column) { return column.visible &&\n            (!_this.parent.groupSettings.showGroupedColumn ? _this.parent.groupSettings.columns.indexOf(column.field) < 0 : column.visible); };\n        var c = this.parent.groupSettings.columns;\n        for (var i = 0; i < c.length; i++) {\n            this.cOffsets[i] = (this.cOffsets[i - 1] | 0) + 30;\n        }\n        var blocks = Array.apply(null, Array(cLen)).map(function () { return col++; });\n        for (var j = 0; j < blocks.length; j++) {\n            blocks[j] = blocks[j] + gLen;\n            this.cOffsets[blocks[j]] = (this.cOffsets[blocks[j] - 1] | 0) + (isVisible(cols[j]) ? parseInt(cols[j].width, 10) : 0);\n        }\n    };\n    VirtualRowModelGenerator.prototype.updateGroupRow = function (current, block) {\n        var currentFirst = current[0];\n        var rows = [];\n        var keys = Object.keys(this.cache);\n        for (var i = 0; i < keys.length; i++) {\n            if (Number(keys[i]) < block) {\n                rows = rows.concat(this.cache[keys[i]]);\n            }\n        }\n        if ((currentFirst && currentFirst.isDataRow) || block % 2 === 0) {\n            return current;\n        }\n        return this.iterateGroup(current, rows);\n    };\n    VirtualRowModelGenerator.prototype.iterateGroup = function (current, rows) {\n        var currentFirst = current[0];\n        var offset = 0;\n        if (currentFirst && currentFirst.isDataRow) {\n            return current;\n        }\n        var isPresent = current.some(function (row) {\n            return rows.some(function (oRow, index) {\n                var res = oRow && oRow.data.field !== undefined && oRow.data.field === row.data.field &&\n                    oRow.data.key === row.data.key;\n                if (res) {\n                    offset = index;\n                }\n                return res;\n            });\n        });\n        if (isPresent) {\n            current.shift();\n            current = this.iterateGroup(current, rows.slice(offset));\n        }\n        return current;\n    };\n    VirtualRowModelGenerator.prototype.getRows = function () {\n        var rows = [];\n        var isBlazorServerRendered = isBlazor() && this.parent.isServerRendered ? true : false;\n        var keys = isBlazorServerRendered ? Object.keys(this.rowCache) : Object.keys(this.cache);\n        for (var i = 0; i < keys.length; i++) {\n            rows = isBlazorServerRendered ? rows.concat(this.rowCache[keys[i]]) : rows.concat(this.cache[keys[i]]);\n        }\n        return rows;\n    };\n    return VirtualRowModelGenerator;\n}());\nexport { VirtualRowModelGenerator };\n"]},"metadata":{},"sourceType":"module"}